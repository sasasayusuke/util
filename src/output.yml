.env.production: 'OPENAI_API_KEY=sk-XXXXXXXXXXXXXXXXXXXX

  CHAT_SERVICE_URL=http://chat:8001


  DEBUG=false

  LOG_LEVEL=INFO'
.env.development: 'OPENAI_API_KEY=sk-XXXXXXXXXXXXXXXXXXXX

  CHAT_SERVICE_URL=http://chat:8001


  DEBUG=true

  LOG_LEVEL=DEBUG'
README.md: '# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ


  FastAPI ã¨ OpenAI ã‚’çµ„ã¿åˆã‚ã›ãŸè»½é‡ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã™ã€‚API ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚’çµŒç”±ã—ã¦å„ã‚µãƒ¼ãƒ“ã‚¹ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã—ã€ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆã®
  Git ã‚µãƒ¼ãƒï¼ˆGiteaï¼‰ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚’è¡Œã„ã¾ã™ã€‚


  ---


  ### å‰ææ¡ä»¶


  - Docker ãŠã‚ˆã³ Docker Compose

  - OpenAI API ã‚­ãƒ¼


  ## ğŸ§± ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£


  - `chat-service`: FastAPI ã¨ OpenAI API ã‚’åˆ©ç”¨ã—ãŸãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

  - `api-gateway`: å„ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é©åˆ‡ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã—ã¾ã™ã€‚

  - `gitea`: è‡ªå‰ã§ãƒ›ã‚¹ãƒˆã™ã‚‹ Git ã‚µãƒ¼ãƒã¨ã—ã¦ã€å®‰å®šã—ãŸé‹ç”¨ã‚’å®Ÿç¾ã—ã¾ã™ã€‚ï¼ˆå¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã¯ä½¿ç”¨ã—ã¦ã„ã¾ã›ã‚“ï¼‰


  ## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ


  ```md

  microstack/

  â”œâ”€â”€ api-gateway/           # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‡¦ç†

  â”œâ”€â”€ chat-service/          # OpenAIã¨ã®é€£æºãƒãƒ£ãƒƒãƒˆã‚µãƒ¼ãƒ“ã‚¹

  â”œâ”€â”€ .devcontainer/         # DevContainer å®šç¾©ï¼ˆVS Code å†ç¾ç”¨ï¼‰

  â”œâ”€â”€ docker-compose.yml     # å„ã‚µãƒ¼ãƒ“ã‚¹ã®é€£æºæ§‹æˆ

  â”œâ”€â”€ .env / .env.sample     # ç’°å¢ƒå¤‰æ•°ï¼ˆAPIã‚­ãƒ¼ãªã©ï¼‰

  â””â”€â”€ README.md              # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«

  ```




  ## ğŸš€ èµ·å‹•æ‰‹é †


  ```bash

  # 1. .env ã‚’ .env.sample ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¦ç·¨é›†

  cp .env.sample .env


  # 2. Docker Compose ã§èµ·å‹•

  docker compose up --build -d

  ```


  ## ğŸ™ Giteaã«ã¤ã„ã¦


  ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆå‹ã® Git ç®¡ç†ã‚µãƒ¼ãƒ


  - [Gitea å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.gitea.io/)


  é–‹ç™ºä¸­ã¯ `http://localhost:3000` ã«ã‚¢ã‚¯ã‚»ã‚¹ã€‚

  SSH ã‚¯ãƒ­ãƒ¼ãƒ³ç”¨ãƒãƒ¼ãƒˆã¯ `222`ã€‚'
.gitignore: '__pycache__/

  *.pyc

  .env

  .vscode/

  gitea-data/

  .gitea/

  '
docker-compose.yml: "services:\n  gateway:\n    build:\n      context: ./api-gateway\n\
  \    ports:\n      - \"8080:8000\"\n    env_file:\n      - .env.production\n   \
  \ restart: always\n  chat:\n    build:\n      context: ./chat-service\n    ports:\n\
  \      - \"8001:8001\"\n    env_file:\n      - .env.production\n    restart: always\n"
.env.sample: '# Common

  OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxx

  CHAT_SERVICE_URL=http://chat:8001


  # Development

  DEBUG=true

  LOG_LEVEL=DEBUG


  # Production

  DEBUG=false

  LOG_LEVEL=INFO

  '
.vscode:
  launch.json: "{\n\t\"version\": \"0.2.0\",\n\t\"configurations\": [\n\t  {\n\t\t\
    \"name\": \"Attach to Gateway\",\n\t\t\"type\": \"python\",\n\t\t\"request\":\
    \ \"attach\",\n\t\t\"connect\": {\n\t\t  \"host\": \"localhost\",\n\t\t  \"port\"\
    : 5678\n\t\t},\n\t\t\"pathMappings\": [\n\t\t  {\n\t\t\t\"localRoot\": \"${workspaceFolder}/api-gateway\"\
    ,\n\t\t\t\"remoteRoot\": \"/src/api-gateway\"\n\t\t  }\n\t\t]\n\t  }\n\t]\n  }\n"
chat-service:
  Dockerfile: 'FROM python:3.11-slim


    WORKDIR /workspace/chat-service


    COPY requirements.txt .

    RUN pip install --no-cache-dir -r requirements.txt


    COPY . .


    CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8001"]

    '
  main.py: "from fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\n\
    from pydantic import BaseModel\nimport openai\nimport os\nfrom dotenv import load_dotenv\n\
    \nload_dotenv()\nopenai.api_key = os.getenv(\"OPENAI_API_KEY\")\n\napp = FastAPI()\n\
    app.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],  # æœ¬ç•ªã¯åˆ¶é™ã™ã‚‹ã“ã¨\n\
    \    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"\
    *\"],\n)\nclass ChatRequest(BaseModel):\n    message: str\n\n@app.post(\"/chat\"\
    )\nasync def chat(request: ChatRequest):\n    print(\"forward_chat called openai\"\
    )\n\n    response = openai.ChatCompletion.create(\n        model=\"gpt-3.5-turbo\"\
    ,\n        messages=[{\"role\": \"user\", \"content\": request.message}]\n   \
    \ )\n    return {\"response\": response[\"choices\"][0][\"message\"][\"content\"\
    ]}\n"
  requirements.txt: 'fastapi

    uvicorn

    openai

    python-dotenv'
.devcontainer:
  docker-compose.dev.yml: "\nservices:\n  gateway:\n    build:\n      context: ../api-gateway\n\
    \    ports:\n      - \"8000:8000\"\n      - \"5678:5678\"\n    env_file:\n   \
    \   - ../.env.development\n    volumes:\n      - ../:/workspace:cached\n  chat:\n\
    \    build:\n      context: ../chat-service\n    ports:\n      - \"8001:8001\"\
    \n    env_file:\n      - ../.env.development\n    volumes:\n      - ../:/workspace:cached\n"
  devcontainer.json: "{\n  \"name\": \"1on1-dev\",\n  \"dockerComposeFile\": [\"docker-compose.dev.yml\"\
    ],\n  \"service\": \"gateway\",\n  \"workspaceFolder\": \"/workspace\",\n  \"\
    settings\": {\n    \"terminal.integrated.defaultProfile.linux\": \"bash\"\n  },\n\
    \  \"extensions\": [\n    \"ms-azuretools.vscode-docker\",\n    \"ms-python.python\"\
    \n  ]\n}\n"
api-gateway:
  Dockerfile: 'FROM python:3.11-slim


    WORKDIR /workspace/api-gateway


    COPY requirements.txt .

    RUN pip install --no-cache-dir -r requirements.txt


    COPY . .


    CMD ["python", "-m", "debugpy", "--listen", "0.0.0.0:5678", "-m", "uvicorn", "main:app",
    "--host", "0.0.0.0", "--port", "8000", "--reload"]


    # CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]

    '
  main.py: "from fastapi import FastAPI\nfrom pydantic import BaseModel\nimport httpx\n\
    import os\n\nCHAT_SERVICE_URL = os.getenv(\"CHAT_SERVICE_URL\", \"http://chat:8001\"\
    )\n\napp = FastAPI()\n\nclass ChatRequest(BaseModel):\n    message: str\n\n@app.post(\"\
    /chat\")\nasync def forward_chat(request: ChatRequest):\n    async with httpx.AsyncClient()\
    \ as client:\n\n        print(\"forward_chat called gatway\")\n        # res =\
    \ await client.post(f\"{CHAT_SERVICE_URL}/chat\", json=request.dict())\n     \
    \   # return res.json()\n        return {}\n\n"
  requirements.txt: 'fastapi

    uvicorn

    python-dotenv

    httpx

    debugpy'
