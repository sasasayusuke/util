from app.utils.platform import PlatformApiOperator
import pytest
from app.main import app
from app.models.customer import CustomerModel
from app.models.master import MasterSupporterOrganizationModel
from app.models.project import (
    GrossProfitAttribute,
    ProjectModel,
    SalesforceMainCustomerAttribute,
)
from app.models.user import UserModel
from app.resources.const import DataType, MasterDataType, UserRoleType
from app.service.project_service import ProjectService
from app.utils.aws.sqs import SqsHelper
from fastapi import HTTPException, status
from fastapi.testclient import TestClient
from pynamodb.exceptions import DoesNotExist
from pynamodb.models import BatchWrite

client = TestClient(app)


class TestUpdateProjectById:
    @pytest.mark.parametrize(
        "project_id, version, body, project_model, expected, customer_model, master_model, user_models",
        [
            (
                "efba46d3-1d56-428b-ac6d-a51e263b54a8",
                1,
                {
                    "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    "name": "サンプルプロジェクト",
                    "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "createNew": "True",
                    "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                    "customerSuccess": "DXの実現",
                    "supportDateFrom": "2021/01/30",
                    "supportDateTo": "2021/02/28",
                    "profit": {
                        "year": 4800000,
                    },
                    "totalContractTime": 200,
                    "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                    "salesforceMainCustomer": {
                        "name": "山田太郎",
                        "email": "yamada@example.com",
                        "organizationName": "IST",
                    },
                    "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "mainSupporterUserId": "906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "isCountManHour": "True",
                    "isKarteRemind": "True",
                    "isMasterKarteRemind": "True",
                    "contractType": "有償",
                    "isSecret": "False",
                },
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                        ],
                        quarterly=[1200000.0, 1200000.0, 1200000.0, 1200000.0],
                        half=[2400000.0, 2400000.0],
                        year=4800000,
                    ),
                    total_contract_time=200.0,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    main_supporter_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                CustomerModel(
                    id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    data_type=DataType.CUSTOMER,
                    name="ソニーグループ株式会社",
                    category="ソニーグループ",
                    salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    salesforce_update_at="2020-10-23T02:21:39.356000+0000",
                    salesforce_target=None,
                    salesforce_credit_limit=None,
                    salesforce_credit_get_month=None,
                    salesforce_credit_manager=None,
                    salesforce_credit_no_retry=None,
                    salesforce_paws_credit_number=None,
                    salesforce_customer_owner=None,
                    salesforce_customer_segment=None,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
                MasterSupporterOrganizationModel(
                    id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                    name="組織開発",
                    value="IST",
                    attributes=None,
                    order=1,
                    use=True,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # MasterSupporterOrganizationModel(
                #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                #     name="組織開発",
                #     value=None,
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                # MasterSupporterOrganizationModel(
                #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
                #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
                #     name="Ideation Service Team",
                #     value="IST",
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                        data_type=DataType.USER,
                        name="山田太郎",
                        email="taro.yamada@example.com",
                        job="部長",
                        supporter_organization_id=[
                            "89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"
                        ],
                        organization_name="IST",
                        cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                        role="supporter_mgr",
                    ),
                ],
            ),
        ],
    )
    @pytest.mark.usefixtures("auth_user")
    def test_ok(
        self,
        mocker,
        project_id,
        version,
        body,
        project_model,
        expected,
        customer_model,
        master_model,
        user_models,
    ):
        mock_customer = mocker.patch.object(CustomerModel, "get")
        mock_customer.return_value = customer_model
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        mock_master_supporter.return_value = master_model
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = user_models

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model
        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")
        mocker.patch.object(CustomerModel, "get")

        mocker_pf_get_projects = mocker.patch.object(PlatformApiOperator, "get_projects")
        mocker_pf_get_projects.return_value = (200, {"total": 0, "projects": []})
        mocker_pf_update_project = mocker.patch.object(PlatformApiOperator, "update_project_by_pf_id")
        mocker_pf_update_project.return_value = (200, {"message": "OK"})

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )

        actual = response.json()
        assert response.status_code == 200
        assert actual == expected

    @pytest.mark.usefixtures("auth_user")
    def test_customer_not_found(self, mocker):
        """案件が存在しない時のテスト"""
        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"
        version = 1
        body = {
            "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            "name": "サンプルプロジェクト",
            "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "createNew": "True",
            "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
            "customerSuccess": "DXの実現",
            "supportDateFrom": "2021/01/30",
            "supportDateTo": "2021/02/28",
            "profit": {
                "year": 4800000,
            },
            "totalContractTime": 200,
            "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
            "salesforceMainCustomer": {
                "name": "山田太郎",
                "email": "yamada@example.com",
                "organizationName": "IST",
            },
            "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
            "mainSupporterUserId": "906a3144-9650-4a34-8a23-3b02f3b9aeac",
            "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
            "isCountManHour": "True",
            "isKarteRemind": "True",
            "isMasterKarteRemind": "True",
            "contractType": "有償",
            "isSecret": "False",
        }

        mock = mocker.patch.object(ProjectModel, "get")
        mock.side_effect = DoesNotExist()

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )

        actual = response.json()
        assert response.status_code == 404
        assert actual["detail"] == "Not found"

    @pytest.mark.parametrize(
        "project_id, version, body, project_model, expected, customer_model, master_model, user_models",
        [
            (
                "efba46d3-1d56-428b-ac6d-a51e263b54a8",
                1,
                {
                    "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    "name": "サンプルプロジェクト",
                    "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "createNew": "True",
                    "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                    "customerSuccess": "DXの実現",
                    "supportDateFrom": "2021/01/30",
                    "supportDateTo": "2021/02/28",
                    "profit": {
                        "year": 4800000,
                    },
                    "totalContractTime": 200,
                    "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                    "salesforceMainCustomer": {
                        "name": "山田太郎",
                        "email": "yamada@example.com",
                        "organizationName": "IST",
                    },
                    "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "mainSupporterUserId": "906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "isCountManHour": "True",
                    "isKarteRemind": "True",
                    "isMasterKarteRemind": "True",
                    "contractType": "有償",
                    "isSecret": "False",
                },
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                        ],
                        quarterly=[1200000.0, 1200000.0, 1200000.0, 1200000.0],
                        half=[2400000.0, 2400000.0],
                        year=4800000,
                    ),
                    total_contract_time=200.0,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    main_supporter_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                CustomerModel(
                    id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    data_type=DataType.CUSTOMER,
                    name="ソニーグループ株式会社",
                    category="ソニーグループ",
                    salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    salesforce_update_at="2020-10-23T02:21:39.356000+0000",
                    salesforce_target=None,
                    salesforce_credit_limit=None,
                    salesforce_credit_get_month=None,
                    salesforce_credit_manager=None,
                    salesforce_credit_no_retry=None,
                    salesforce_paws_credit_number=None,
                    salesforce_customer_owner=None,
                    salesforce_customer_segment=None,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
                MasterSupporterOrganizationModel(
                    id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                    name="組織開発",
                    value="IST",
                    attributes=None,
                    order=1,
                    use=True,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # MasterSupporterOrganizationModel(
                #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                #     name="組織開発",
                #     value=None,
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                # MasterSupporterOrganizationModel(
                #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
                #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
                #     name="Ideation Service Team",
                #     value="IST",
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                        data_type=DataType.USER,
                        name="山田太郎",
                        email="taro.yamada@example.com",
                        company="テスト株式会社",
                        supporter_organization_id=[
                            "556a3144-9650-4a34-8a23-3b02f3b9aeac"
                        ],
                        is_input_man_hour=True,
                        project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                        cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                        agreed=True,
                        role=UserRoleType.SUPPORTER.key,
                        version=1,
                    ),
                ],
            ),
            (
                "efba46d3-1d56-428b-ac6d-a51e263b54a8",
                1,
                {
                    "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    "name": "サンプルプロジェクト",
                    "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "createNew": "True",
                    "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                    "customerSuccess": "DXの実現",
                    "supportDateFrom": "2021/01/30",
                    "supportDateTo": "2021/02/28",
                    "profit": {
                        "year": 4800000,
                    },
                    "totalContractTime": 200,
                    "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                    "salesforceMainCustomer": {
                        "name": "山田太郎",
                        "email": "yamada@example.com",
                        "organizationName": "IST",
                    },
                    "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                    "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "supporterUsers": [{"id": "906a3144-9650-4a34-8a23-3b02f3b9aeac"}],
                    "isCountManHour": "True",
                    "isKarteRemind": "True",
                    "isMasterKarteRemind": "True",
                    "contractType": "有償",
                    "isSecret": "False",
                },
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                        ],
                        quarterly=[1200000.0, 1200000.0, 1200000.0, 1200000.0],
                        half=[2400000.0, 2400000.0],
                        year=4800000,
                    ),
                    total_contract_time=200.0,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["906a3144-9650-4a34-8a23-3b02f3b9aeac"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                CustomerModel(
                    id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    data_type=DataType.CUSTOMER,
                    name="ソニーグループ株式会社",
                    category="ソニーグループ",
                    salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    salesforce_update_at="2020-10-23T02:21:39.356000+0000",
                    salesforce_target=None,
                    salesforce_credit_limit=None,
                    salesforce_credit_get_month=None,
                    salesforce_credit_manager=None,
                    salesforce_credit_no_retry=None,
                    salesforce_paws_credit_number=None,
                    salesforce_customer_owner=None,
                    salesforce_customer_segment=None,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
                MasterSupporterOrganizationModel(
                    id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                    name="組織開発",
                    value="IST",
                    attributes=None,
                    order=1,
                    use=True,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # MasterSupporterOrganizationModel(
                #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                #     name="組織開発",
                #     value=None,
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                # MasterSupporterOrganizationModel(
                #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
                #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
                #     name="Ideation Service Team",
                #     value="IST",
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                        data_type=DataType.USER,
                        name="山田太郎",
                        email="taro.yamada@example.com",
                        company="テスト株式会社",
                        supporter_organization_id=[
                            "556a3144-9650-4a34-8a23-3b02f3b9aeac"
                        ],
                        is_input_man_hour=True,
                        project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                        cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                        agreed=True,
                        role=UserRoleType.SUPPORTER.key,
                        version=1,
                    ),
                ],
            ),
        ],
    )
    @pytest.mark.usefixtures("auth_supporter_user")
    def test_auth_ok_supporter(
        self,
        mocker,
        project_id,
        version,
        body,
        project_model,
        expected,
        customer_model,
        master_model,
        user_models,
    ):
        mock_customer = mocker.patch.object(CustomerModel, "get")
        mock_customer.return_value = customer_model
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        mock_master_supporter.return_value = master_model
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = user_models

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model
        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")
        mocker.patch.object(CustomerModel, "get")

        mocker_pf_get_projects = mocker.patch.object(PlatformApiOperator, "get_projects")
        mocker_pf_get_projects.return_value = (200, {"total": 0, "projects": []})
        mocker_pf_update_project = mocker.patch.object(PlatformApiOperator, "update_project_by_pf_id")
        mocker_pf_update_project.return_value = (200, {"message": "OK"})

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )

        actual = response.json()
        assert response.status_code == 200
        assert actual == expected

    @pytest.mark.parametrize(
        "project_id, version, body, project_model, expected, customer_model, master_model, user_models",
        [
            (
                "efba46d3-1d56-428b-ac6d-a51e263b54a8",
                1,
                {
                    "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    "name": "サンプルプロジェクト",
                    "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "createNew": "True",
                    "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                    "customerSuccess": "DXの実現",
                    "supportDateFrom": "2021/01/30",
                    "supportDateTo": "2021/02/28",
                    "profit": {
                        "year": 4800000,
                    },
                    "totalContractTime": 200,
                    "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                    "salesforceMainCustomer": {
                        "name": "山田太郎",
                        "email": "yamada@example.com",
                        "organizationName": "IST",
                    },
                    "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "mainSupporterUserId": "906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "isCountManHour": "True",
                    "isKarteRemind": "True",
                    "isMasterKarteRemind": "True",
                    "contractType": "有償",
                    "isSecret": "False",
                },
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                        ],
                        quarterly=[1200000.0, 1200000.0, 1200000.0, 1200000.0],
                        half=[2400000.0, 2400000.0],
                        year=4800000,
                    ),
                    total_contract_time=200.0,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    main_supporter_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                CustomerModel(
                    id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    data_type=DataType.CUSTOMER,
                    name="ソニーグループ株式会社",
                    category="ソニーグループ",
                    salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    salesforce_update_at="2020-10-23T02:21:39.356000+0000",
                    salesforce_target=None,
                    salesforce_credit_limit=None,
                    salesforce_credit_get_month=None,
                    salesforce_credit_manager=None,
                    salesforce_credit_no_retry=None,
                    salesforce_paws_credit_number=None,
                    salesforce_customer_owner=None,
                    salesforce_customer_segment=None,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
                MasterSupporterOrganizationModel(
                    id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                    name="組織開発",
                    value="IST",
                    attributes=None,
                    order=1,
                    use=True,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # MasterSupporterOrganizationModel(
                #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                #     name="組織開発",
                #     value=None,
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                # MasterSupporterOrganizationModel(
                #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
                #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
                #     name="Ideation Service Team",
                #     value="IST",
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                        data_type=DataType.USER,
                        name="山田太郎",
                        email="taro.yamada@example.com",
                        company="テスト株式会社",
                        supporter_organization_id=[
                            "556a3144-9650-4a34-8a23-3b02f3b9aeac"
                        ],
                        is_input_man_hour=True,
                        project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                        cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                        agreed=True,
                        role=UserRoleType.SUPPORTER_MGR.key,
                        version=1,
                    ),
                ],
            ),
            (
                "efba46d3-1d56-428b-ac6d-a51e263b54a8",
                1,
                {
                    "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    "name": "サンプルプロジェクト",
                    "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "createNew": "True",
                    "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                    "customerSuccess": "DXの実現",
                    "supportDateFrom": "2021/01/30",
                    "supportDateTo": "2021/02/28",
                    "profit": {
                        "year": 4800000,
                    },
                    "totalContractTime": 200,
                    "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                    "salesforceMainCustomer": {
                        "name": "山田太郎",
                        "email": "yamada@example.com",
                        "organizationName": "IST",
                    },
                    "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                    "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "supporterUsers": [{"id": "906a3144-9650-4a34-8a23-3b02f3b9aeac"}],
                    "isCountManHour": "True",
                    "isKarteRemind": "True",
                    "isMasterKarteRemind": "True",
                    "contractType": "有償",
                    "isSecret": "False",
                },
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                        ],
                        quarterly=[1200000.0, 1200000.0, 1200000.0, 1200000.0],
                        half=[2400000.0, 2400000.0],
                        year=4800000,
                    ),
                    total_contract_time=200.0,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["906a3144-9650-4a34-8a23-3b02f3b9aeac"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                CustomerModel(
                    id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    data_type=DataType.CUSTOMER,
                    name="ソニーグループ株式会社",
                    category="ソニーグループ",
                    salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    salesforce_update_at="2020-10-23T02:21:39.356000+0000",
                    salesforce_target=None,
                    salesforce_credit_limit=None,
                    salesforce_credit_get_month=None,
                    salesforce_credit_manager=None,
                    salesforce_credit_no_retry=None,
                    salesforce_paws_credit_number=None,
                    salesforce_customer_owner=None,
                    salesforce_customer_segment=None,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
                MasterSupporterOrganizationModel(
                    id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                    name="組織開発",
                    value="IST",
                    attributes=None,
                    order=1,
                    use=True,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # MasterSupporterOrganizationModel(
                #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                #     name="組織開発",
                #     value=None,
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                # MasterSupporterOrganizationModel(
                #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
                #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
                #     name="Ideation Service Team",
                #     value="IST",
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                        data_type=DataType.USER,
                        name="山田太郎",
                        email="taro.yamada@example.com",
                        company="テスト株式会社",
                        supporter_organization_id=[
                            "556a3144-9650-4a34-8a23-3b02f3b9aeac"
                        ],
                        is_input_man_hour=True,
                        project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                        cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                        agreed=True,
                        role=UserRoleType.SUPPORTER_MGR.key,
                        version=1,
                    ),
                ],
            ),
        ],
    )
    @pytest.mark.usefixtures("auth_supporter_mgr_user")
    def test_auth_ok_supporter_mgr(
        self,
        mocker,
        project_id,
        version,
        body,
        project_model,
        expected,
        customer_model,
        master_model,
        user_models,
    ):
        mock_customer = mocker.patch.object(CustomerModel, "get")
        mock_customer.return_value = customer_model
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        mock_master_supporter.return_value = master_model
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = user_models

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model
        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")
        mocker.patch.object(CustomerModel, "get")

        mocker_pf_get_projects = mocker.patch.object(PlatformApiOperator, "get_projects")
        mocker_pf_get_projects.return_value = (200, {"total": 0, "projects": []})
        mocker_pf_update_project = mocker.patch.object(PlatformApiOperator, "update_project_by_pf_id")
        mocker_pf_update_project.return_value = (200, {"message": "OK"})

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )

        actual = response.json()
        assert response.status_code == 200
        assert actual == expected

    @pytest.mark.parametrize(
        "project_id, version, body, project_model, expected, customer_model, master_model, user_models",
        [
            (
                "efba46d3-1d56-428b-ac6d-a51e263b54a8",
                1,
                {
                    "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    "name": "サンプルプロジェクト",
                    "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "createNew": "True",
                    "mainSalesUserId": "906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    "customerSuccess": "DXの実現",
                    "supportDateFrom": "2021/01/30",
                    "supportDateTo": "2021/02/28",
                    "profit": {
                        "year": 4800000,
                    },
                    "totalContractTime": 200,
                    "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                    "salesforceMainCustomer": {
                        "name": "山田太郎",
                        "email": "yamada@example.com",
                        "organizationName": "IST",
                    },
                    "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                    "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "isCountManHour": "True",
                    "isKarteRemind": "True",
                    "isMasterKarteRemind": "True",
                    "contractType": "有償",
                    "isSecret": "False",
                },
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                        ],
                        quarterly=[1200000.0, 1200000.0, 1200000.0, 1200000.0],
                        half=[2400000.0, 2400000.0],
                        year=4800000,
                    ),
                    total_contract_time=200.0,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                CustomerModel(
                    id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    data_type=DataType.CUSTOMER,
                    name="ソニーグループ株式会社",
                    category="ソニーグループ",
                    salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    salesforce_update_at="2020-10-23T02:21:39.356000+0000",
                    salesforce_target=None,
                    salesforce_credit_limit=None,
                    salesforce_credit_get_month=None,
                    salesforce_credit_manager=None,
                    salesforce_credit_no_retry=None,
                    salesforce_paws_credit_number=None,
                    salesforce_customer_owner=None,
                    salesforce_customer_segment=None,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
                MasterSupporterOrganizationModel(
                    id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                    name="組織開発",
                    value="IST",
                    attributes=None,
                    order=1,
                    use=True,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # MasterSupporterOrganizationModel(
                #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                #     name="組織開発",
                #     value=None,
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                # MasterSupporterOrganizationModel(
                #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
                #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
                #     name="Ideation Service Team",
                #     value="IST",
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                        data_type=DataType.USER,
                        name="山田太郎",
                        email="taro.yamada@example.com",
                        company="テスト株式会社",
                        is_input_man_hour=True,
                        project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                        cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                        agreed=True,
                        role=UserRoleType.SALES.key,
                        version=1,
                    ),
                ],
            ),
        ],
    )
    @pytest.mark.usefixtures("auth_sales_user")
    def test_auth_ok_sales(
        self,
        mocker,
        project_id,
        version,
        body,
        project_model,
        expected,
        customer_model,
        master_model,
        user_models,
    ):
        mock_customer = mocker.patch.object(CustomerModel, "get")
        mock_customer.return_value = customer_model
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        mock_master_supporter.return_value = master_model
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = user_models

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model
        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")
        mocker.patch.object(CustomerModel, "get")

        mocker_pf_get_projects = mocker.patch.object(PlatformApiOperator, "get_projects")
        mocker_pf_get_projects.return_value = (200, {"total": 0, "projects": []})
        mocker_pf_update_project = mocker.patch.object(PlatformApiOperator, "update_project_by_pf_id")
        mocker_pf_update_project.return_value = (200, {"message": "OK"})

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )

        actual = response.json()
        assert response.status_code == 200
        assert actual == expected

    @pytest.mark.parametrize(
        "project_id, version, body, project_model, expected, customer_model, master_model, user_models",
        [
            (
                "efba46d3-1d56-428b-ac6d-a51e263b54a8",
                1,
                {
                    "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    "name": "サンプルプロジェクト",
                    "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "createNew": "True",
                    "mainSalesUserId": "906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    "customerSuccess": "DXの実現",
                    "supportDateFrom": "2021/01/30",
                    "supportDateTo": "2021/02/28",
                    "profit": {
                        "year": 4800000,
                    },
                    "totalContractTime": 200,
                    "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                    "salesforceMainCustomer": {
                        "name": "山田太郎",
                        "email": "yamada@example.com",
                        "organizationName": "IST",
                    },
                    "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                    "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "isCountManHour": "True",
                    "isKarteRemind": "True",
                    "isMasterKarteRemind": "True",
                    "contractType": "有償",
                    "isSecret": "False",
                },
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                        ],
                        quarterly=[1200000.0, 1200000.0, 1200000.0, 1200000.0],
                        half=[2400000.0, 2400000.0],
                        year=4800000,
                    ),
                    total_contract_time=200.0,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                "",
                CustomerModel(
                    id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    data_type=DataType.CUSTOMER,
                    name="ソニーグループ株式会社",
                    category="ソニーグループ",
                    salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    salesforce_update_at="2020-10-23T02:21:39.356000+0000",
                    salesforce_target=None,
                    salesforce_credit_limit=None,
                    salesforce_credit_get_month=None,
                    salesforce_credit_manager=None,
                    salesforce_credit_no_retry=None,
                    salesforce_paws_credit_number=None,
                    salesforce_customer_owner=None,
                    salesforce_customer_segment=None,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
                MasterSupporterOrganizationModel(
                    id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                    name="組織開発",
                    value="IST",
                    attributes=None,
                    order=1,
                    use=True,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # MasterSupporterOrganizationModel(
                #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                #     name="組織開発",
                #     value=None,
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                # MasterSupporterOrganizationModel(
                #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
                #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
                #     name="Ideation Service Team",
                #     value="IST",
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                        data_type=DataType.USER,
                        name="山田太郎",
                        email="taro.yamada@example.com",
                        customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                        customer_name="取引先株式会社",
                        job="部長",
                        organization_name="コンサルティング事業部",
                        project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                        cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                        agreed=True,
                        role=UserRoleType.CUSTOMER.key,
                        version=1,
                    ),
                ],
            ),
        ],
    )
    @pytest.mark.usefixtures("auth_customer_user")
    def test_auth_error_customer_403(
        self,
        mocker,
        project_id,
        version,
        body,
        project_model,
        expected,
        customer_model,
        master_model,
        user_models,
    ):
        mock_customer = mocker.patch.object(CustomerModel, "get")
        mock_customer.return_value = customer_model
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        mock_master_supporter.return_value = master_model
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = user_models

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model
        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )

        assert response.status_code == 403

    @pytest.mark.parametrize(
        "project_id, version, body, project_model, expected, customer_model, master_model, user_models",
        [
            (
                "efba46d3-1d56-428b-ac6d-a51e263b54a8",
                1,
                {
                    "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    "name": "サンプルプロジェクト",
                    "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "createNew": "True",
                    "mainSalesUserId": "906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    "customerSuccess": "DXの実現",
                    "supportDateFrom": "2021/01/30",
                    "supportDateTo": "2021/02/28",
                    "profit": {
                        "year": 4800000,
                    },
                    "totalContractTime": 200,
                    "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                    "salesforceMainCustomer": {
                        "name": "山田太郎",
                        "email": "yamada@example.com",
                        "organizationName": "IST",
                    },
                    "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                    "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "isCountManHour": "True",
                    "isKarteRemind": "True",
                    "isMasterKarteRemind": "True",
                    "contractType": "有償",
                    "isSecret": "False",
                },
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                        ],
                        quarterly=[1200000.0, 1200000.0, 1200000.0, 1200000.0],
                        half=[2400000.0, 2400000.0],
                        year=4800000,
                    ),
                    total_contract_time=200.0,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                "",
                CustomerModel(
                    id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    data_type=DataType.CUSTOMER,
                    name="ソニーグループ株式会社",
                    category="ソニーグループ",
                    salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    salesforce_update_at="2020-10-23T02:21:39.356000+0000",
                    salesforce_target=None,
                    salesforce_credit_limit=None,
                    salesforce_credit_get_month=None,
                    salesforce_credit_manager=None,
                    salesforce_credit_no_retry=None,
                    salesforce_paws_credit_number=None,
                    salesforce_customer_owner=None,
                    salesforce_customer_segment=None,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
                MasterSupporterOrganizationModel(
                    id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                    name="組織開発",
                    value="IST",
                    attributes=None,
                    order=1,
                    use=True,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # MasterSupporterOrganizationModel(
                #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                #     name="組織開発",
                #     value=None,
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                # MasterSupporterOrganizationModel(
                #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
                #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
                #     name="Ideation Service Team",
                #     value="IST",
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                        data_type=DataType.USER,
                        name="山田太郎",
                        email="taro.yamada@example.com",
                        company="テスト株式会社",
                        is_input_man_hour=True,
                        project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                        cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                        agreed=True,
                        role=UserRoleType.SALES_MGR.key,
                        version=1,
                    ),
                ],
            ),
        ],
    )
    @pytest.mark.usefixtures("auth_sales_mgr_user")
    def test_auth_error_sales_mgr_403(
        self,
        mocker,
        project_id,
        version,
        body,
        project_model,
        expected,
        customer_model,
        master_model,
        user_models,
    ):
        mock_customer = mocker.patch.object(CustomerModel, "get")
        mock_customer.return_value = customer_model
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        mock_master_supporter.return_value = master_model
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = user_models

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model
        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )

        assert response.status_code == 403

    @pytest.mark.parametrize(
        "project_id, version, body, project_model, expected, customer_model, master_model, user_models",
        [
            (
                "efba46d3-1d56-428b-ac6d-a51e263b54a8",
                1,
                {
                    "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    "name": "サンプルプロジェクト",
                    "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "createNew": "True",
                    "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                    "customerSuccess": "DXの実現",
                    "supportDateFrom": "2021/01/30",
                    "supportDateTo": "2021/02/28",
                    "profit": {
                        "year": 4800000,
                    },
                    "totalContractTime": 200,
                    "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                    "salesforceMainCustomer": {
                        "name": "山田太郎",
                        "email": "yamada@example.com",
                        "organizationName": "IST",
                    },
                    "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                    "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "isCountManHour": "True",
                    "isKarteRemind": "True",
                    "isMasterKarteRemind": "True",
                    "contractType": "有償",
                    "isSecret": "False",
                },
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                        ],
                        quarterly=[1200000.0, 1200000.0, 1200000.0, 1200000.0],
                        half=[2400000.0, 2400000.0],
                        year=4800000,
                    ),
                    total_contract_time=200.0,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                "",
                CustomerModel(
                    id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    data_type=DataType.CUSTOMER,
                    name="ソニーグループ株式会社",
                    category="ソニーグループ",
                    salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    salesforce_update_at="2020-10-23T02:21:39.356000+0000",
                    salesforce_target=None,
                    salesforce_credit_limit=None,
                    salesforce_credit_get_month=None,
                    salesforce_credit_manager=None,
                    salesforce_credit_no_retry=None,
                    salesforce_paws_credit_number=None,
                    salesforce_customer_owner=None,
                    salesforce_customer_segment=None,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
                MasterSupporterOrganizationModel(
                    id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                    name="組織開発",
                    value="IST",
                    attributes=None,
                    order=1,
                    use=True,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # MasterSupporterOrganizationModel(
                #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                #     name="組織開発",
                #     value=None,
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                # MasterSupporterOrganizationModel(
                #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
                #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
                #     name="Ideation Service Team",
                #     value="IST",
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                        data_type=DataType.USER,
                        name="山田太郎",
                        email="taro.yamada@example.com",
                        company="テスト株式会社",
                        supporter_organization_id=[
                            "556a3144-9650-4a34-8a23-3b02f3b9aeac"
                        ],
                        is_input_man_hour=True,
                        project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                        cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                        agreed=True,
                        role=UserRoleType.SUPPORTER.key,
                        version=1,
                    ),
                ],
            ),
        ],
    )
    @pytest.mark.usefixtures("auth_supporter_user")
    def test_auth_error_supporter_404(
        self,
        mocker,
        project_id,
        version,
        body,
        project_model,
        expected,
        customer_model,
        master_model,
        user_models,
    ):
        mock_customer = mocker.patch.object(CustomerModel, "get")
        mock_customer.return_value = customer_model
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        mock_master_supporter.return_value = master_model
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = user_models

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model
        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )

        assert response.status_code == 404

    @pytest.mark.parametrize(
        "project_id, version, body, project_model, expected, customer_model, master_model, user_models",
        [
            (
                "efba46d3-1d56-428b-ac6d-a51e263b54a8",
                1,
                {
                    "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    "name": "サンプルプロジェクト",
                    "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "createNew": "True",
                    "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                    "customerSuccess": "DXの実現",
                    "supportDateFrom": "2021/01/30",
                    "supportDateTo": "2021/02/28",
                    "profit": {
                        "year": 4800000,
                    },
                    "totalContractTime": 200,
                    "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                    "salesforceMainCustomer": {
                        "name": "山田太郎",
                        "email": "yamada@example.com",
                        "organizationName": "IST",
                    },
                    "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                    "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "isCountManHour": "True",
                    "isKarteRemind": "True",
                    "isMasterKarteRemind": "True",
                    "contractType": "有償",
                    "isSecret": "False",
                },
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                        ],
                        quarterly=[1200000.0, 1200000.0, 1200000.0, 1200000.0],
                        half=[2400000.0, 2400000.0],
                        year=4800000,
                    ),
                    total_contract_time=200.0,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                "",
                CustomerModel(
                    id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    data_type=DataType.CUSTOMER,
                    name="ソニーグループ株式会社",
                    category="ソニーグループ",
                    salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    salesforce_update_at="2020-10-23T02:21:39.356000+0000",
                    salesforce_target=None,
                    salesforce_credit_limit=None,
                    salesforce_credit_get_month=None,
                    salesforce_credit_manager=None,
                    salesforce_credit_no_retry=None,
                    salesforce_paws_credit_number=None,
                    salesforce_customer_owner=None,
                    salesforce_customer_segment=None,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
                MasterSupporterOrganizationModel(
                    id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                    name="組織開発",
                    value="IST",
                    attributes=None,
                    order=1,
                    use=True,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # MasterSupporterOrganizationModel(
                #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                #     name="組織開発",
                #     value=None,
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                # MasterSupporterOrganizationModel(
                #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
                #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
                #     name="Ideation Service Team",
                #     value="IST",
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                        data_type=DataType.USER,
                        name="山田太郎",
                        email="taro.yamada@example.com",
                        company="テスト株式会社",
                        supporter_organization_id=[
                            "556a3144-9650-4a34-8a23-3b02f3b9aeac"
                        ],
                        is_input_man_hour=True,
                        project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                        cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                        agreed=True,
                        role=UserRoleType.SUPPORTER_MGR.key,
                        version=1,
                    ),
                ],
            ),
        ],
    )
    @pytest.mark.usefixtures("auth_supporter_mgr_user")
    def test_auth_error_supporter_mgr_404(
        self,
        mocker,
        project_id,
        version,
        body,
        project_model,
        expected,
        customer_model,
        master_model,
        user_models,
    ):
        mock_customer = mocker.patch.object(CustomerModel, "get")
        mock_customer.return_value = customer_model
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        mock_master_supporter.return_value = master_model
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = user_models

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model
        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )

        assert response.status_code == 404

    @pytest.mark.parametrize(
        "project_id, version, body, project_model, expected, customer_model, master_model, user_models",
        [
            (
                "efba46d3-1d56-428b-ac6d-a51e263b54a8",
                1,
                {
                    "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    "name": "サンプルプロジェクト",
                    "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "createNew": "True",
                    "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                    "customerSuccess": "DXの実現",
                    "supportDateFrom": "2021/01/30",
                    "supportDateTo": "2021/02/28",
                    "profit": {
                        "year": 4800000,
                    },
                    "totalContractTime": 200,
                    "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                    "salesforceMainCustomer": {
                        "name": "山田太郎",
                        "email": "yamada@example.com",
                        "organizationName": "IST",
                    },
                    "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                    "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "isCountManHour": "True",
                    "isKarteRemind": "True",
                    "isMasterKarteRemind": "True",
                    "contractType": "有償",
                    "isSecret": "False",
                },
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                            400000.0,
                        ],
                        quarterly=[1200000.0, 1200000.0, 1200000.0, 1200000.0],
                        half=[2400000.0, 2400000.0],
                        year=4800000,
                    ),
                    total_contract_time=200.0,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                "",
                CustomerModel(
                    id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    data_type=DataType.CUSTOMER,
                    name="ソニーグループ株式会社",
                    category="ソニーグループ",
                    salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    salesforce_update_at="2020-10-23T02:21:39.356000+0000",
                    salesforce_target=None,
                    salesforce_credit_limit=None,
                    salesforce_credit_get_month=None,
                    salesforce_credit_manager=None,
                    salesforce_credit_no_retry=None,
                    salesforce_paws_credit_number=None,
                    salesforce_customer_owner=None,
                    salesforce_customer_segment=None,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
                MasterSupporterOrganizationModel(
                    id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                    name="組織開発",
                    value="IST",
                    attributes=None,
                    order=1,
                    use=True,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # MasterSupporterOrganizationModel(
                #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                #     name="組織開発",
                #     value=None,
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                # MasterSupporterOrganizationModel(
                #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
                #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
                #     name="Ideation Service Team",
                #     value="IST",
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                        data_type=DataType.USER,
                        name="山田太郎",
                        email="taro.yamada@example.com",
                        company="テスト株式会社",
                        is_input_man_hour=True,
                        project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                        cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                        agreed=True,
                        role=UserRoleType.SALES.key,
                        version=1,
                    ),
                ],
            ),
        ],
    )
    @pytest.mark.usefixtures("auth_sales_user")
    def test_auth_error_sales_404(
        self,
        mocker,
        project_id,
        version,
        body,
        project_model,
        expected,
        customer_model,
        master_model,
        user_models,
    ):
        mock_customer = mocker.patch.object(CustomerModel, "get")
        mock_customer.return_value = customer_model
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        mock_master_supporter.return_value = master_model
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = user_models

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model
        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )

        assert response.status_code == 404

    @pytest.mark.usefixtures("auth_user")
    def test_400_customer_id_not_exists(
        self,
        mocker,
    ):
        """取引先IDの存在チェックエラー"""
        body = {
            "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            "name": "サンプルプロジェクト",
            "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "createNew": "True",
            "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
            "customerSuccess": "DXの実現",
            "supportDateFrom": "2021/01/30",
            "supportDateTo": "2021/02/28",
            "profit": {
                "year": 4800000,
            },
            "totalContractTime": 200,
            "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
            "salesforceMainCustomer": {
                "name": "山田太郎",
                "email": "yamada@example.com",
                "organizationName": "IST",
            },
            "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
            "mainSupporterUserId": "906a3144-9650-4a34-8a23-3b02f3b9aeac",
            "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
            "isCountManHour": "True",
            "isKarteRemind": "True",
            "isMasterKarteRemind": "True",
            "contractType": "有償",
            "isSecret": "False",
        }
        mock_customer = mocker.patch.object(CustomerModel, "get")
        mock_customer.side_effect = DoesNotExist()
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                job="部長",
                supporter_organization_id=["89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"],
                organization_name="IST",
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                role="supporter_mgr",
            ),
        ]
        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"
        version = 1

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            main_supporter_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )
        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"] == "[{'loc': ['body', 'customerId'], 'msg': 'Not exist.'}]"
        )

    @pytest.mark.usefixtures("auth_user")
    def test_400_service_type_not_exists(
        self,
        mocker,
    ):
        """サービス区分の存在チェックエラー"""
        mock_customer = mocker.patch.object(CustomerModel, "get")
        mock_customer.return_value = CustomerModel(
            id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            data_type=DataType.CUSTOMER,
            name="ソニーグループ株式会社",
            category="ソニーグループ",
            salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            salesforce_update_at="2020-10-23T02:21:39.356000+0000",
            salesforce_target=None,
            salesforce_credit_limit=None,
            salesforce_credit_get_month=None,
            salesforce_credit_manager=None,
            salesforce_credit_no_retry=None,
            salesforce_paws_credit_number=None,
            salesforce_customer_owner=None,
            salesforce_customer_segment=None,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        mock_master_supporter.side_effect = DoesNotExist()
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                job="部長",
                supporter_organization_id=["89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"],
                organization_name="IST",
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                role="supporter_mgr",
            ),
        ]

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            main_supporter_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )
        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"
        version = 1
        body = {
            "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            "name": "サンプルプロジェクト",
            "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "createNew": "True",
            "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
            "customerSuccess": "DXの実現",
            "supportDateFrom": "2021/01/30",
            "supportDateTo": "2021/02/28",
            "profit": {
                "year": 4800000,
            },
            "totalContractTime": 200,
            "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
            "salesforceMainCustomer": {
                "name": "山田太郎",
                "email": "yamada@example.com",
                "organizationName": "IST",
            },
            "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
            "mainSupporterUserId": "906a3144-9650-4a34-8a23-3b02f3b9aeac",
            "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
            "isCountManHour": "True",
            "isKarteRemind": "True",
            "isMasterKarteRemind": "True",
            "contractType": "有償",
            "isSecret": "False",
        }

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'serviceType'], 'msg': 'Not exist.'}]"
        )

    @pytest.mark.usefixtures("auth_user")
    def test_400_supporter_organization_id_not_exists(
        self,
        mocker,
    ):
        """支援者組織（課）IDの存在チェックエラー"""
        mock_customer = mocker.patch.object(CustomerModel, "get")
        mock_customer.return_value = CustomerModel(
            id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            data_type=DataType.CUSTOMER,
            name="ソニーグループ株式会社",
            category="ソニーグループ",
            salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            salesforce_update_at="2020-10-23T02:21:39.356000+0000",
            salesforce_target=None,
            salesforce_credit_limit=None,
            salesforce_credit_get_month=None,
            salesforce_credit_manager=None,
            salesforce_credit_no_retry=None,
            salesforce_paws_credit_number=None,
            salesforce_customer_owner=None,
            salesforce_customer_segment=None,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        mocker.patch.object(MasterSupporterOrganizationModel, "get")
        mock_master_supporter = mocker.patch.object(ProjectService, "get_service_name")
        mock_master_supporter.side_effect = HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=[{"loc": ["body", "supporterOrganizationId"], "msg": "Not exist."}],
        )
        mock_get_customer_name = mocker.patch.object(
            ProjectService, "get_customer_name"
        )
        mock_get_customer_name.return_value = "組織開発"
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                job="部長",
                supporter_organization_id=["89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"],
                organization_name="IST",
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                role="supporter_mgr",
            ),
        ]

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            main_supporter_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )
        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"
        version = 1
        body = {
            "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            "name": "サンプルプロジェクト",
            "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "createNew": "True",
            "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
            "customerSuccess": "DXの実現",
            "supportDateFrom": "2021/01/30",
            "supportDateTo": "2021/02/28",
            "profit": {
                "year": 4800000,
            },
            "totalContractTime": 200,
            "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
            "salesforceMainCustomer": {
                "name": "山田太郎",
                "email": "yamada@example.com",
                "organizationName": "IST",
            },
            "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
            "mainSupporterUserId": "906a3144-9650-4a34-8a23-3b02f3b9aeac",
            "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
            "isCountManHour": "True",
            "isKarteRemind": "True",
            "isMasterKarteRemind": "True",
            "contractType": "有償",
            "isSecret": "False",
        }

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )
        assert response.status_code == 400

    @pytest.mark.usefixtures("auth_user")
    def test_400_main_sales_user_id_not_exists(
        self,
        mocker,
    ):
        """営業担当者IDの存在チェックエラー"""
        mock_customer = mocker.patch.object(CustomerModel, "get")
        mock_customer.return_value = CustomerModel(
            id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            data_type=DataType.CUSTOMER,
            name="ソニーグループ株式会社",
            category="ソニーグループ",
            salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            salesforce_update_at="2020-10-23T02:21:39.356000+0000",
            salesforce_target=None,
            salesforce_credit_limit=None,
            salesforce_credit_get_month=None,
            salesforce_credit_manager=None,
            salesforce_credit_no_retry=None,
            salesforce_paws_credit_number=None,
            salesforce_customer_owner=None,
            salesforce_customer_segment=None,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                job="部長",
                supporter_organization_id=["89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"],
                organization_name="IST",
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                role="supporter_mgr",
            ),
        ]

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            main_supporter_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )
        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"
        version = 1
        body = {
            "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            "name": "サンプルプロジェクト",
            "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "createNew": "True",
            "mainSalesUserId": "xxxxxxxx-cdab-494c-818e-d4845088269b",
            "customerSuccess": "DXの実現",
            "supportDateFrom": "2021/01/30",
            "supportDateTo": "2021/02/28",
            "profit": {
                "year": 4800000,
            },
            "totalContractTime": 200,
            "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
            "salesforceMainCustomer": {
                "name": "山田太郎",
                "email": "yamada@example.com",
                "organizationName": "IST",
            },
            "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
            "mainSupporterUserId": "906a3144-9650-4a34-8a23-3b02f3b9aeac",
            "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
            "isCountManHour": "True",
            "isKarteRemind": "True",
            "isMasterKarteRemind": "True",
            "contractType": "有償",
            "isSecret": "False",
        }

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'mainSalesUserId'], 'msg': 'Not exist.'}]"
        )

    @pytest.mark.usefixtures("auth_user")
    def test_400_main_customer_user_id_not_exists(
        self,
        mocker,
    ):
        """営業担当者IDの存在チェックエラー"""
        mock_customer = mocker.patch.object(CustomerModel, "get")
        mock_customer.return_value = CustomerModel(
            id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            data_type=DataType.CUSTOMER,
            name="ソニーグループ株式会社",
            category="ソニーグループ",
            salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            salesforce_update_at="2020-10-23T02:21:39.356000+0000",
            salesforce_target=None,
            salesforce_credit_limit=None,
            salesforce_credit_get_month=None,
            salesforce_credit_manager=None,
            salesforce_credit_no_retry=None,
            salesforce_paws_credit_number=None,
            salesforce_customer_owner=None,
            salesforce_customer_segment=None,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                job="部長",
                supporter_organization_id=["89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"],
                organization_name="IST",
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                role="supporter_mgr",
            ),
        ]

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            main_supporter_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )
        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"
        version = 1
        body = {
            "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            "name": "サンプルプロジェクト",
            "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "createNew": "True",
            "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
            "customerSuccess": "DXの実現",
            "supportDateFrom": "2021/01/30",
            "supportDateTo": "2021/02/28",
            "profit": {
                "year": 4800000,
            },
            "totalContractTime": 200,
            "mainCustomerUserId": "xxxxxxxx-cdab-494c-818e-d4845088269b",
            "salesforceMainCustomer": {
                "name": "山田太郎",
                "email": "yamada@example.com",
                "organizationName": "IST",
            },
            "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
            "mainSupporterUserId": "906a3144-9650-4a34-8a23-3b02f3b9aeac",
            "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
            "isCountManHour": "True",
            "isKarteRemind": "True",
            "isMasterKarteRemind": "True",
            "contractType": "有償",
            "isSecret": "False",
        }

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'mainCustomerUserId'], 'msg': 'Not exist.'}]"
        )

    @pytest.mark.usefixtures("auth_user")
    def test_400_main_supporter_user_id_not_exists(
        self,
        mocker,
    ):
        """メイン支援者（主担当）IDの存在チェックエラー"""
        mock_customer = mocker.patch.object(CustomerModel, "get")
        mock_customer.return_value = CustomerModel(
            id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            data_type=DataType.CUSTOMER,
            name="ソニーグループ株式会社",
            category="ソニーグループ",
            salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            salesforce_update_at="2020-10-23T02:21:39.356000+0000",
            salesforce_target=None,
            salesforce_credit_limit=None,
            salesforce_credit_get_month=None,
            salesforce_credit_manager=None,
            salesforce_credit_no_retry=None,
            salesforce_paws_credit_number=None,
            salesforce_customer_owner=None,
            salesforce_customer_segment=None,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                job="部長",
                supporter_organization_id=["89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"],
                organization_name="IST",
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                role="supporter_mgr",
            ),
        ]

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            main_supporter_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )
        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"
        version = 1
        body = {
            "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            "name": "サンプルプロジェクト",
            "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "createNew": "True",
            "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
            "customerSuccess": "DXの実現",
            "supportDateFrom": "2021/01/30",
            "supportDateTo": "2021/02/28",
            "profit": {
                "year": 4800000,
            },
            "totalContractTime": 200,
            "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
            "salesforceMainCustomer": {
                "name": "山田太郎",
                "email": "yamada@example.com",
                "organizationName": "IST",
            },
            "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
            "mainSupporterUserId": "xxxxxxxx-cdab-494c-818e-d4845088269b",
            "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
            "isCountManHour": "True",
            "isKarteRemind": "True",
            "isMasterKarteRemind": "True",
            "contractType": "有償",
            "isSecret": "False",
        }

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'mainSupporterUserId'], 'msg': 'Not exist.'}]"
        )

    @pytest.mark.usefixtures("auth_user")
    def test_400_customer_users_not_exists(
        self,
        mocker,
    ):
        """顧客メンバーIDの存在チェックエラー"""
        mock_customer = mocker.patch.object(CustomerModel, "get")
        mock_customer.return_value = CustomerModel(
            id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            data_type=DataType.CUSTOMER,
            name="ソニーグループ株式会社",
            category="ソニーグループ",
            salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            salesforce_update_at="2020-10-23T02:21:39.356000+0000",
            salesforce_target=None,
            salesforce_credit_limit=None,
            salesforce_credit_get_month=None,
            salesforce_credit_manager=None,
            salesforce_credit_no_retry=None,
            salesforce_paws_credit_number=None,
            salesforce_customer_owner=None,
            salesforce_customer_segment=None,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                job="部長",
                supporter_organization_id=["89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"],
                organization_name="IST",
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                role="supporter_mgr",
            ),
        ]

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            main_supporter_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )
        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"
        version = 1
        body = {
            "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            "name": "サンプルプロジェクト",
            "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "createNew": "True",
            "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
            "customerSuccess": "DXの実現",
            "supportDateFrom": "2021/01/30",
            "supportDateTo": "2021/02/28",
            "profit": {
                "year": 4800000,
            },
            "totalContractTime": 200,
            "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
            "salesforceMainCustomer": {
                "name": "山田太郎",
                "email": "yamada@example.com",
                "organizationName": "IST",
            },
            "customerUsers": [{"id": "xxxxxxxx-cdab-494c-818e-d4845088269b"}],
            "mainSupporterUserId": "906a3144-9650-4a34-8a23-3b02f3b9aeac",
            "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
            "isCountManHour": "True",
            "isKarteRemind": "True",
            "isMasterKarteRemind": "True",
            "contractType": "有償",
            "isSecret": "False",
        }

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'customerUsers'], 'msg': 'Not exist.'}]"
        )

    @pytest.mark.usefixtures("auth_user")
    def test_400_supporter_users_not_exists(
        self,
        mocker,
    ):
        """支援メンバー（副担当）IDの存在チェックエラー"""
        mock_customer = mocker.patch.object(CustomerModel, "get")
        mock_customer.return_value = CustomerModel(
            id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            data_type=DataType.CUSTOMER,
            name="ソニーグループ株式会社",
            category="ソニーグループ",
            salesforce_customer_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            salesforce_update_at="2020-10-23T02:21:39.356000+0000",
            salesforce_target=None,
            salesforce_credit_limit=None,
            salesforce_credit_get_month=None,
            salesforce_credit_manager=None,
            salesforce_credit_no_retry=None,
            salesforce_paws_credit_number=None,
            salesforce_customer_owner=None,
            salesforce_customer_segment=None,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                job="部長",
                supporter_organization_id=["89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"],
                organization_name="IST",
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                role="supporter_mgr",
            ),
        ]

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            main_supporter_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )
        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")

        mock_npf = mocker.patch.object(PlatformApiOperator, "update_project_by_pf_id")
        mock_npf.return_value = (200, {})

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"
        version = 1
        body = {
            "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            "name": "サンプルプロジェクト",
            "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "createNew": "True",
            "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
            "customerSuccess": "DXの実現",
            "supportDateFrom": "2021/01/30",
            "supportDateTo": "2021/02/28",
            "profit": {
                "year": 4800000,
            },
            "totalContractTime": 200,
            "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
            "salesforceMainCustomer": {
                "name": "山田太郎",
                "email": "yamada@example.com",
                "organizationName": "IST",
            },
            "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
            "mainSupporterUserId": "906a3144-9650-4a34-8a23-3b02f3b9aeac",
            "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
            "supporterUsers": [{"id": "xxxxxxxx-cdab-494c-818e-d4845088269b"}],
            "isCountManHour": "True",
            "isKarteRemind": "True",
            "isMasterKarteRemind": "True",
            "contractType": "有償",
            "isSecret": "False",
        }

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'supporterUsers'], 'msg': 'Not exist.'}]"
        )

    @pytest.mark.parametrize(
        "body",
        [
            (
                {
                    "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    "name": "サンプルプロジェクト",
                    "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "createNew": "True",
                    "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                    "customerSuccess": "DXの実現",
                    "supportDateFrom": "2021/01/30",
                    "supportDateTo": "2021/02/28",
                    "profit": {
                        "year": 4800000,
                    },
                    "totalContractTime": 200,
                    "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                    "salesforceMainCustomer": {
                        "name": "山田太郎",
                        "email": "yamada@example.com",
                        "organizationName": "IST",
                    },
                    "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "mainSupporterUserId": "906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                    "isCountManHour": "True",
                    "isKarteRemind": "True",
                    "isMasterKarteRemind": "True",
                    "contractType": "有償",
                    "isSecret": "False",
                }
            ),
        ],
    )
    @pytest.mark.usefixtures("auth_user")
    def test_project_version_conflict(self, mocker, body):
        project_id = "efba46d3-1d56-428b-ac6d-a51e263b54a8"
        version = 1

        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        mock_master_supporter.return_value = []
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                job="部長",
                supporter_organization_id=["89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"],
                organization_name="IST",
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                role="supporter_mgr",
            )
        ]

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            main_supporter_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=2,
        )

        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )

        actual = response.json()
        assert response.status_code == 409
        assert actual["detail"] == "Conflict"

    @pytest.mark.parametrize(
        "body",
        [
            # ###########################
            # customerId
            # ###########################
            # 必須チェック
            {
                # "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # Noneチェック
            {
                # "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "customerId": None,
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # ###########################
            # name
            # ###########################
            # 必須チェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                # "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # Noneチェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                # "name": "サンプルプロジェクト",
                "name": None,
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # ###########################
            # serviceType
            # ###########################
            # 必須チェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                # "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # Noneチェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                # "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "serviceType": None,
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # ###########################
            # mainSalesUserId
            # ###########################
            # 必須チェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                # "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # Noneチェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                # "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "mainSalesUserId": None,
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # ###########################
            # supportDateFrom
            # ###########################
            # 必須チェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                # "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # Noneチェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                # "supportDateFrom": "2021/01/30",
                "supportDateFrom": None,
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # ###########################
            # supportDateTo
            # ###########################
            # 必須チェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                # "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # Noneチェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                # "supportDateTo": "2021/02/28",
                "supportDateTo": None,
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # ###########################
            # profit
            # ###########################
            # 必須チェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                # "profit": {
                #     "monthly": [400000,400000,400000,400000,400000,400000,400000,400000,400000,400000,400000,400000],
                #     "quarterly": [1200000,1200000,1200000,1200000],
                #     "half": [2400000,2400000],
                #     "year": 4800000,
                # },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # Noneチェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                # "profit": {
                #     "monthly": [400000,400000,400000,400000,400000,400000,400000,400000,400000,400000,400000,400000],
                #     "quarterly": [1200000,1200000,1200000,1200000],
                #     "half": [2400000,2400000],
                #     "year": 4800000,
                # },
                "profit": None,
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # ###########################
            # profit.year
            # ###########################
            # 必須チェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    # "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # Noneチェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    # "year": 4800000,
                    "year": None,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # ###########################
            # totalContractTime
            # ###########################
            # 必須チェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                # "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # Noneチェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                # "totalContractTime": 200,
                "totalContractTime": None,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # ###########################
            # isCountManHour
            # ###########################
            # 必須チェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                # "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # Noneチェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                # "isCountManHour": "True",
                "isCountManHour": None,
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # ###########################
            # isKarteRemind
            # ###########################
            # 必須チェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                # "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # Noneチェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                # "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "isKarteRemind": None,
                "contractType": "有償",
                "isSecret": "False",
            },
            # ###########################
            # isMasterKarteRemind
            # ###########################
            # 必須チェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                # "isMasterKarteRemind": "True",
                "contractType": "有償",
                "isSecret": "False",
            },
            # Noneチェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                # "isMasterKarteRemind": "True",
                "isMasterKarteRemind": None,
                "contractType": "有償",
                "isSecret": "False",
            },
            # ###########################
            # contractType
            # ###########################
            # 必須チェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                # "contractType": "有償",
                "isSecret": "False",
            },
            # Noneチェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                # "contractType": "有償",
                "contractType": None,
                "isSecret": "False",
            },
            # ENUMチェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "一括",
                "isSecret": "False",
            },
            # ###########################
            # isSecret
            # ###########################
            # 必須チェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                # "isSecret": "False",
            },
            # Noneチェック
            {
                "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                "name": "サンプルプロジェクト",
                "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "createNew": "True",
                "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                "customerSuccess": "DXの実現",
                "supportDateFrom": "2021/01/30",
                "supportDateTo": "2021/02/28",
                "profit": {
                    "year": 4800000,
                },
                "totalContractTime": 200,
                "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                "salesforceMainCustomer": {
                    "name": "山田太郎",
                    "email": "yamada@example.com",
                    "organizationName": "IST",
                },
                "customerUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                "supporterUsers": [{"id": "c9b67094-cdab-494c-818e-d4845088269b"}],
                "isCountManHour": "True",
                "isKarteRemind": "True",
                "isMasterKarteRemind": "True",
                "contractType": "有償",
                # "isSecret": "False",
                "isSecret": None,
            },
        ],
    )
    @pytest.mark.usefixtures("auth_user")
    def test_validation(self, mocker, body):
        project_id = "efba46d3-1d56-428b-ac6d-a51e263b54a8"
        version = 1

        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        mock_master_supporter.return_value = []
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                job="部長",
                supporter_organization_id=["89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"],
                organization_name="IST",
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                role="supporter_mgr",
            )
        ]

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            main_supporter_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=2,
        )

        mocker.patch.object(ProjectModel, "update")
        mocker.patch.object(BatchWrite, "save")
        mocker.patch.object(SqsHelper, "send_message_to_queue")

        response = client.put(
            f"/api/projects/{project_id}?version={version}", json=body
        )

        assert response.status_code == 422
