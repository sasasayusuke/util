from app.models.project import ProjectModel
from app.models.user import UserModel
from app.service.schedule_service import SchedulesService
import pytest


class TestScheduleService:
    @pytest.mark.parametrize(
        ["user", "project", "expected"],
        [
            pytest.param(
                UserModel(
                    id="test_id",
                    data_type="user",
                    name="営業責任者",
                    role="sales_mgr",
                    email="sales_manager@example.com",
                ),
                ProjectModel(
                    id="test_project_id",
                    name="test_project",
                    customer_id="test_customer_id",
                    customer_name="test_customer",
                    main_sales_user_id="test_id",
                    main_customer_user_id="test_customer_id",
                    main_supporter_user_id="test_supporter_id",
                    supporter_user_ids=["test_supporter_id"],
                    customer_user_ids=["test_customer_id"],
                    support_date_from="2024/01/01",
                    support_date_to="2024/12/31",
                    total_contract_time=100,
                ),
                True,
                id="returns_true_for_sales_mgr_assigned_cases",
            ),
            pytest.param(
                UserModel(
                    id="test_id",
                    data_type="user",
                    name="事業者責任者",
                    role="business_mgr",
                    email="business_mgr@example.com",
                ),
                ProjectModel(
                    id="test_project_id",
                    name="test_project",
                    customer_id="test_customer_id",
                    customer_name="test_customer",
                    main_sales_user_id="test_id",
                    main_customer_user_id="test_customer_id",
                    main_supporter_user_id="test_supporter_id",
                    supporter_user_ids=["test_supporter_id"],
                    customer_user_ids=["test_customer_id"],
                    support_date_from="2024/01/01",
                    support_date_to="2024/12/31",
                    total_contract_time=100,
                ),
                True,
                id="returns_true_for_business_mgr_assigned_cases",
            ),
            pytest.param(
                UserModel(
                    id="test_id",
                    data_type="user",
                    name="支援者",
                    role="supporter",
                    email="supporter@example.com",
                    project_ids=["test_project_id"],
                ),
                ProjectModel(
                    id="test_project_id",
                    name="test_project",
                    customer_id="test_customer_id",
                    customer_name="test_customer",
                    main_sales_user_id="test_id",
                    main_customer_user_id="test_customer_id",
                    main_supporter_user_id="test_supporter_id",
                    supporter_user_ids=["test_supporter_id"],
                    customer_user_ids=["test_customer_id"],
                    support_date_from="2024/01/01",
                    support_date_to="2024/12/31",
                    total_contract_time=100,
                ),
                True,
                id="returns_true_for_supporter_assigned_cases",
            ),
            pytest.param(
                UserModel(
                    id="test_id",
                    data_type="user",
                    name="支援者",
                    role="supporter",
                    email="supporter@example.com",
                    project_ids=["example_project_id"],
                ),
                ProjectModel(
                    id="test_project_id",
                    name="test_project",
                    customer_id="test_customer_id",
                    customer_name="test_customer",
                    main_sales_user_id="test_id",
                    main_customer_user_id="test_customer_id",
                    main_supporter_user_id="test_supporter_id",
                    supporter_user_ids=["test_supporter_id"],
                    customer_user_ids=["test_customer_id"],
                    support_date_from="2024/01/01",
                    support_date_to="2024/12/31",
                    total_contract_time=100,
                ),
                False,
                id="returns_true_for_supporter_unassigned_cases",
            ),
            pytest.param(
                UserModel(
                    id="test_id",
                    data_type="user",
                    name="支援者",
                    role="supporter",
                    email="supporter@example.com",
                ),
                ProjectModel(
                    id="test_project_id",
                    name="test_project",
                    customer_id="test_customer_id",
                    customer_name="test_customer",
                    main_sales_user_id="test_id",
                    main_customer_user_id="test_customer_id",
                    main_supporter_user_id="test_supporter_id",
                    supporter_user_ids=["test_supporter_id"],
                    customer_user_ids=["test_customer_id"],
                    support_date_from="2024/01/01",
                    support_date_to="2024/12/31",
                    total_contract_time=100,
                ),
                False,
                id="returns_false_for_supporter_when_no_cases_are_assigned",
            ),
            pytest.param(
                UserModel(
                    id="test_id",
                    data_type="user",
                    name="営業",
                    role="sales",
                    email="sales@example.com",
                    project_ids=["test_project_id"],
                ),
                ProjectModel(
                    id="test_project_id",
                    name="test_project",
                    customer_id="test_customer_id",
                    customer_name="test_customer",
                    main_sales_user_id="test_id",
                    main_customer_user_id="test_customer_id",
                    main_supporter_user_id="test_supporter_id",
                    supporter_user_ids=["test_supporter_id"],
                    customer_user_ids=["test_customer_id"],
                    support_date_from="2024/01/01",
                    support_date_to="2024/12/31",
                    total_contract_time=100,
                ),
                True,
                id="returns_true_for_sales_assigned_cases",
            ),
            pytest.param(
                UserModel(
                    id="test_id",
                    data_type="user",
                    name="営業",
                    role="sales",
                    email="sales@example.com",
                    project_ids=["example_project_id"],
                ),
                ProjectModel(
                    id="test_project_id",
                    name="test_project",
                    customer_id="test_customer_id",
                    customer_name="test_customer",
                    main_sales_user_id="test_id",
                    main_customer_user_id="test_customer_id",
                    main_supporter_user_id="test_supporter_id",
                    supporter_user_ids=["test_supporter_id"],
                    customer_user_ids=["test_customer_id"],
                    support_date_from="2024/01/01",
                    support_date_to="2024/12/31",
                    total_contract_time=100,
                ),
                False,
                id="returns_true_for_sales_unassigned_cases",
            ),
            pytest.param(
                UserModel(
                    id="test_id",
                    data_type="user",
                    name="営業",
                    role="sales",
                    email="sales@example.com",
                ),
                ProjectModel(
                    id="test_project_id",
                    name="test_project",
                    customer_id="test_customer_id",
                    customer_name="test_customer",
                    main_sales_user_id="test_id",
                    main_customer_user_id="test_customer_id",
                    main_supporter_user_id="test_supporter_id",
                    supporter_user_ids=["test_supporter_id"],
                    customer_user_ids=["test_customer_id"],
                    support_date_from="2024/01/01",
                    support_date_to="2024/12/31",
                    total_contract_time=100,
                ),
                False,
                id="returns_false_for_sales_when_no_cases_are_assigned",
            ),
            pytest.param(
                UserModel(
                    id="test_id",
                    data_type="user",
                    name="支援者責任者",
                    role="supporter_mgr",
                    email="supporter_mgr@example.com",
                    project_ids=["test_project_id"],
                    supporter_organization_id=["test_organization_id"],
                ),
                ProjectModel(
                    id="test_project_id",
                    name="test_project",
                    customer_id="test_customer_id",
                    customer_name="test_customer",
                    main_sales_user_id="test_id",
                    main_customer_user_id="test_customer_id",
                    main_supporter_user_id="test_supporter_id",
                    supporter_user_ids=["test_supporter_id"],
                    customer_user_ids=["test_customer_id"],
                    support_date_from="2024/01/01",
                    support_date_to="2024/12/31",
                    total_contract_time=100,
                ),
                True,
                id="returns_true_for_supporter_mgr_assigned_cases",
            ),
            pytest.param(
                UserModel(
                    id="test_id",
                    data_type="user",
                    name="支援者責任者",
                    role="supporter_mgr",
                    email="supporter_mgr@example.com",
                    supporter_organization_id=["test_organization_id"],
                    project_ids=["example_project_id"],
                ),
                ProjectModel(
                    id="test_project_id",
                    name="test_project",
                    customer_id="test_customer_id",
                    customer_name="test_customer",
                    main_sales_user_id="test_id",
                    main_customer_user_id="test_customer_id",
                    main_supporter_user_id="test_supporter_id",
                    supporter_user_ids=["test_supporter_id"],
                    customer_user_ids=["test_customer_id"],
                    support_date_from="2024/01/01",
                    support_date_to="2024/12/31",
                    total_contract_time=100,
                ),
                False,
                id="returns_true_for_supporter_mgr_unassigned_cases",
            ),
            pytest.param(
                UserModel(
                    id="test_id",
                    data_type="user",
                    name="支援者責任者",
                    role="supporter_mgr",
                    email="supporter_mgr@example.com",
                    project_ids=[],
                    supporter_organization_id=["test_organization_id"],
                ),
                ProjectModel(
                    id="test_project_id",
                    name="test_project",
                    customer_id="test_customer_id",
                    customer_name="test_customer",
                    supporter_organization_id="test_organization_id",
                    main_sales_user_id="test_id",
                    main_customer_user_id="test_customer_id",
                    main_supporter_user_id="test_supporter_id",
                    supporter_user_ids=["test_supporter_id"],
                    customer_user_ids=["test_customer_id"],
                    support_date_from="2024/01/01",
                    support_date_to="2024/12/31",
                    total_contract_time=100,
                ),
                True,
                id="returns_true_for_supporter_mgr_department_assigned_cases",
            ),
            pytest.param(
                UserModel(
                    id="test_id",
                    data_type="user",
                    name="支援者責任者",
                    role="supporter_mgr",
                    email="supporter_mgr@example.com",
                    project_ids=[],
                    supporter_organization_id=["test_organization_id"],
                ),
                ProjectModel(
                    id="test_project_id",
                    name="test_project",
                    customer_id="test_customer_id",
                    customer_name="test_customer",
                    supporter_organization_id="example_organization_id",
                    main_sales_user_id="test_id",
                    main_customer_user_id="test_customer_id",
                    main_supporter_user_id="test_supporter_id",
                    supporter_user_ids=["test_supporter_id"],
                    customer_user_ids=["test_customer_id"],
                    support_date_from="2024/01/01",
                    support_date_to="2024/12/31",
                    total_contract_time=100,
                ),
                False,
                id="returns_false_for_supporter_non_department_assigned_cases",
            ),
            pytest.param(
                UserModel(
                    id="test_id",
                    data_type="user",
                    name="支援者責任者",
                    role="supporter_mgr",
                    email="supporter_mgr@example.com",
                    supporter_organization_id=["test_organization_id"],
                ),
                ProjectModel(
                    id="test_project_id",
                    name="test_project",
                    customer_id="test_customer_id",
                    customer_name="test_customer",
                    supporter_organization_id="example_organization_id",
                    main_sales_user_id="test_id",
                    main_customer_user_id="test_customer_id",
                    main_supporter_user_id="test_supporter_id",
                    supporter_user_ids=["test_supporter_id"],
                    customer_user_ids=["test_customer_id"],
                    support_date_from="2024/01/01",
                    support_date_to="2024/12/31",
                    total_contract_time=100,
                ),
                False,
                id="returns_true_for_supporter_mgr_when_no_cases_are_assigned",
            ),
        ],
    )
    def test_is_accessible_karte_detail(self, user, project, expected):
        result = SchedulesService.is_accessible_karte_detail(user, project)
        assert result == expected
