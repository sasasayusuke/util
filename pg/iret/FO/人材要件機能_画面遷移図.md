# 人材要件機能 画面遷移図

## 📋 概要
このドキュメントは、人材要件機能（ソルバーソーシング機能）の画面遷移を視覚的に表現した画面遷移図です。
各画面間の遷移関係と主要な操作フローを明確にし、システムの全体像を把握できるようにしています。

---

## 🗺️ 全体画面遷移図

```mermaid
%%{init: {'theme':'base', 'themeVariables': {'primaryColor':'#e1d5e7', 'primaryTextColor':'#000', 'primaryBorderColor':'#7C0000', 'lineColor':'#F8B229', 'secondaryColor':'#006100', 'tertiaryColor':'#fff'}}}%%
graph TB
    %% ログイン・認証系
    Login[ログイン画面<br/>index.vue] --> Home[ホーム画面<br/>home.vue]
    
    %% ホームからメニューへ
    Home --> SolverMenu[ソルバーメニュー<br/>solver/menu.vue]
    
    %% メニューから各機能へ
    SolverMenu --> |新規個人ソルバー申請| SolverApp[個人ソルバー申請<br/>solver/application.vue]
    SolverMenu --> |新規ソルバー候補申請| CandidateApp[ソルバー候補申請<br/>solver/candidate/application.vue]
    SolverMenu --> |個人ソルバー一覧| SolverList[個人ソルバー一覧<br/>solver/list/_solverCorporationId.vue]
    SolverMenu --> |ソルバー候補一覧| CandidateList[ソルバー候補一覧<br/>solver/candidate/list/_solverCorporationId.vue]
    SolverMenu --> |稼働率・単価更新| UtilRate[稼働率・単価更新<br/>solver/utilization-rate/_solver_corporation_id.vue]
    SolverMenu --> |法人ソルバー情報詳細| CorpDetail[法人ソルバー詳細<br/>solver/corporation/_corporationId.vue]
    
    %% 一覧から詳細へ
    SolverList --> |詳細確認| SolverDetail[個人ソルバー詳細<br/>solver/_solverId.vue]
    CandidateList --> |詳細確認| CandidateDetail[ソルバー候補詳細<br/>solver/candidate/_solver_id.vue]
    
    %% 候補から認定へ
    CandidateDetail --> |個人ソルバー認定| CertScreen[ソルバー認定画面<br/>solver/candidate/certification/_solver_id.vue]
    
    %% 各画面から戻る
    SolverApp -.-> |戻る/完了| SolverMenu
    CandidateApp -.-> |戻る/完了| SolverMenu
    SolverList -.-> |戻る| SolverMenu
    CandidateList -.-> |戻る| SolverMenu
    UtilRate -.-> |戻る/完了| SolverMenu
    CorpDetail -.-> |戻る| SolverMenu
    SolverDetail -.-> |戻る| SolverList
    CandidateDetail -.-> |戻る| CandidateList
    CertScreen -.-> |完了| SolverList
    
    %% スタイル定義
    classDef menu fill:#e1d5e7,stroke:#333,stroke-width:2px,color:#000
    classDef form fill:#d5e7e1,stroke:#333,stroke-width:2px,color:#000
    classDef list fill:#e7e1d5,stroke:#333,stroke-width:2px,color:#000
    classDef detail fill:#d5d5e7,stroke:#333,stroke-width:2px,color:#000
    
    class SolverMenu menu
    class SolverApp,CandidateApp,UtilRate,CertScreen form
    class SolverList,CandidateList list
    class SolverDetail,CandidateDetail,CorpDetail detail
```

---

## 🔄 主要機能別画面遷移

### 1. 個人ソルバー申請フロー

```mermaid
%%{init: {'theme':'base', 'themeVariables': {'primaryColor':'#d5e7e1'}}}%%
graph LR
    Menu[ソルバーメニュー] --> App[個人ソルバー申請画面]
    App --> |一時保存| App
    App --> |確認画面へ| Confirm[確認画面<br/>※同一画面内]
    Confirm --> |申請| Complete[完了<br/>※モーダル表示]
    Complete --> Menu
    
    App --> |キャンセル| Menu
```

### 2. ソルバー候補管理フロー

```mermaid
%%{init: {'theme':'base', 'themeVariables': {'primaryColor':'#e7e1d5'}}}%%
graph LR
    Menu[ソルバーメニュー] --> CandList[ソルバー候補一覧]
    CandList --> CandDetail[候補者詳細]
    CandDetail --> |編集| CandDetail
    CandDetail --> |認定開始| Cert[認定画面]
    Cert --> |認定完了| SolverList[個人ソルバー一覧]
    
    CandDetail --> |削除| CandList
    CandDetail --> |戻る| CandList
    CandList --> |戻る| Menu
```

### 3. 稼働率・単価更新フロー

```mermaid
%%{init: {'theme':'base', 'themeVariables': {'primaryColor':'#d5d5e7'}}}%%
graph LR
    Menu[ソルバーメニュー] --> UtilRate[稼働率・単価更新画面]
    UtilRate --> |一括更新| UtilRate
    UtilRate --> |更新完了| Complete[完了メッセージ<br/>※同一画面内]
    Complete --> UtilRate
    UtilRate --> |戻る| Menu
```

---

## 📱 画面詳細情報

### メニュー画面
- **パス**: `/solver/menu`
- **ファイル**: `solver/menu.vue`
- **主要機能**: 
  - 法人ソルバー選択（必須）
  - 各機能へのナビゲーション

### 申請系画面
| 画面名 | パス | 特徴 |
|--------|------|------|
| 個人ソルバー申請 | `/solver/application` | 32項目入力、一時保存可能 |
| ソルバー候補申請 | `/solver/candidate/application` | 基本情報のみ、複数人同時申請可能 |

### 一覧系画面
| 画面名 | パス | 特徴 |
|--------|------|------|
| 個人ソルバー一覧 | `/solver/list/{corporationId}` | 絞り込み検索、ページング |
| ソルバー候補一覧 | `/solver/candidate/list/{corporationId}` | 候補者管理、認定操作 |

### 詳細・編集系画面
| 画面名 | パス | 特徴 |
|--------|------|------|
| 個人ソルバー詳細 | `/solver/{solverId}` | 閲覧・編集・削除 |
| ソルバー候補詳細 | `/solver/candidate/{solver_id}` | 閲覧・編集・認定・削除 |
| 認定画面 | `/solver/candidate/certification/{solver_id}` | 候補→個人ソルバー昇格 |
| 法人ソルバー詳細 | `/solver/corporation/{corporationId}` | 法人情報管理 |

### 更新系画面
| 画面名 | パス | 特徴 |
|--------|------|------|
| 稼働率・単価更新 | `/solver/utilization-rate/{corporationId}` | 一括更新、楽観ロック制御 |

---

## 🚦 画面遷移の制御

### 権限による制御
```mermaid
graph TD
    Auth{認証・権限確認} --> |APT| AllAccess[全機能アクセス可能]
    Auth --> |SOLVER_STAFF| LimitedAccess[所属法人のみアクセス可能]
    Auth --> |権限なし| Error403[403エラー画面]
```

### 法人ソルバー選択による制御
```mermaid
graph TD
    Menu[ソルバーメニュー] --> Check{法人選択済み？}
    Check --> |Yes| Functions[各機能有効化]
    Check --> |No| Modal[法人情報入力モーダル]
    Modal --> |登録完了| Functions
```

---

## 💡 画面遷移のポイント

### 1. 状態管理
- **Vuex Store**を使用した状態管理
- 選択された法人ソルバーIDは`solver-corporation`ストアで管理
- エラー情報は`error-bar`ストアで一元管理

### 2. 遷移制御
- **middleware/roleCheck.ts**による権限チェック
- 法人未選択時は機能ボタンを無効化
- 認定完了後は自動的に個人ソルバー一覧へ遷移

### 3. ユーザビリティ
- パンくずリストによる現在位置の明示
- 「戻る」ボタンの統一的な配置
- 処理中のローディング表示

### 4. エラーハンドリング
- 403: 権限エラー → 専用エラー画面
- 409: 更新競合 → 再読み込みを促すメッセージ
- 500: サーバーエラー → エラーバーで通知

---

## 🔗 関連ドキュメント
- [ソルバーソーシング機能フローチャート.md](./ソルバーソーシング機能フローチャート.md) - 処理フローの詳細
- [人材要件機能フローチャート.md](./人材要件機能フローチャート.md) - 業務フローを含む完全版