# 人材要件機能画面遷移図

## 📋 概要
ログイン画面から人材要件機能（ソルバー管理）までの画面遷移を示すフローチャートです。
法人ソルバー担当者が個人ソルバーを管理するまでの一連の画面遷移を表現しています。

---

## 🔍 参考資料
- 参照したPDF: 【FY25】ソルバーソーシング機能(対応範囲のみ）.pdf
- 参照したSVG: 新業務フロー図.drawio.svg
- 関連ソースコード:
  - `/src/pages/index.vue` - ログイン画面
  - `/src/pages/user-policy.vue` - 利用規約画面
  - `/src/pages/solver/menu.vue` - ソルバーメニュー画面
  - `/src/middleware/roleCheck.ts` - 利用規約チェック処理

---

## 📊 画面遷移図

```mermaid
%%{init: {'theme':'base', 'themeVariables': {'primaryColor':'#e1d5e7'}}}%%
flowchart TD
    Start([開始]) --> Login[ログイン画面<br/>URL: /]
    
    Login --> Auth{認証<br/>サインイン}
    Auth -->|成功| RoleCheck{利用規約<br/>同意済み？}
    Auth -->|失敗| Login
    
    RoleCheck -->|未同意<br/>初回ログイン| Policy[利用規約画面<br/>URL: /user-policy]
    RoleCheck -->|同意済み| CheckUserRole{ユーザー<br/>ロール判定}
    
    Policy --> Agree{利用規約に<br/>同意する？}
    Agree -->|同意| CheckUserRole
    Agree -->|非同意| Login
    
    CheckUserRole -->|APT/<br/>SOLVER_STAFF| SolverMenu[ソルバーメニュー画面<br/>URL: /solver/menu]
    CheckUserRole -->|その他| Home[ホーム画面<br/>URL: /home]
    
    SolverMenu --> SelectCorp[法人ソルバー選択<br/>GUI: プルダウン選択]
    
    SelectCorp --> CheckCorpInfo{法人情報<br/>登録済み？}
    CheckCorpInfo -->|未登録| CorpModal[法人情報入力モーダル<br/>GUI: モーダル表示]
    CheckCorpInfo -->|登録済み| MenuDisplay[メニュー項目表示]
    
    CorpModal --> InputCorpInfo[法人情報入力<br/>GUI: フォーム入力]
    InputCorpInfo --> SaveCorp[法人情報保存]
    SaveCorp --> MenuDisplay
    
    MenuDisplay --> HR[人材要件機能選択<br/>GUI: メニュークリック]
    
    HR --> |個人ソルバー一覧| SolverList[個人ソルバー一覧画面<br/>URL: /solver/list/{corporationId}]
    HR --> |新規個人ソルバー申請| SolverApp[新規個人ソルバー申請画面<br/>URL: /solver/application]
    HR --> |新規ソルバー候補申請| CandidateApp[新規ソルバー候補申請画面<br/>URL: /solver/candidate/application]
    HR --> |ソルバー候補一覧| CandidateList[ソルバー候補一覧画面<br/>URL: /solver/candidate/list/{corporationId}]
    HR --> |稼働率・単価更新| RateUpdate[稼働率・単価更新画面<br/>URL: /solver/utilization-rate/{corporationId}]
    
    SolverList --> End([終了])
    SolverApp --> End
    CandidateApp --> End
    CandidateList --> End
    RateUpdate --> End
    
    style Start fill:#e1f5fe
    style End fill:#c8e6c9
    style Policy fill:#fff3e0
    style CorpModal fill:#fff3e0
```

---

## 🖥️ 画面別詳細

### 1. ログイン画面（URL: /）
**ソースファイル**: `src/pages/index.vue`

#### 画面要素:
| 表示ラベル | 動作 | 次の遷移先 |
|-----------|------|-----------|
| サインイン | AWS Cognitoによる認証 | 利用規約画面 or メニュー画面 |
| アカウント新規登録 | 新規登録画面へ | 新規登録画面 |

---

### 2. 利用規約画面（URL: /user-policy）
**ソースファイル**: `src/pages/user-policy.vue`
**表示条件**: 初回ログイン時（agreed = false）

#### 画面要素:
| 表示ラベル | 動作 | 次の遷移先 |
|-----------|------|-----------|
| Partner Portal利用規約に同意する | チェックボックス選択 | - |
| 利用を開始する | 同意処理実行 | ロールに応じた画面 |

#### ロール別遷移先:
- APT、SOLVER_STAFF → `/solver/menu`
- その他のロール → `/home`

---

### 3. ソルバーメニュー画面（URL: /solver/menu）
**ソースファイル**: `src/pages/solver/menu.vue`

#### 画面要素:
| 表示ラベル | 動作 | 次の遷移先 |
|-----------|------|-----------|
| 法人ソルバーを選択する | プルダウン選択 | 各機能へ |
| 新規個人ソルバー申請 | 新規申請画面へ | /solver/application |
| 新規ソルバー候補申請 | 候補申請画面へ | /solver/candidate/application |
| 個人ソルバー一覧 | 一覧表示 | /solver/list/{corporationId} |
| ソルバー候補一覧 | 候補一覧表示 | /solver/candidate/list/{corporationId} |
| 個人ソルバー稼働率・単価更新 | 稼働率更新画面へ | /solver/utilization-rate/{corporationId} |

---

## 🔄 画面遷移フロー詳細

### STEP 1: ログイン認証
1. **ログイン画面**でサインインボタンをクリック
2. **AWS Cognito**による認証処理
3. 認証成功後、ミドルウェアで利用規約同意状態をチェック

### STEP 2: 利用規約確認（初回のみ）
1. **利用規約画面**が自動表示される
2. 「Partner Portal利用規約に同意する」をチェック
3. 「利用を開始する」ボタンをクリック
4. ロールに応じて適切な画面へ遷移

### STEP 3: ソルバーメニュー表示
1. APT/SOLVER_STAFFロールの場合、**ソルバーメニュー画面**へ遷移
2. 法人ソルバーをプルダウンから選択
3. 法人情報未登録の場合はモーダルで入力を促す

### STEP 4: 人材要件機能へのアクセス
1. メニューから必要な機能を選択
2. 各機能画面へ遷移して操作を実行

---

## ⚠️ 注意事項

### 利用規約の表示条件
- `meStore.agreed`が`false`の場合のみ表示
- 一度同意すると再表示されない
- `/src/middleware/roleCheck.ts`で制御

### ロール別アクセス制限
| ロール | アクセス可能画面 |
|--------|----------------|
| APT | ソルバーメニュー画面（全法人選択可） |
| SOLVER_STAFF | ソルバーメニュー画面（所属法人のみ） |
| その他 | ホーム画面 |

### 法人情報の初期設定
- 法人ソルバー選択時、`updateAt`が存在しない場合は初期設定が必要
- モーダルで法人情報入力を促す
- 入力完了後、メニュー項目が有効化される

---

## 📝 補足情報

### 新人向けの説明
1. **画面遷移の基本フロー**
   - ログイン → 利用規約（初回） → メニュー → 各機能
   - 利用規約は初回ログイン時のみ表示される

2. **ロールによる画面制御**
   - APTとSOLVER_STAFFのみソルバーメニューにアクセス可能
   - その他のロールはホーム画面へ遷移

3. **法人ソルバー選択の重要性**
   - すべての人材要件機能は法人ソルバー選択が前提
   - 法人情報が未登録の場合は先に登録が必要