# 個人ソルバー不明データ対応機能テスト仕様書

## 📋 概要

個人ソルバーの「生年月日不明」「単価不明」対応機能のテスト仕様書です。
生年月日や単価（人月単価、時間単価）が不明な個人ソルバーが存在するため、それらのデータを明示的に「不明」として設定・確認できる機能を追加します。

### 要件概要
1. **生年月日不明**: チェックボックスでの不明設定、選択時は生年月日入力をグレーアウト
2. **単価不明**: 0（ゼロ）値を「不明」表示（稼働率・単価一括更新画面は除く）
3. **Salesforce連携**: 生年月日不明フラグの新項目追加

### 現在の実装状況
- **部分実装済み**: 0値を「不明」表示、デフォルト生年月日（1900/01/01）を「不明」表示
- **追加実装必要**: 明示的な「不明」チェックボックス、Salesforce連携項目

---

## 🔍 要件と現在実装の差異

| 項目 | 要件 | 現在の実装 | 状態 |
|------|------|-----------|------|
| **生年月日不明チェックボックス** | 新規追加 | ❌ 未実装 | 🔄 実装予定 |
| **生年月日グレーアウト** | チェック時に無効化 | ❌ 未実装 | 🔄 実装予定 |
| **単価0値の不明表示** | 「不明」と表示 | ✅ 実装済み | ✅ 実装済み |
| **稼働率・単価一括更新での不明非表示** | 0値のまま表示 | ✅ 実装済み | ✅ 実装済み |
| **Salesforce連携項目** | 新項目追加 | ❌ 未実装 | 🔄 実装予定 |

---

## 🎯 テスト目的

1. **生年月日不明機能**: チェックボックスでの不明設定とグレーアウト動作確認
2. **単価不明表示**: 0値の「不明」表示動作確認
3. **画面別表示差異**: 詳細画面と一括更新画面での表示差異確認
4. **データ保存・読み込み**: 不明状態の正常な保存・表示確認
5. **Salesforce連携**: 新項目の連携動作確認

---

## 👥 テスト実施対象ロール

| ロール | 日本語名 | ソルバー管理 | 一括更新 | テスト実施 | 備考 |
|--------|----------|-------------|---------|-----------|------|
| **apt** | アライアンス担当 | ✅ | ✅ | ✅ | メインテストロール |
| **solver_staff** | 法人ソルバー担当 | ✅（自社のみ） | ✅（自社のみ） | ✅ | 制限付きテスト |

---

## 📊 テスト前準備（データ作成手順）

### STEP 1: テスト用ユーザー作成

#### 1-1. アライアンス担当（apt）の作成
```
必要データ:
- ユーザーID: test-apt-unknown-001
- 名前: 不明データテストAPT
- メールアドレス: unknown-apt@example.com
- ロール: apt
```

#### 1-2. 法人ソルバー担当（solver_staff）の作成
```
必要データ:
- ユーザーID: test-staff-unknown-001
- 名前: 不明データテスト担当
- メールアドレス: unknown-staff@example.com
- ロール: solver_staff
- 所属ソルバー法人ID: test-corporation-unknown-001
```

### STEP 2: テスト用ソルバー法人作成

```
必要データ:
- ソルバー法人ID: test-corporation-unknown-001
- 法人名: 不明データテスト株式会社
- 担当者: test-staff-unknown-001
```

### STEP 3: テスト用個人ソルバー作成

#### 3-1. 既存データパターンのソルバー作成
```
ソルバー1（通常データ）:
- ID: test-solver-normal-001
- 名前: 通常太郎
- 生年月日: 1990/05/15
- 人月単価（上限）: 800000
- 人月単価（下限）: 600000
- 時間単価（上限）: 5000
- 時間単価（下限）: 3000

ソルバー2（現在の不明データ）:
- ID: test-solver-unknown-001
- 名前: 不明花子
- 生年月日: 1900/01/01（デフォルト値）
- 人月単価（上限）: 0
- 人月単価（下限）: 0
- 時間単価（上限）: 0
- 時間単価（下限）: 0
```

### STEP 4: Salesforceテスト環境準備

```
Salesforce側準備:
- 新項目「生年月日不明」フラグの追加
- 連携テスト用アカウント設定
- データ同期確認用の設定
```

---

## 🧪 テストケース詳細

### 【テストケース TC-UNKNOWN-001】生年月日不明チェックボックス機能確認

#### 実施ロール: apt（アライアンス担当）

#### 手順:
1. **FO画面にaptでログイン**
   - URL: `/`
   - 期待結果: HOME画面が表示される

2. **ソルバー法人一覧にアクセス**
   - 操作: ヘッダー → 「ソルバー法人管理」をクリック
   - URL: `/solver-corporation/list`
   - 期待結果: ソルバー法人一覧画面が表示される

3. **テスト用ソルバー法人を選択**
   - 操作: 「不明データテスト株式会社」をクリック
   - URL: `/solver-corporation/test-corporation-unknown-001`
   - 期待結果: ソルバー法人詳細画面が表示される

4. **個人ソルバー一覧にアクセス**
   - 操作: 「個人ソルバー一覧」タブをクリック
   - URL: `/solver/list/test-corporation-unknown-001`
   - 期待結果: 個人ソルバー一覧画面が表示される

5. **個人ソルバー詳細画面に遷移**
   - 操作: 「通常太郎」をクリック
   - URL: `/solver/test-solver-normal-001`
   - 期待結果: ソルバー詳細画面が表示される

6. **編集モードに切り替え**
   - 操作: 「編集」ボタンをクリック
   - 期待結果: ソルバー編集モードになる

7. **生年月日不明チェックボックスを確認**
   - 確認項目: 生年月日入力欄の近くに「生年月日不明」チェックボックスが表示される
   - 期待結果: ✅ チェックボックスが実装されている

8. **生年月日不明チェックボックスをチェック**
   - 操作: 「生年月日不明」チェックボックスにチェックを入れる
   - 確認項目: 生年月日入力欄がグレーアウト（無効化）される
   - 期待結果: ✅ 生年月日欄が編集不可になる

9. **保存動作確認**
   - 操作: 「保存」ボタンをクリック
   - 期待結果: ✅ 正常に保存される

#### 判定基準:
- ✅ **PASS**: チェックボックスが機能し、グレーアウトと保存が正常動作
- ❌ **FAIL**: チェックボックスが表示されない、またはグレーアウトしない

---

### 【テストケース TC-UNKNOWN-002】生年月日不明チェック解除時の動作確認

#### 実施ロール: apt（アライアンス担当）

#### 手順:
1. **前のテストケースから継続**
   - 前提: TC-UNKNOWN-001で「生年月日不明」をチェック済み

2. **生年月日不明チェックを解除**
   - 操作: 「生年月日不明」チェックボックスのチェックを外す
   - 確認項目: 生年月日入力欄のグレーアウトが解除される
   - 期待結果: ✅ 生年月日欄が編集可能に戻る

3. **生年月日を入力**
   - 操作: 生年月日欄に「1995/03/20」を入力
   - 期待結果: ✅ 正常に入力できる

4. **保存と表示確認**
   - 操作: 「保存」ボタンをクリック
   - 確認項目: 詳細表示で「1995/03/20」が表示される
   - 期待結果: ✅ 入力した生年月日が正しく表示される

#### 判定基準:
- ✅ **PASS**: チェック解除で入力可能になり、正常に保存・表示される
- ❌ **FAIL**: グレーアウトが解除されない、または保存できない

---

### 【テストケース TC-UNKNOWN-003】単価不明表示確認（詳細画面）

#### 実施ロール: apt（アライアンス担当）

#### 手順:
1. **0値単価のソルバー詳細画面にアクセス**
   - 操作: ソルバー一覧 → 「不明花子」をクリック
   - URL: `/solver/test-solver-unknown-001`
   - 期待結果: ソルバー詳細画面が表示される

2. **人月単価の不明表示確認**
   - 確認項目: 人月単価（上限）欄に「不明」と表示される
   - 確認項目: 人月単価（下限）欄に「不明」と表示される
   - 確認項目: 単位表示（万円）が非表示になる
   - 期待結果: ✅ 0値が「不明」として表示される

3. **時間単価の不明表示確認**
   - 確認項目: 時間単価（上限）欄に「不明」と表示される
   - 確認項目: 時間単価（下限）欄に「不明」と表示される
   - 確認項目: 単位表示（円）が非表示になる
   - 期待結果: ✅ 0値が「不明」として表示される

4. **編集モードでの確認**
   - 操作: 「編集」ボタンをクリック
   - 確認項目: 編集モードでも入力欄に0が表示されるか、空欄になるか
   - 期待結果: ✅ 適切な編集表示

#### 判定基準:
- ✅ **PASS**: 0値が全て「不明」表示され、単位も非表示
- ❌ **FAIL**: 0値がそのまま表示される、または単位が表示される

---

### 【テストケース TC-UNKNOWN-004】単価不明から通常値への変更確認

#### 実施ロール: apt（アライアンス担当）

#### 手順:
1. **0値単価のソルバーを編集**
   - 前提: TC-UNKNOWN-003の編集モード状態
   
2. **人月単価を通常値に変更**
   - 操作: 人月単価（上限）に「800000」を入力
   - 操作: 人月単価（下限）に「600000」を入力
   - 期待結果: ✅ 正常に入力できる

3. **時間単価を通常値に変更**
   - 操作: 時間単価（上限）に「5000」を入力
   - 操作: 時間単価（下限）に「3000」を入力
   - 期待結果: ✅ 正常に入力できる

4. **保存と表示確認**
   - 操作: 「保存」ボタンをクリック
   - 確認項目: 詳細表示で単価が数値表示される
   - 確認項目: 単位（万円、円）が表示される
   - 期待結果: ✅ 通常の単価表示に変わる

5. **再度0値に変更**
   - 操作: 編集モードで全ての単価を「0」に変更
   - 操作: 保存
   - 確認項目: 再び「不明」表示に戻る
   - 期待結果: ✅ 「不明」表示に戻る

#### 判定基準:
- ✅ **PASS**: 通常値と0値の間で適切に表示が切り替わる
- ❌ **FAIL**: 表示が正しく切り替わらない

---

### 【テストケース TC-UNKNOWN-005】稼働率・単価一括更新画面での表示確認

#### 実施ロール: apt（アライアンス担当）

#### 手順:
1. **稼働率・単価一括更新画面にアクセス**
   - 操作: ソルバー法人詳細 → 「稼働率・単価一括更新」ボタンをクリック
   - URL: `/solver/utilization-rate/test-corporation-unknown-001`
   - 期待結果: 一括更新画面が表示される

2. **一括更新画面での0値表示確認**
   - 確認項目: 「不明花子」の人月単価欄に「0」が表示される（「不明」ではない）
   - 確認項目: 「不明花子」の時間単価欄に「0」が表示される（「不明」ではない）
   - 期待結果: ✅ 一括更新画面では「不明」表示せず0値のまま

3. **通常値ソルバーとの比較**
   - 確認項目: 「通常太郎」の単価は数値で表示される
   - 確認項目: 0値と通常値の表示が区別できる
   - 期待結果: ✅ 正常値と0値が適切に表示される

4. **一括更新での単価変更**
   - 操作: 「不明花子」の人月単価を「700000-500000」に変更
   - 操作: 「保存」ボタンをクリック
   - 期待結果: ✅ 正常に更新される

5. **詳細画面での更新確認**
   - 操作: ソルバー詳細画面に戻る
   - 確認項目: 変更した単価が数値表示されている
   - 期待結果: ✅ 一括更新が詳細画面に反映される

#### 判定基準:
- ✅ **PASS**: 一括更新画面では「不明」表示せず、0値と数値が正しく表示される
- ❌ **FAIL**: 一括更新画面でも「不明」表示される、または表示に問題

---

### 【テストケース TC-UNKNOWN-006】法人ソルバー担当での制限確認

#### 実施ロール: solver_staff（法人ソルバー担当）

#### 手順:
1. **FO画面にsolver_staffでログイン**
   - URL: `/`
   - 期待結果: HOME画面が表示される

2. **自社ソルバー一覧のアクセス確認**
   - 操作: ソルバー管理画面にアクセス
   - 確認項目: 自社（test-corporation-unknown-001）のソルバーのみ表示される
   - 期待結果: ✅ 自社ソルバーのみアクセス可能

3. **他社ソルバーへのアクセス制限確認**
   - 操作: URLを直接変更して他社ソルバーにアクセス試行
   - URL: `/solver/list/other-corporation-id`
   - 期待結果: ✅ 403エラーまたはアクセス拒否

4. **自社ソルバーでの不明データ機能確認**
   - 操作: 自社ソルバーの編集
   - 確認項目: 生年月日不明チェックボックスが表示される
   - 確認項目: 単価不明表示が機能する
   - 期待結果: ✅ aptと同様の機能が利用可能

#### 判定基準:
- ✅ **PASS**: 自社ソルバーのみアクセス可能で、不明データ機能も正常動作
- ❌ **FAIL**: 他社にアクセスできる、または機能に制限がある

---

### 【テストケース TC-UNKNOWN-007】Salesforce連携確認

#### 実施ロール: apt（アライアンス担当）

#### 手順:
1. **生年月日不明データの連携確認**
   - 前提: TC-UNKNOWN-001で「生年月日不明」にチェックしたソルバー
   - 操作: Salesforce側でソルバーデータを確認
   - 確認項目: 新項目「生年月日不明」フラグがtrueになっている
   - 期待結果: ✅ 不明フラグが正しく連携される

2. **生年月日通常データの連携確認**
   - 前提: 通常の生年月日が設定されたソルバー
   - 操作: Salesforce側でソルバーデータを確認
   - 確認項目: 「生年月日不明」フラグがfalseまたは未設定
   - 確認項目: 生年月日フィールドに実際の日付が入っている
   - 期待結果: ✅ 通常データも正しく連携される

3. **連携タイミングの確認**
   - 操作: ソルバーデータを更新
   - 確認項目: Salesforceへの同期タイミング（即時/バッチ処理）
   - 期待結果: ✅ 決められたタイミングで同期される

#### 判定基準:
- ✅ **PASS**: 生年月日不明フラグが正しくSalesforceに連携される
- ❌ **FAIL**: 連携されない、または不正確なデータが連携される

---

### 【テストケース TC-UNKNOWN-008】データ境界値・異常系テスト

#### 実施ロール: apt（アライアンス担当）

#### 手順:
1. **生年月日不明チェック状態での日付入力試行**
   - 操作: 「生年月日不明」をチェック
   - 操作: 生年月日欄への直接入力を試行
   - 期待結果: ✅ 入力が無効化されている

2. **負の値での単価設定試行**
   - 操作: 人月単価に「-100000」を入力
   - 期待結果: ✅ バリデーションエラーが表示される

3. **上限 < 下限の単価設定**
   - 操作: 人月単価上限「500000」、下限「800000」を設定
   - 期待結果: ✅ 論理エラーが検出される

4. **極端に大きな値の単価設定**
   - 操作: 人月単価に「999999999」を入力
   - 期待結果: ✅ 適切な上限チェックまたは警告

5. **必須項目未入力での保存試行**
   - 操作: 名前を空欄にして保存
   - 期待結果: ✅ 必須項目エラーが表示される

#### 判定基準:
- ✅ **PASS**: 全ての異常値・境界値で適切な制御・エラー表示
- ❌ **FAIL**: 異常値が受け入れられる、またはエラー処理が不適切

---

## 📋 テスト実施チェックリスト

### 基本機能テスト
- [ ] TC-UNKNOWN-001: 生年月日不明チェックボックス機能
- [ ] TC-UNKNOWN-002: 生年月日不明チェック解除動作
- [ ] TC-UNKNOWN-003: 単価不明表示確認（詳細画面）
- [ ] TC-UNKNOWN-004: 単価不明から通常値への変更
- [ ] TC-UNKNOWN-005: 稼働率・単価一括更新画面での表示
- [ ] TC-UNKNOWN-006: 法人ソルバー担当での制限確認
- [ ] TC-UNKNOWN-007: Salesforce連携確認
- [ ] TC-UNKNOWN-008: データ境界値・異常系テスト

### 表示・UI確認
- [ ] 生年月日不明チェックボックスの表示
- [ ] 生年月日欄のグレーアウト動作
- [ ] 単価「不明」表示の正確性
- [ ] 一括更新画面での0値表示

### データ連携確認
- [ ] Salesforce生年月日不明フラグ連携
- [ ] 連携タイミングの確認
- [ ] データ整合性チェック

---

## 🚨 実装必要箇所と現在状況

| 機能 | 実装状況 | 対応状況 |
|------|----------|----------|
| **生年月日不明チェックボックス** | ❌ 未実装 | 🔄 v2.5で実装予定 |
| **生年月日グレーアウト制御** | ❌ 未実装 | 🔄 v2.5で実装予定 |
| **単価0値不明表示** | ✅ 実装済み | ✅ 既存機能 |
| **一括更新画面0値表示** | ✅ 実装済み | ✅ 既存機能 |
| **Salesforce連携項目** | ❌ 未実装 | 🔄 v2.5で実装予定 |

---

## 🎯 テスト完了判定基準

### ✅ 全テストPASS条件（実装完了後）
1. **生年月日不明チェックボックスが正常に機能する**
2. **生年月日欄のグレーアウト制御が動作する**
3. **単価0値の「不明」表示が適切に機能する**
4. **一括更新画面では「不明」表示されない**
5. **Salesforce連携で不明フラグが正しく同期される**
6. **ロール別アクセス制限が適切に機能する**

### ⚠️ 現在テスト可能な項目
- 単価0値の「不明」表示機能
- 一括更新画面での0値表示
- ロール別アクセス制限
- 既存の生年月日デフォルト値表示

---

## 📊 実装ファイル予想

### フロントエンド修正箇所
```
/components/solver/molecules/SolverDetailRows.vue
/components/common/molecules/SolverDateSelect.vue
/types/Solver.ts
/common/BaseVueClass.ts
```

### バックエンド修正箇所
```
/schemas/solver.py
/models/solver.py
/service/solver_service.py
```

### Salesforce連携
```
新フィールド: BirthDateUnknown__c (Checkbox)
```

---

## 📞 問題発生時の連絡先

- **システム管理者**: [連絡先]
- **開発チーム**: [連絡先]
- **Salesforce管理者**: [連絡先]

---

*このテスト仕様書は、個人ソルバーの不明データ対応機能の動作確認を目的としています。*
*v2.5での実装完了後、このテスト仕様に基づいて機能検証を実施してください。*