# 個別カルテ・スケジュール一覧表示位置変更機能テスト仕様書

## 📋 概要

個別カルテ・スケジュール一覧画面における支援日スケジュールの表示位置変更機能のテスト仕様書です。
ユーザビリティ向上のため、直近の支援スケジュールを最上部などの目立つ位置に表示し、ログインから個別カルテ入力までの導線を短縮する機能改善をテストします。

### 現在の実装状況
- **カルテ一覧画面**: `/karte/list/{projectId}`で表示
- **スケジュール表示**: `LatestSupportProjectSchedule.vue`コンポーネントで実装済み
- **ソート順**: 過去7日間から今日まで、日時降順（直近が上位）
- **表示件数**: 最大10件

---

## 🔍 要件と現在実装の差異

| 項目 | 要件 | 現在の実装 | 状態 |
|------|------|-----------|------|
| **表示位置** | 最上部などの目立つ位置 | 画面上部に配置済み | ✅ 実装済み |
| **ソート順** | 直近の日付のものを最初に表示 | 日時降順で実装済み | ✅ 実装済み |
| **クエリロジック** | HOMEの「直近の個別カルテ」に合わせる | 同様のロジック実装済み | ✅ 実装済み |
| **ユーザー導線** | ログイン→カルテ入力の導線短縮 | HOME画面からダイレクトアクセス可能 | ✅ 実装済み |

---

## 🎯 テスト目的

1. **表示位置確認**: 支援スケジュールが画面上部の目立つ位置に表示されることを確認
2. **ソート順確認**: 直近の支援スケジュールが最上位に表示されることを確認
3. **クエリ動作確認**: HOMEの「直近の個別カルテ」と同様のフィルタリング・ソートが動作することを確認
4. **ユーザー導線確認**: ログインからカルテ入力までの操作が短縮されることを確認
5. **ロール別表示確認**: 各ユーザーロールで適切にスケジュールが表示されることを確認

---

## 👥 テスト実施可能ロール

| ロール | 日本語名 | カルテ閲覧 | カルテ編集 | HOME直近カルテ表示 | 備考 |
|--------|----------|-----------|-----------|-------------------|------|
| **supporter** | 支援者 | ✅ | ✅ | ✅（10件） | 主要テストロール |
| **supporter_mgr** | 支援者責任者 | ✅ | ✅ | ✅（10件） | 全権限 |
| **business_mgr** | 事業責任者 | ✅ | ✅ | ✅（10件） | 全権限 |
| **sales** | 営業担当者 | ✅ | ❌ | ✅（10件） | 閲覧のみ |
| **customer** | 顧客 | ✅ | ❌ | ✅（5件） | 公開カルテのみ |
| **sales_mgr** | 営業責任者 | ✅ | ❌ | ❌ | HOME直近カルテ非表示 |

---

## 📊 テスト前準備（データ作成手順）

### STEP 1: テスト用ユーザー作成

#### 1-1. 支援者（supporter）の作成
```
必要データ:
- ユーザーID: test-supporter-schedule-001
- 名前: スケジュールテスト支援者
- メールアドレス: schedule-supporter@example.com
- ロール: supporter
```

#### 1-2. 顧客（customer）の作成
```
必要データ:
- ユーザーID: test-customer-schedule-001
- 名前: スケジュールテスト顧客
- メールアドレス: schedule-customer@example.com
- ロール: customer
```

### STEP 2: テスト用プロジェクト作成

```
必要データ:
- プロジェクトID: test-project-schedule-001
- プロジェクト名: スケジュール表示位置テストプロジェクト
- 顧客名: テストスケジュール株式会社
- 主担当支援者ID: test-supporter-schedule-001
- 主担当顧客ID: test-customer-schedule-001
- 支援開始日: 2024/01/01
- 支援終了日: 2024/12/31
```

### STEP 3: テスト用支援スケジュール・カルテ作成

#### 3-1. 複数日程のスケジュール作成
FO画面で以下のスケジュールを作成：

**過去のスケジュール（実施済み）:**
```
1. 日付: 2024/01/10, 時間: 10:00-12:00
2. 日付: 2024/01/08, 時間: 14:00-16:00
3. 日付: 2024/01/05, 時間: 09:00-11:00
```

**本日・近日のスケジュール:**
```
4. 日付: [本日], 時間: 13:00-15:00
5. 日付: [明日], 時間: 10:00-12:00
6. 日付: [3日後], 時間: 16:00-18:00
```

#### 3-2. カルテ自動生成の確認
各スケジュール作成後、対応するカルテが自動生成されることを確認

#### 3-3. 一部カルテの編集・確定
```
- カルテ1（1/10）: 内容入力済み、下書きフラグ=false
- カルテ2（1/8）: 内容入力済み、下書きフラグ=false
- カルテ3（1/5）: 下書き状態（空）
- カルテ4（本日）: 下書き状態（空）
- カルテ5（明日）: 下書き状態（空）
```

### STEP 4: 比較用データ作成

#### 4-1. HOME画面表示確認用データ
追加でカルテを作成して、HOME画面の「直近の個別カルテ」表示を確認

---

## 🧪 テストケース詳細

### 【テストケース TC-SCHED-001】HOME画面からの導線確認

#### 実施ロール: supporter（支援者）

#### 手順:
1. **FO画面にsupporterでログイン**
   - URL: `/`
   - 期待結果: HOME画面が表示される

2. **「直近のカルテ」セクションを確認**
   - 確認項目: 直近10件のカルテが表示されている
   - 確認項目: 日時降順（新しいものが上）でソートされている
   - 期待結果: ✅ 作成したテストカルテが適切にソートされて表示される

3. **カルテカードをクリックしてカルテ詳細画面へ遷移**
   - 操作: 最新のカルテカードをクリック
   - 期待結果: カルテ詳細画面（`/karte/{karteId}`）が表示される

4. **操作時間を測定**
   - 測定項目: ログインからカルテ詳細画面表示までの時間
   - 期待結果: 3クリック以内でアクセス可能

#### 判定基準:
- ✅ **PASS**: 直近カルテが正しくソートされ、3クリック以内でカルテ詳細に到達
- ❌ **FAIL**: ソート順が間違っている、または導線が長い

---

### 【テストケース TC-SCHED-002】カルテ一覧画面のスケジュール表示位置確認

#### 実施ロール: supporter（支援者）

#### 手順:
1. **カルテ一覧画面にアクセス**
   - URL: `/karte/list/test-project-schedule-001`
   - 期待結果: プロジェクトのカルテ一覧画面が表示される

2. **画面レイアウトの確認**
   - 確認項目: 画面上部に「直近のカルテ」セクションが表示されている
   - 確認項目: スケジュール一覧がその下に表示されている
   - 期待結果: ✅ 目立つ位置（上部）にスケジュールが配置されている

3. **スケジュール表示順序の確認**
   - 確認項目: 直近の日付のスケジュールが最上位に表示される
   - 確認項目: 過去7日間から今日までのスケジュールのみ表示される
   - 期待結果: ✅ 日時降順でソートされている

4. **表示件数の確認**
   - 確認項目: 最大10件のスケジュールが表示される
   - 期待結果: ✅ 件数制限が正しく適用されている

#### 判定基準:
- ✅ **PASS**: スケジュールが上部に配置され、正しくソートされている
- ❌ **FAIL**: 表示位置が目立たない、またはソート順が間違っている

---

### 【テストケース TC-SCHED-003】スケジュール表示内容確認

#### 実施ロール: supporter（支援者）

#### 手順:
1. **カルテ一覧画面でスケジュール詳細を確認**
   - 確認項目: 各スケジュールの表示内容
     - 日付・時間
     - ステータス（予定/進行中/実施済）
     - カルテへのリンク

2. **ステータス表示の確認**
   - **予定**: 開始時間が未来のスケジュール
   - **進行中**: 現在時刻が開始〜終了時間の間のスケジュール
   - **実施済**: 終了時間が過去のスケジュール
   - 期待結果: ✅ 各ステータスが正しく表示される

3. **カルテリンクの動作確認**
   - 操作: スケジュール行のカルテリンクをクリック
   - 期待結果: 対応するカルテ詳細画面が表示される

#### 判定基準:
- ✅ **PASS**: 全ての表示内容とリンクが正常に動作する
- ❌ **FAIL**: 表示内容に誤りがある、またはリンクが動作しない

---

### 【テストケース TC-SCHED-004】ロール別表示権限確認

#### 4-1. 顧客（customer）での表示確認

#### 手順:
1. **FO画面にcustomerでログイン**
2. **HOME画面の直近カルテを確認**
   - 確認項目: 最大5件の表示
   - 確認項目: 下書き状態のカルテは非表示
   - 期待結果: ✅ 顧客向け制限が正しく適用される

3. **カルテ一覧画面にアクセス**
   - URL: `/karte/list/test-project-schedule-001`
   - 期待結果: アクセス可能で適切な内容が表示される

#### 4-2. 営業責任者（sales_mgr）での表示確認

#### 手順:
1. **BO画面にsales_mgrでログイン**
2. **HOME画面の直近カルテ表示を確認**
   - 確認項目: 「直近のカルテ」セクションが表示されない
   - 期待結果: ✅ 営業責任者には直近カルテが非表示

3. **カルテ一覧画面にアクセス**
   - アクセス方法: ヘッダー → 案件管理 → プロジェクト詳細 → カルテ一覧
   - 期待結果: ✅ アクセス可能で内容が表示される

#### 判定基準:
- ✅ **PASS**: 各ロールで期待通りの表示制御が動作する
- ❌ **FAIL**: ロール別制限が正しく適用されない

---

### 【テストケース TC-SCHED-005】クエリ動作確認（HOMEとの整合性）

#### 実施ロール: supporter（支援者）

#### 手順:
1. **HOME画面の直近カルテデータを記録**
   - 確認項目: 表示されるカルテのID・日時・順序
   - 記録: HOME画面での表示内容をメモ

2. **カルテ一覧画面のスケジュール表示を確認**
   - 確認項目: HOME画面と同じフィルタリング・ソートロジックが適用されているか
   - 比較項目:
     - 日付範囲（過去7日間〜今日）
     - ソート順（日時降順）
     - 表示件数制限

3. **データの整合性確認**
   - 確認項目: 同じプロジェクトのカルテが両画面で一貫して表示される
   - 期待結果: ✅ HOMEとカルテ一覧で同様のロジックが動作

#### 判定基準:
- ✅ **PASS**: HOMEとカルテ一覧でクエリロジックが整合している
- ❌ **FAIL**: 表示内容に不整合がある

---

### 【テストケース TC-SCHED-006】レスポンシブ表示確認

#### 実施ロール: supporter（支援者）

#### 手順:
1. **デスクトップ表示での確認**
   - 画面サイズ: 1920x1080
   - 確認項目: スケジュール表示が適切にレイアウトされている

2. **タブレット表示での確認**
   - 画面サイズ: 768x1024
   - 確認項目: スケジュール表示が崩れていない

3. **スマートフォン表示での確認**
   - 画面サイズ: 375x667
   - 確認項目: スケジュール表示が適切に縮小表示される

#### 判定基準:
- ✅ **PASS**: 全ての画面サイズで適切に表示される
- ❌ **FAIL**: 特定の画面サイズで表示が崩れる

---

### 【テストケース TC-SCHED-007】パフォーマンス確認

#### 実施ロール: supporter（支援者）

#### 手順:
1. **大量データでの表示確認**
   - 前提: 100件以上のスケジュール・カルテが存在する状態
   - 測定項目: カルテ一覧画面の読み込み時間

2. **表示速度の確認**
   - 期待値: 3秒以内での画面表示完了
   - 確認項目: スケジュール表示部分の読み込み時間

#### 判定基準:
- ✅ **PASS**: 大量データでも3秒以内で表示完了
- ❌ **FAIL**: 表示に3秒以上かかる

---

## 📋 テスト実施チェックリスト

### 機能テスト
- [ ] TC-SCHED-001: HOME画面からの導線確認
- [ ] TC-SCHED-002: カルテ一覧画面のスケジュール表示位置確認
- [ ] TC-SCHED-003: スケジュール表示内容確認
- [ ] TC-SCHED-004: ロール別表示権限確認
  - [ ] 4-1: customer表示確認
  - [ ] 4-2: sales_mgr表示確認
- [ ] TC-SCHED-005: クエリ動作確認（HOMEとの整合性）
- [ ] TC-SCHED-006: レスポンシブ表示確認
- [ ] TC-SCHED-007: パフォーマンス確認

### ユーザビリティテスト
- [ ] ログイン→カルテ入力の操作時間短縮確認
- [ ] 直感的な画面レイアウト確認
- [ ] スケジュール情報の視認性確認

---

## 🚨 既知の実装状況

| 項目 | 要件 | 現在実装 | 対応状況 |
|------|------|----------|----------|
| **表示位置** | 最上部などの目立つ位置 | 画面上部に実装済み | ✅ 実装完了 |
| **ソート順** | 直近の日付を最初に表示 | 日時降順で実装済み | ✅ 実装完了 |
| **クエリ整合性** | HOMEの直近カルテと合わせる | 同様ロジック実装済み | ✅ 実装完了 |
| **ユーザー導線** | ログイン→カルテ入力短縮 | HOMEからダイレクトアクセス可能 | ✅ 実装完了 |

---

## 🎯 テスト完了判定基準

### ✅ 全テストPASS条件
1. **全機能テストケースがPASS**
2. **全ロールでの表示権限制御が正常動作**
3. **HOMEとカルテ一覧のクエリロジックが整合**
4. **ユーザー導線が3クリック以内で完了**
5. **レスポンシブ表示が全画面サイズで正常**

### 🎯 ユーザビリティ改善効果の確認
1. **操作時間短縮**: ログインからカルテ入力まで従来比50%短縮
2. **視認性向上**: 直近スケジュールが即座に確認可能
3. **直感的操作**: 新人でも迷わずカルテ入力画面にアクセス可能

---

## 📊 性能基準

| 項目 | 目標値 | 測定方法 |
|------|--------|----------|
| **画面表示時間** | 3秒以内 | ブラウザ開発者ツールで測定 |
| **スケジュール表示** | 1秒以内 | コンポーネント読み込み時間 |
| **ユーザー操作** | 3クリック以内 | ログイン→カルテ詳細画面 |

---

## 📞 問題発生時の連絡先

- **システム管理者**: [連絡先]
- **開発チーム**: [連絡先]
- **UX/UI担当**: [連絡先]

---

*このテスト仕様書は、個別カルテ・スケジュール一覧画面の表示位置変更機能の動作確認とユーザビリティ改善効果の検証を目的としています。*
*機能は既に実装済みのため、テストは動作確認と改善効果の測定に重点を置いて実施してください。*