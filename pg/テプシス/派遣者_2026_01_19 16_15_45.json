{
  "HeaderInfo": {
    "AssemblyVersion": "1.4.1.1",
    "BaseSiteId": 255686,
    "Server": "http://192.168.10.67",
    "CreatorName": "Administrator",
    "PackageTime": "2026-01-19T07:15:45.8665144+00:00",
    "Convertors": [
      {
        "SiteId": 255686,
        "SiteTitle": "派遣者",
        "ReferenceType": "Results",
        "IncludeData": false
      }
    ],
    "IncludeSitePermission": true,
    "IncludeRecordPermission": true,
    "IncludeColumnPermission": true,
    "IncludeNotifications": true,
    "IncludeReminders": true
  },
  "Sites": [
    {
      "TenantId": 1,
      "SiteId": 255686,
      "Title": "派遣者",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 255673,
      "InheritPermission": 255686,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "DateA",
          "ClassB",
          "ClassC"
        ],
        "EditorColumnHash": {
          "General": [
            "ResultId",
            "ClassA",
            "DateA",
            "ClassC",
            "CheckA",
            "ClassB",
            "ClassY"
          ]
        },
        "LinkColumns": [
          "ClassA",
          "DateA",
          "ClassB",
          "ClassC"
        ],
        "Columns": [
          {
            "ColumnName": "ResultId",
            "LabelText": "派遣者予定Id",
            "Hide": true
          },
          {
            "ColumnName": "ClassA",
            "LabelText": "店舗名",
            "NoWrap": true,
            "ValidateRequired": true
          },
          {
            "ColumnName": "DateA",
            "LabelText": "日付",
            "NoWrap": true
          },
          {
            "ColumnName": "DateB",
            "LabelText": "派遣不可期間 終了日"
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "イベント予定一覧",
            "ChoicesText": "[[255671]]",
            "Hide": true,
            "Link": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "派遣者名",
            "ChoicesText": "[[255670,NoAddButton]]",
            "MultipleSelections": true,
            "NoWrap": true,
            "Link": true
          },
          {
            "ColumnName": "CheckA",
            "LabelText": "派遣有無",
            "Hide": true
          },
          {
            "ColumnName": "ClassY",
            "LabelText": "イベント店舗ID",
            "ValidateRequired": true,
            "EditorReadOnly": true
          }
        ],
        "Links": [
          {
            "ColumnName": "ClassB",
            "SiteId": 255671
          },
          {
            "ColumnName": "ClassC",
            "SiteId": 255670,
            "NoAddButton": true
          }
        ],
        "Exports": [
          {
            "Name": "一括アップロード用",
            "Columns": [
              {
                "Id": 1,
                "ColumnName": "ClassA"
              },
              {
                "Id": 2,
                "ColumnName": "ClassB"
              },
              {
                "Id": 3,
                "ColumnName": "CheckA"
              },
              {
                "Id": 4,
                "ColumnName": "ClassC"
              },
              {
                "Id": 5,
                "ColumnName": "DateA"
              }
            ],
            "Type": 0,
            "DelimiterType": 0,
            "ExecutionType": 0,
            "Id": 1
          }
        ],
        "Styles": [
          {
            "Title": "【表示制御】派遣者画面スタイル",
            "New": true,
            "Edit": true,
            "Body": "@charset \"UTF-8\";\n/* ===================\n    色定義\n==================*/\n/* ===================\n    縦スペース定義\n==================*/\n/* ===================\n    横スペース定義\n==================*/\n/* ===================\n    テキストサイズ定義\n==================*/\n.sdt-dispatch {\n  position: absolute;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  overflow: auto;\n  background-color: #F2F2F2;\n  z-index: 705;\n}\n.sdt-dispatch .sdt-dispatch-wrap {\n  position: relative;\n  display: block;\n  width: 100%;\n  height: 100%;\n  padding: 20px;\n  background-color: #F2F2F2;\n}\n.sdt-dispatch .sdt-dispatch-title {\n  margin: 0;\n}\n.sdt-dispatch .sdt-dispatch-title__text {\n  font-weight: bold;\n  font-size: 1.2em;\n}\n.sdt-dispatch .sdt-dispatch-form {\n  margin-top: 20px;\n}\n@media screen and (max-width: 760px) {\n  .sdt-dispatch .sdt-dispatch-form {\n    margin-top: 15px;\n  }\n}\n.sdt-dispatch .sdt-dispatch-form__area {\n  position: relative;\n  display: flex;\n  flex-wrap: wrap;\n  width: 100%;\n  padding: 20px;\n  border-radius: 10px;\n  background-color: #fff;\n}\n@media screen and (max-width: 760px) {\n  .sdt-dispatch .sdt-dispatch-form__area {\n    padding: 15px;\n  }\n}\n.sdt-dispatch .sdt-dispatch-form .sdt-form-title {\n  width: 100%;\n  margin: 0;\n  padding: 0;\n  margin-bottom: 12px;\n}\n@media screen and (max-width: 760px) {\n  .sdt-dispatch .sdt-dispatch-form .sdt-form-title {\n    margin-bottom: 9px;\n  }\n}\n.sdt-dispatch .sdt-form-box {\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n  min-width: 30%;\n  max-width: 50%;\n  height: 30px;\n  padding-right: 12px;\n  margin-bottom: 12px;\n}\n@media screen and (max-width: 760px) {\n  .sdt-dispatch .sdt-form-box {\n    min-width: 100%;\n    max-width: 100%;\n    padding-right: 9px;\n    margin-bottom: 9px;\n  }\n}\n.sdt-dispatch .sdt-form-label {\n  position: relative;\n  min-width: 120px;\n  height: auto;\n}\n.sdt-dispatch .sdt-required {\n  color: #E80000;\n  margin-left: 4px;\n}\n.sdt-dispatch .sdt-form-inputArea {\n  width: calc(100% - 120px);\n  height: 100%;\n}\n.sdt-dispatch .sdt-form-inputArea--date {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.sdt-dispatch .sdt-date-separator {\n  color: #3B3B3B;\n}\n.sdt-dispatch .sdt-input {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  padding: 0 12px;\n  border-radius: 5px;\n  border: none;\n  box-shadow: 0 0 0 1px #78818F inset;\n  -webkit-appearance: none;\n     -moz-appearance: none;\n          appearance: none;\n  font-size: 14px;\n  background-color: #fff;\n}\n.sdt-dispatch .sdt-input--date {\n  width: 140px;\n}\n@media screen and (max-width: 760px) {\n  .sdt-dispatch .sdt-input {\n    padding: 0 9px;\n    font-size: 14px;\n  }\n  .sdt-dispatch .sdt-input--date {\n    width: 120px;\n  }\n}\n.sdt-dispatch .sdt-input::-moz-placeholder {\n  color: #C4C9D0;\n}\n.sdt-dispatch .sdt-input::placeholder {\n  color: #C4C9D0;\n}\n.sdt-dispatch .sdt-input:focus {\n  outline: 0;\n  box-shadow: 0 0 0 2px #2F80ED inset;\n  color: #3B3B3B;\n}\n.sdt-dispatch .sdt-selector {\n  position: relative;\n  width: 100%;\n}\n.sdt-dispatch .sdt-selector:before {\n  content: \"\";\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  margin: auto;\n  width: 0;\n  height: 0;\n  right: 8px;\n  border-left: 6px solid transparent;\n  border-right: 6px solid transparent;\n  border-top: 10px solid #C4C9D0;\n  pointer-events: none;\n}\n@media screen and (max-width: 760px) {\n  .sdt-dispatch .sdt-selector:before {\n    right: 6px;\n    border-left: 5px solid transparent;\n    border-right: 5px solid transparent;\n    border-top: 8px solid #C4C9D0;\n  }\n}\n.sdt-dispatch .sdt-selector-content {\n  width: 100%;\n  height: 30px;\n  padding: 0 38px 0 8px;\n  border-radius: 4px;\n  border: none;\n  box-shadow: 0 0 0 1px #C4C9D0 inset;\n  -webkit-appearance: none;\n     -moz-appearance: none;\n          appearance: none;\n  cursor: pointer;\n  font-size: 14px;\n}\n@media screen and (max-width: 760px) {\n  .sdt-dispatch .sdt-selector-content {\n    font-size: 12px;\n    height: 30px;\n    padding: 0 25px 0 6px;\n  }\n}\n.sdt-dispatch .sdt-selector-content:focus {\n  outline: 0;\n  box-shadow: 0 0 0 2px #2F80ED inset;\n}\n/* フォーム項目の幅調整 */\n.sdt-dispatch .sdt-form-shop {\n  width: 100%;\n  max-width: 100%;\n}\n.sdt-dispatch .sdt-form-shop .sdt-form-inputArea {\n  width: 200px;\n}\n.sdt-dispatch .sdt-form-date {\n  width: 100%;\n  max-width: 100%;\n}\n/* 派遣者一覧テーブル */\n.sdt-dispatch .sdt-dispatch-table {\n  position: relative;\n  margin-top: 20px;\n}\n@media screen and (max-width: 760px) {\n  .sdt-dispatch .sdt-dispatch-table {\n    margin-top: 15px;\n  }\n}\n.sdt-dispatch .sdt-dispatch-table__wrap {\n  position: relative;\n  width: 100%;\n  max-height: 300px;\n  overflow: auto;\n  border-radius: 8px;\n  border: 1px solid #C4C9D0;\n  background-color: #fff;\n}\n.sdt-dispatch .sdt-table {\n  width: 100%;\n  border-collapse: collapse;\n}\n.sdt-dispatch .sdt-table__head {\n  background-color: #F8F9FA;\n  position: sticky;\n  top: 0;\n  z-index: 10;\n}\n.sdt-dispatch .sdt-table__cell {\n  padding: 12px;\n  box-sizing: border-box;\n  border-bottom: solid 1px #E0E0E0;\n  text-align: left;\n  vertical-align: middle;\n  position: relative;\n  z-index: 1;\n}\n.sdt-dispatch .sdt-table__cell-head {\n  font-weight: bold;\n  background-color: #F8F9FA;\n}\n@media screen and (max-width: 760px) {\n  .sdt-dispatch .sdt-table__cell {\n    padding: 9px;\n  }\n}\n.sdt-dispatch .sdt-checkbox {\n  width: 18px;\n  height: 18px;\n  cursor: pointer;\n}\n.sdt-dispatch .sdt-checkbox:disabled {\n  cursor: not-allowed;\n  opacity: 0.5;\n}\n/* 派遣不可行のスタイル */\n.sdt-dispatch .sdt-table__row--disabled {\n  background-color: #f5f5f5;\n  color: #999;\n}\n/* アクションボタン */\n.sdt-dispatch .sdt-form-buttonArea {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 20px;\n  width: 100%;\n  margin-top: 20px;\n}\n@media screen and (max-width: 760px) {\n  .sdt-dispatch .sdt-form-buttonArea {\n    gap: 15px;\n    margin-top: 15px;\n  }\n}\n.sdt-dispatch .sdt-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 150px;\n  height: 40px;\n  border-radius: 8px;\n  padding: 12px 20px;\n  border: none;\n  cursor: pointer;\n  transition: opacity 0.2s;\n}\n.sdt-dispatch .sdt-button:hover {\n  opacity: 0.8;\n}\n.sdt-dispatch .sdt-button:disabled {\n  background-color: #C4C9D0;\n  cursor: not-allowed;\n  opacity: 0.6;\n}\n.sdt-dispatch .sdt-button:disabled .sdt-button__text {\n  color: #fff;\n}\n.sdt-dispatch .sdt-button--primary {\n  background-color: #2F80ED;\n}\n.sdt-dispatch .sdt-button--primary .sdt-button__text {\n  color: #fff;\n}\n.sdt-dispatch .sdt-button--secondary {\n  background-color: #f8f8f8;\n  border: 1px solid #C4C9D0;\n}\n.sdt-dispatch .sdt-button--secondary .sdt-button__text {\n  color: #3B3B3B;\n}\n.sdt-dispatch .sdt-button--danger {\n  background-color: #E80000;\n}\n.sdt-dispatch .sdt-button--danger .sdt-button__text {\n  color: #fff;\n}\n@media screen and (max-width: 760px) {\n  .sdt-dispatch .sdt-button {\n    min-width: 120px;\n    padding: 9px 15px;\n  }\n}\n",
            "Id": 1
          },
          {
            "Title": "【表示制御】プリザンター表示合わせ調整スタイル",
            "New": true,
            "Edit": true,
            "Body": ".sdt-dispatch .sdt-dispatch-wrap {\n  background-color: #fff;\n  border: 1px solid #d19405;\n  background: #feeebd url(../../styles/plugins/themes/sunny/images/ui-bg_highlight-soft_100_feeebd_1x100.png) 50% top repeat-x;\n  border-radius: 10px;\n}\n.sdt-dispatch .sdt-dispatch-wrap .sdt-dispatch-title {\n  font-size: 20px;\n  font-weight: bold;\n}\n.sdt-dispatch .sdt-dispatch-wrap .sdt-dispatch-form {\n  color: #383838;\n}\n.sdt-dispatch .sdt-dispatch-wrap .sdt-dispatch-form__area {\n  background-color: initial;\n}\n.sdt-dispatch .sdt-dispatch-wrap .sdt-dispatch-form .sdt-selector-content {\n  font-size: 12px;\n}\n.sdt-dispatch .sdt-dispatch-wrap .sdt-dispatch-form .sdt-input {\n  font-size: 12px;\n}\n.sdt-dispatch .sdt-dispatch-wrap .sdt-dispatch-table {\n  margin-top: 0;\n}\n.sdt-dispatch .sdt-dispatch-wrap .sdt-dispatch-table .sdt-table__head {\n  top: -5px;\n  margin-top: -5px;\n}\n.sdt-dispatch .sdt-dispatch-wrap .sdt-dispatch-table .sdt-table__head .sdt-table__row {\n  border: 1px solid #494437;\n  background: #817865 url(../../styles/plugins/themes/sunny/images/ui-bg_gloss-wave_45_817865_500x100.png) 50% 50% repeat-x;\n  color: #fff;\n  font-weight: bold;\n}\n.sdt-dispatch .sdt-dispatch-wrap .sdt-dispatch-table .sdt-table__head .sdt-table__row .sdt-table__cell-head {\n  height: 42px;\n  padding: 6px;\n  border-top: solid 1px transparent;\n  border-bottom: solid 1px transparent;\n  border-left: solid 1px transparent;\n  border-right: solid 1px #fff;\n  background-color: initial;\n  text-align: left;\n}\n.sdt-dispatch .sdt-dispatch-wrap .sdt-dispatch-table .sdt-table__body .sdt-table__row {\n  border: solid 1px #c0c0c0;\n}\n.sdt-dispatch .sdt-dispatch-wrap .sdt-dispatch-table .sdt-table__body .sdt-table__row .sdt-table__cell {\n  border-bottom: solid 1px #c0c0c0;\n  border-left: dotted 1px #c0c0c0;\n  border-right: dotted 1px #c0c0c0;\n  text-align: left;\n}\n.sdt-dispatch .sdt-dispatch-wrap .sdt-form-buttonArea .sdt-button {\n  height: auto;\n  min-width: 80px;\n  padding: 4px 4px 6px 2px;\n}\n.sdt-dispatch .sdt-dispatch-wrap .sdt-form-buttonArea .sdt-button.sdt-button--primary {\n  border: 1px solid #d19405;\n  background: #fece2f url(../../styles/plugins/themes/sunny/images/ui-bg_gloss-wave_60_fece2f_500x100.png) 50% 50% repeat-x;\n}\n.sdt-dispatch .sdt-dispatch-wrap .sdt-form-buttonArea .sdt-button.sdt-button--primary .sdt-button__text {\n  color: #333;\n}",
            "Id": 2
          }
        ],
        "Scripts": [
          {
            "Title": "【設定】サイトID",
            "All": true,
            "Body": "  /* ========================================\n   * 定数・変数\n   * ======================================== */\n  var DISPATCH_OUTPUT_SITE_ID = 255686;      // 派遣者テーブル\n  var DISPATCH_STATUS_SITE_ID = 255670;      // 派遣状況テーブル\n  var PERIOD_SITE_ID = 255692;               // 店舗・期間マスタ\n ",
            "Id": 1
          },
          {
            "Title": "【設定】グローバル変数定義",
            "All": true,
            "Body": " window.force = true;\n\n  // テーブル・カラム定義\n  var TABLES = {\n    // 派遣者テーブル（出力先）\n    DISPATCH_OUTPUT: {\n      SITE_ID: DISPATCH_OUTPUT_SITE_ID,\n      COLUMNS: {\n        SHOP_NAME: 'ClassA',           // 店舗名\n        EVENT_ID: 'ClassB',            // イベント予定一覧（LinkId）\n        DISPATCH_IDS: 'ClassC',        // 派遣者名（JSON配列）\n        SHOP_RESULT_ID: 'ClassY',      // イベント店舗ID\n        DATE: 'DateA'                  // 日付（単日）\n      }\n    },\n    // 派遣状況テーブル（マスタ）\n    DISPATCH_STATUS: {\n      SITE_ID: DISPATCH_STATUS_SITE_ID,\n      COLUMNS: {\n        NAME: 'ClassA',                // 派遣名\n        EVENT_NAME: 'ClassB',          // 派遣先イベント名称\n        RESERVED_DATE: 'DateA',        // 直近の派遣日\n        UNAVAILABLE_FROM: 'DateB',     // 派遣不可期間（開始日）\n        UNAVAILABLE_TO: 'DateC'        // 派遣不可期間（終了日）\n      }\n    },\n    // 開始～終了期間テーブル\n    PERIOD: {\n      SITE_ID: PERIOD_SITE_ID,\n      COLUMNS: {\n        NAME: 'ClassA',                // 店舗名\n        EVENT_ID: 'ClassB',            // イベントID（LinkId）\n        START_DATE: 'DateA',           // 開始日\n        END_DATE: 'DateB'              // 終了日\n      }\n    }\n  };\n",
            "Id": 7
          },
          {
            "Title": "【共通処理】PleasanterAPI",
            "All": true,
            "Body": "/**\n * Pleasanter API ユーティリティクラス（バニラJS版）\n * Python FastAPI の pleasanter/service.py を JavaScript に移植\n */\n\n/**\n * 定数\n */\nconst EMPTY_DATE = '1899-12-30T00:00:00';\nconst PAGE_SIZE = 200;\n\n/**\n * Pleasanter API クライアント\n */\nclass PleasanterAPI {\n  /**\n   * @param {string} baseUrl - PleasanterのベースURL (例: location.origin)\n   * @param {Object} options - オプション\n   * @param {string} [options.apiKey] - APIキー（認証が必要な場合）\n   * @param {string} [options.apiVersion] - APIバージョン（デフォルト: 1.1）\n   * @param {boolean} [options.logging] - ログ出力（デフォルト: false）\n   */\n  constructor(baseUrl, options = {}) {\n    if (!baseUrl) throw new Error('baseUrl は必須です');\n\n    this.baseUrl = baseUrl;\n    this.apiKey = options.apiKey || null;\n    this.apiVersion = options.apiVersion || 1.1;\n    this.logging = options.logging === true;\n  }\n\n  /**\n   * 基本リクエストボディ\n   * @private\n   */\n  _baseBody() {\n    const body = { ApiVersion: this.apiVersion };\n    if (this.apiKey) {\n      body.ApiKey = this.apiKey;\n    }\n    return body;\n  }\n\n  /**\n   * update_dict を 5 つのハッシュに分類\n   * @private\n   */\n  _splitHash(update) {\n    const classHash = {};\n    const numHash = {};\n    const dateHash = {};\n    const descriptionHash = {};\n    const checkHash = {};\n    const other = {};\n\n    for (const [k, v] of Object.entries(update)) {\n      if (k.includes('Class')) {\n        classHash[k] = v;\n      } else if (k.includes('Num')) {\n        numHash[k] = v;\n      } else if (k.includes('Date')) {\n        dateHash[k] = v || EMPTY_DATE;\n      } else if (k.includes('Description')) {\n        descriptionHash[k] = v;\n      } else if (k.includes('Check')) {\n        checkHash[k] = v;\n      } else {\n        other[k] = v;\n      }\n    }\n\n    return {\n      ClassHash: classHash,\n      NumHash: numHash,\n      DateHash: dateHash,\n      DescriptionHash: descriptionHash,\n      CheckHash: checkHash,\n      ...other,\n    };\n  }\n\n  /**\n   * View セクション構築\n   * @private\n   */\n  _buildView(columns, options = {}) {\n    const { setLabelText = true, setDisplayValue = 'DisplayValue' } = options;\n\n    const cols = columns || ['ClassA', 'NumA'];\n\n    return {\n      ApiDataType: 'KeyValues',\n      ApiColumnKeyDisplayType: setLabelText ? 'LabelText' : 'ColumnName',\n      ApiColumnValueDisplayType: setDisplayValue,\n      GridColumns: cols,\n    };\n  }\n\n  /**\n   * HTTP POST リクエスト送信\n   * @private\n   */\n  async _request(endpoint, body, options = {}) {\n    const { ignoreErrors = false } = options;\n\n    const headers = {\n      'Content-Type': 'application/json',\n    };\n\n    try {\n      const res = await fetch(`${this.baseUrl}${endpoint}`, {\n        method: 'POST',\n        headers,\n        body: JSON.stringify(body),\n      });\n\n      if (!res.ok) {\n        if (ignoreErrors) {\n          console.error(`Pleasanter API Error: ${res.status}`);\n          return null;\n        }\n        throw new Error(`HTTP Error: ${res.status} ${res.statusText}`);\n      }\n\n      const data = await res.json();\n      return data;\n    } catch (error) {\n      if (ignoreErrors) {\n        console.error('Pleasanter API Request Failed:', error);\n        return null;\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * 単一レコード取得\n   * @param {number|string} recordId - レコードID\n   * @param {Object} [options] - オプション\n   * @param {string[]} [options.columns] - 取得するカラム\n   * @param {boolean} [options.setLabelText] - カラムキーをラベル名で表示（デフォルト: true）\n   * @param {'DisplayValue'|'Value'|'Both'} [options.setDisplayValue] - 値の表示形式（デフォルト: 'DisplayValue'）\n   * @param {boolean} [options.ignoreErrors] - エラーを無視（デフォルト: false）\n   * @returns {Promise<Object>} レコードデータ\n   */\n  async getRecord(recordId, options = {}) {\n    if (!recordId) throw new Error('recordId は必須です');\n\n    const {\n      columns = null,\n      setLabelText = true,\n      setDisplayValue = 'DisplayValue',\n      ignoreErrors = false,\n    } = options;\n\n    if (setDisplayValue === 'Both') {\n      // DisplayValueとValueの両方を取得してマージ\n      const displayRecord = await this.getRecord(recordId, {\n        ...options,\n        setDisplayValue: 'DisplayValue',\n      });\n      const valueRecord = await this.getRecord(recordId, {\n        ...options,\n        setDisplayValue: 'Value',\n      });\n\n      // マージ\n      const merged = {};\n      for (const key of Object.keys(displayRecord)) {\n        merged[key] = {\n          Display: displayRecord[key],\n          Value: valueRecord[key],\n        };\n      }\n      return merged;\n    }\n\n    // 単一形式で取得\n    const view = this._buildView(columns, { setLabelText, setDisplayValue });\n    const body = { ...this._baseBody(), View: view };\n\n    const resp = await this._request(`/api/items/${recordId}/get`, body, { ignoreErrors });\n\n    if (!resp) {\n      return {};\n    }\n\n    return resp.Response?.Data?.[0] || {};\n  }\n\n  /**\n   * レコード一覧取得（ページネーション対応・全件取得）\n   * @param {number|string} tableId - テーブル（サイト）ID\n   * @param {Object} [options] - オプション\n   * @param {string[]} [options.columns] - 取得するカラム\n   * @param {boolean} [options.setLabelText] - カラムキーをラベル名で表示（デフォルト: true）\n   * @param {'DisplayValue'|'Value'|'Both'} [options.setDisplayValue] - 値の表示形式（デフォルト: 'DisplayValue'）\n   * @param {boolean} [options.ignoreErrors] - エラーを無視（デフォルト: false）\n   * @returns {Promise<Object[]>} レコード配列\n   */\n  async getRecords(tableId, options = {}) {\n    if (!tableId) throw new Error('tableId は必須です');\n\n    const {\n      columns = null,\n      setLabelText = true,\n      setDisplayValue = 'DisplayValue',\n      ignoreErrors = false,\n    } = options;\n\n    if (setDisplayValue === 'Both') {\n      // DisplayValueとValueの両方を取得してマージ\n      const displayRecords = await this.getRecords(tableId, {\n        ...options,\n        setDisplayValue: 'DisplayValue',\n      });\n      const valueRecords = await this.getRecords(tableId, {\n        ...options,\n        setDisplayValue: 'Value',\n      });\n\n      // マージ\n      const merged = displayRecords.map((displayRec, index) => {\n        const valueRec = valueRecords[index];\n        const mergedRec = {};\n        for (const key of Object.keys(displayRec)) {\n          mergedRec[key] = {\n            Display: displayRec[key],\n            Value: valueRec[key],\n          };\n        }\n        return mergedRec;\n      });\n\n      if (this.logging) {\n        console.log(`テーブル(${this.baseUrl}/items/${tableId}/index)から ${merged.length} 件取得しました(Both形式)`);\n        console.table(merged);\n      }\n      return merged;\n    }\n\n    // 単一形式で取得（ページネーション対応）\n    const view = this._buildView(columns, { setLabelText, setDisplayValue });\n    const records = [];\n    let offset = 0;\n\n    while (true) {\n      const body = {\n        ...this._baseBody(),\n        Offset: offset,\n        PageSize: PAGE_SIZE,\n        View: view,\n      };\n\n      const resp = await this._request(`/api/items/${tableId}/get`, body, { ignoreErrors });\n\n      if (!resp) {\n        break;\n      }\n\n      const page = resp.Response?.Data || [];\n      records.push(...page);\n\n      if (page.length < PAGE_SIZE) {\n        break;\n      }\n\n      offset += PAGE_SIZE;\n    }\n\n    if (this.logging) {\n      console.log(`テーブル(${this.baseUrl}/items/${tableId}/index)から ${records.length} 件取得しました`);\n      console.table(records);\n    }\n    return records;\n  }\n\n  /**\n   * レコード作成\n   * @param {number|string} tableId - テーブル（サイト）ID\n   * @param {Object} createData - 作成するレコードデータ\n   * @returns {Promise<Object>} 作成結果\n   */\n  async createRecord(tableId, createData = {}) {\n    if (!tableId) throw new Error('tableId は必須です');\n    if (!createData || Object.keys(createData).length === 0) {\n      throw new Error('createData は必須です');\n    }\n\n    const payload = {\n      ...this._baseBody(),\n      ...this._splitHash(createData),\n    };\n\n    const data = await this._request(`/api/items/${tableId}/create`, payload);\n\n    if (!data) {\n      return {};\n    }\n\n    if (this.logging) {\n      console.log('登録内容:', data);\n    }\n    return data;\n  }\n\n  /**\n   * レコード更新\n   * @param {number|string} recordId - 更新するレコードID\n   * @param {Object} updateData - 更新データ\n   * @returns {Promise<Object>} 更新結果\n   */\n  async updateRecord(recordId, updateData = {}) {\n    if (!recordId) throw new Error('recordId は必須です');\n    if (!updateData || Object.keys(updateData).length === 0) {\n      throw new Error('updateData は必須です');\n    }\n\n    const payload = {\n      ...this._baseBody(),\n      ...this._splitHash(updateData),\n    };\n\n    const data = await this._request(`/api/items/${recordId}/update`, payload);\n\n    if (!data) {\n      return {};\n    }\n\n    if (this.logging) {\n      console.log('更新内容:', data);\n    }\n    return data;\n  }\n\n  /**\n   * レコード削除\n   * @param {number|string} recordId - 削除するレコードID\n   * @returns {Promise<Object>} 削除結果\n   */\n  async deleteRecord(recordId) {\n    if (!recordId) throw new Error('recordId は必須です');\n\n    const payload = this._baseBody();\n\n    const data = await this._request(`/api/items/${recordId}/delete`, payload);\n\n    if (!data) {\n      return {};\n    }\n\n    if (this.logging) {\n      console.log(`削除完了: レコードID ${recordId}`);\n    }\n    return data;\n  }\n}\n",
            "Id": 2
          },
          {
            "Title": "【初期処理】新規作成ボタンの除去",
            "All": true,
            "Body": "document.getElementById(\"NewMenuContainer\").remove()",
            "Id": 6
          },
          {
            "Title": "【画面作成】派遣者初期表示",
            "New": true,
            "Edit": true,
            "Body": "(function ($) {\n  'use strict';\n\n  /************************************************************************\n   * 画面読み込み時に一度だけ実行する初期表示処理\n   *\n   * 目的：\n   *  - ヘッダー（#Header）の高さを取得して、その高さ分だけ\n   *    #fn-dispatch の top をずらします（重なり防止）。\n   *  - さらに #fn-dispatch の高さを CSS の calc() を使って\n   *    calc(100% - {headerHeight}px) に設定します。\n   *  - 店舗マスタ（SiteId: 253154）からデータを取得し、セレクトボックスに設定\n   *\n   * 注意：\n   *  - この処理は「読み込み時に一度だけ実行」されます。\n   *  - #fn-dispatch に top を効かせるには position が必要です。\n   ************************************************************************/\n\n  // 店舗データを保持（セレクトボックス変更時に参照）\n  window.shopRecords = [];\n\n  // 編集モード判定（初期化時に設定）\n  window.isCreateMode = false;\n  // URL由来のモードを保持（動的モード切り替えの判定用）\n  window.isUrlCreateMode = false;\n\n  /* ========================================\n   * レイアウト関連\n   * ======================================== */\n\n  /**\n   * getHeaderHeight\n   * - #Header 要素の「見た目の高さ」をピクセル単位で返します。\n   * - 要素が見つからなければ 0 を返します。\n   *\n   * @returns {number} headerHeightPx - 整数ピクセル\n   */\n  function getHeaderHeight() {\n    var $header = $('#Header');\n\n    if ($header.length === 0) {\n      return 0;\n    }\n\n    var rect = $header[0].getBoundingClientRect();\n    var h = Math.round(rect.height || 0);\n\n    return (h > 0) ? h : 0;\n  }\n\n  /**\n   * buildCalcHeightCss\n   * - ヘッダーのピクセル値を受け取り、CSS の calc() 文字列を返します。\n   *\n   * @param {number} px - ヘッダー高さ（ピクセル）\n   * @returns {string} CSS の値\n   */\n  function buildCalcHeightCss(px) {\n    var n = (typeof px === 'number' && !isNaN(px)) ? px : 0;\n    return 'calc(100% - ' + String(n) + 'px)';\n  }\n\n  /**\n   * applyDispatchLayout\n   * - 実際に DOM に対して style を当てる関数\n   *\n   * @param {number} headerHeightPx - ヘッダーの高さ（ピクセル）\n   */\n  function applyDispatchLayout(headerHeightPx) {\n    var $target = $('#fn-dispatch');\n\n    if ($target.length === 0) {\n      return;\n    }\n\n    $target.css('top', String(headerHeightPx) + 'px');\n    $target.css('height', buildCalcHeightCss(headerHeightPx));\n  }\n\n  /**\n   * initDispatchLayout\n   * - レイアウト初期化\n   */\n  function initDispatchLayout() {\n    var headerH = getHeaderHeight();\n    applyDispatchLayout(headerH);\n  }\n\n  /* ========================================\n   * URLパラメータ取得\n   * ======================================== */\n\n  /**\n   * getUrlParam\n   * - URLから指定したパラメータの値を取得\n   *\n   * @param {string} name - パラメータ名\n   * @returns {string|null} パラメータ値（存在しない場合はnull）\n   */\n  window.getUrlParam = function (name) {\n    var params = new URLSearchParams(window.location.search);\n    return params.get(name);\n  };\n\n  /* ========================================\n   * 店舗セレクトボックス初期化\n   * ======================================== */\n\n  /**\n   * loadShopOptions\n   * - 店舗マスタからデータを取得し、セレクトボックスに設定\n   * - 登録パターン: URLのLinkIdでフィルタリング\n   * - 更新パターン: $p.id()で既存レコードを取得し、EVENT_IDでフィルタリング\n   */\n  async function loadShopOptions() {\n    var $select = $('#fn-formShop');\n    if ($select.length === 0) {\n      return;\n    }\n\n    // 既存のオプションをクリア（placeholder以外）\n    $select.find('option:not([disabled])').remove();\n\n    try {\n      var api = new PleasanterAPI(location.origin, { logging: window.force });\n\n      // フィルタリング用のイベントIDを取得\n      var eventId = null;\n\n      if (window.isUrlCreateMode) {\n        // 登録パターン: URLからLinkIdを取得\n        eventId = window.getUrlParam('LinkId');\n        window.force && console.log('登録パターン - LinkId:', eventId);\n      } else {\n        // 更新パターン: $p.id()で既存レコードを取得し、EVENT_IDを取得\n        var recordId = $p.id();\n        if (recordId) {\n          var existingRecord = await api.getRecord(recordId, {\n            columns: [TABLES.DISPATCH_OUTPUT.COLUMNS.EVENT_ID, TABLES.DISPATCH_OUTPUT.COLUMNS.SHOP_NAME, TABLES.DISPATCH_OUTPUT.COLUMNS.DATE],\n            setLabelText: false,\n            setDisplayValue: 'Value',\n          });\n\n          if (existingRecord && existingRecord[TABLES.DISPATCH_OUTPUT.COLUMNS.EVENT_ID]) {\n            eventId = existingRecord[TABLES.DISPATCH_OUTPUT.COLUMNS.EVENT_ID];\n            window.existingEventId = eventId;\n            window.force && console.log('更新パターン - EVENT_ID:', eventId);\n\n            // 既存の店舗名と日付を保持（後でセット）\n            window.existingShopName = existingRecord[TABLES.DISPATCH_OUTPUT.COLUMNS.SHOP_NAME] || '';\n            window.existingDate = existingRecord[TABLES.DISPATCH_OUTPUT.COLUMNS.DATE] || '';\n          }\n        }\n      }\n\n      // イベント予定一覧（PERIOD_SITE_ID）を取得\n      var records = await api.getRecords(PERIOD_SITE_ID, {\n        columns: [TABLES.PERIOD.COLUMNS.NAME, TABLES.PERIOD.COLUMNS.EVENT_ID, TABLES.PERIOD.COLUMNS.START_DATE, TABLES.PERIOD.COLUMNS.END_DATE, 'ResultId'],\n        setLabelText: false,\n        setDisplayValue: 'Value',\n      });\n\n      if (!records || records.length === 0) {\n        window.force && console.warn('店舗データが取得できませんでした');\n        return;\n      }\n\n      // eventIdでフィルタリング\n      var filteredRecords = eventId\n        ? records.filter(function (record) {\n            return String(record[TABLES.PERIOD.COLUMNS.EVENT_ID]) === String(eventId);\n          })\n        : records;\n\n      window.force && console.log('フィルタ後の店舗データ:', filteredRecords);\n\n      // 店舗データを保持\n      window.shopRecords = filteredRecords;\n\n      filteredRecords.forEach(function (record) {\n        var name = record[TABLES.PERIOD.COLUMNS.NAME] || '';\n\n        if (name) {\n          var $option = $('<option></option>').val(name).text(name);\n          $select.append($option);\n        }\n      });\n\n      // セレクトボックス変更時のイベントハンドラ\n      $select.off('change.shop').on('change.shop', handleShopChange);\n\n      // 日付変更時のイベントハンドラ\n      $('#fn-formDate').off('change.date').on('change.date', handleDateChange);\n\n      // 更新パターン時は既存の店舗と日付をセット、テーブルを表示\n      if (!window.isUrlCreateMode && window.existingShopName) {\n        // 初期表示時のexistingRecordIdを$p.id()でセット（preChecked判定用）\n        window.existingRecordId = $p.id();\n\n        $select.val(window.existingShopName);\n\n        // 選択された店舗のレコードを取得してmin/maxを設定\n        var selectedRecord = window.shopRecords.find(function (record) {\n          return record[TABLES.PERIOD.COLUMNS.NAME] === window.existingShopName;\n        });\n        if (selectedRecord) {\n          var dateFrom = selectedRecord[TABLES.PERIOD.COLUMNS.START_DATE] || '';\n          var dateTo = selectedRecord[TABLES.PERIOD.COLUMNS.END_DATE] || '';\n          var $dateInput = $('#fn-formDate');\n          if ($dateInput.length > 0) {\n            $dateInput.attr('min', window.formatDateForInput(dateFrom));\n            $dateInput.attr('max', window.formatDateForInput(dateTo));\n          }\n        }\n\n        // 日付もセット\n        if (window.existingDate) {\n          $('#fn-formDate').val(window.formatDateForInput(window.existingDate));\n        }\n\n        // 派遣テーブルを表示して描画\n        $('#sdt-dispatch-table').show();\n        if (typeof window.loadDispatchStatus === 'function') {\n          window.loadDispatchStatus();\n        }\n      }\n\n    } catch (error) {\n      window.force && console.error('店舗データ取得エラー:', error);\n    }\n  }\n\n  /**\n   * handleShopChange\n   * - 店舗セレクトボックス変更時に日付の範囲制限を設定（派遣は単日入力）\n   */\n  function handleShopChange() {\n    var selectedValue = $(this).val();\n    if (!selectedValue) {\n      // 店舗未選択時はテーブルを非表示\n      $('#sdt-dispatch-table').hide();\n      return;\n    }\n\n    // 選択された店舗のレコードを検索\n    var selectedRecord = window.shopRecords.find(function (record) {\n      return record[TABLES.PERIOD.COLUMNS.NAME] === selectedValue;\n    });\n\n    if (!selectedRecord) {\n      window.force && console.warn('選択された店舗のデータが見つかりません:', selectedValue);\n      return;\n    }\n\n    window.force && console.log('選択された店舗データ:', selectedRecord);\n\n    // 日付入力のmin/max制限を設定\n    var dateFrom = selectedRecord[TABLES.PERIOD.COLUMNS.START_DATE] || '';\n    var dateTo = selectedRecord[TABLES.PERIOD.COLUMNS.END_DATE] || '';\n\n    var $dateInput = $('#fn-formDate');\n    if ($dateInput.length > 0) {\n      $dateInput.attr('min', window.formatDateForInput(dateFrom));\n      $dateInput.attr('max', window.formatDateForInput(dateTo));\n      // 初期値として開始日を設定\n      $dateInput.val(window.formatDateForInput(dateFrom));\n    }\n\n    // 派遣テーブルを表示して再描画\n    $('#sdt-dispatch-table').show();\n    if (typeof window.loadDispatchStatus === 'function') {\n      window.loadDispatchStatus();\n    }\n  }\n\n  /**\n   * handleDateChange\n   * - 日付変更時に派遣テーブルを再描画\n   */\n  function handleDateChange() {\n    var shopValue = $('#fn-formShop').val();\n    var dateValue = $(this).val();\n\n    if (!shopValue || !dateValue) {\n      return;\n    }\n\n    // 派遣テーブルを再描画（モード切替判定も含む）\n    if (typeof window.loadDispatchStatus === 'function') {\n      window.loadDispatchStatus();\n    }\n  }\n\n  /**\n   * formatDateForInput\n   * - 日付文字列を input[type=\"date\"] 用のフォーマット (YYYY-MM-DD) に変換\n   *\n   * @param {string} dateStr - 日付文字列\n   * @returns {string} YYYY-MM-DD 形式の日付\n   */\n  window.formatDateForInput = function (dateStr) {\n    if (!dateStr) return '';\n\n    // ISO形式 (2025-01-07T00:00:00) の場合\n    if (dateStr.includes('T')) {\n      return dateStr.split('T')[0];\n    }\n\n    // すでに YYYY-MM-DD 形式の場合\n    if (/^\\d{4}-\\d{2}-\\d{2}$/.test(dateStr)) {\n      return dateStr;\n    }\n\n    // その他の形式の場合はDateオブジェクトで変換を試みる\n    try {\n      var d = new Date(dateStr);\n      if (!isNaN(d.getTime())) {\n        return d.toISOString().split('T')[0];\n      }\n    } catch (e) {\n      window.force && console.warn('日付変換エラー:', dateStr, e);\n    }\n\n    return '';\n  };\n\n  /* ========================================\n   * 初期化\n   * ======================================== */\n\n  document.addEventListener('DOMContentLoaded', function () {\n    try {\n      // 編集モード判定（$p.action() が 'NEW' なら作成モード、それ以外は更新モード）\n      var action = $p.action();\n      window.isCreateMode = String(action).toUpperCase() === 'NEW';\n      // URL由来のモードを保持（動的モード切り替えの判定用）\n      window.isUrlCreateMode = window.isCreateMode;\n      window.force && console.log('$p.action():', action);\n      window.force && console.log('isCreateMode:', window.isCreateMode);\n\n      // レイアウト初期化\n      initDispatchLayout();\n\n      // モードに応じてタイトル・ボタンテキストを変更\n      var modeText = window.isCreateMode ? '登録' : '更新';\n      $('.sdt-dispatch-title__text').text('派遣者' + modeText);\n      $('#fn-submitButton .sdt-button__text').text(modeText);\n\n      // 店舗セレクトボックス初期化\n      // 注: 更新パターン時も店舗は変更可能（EVENT_IDでフィルタリング済み）\n      loadShopOptions();\n\n    } catch (e) {\n      window.force && console.error('initDispatchLayout error', e);\n    }\n  });\n\n})(jQuery);\n",
            "Id": 3
          },
          {
            "Title": "【表示制御】派遣者使用可能判定",
            "New": true,
            "Edit": true,
            "Body": "(function ($) {\n  'use strict';\n\n  /************************************************************************\n   * 派遣状況テーブルの取得・判定・描画\n   ************************************************************************/\n\n  // 派遣状況データを保持\n  window.dispatchStatusRecords = [];\n\n  // 派遣出力テーブルの予約データを保持\n  window.dispatchOutputRecords = [];\n\n  // 更新モード初期表示時の既存派遣者IDs（チェック復元用）\n  window.existingDispatchIds = [];\n\n  /* ========================================\n   * 派遣状況テーブル初期化\n   * ======================================== */\n\n  /**\n   * loadDispatchStatus\n   * - 派遣状況テーブルからデータを取得し、テーブルに表示\n   */\n  async function loadDispatchStatus() {\n    // 店舗・日付変更時はチェック状態をリセット\n    window.existingDispatchIds = [];\n\n    try {\n      var api = new PleasanterAPI(location.origin, { logging: window.force });\n\n      // 派遣状況テーブルから取得（RESERVED_DATE は不要）\n      var records = await api.getRecords(DISPATCH_STATUS_SITE_ID, {\n        columns: [TABLES.DISPATCH_STATUS.COLUMNS.NAME, TABLES.DISPATCH_STATUS.COLUMNS.UNAVAILABLE_FROM, TABLES.DISPATCH_STATUS.COLUMNS.UNAVAILABLE_TO, 'ResultId'],\n        setLabelText: false,\n        setDisplayValue: 'Value',\n      });\n\n      if (!records || records.length === 0) {\n        window.force && console.warn('派遣状況データが取得できませんでした');\n        return;\n      }\n\n      window.force && console.log('派遣状況データ:', records);\n\n      // 派遣出力テーブル（253132）から全件取得\n      var outputRecords = await api.getRecords(DISPATCH_OUTPUT_SITE_ID, {\n        columns: [TABLES.DISPATCH_OUTPUT.COLUMNS.DISPATCH_IDS, TABLES.DISPATCH_OUTPUT.COLUMNS.DATE, TABLES.DISPATCH_OUTPUT.COLUMNS.SHOP_NAME, 'ResultId'],\n        setLabelText: false,\n        setDisplayValue: 'Value',\n      });\n\n      window.force && console.log('派遣出力データ:', outputRecords);\n      window.dispatchOutputRecords = outputRecords || [];\n\n      // モード判定（2x2マトリクス）\n      // ┌─────────────┬──────────────────┬──────────────────┐\n      // │             │ URLパターン=NEW  │ URLパターン=Edit │\n      // │             │ (店舗変更可)     │ (店舗変更可)     │\n      // ├─────────────┼──────────────────┼──────────────────┤\n      // │ レコードあり │ 更新モード       │ 更新モード       │\n      // │ レコードなし │ 登録モード       │ 登録モード       │\n      // └─────────────┴──────────────────┴──────────────────┘\n      // - isUrlCreateMode: URLパターン（EVENT_ID取得方法を決定）\n      // - isCreateMode: 実際のモード（API処理 create/update を決定）\n      // - 派遣は「店舗+日付」の組み合わせでレコードを特定\n      // - 店舗・日付変更時は常にモード判定を行う\n      var formShopName = $('#fn-formShop').val() || '';\n      var formDate = $('#fn-formDate').val() || '';\n      var existingRecord = (outputRecords || []).find(function (rec) {\n        // 店舗名と日付の両方が一致するレコードを検索\n        var recShopName = rec[TABLES.DISPATCH_OUTPUT.COLUMNS.SHOP_NAME] || '';\n        var recDate = rec[TABLES.DISPATCH_OUTPUT.COLUMNS.DATE] ? window.formatDateForInput(rec[TABLES.DISPATCH_OUTPUT.COLUMNS.DATE]) : '';\n        return recShopName === formShopName && recDate === formDate;\n      });\n\n      if (existingRecord) {\n        // レコードあり → 更新モード（動的更新 or 更新）\n        window.isCreateMode = false;\n        window.existingRecordId = existingRecord.ResultId;\n        window.force && console.log('同店舗・同日レコード発見、更新モードに切り替え:', existingRecord.ResultId);\n\n        // タイトル・ボタンテキストを更新\n        $('.sdt-dispatch-title__text').text('派遣者更新');\n        $('#fn-submitButton .sdt-button__text').text('更新');\n\n        // 削除ボタンを表示\n        $('#fn-deleteButton').show();\n\n        // 更新モード初期表示時（URLから直接開いた時）は既存のDISPATCH_IDSを保持\n        if (!window.isUrlCreateMode) {\n          var dispatchIdsRaw = existingRecord[TABLES.DISPATCH_OUTPUT.COLUMNS.DISPATCH_IDS];\n          if (Array.isArray(dispatchIdsRaw)) {\n            window.existingDispatchIds = dispatchIdsRaw;\n          } else if (typeof dispatchIdsRaw === 'string') {\n            try {\n              window.existingDispatchIds = JSON.parse(dispatchIdsRaw || '[]');\n            } catch (e) {\n              window.existingDispatchIds = [];\n            }\n          } else {\n            window.existingDispatchIds = [];\n          }\n          window.force && console.log('既存派遣者IDs:', window.existingDispatchIds);\n        }\n      } else {\n        // レコードなし → 登録モード（登録 or 動的登録）\n        window.isCreateMode = true;\n        window.existingRecordId = null;\n        window.force && console.log('同店舗・同日レコードなし、登録モードに切り替え');\n\n        // タイトル・ボタンテキストを登録に変更\n        $('.sdt-dispatch-title__text').text('派遣者登録');\n        $('#fn-submitButton .sdt-button__text').text('登録');\n\n        // 削除ボタンを非表示\n        $('#fn-deleteButton').hide();\n      }\n\n      // データを保持\n      window.dispatchStatusRecords = records;\n\n      // テーブルに描画\n      renderDispatchTable(records);\n\n    } catch (error) {\n      window.force && console.error('派遣状況データ取得エラー:', error);\n    }\n  }\n\n  /**\n   * isDateMatch\n   * - 2つの日付が一致しているかを判定（派遣は単日）\n   *\n   * @param {Date} date1 - 日付1\n   * @param {Date} date2 - 日付2\n   * @returns {boolean} 一致していればtrue\n   */\n  function isDateMatch(date1, date2) {\n    return date1.getTime() === date2.getTime();\n  }\n\n  /**\n   * isDateInRange\n   * - 日付が期間内にあるかを判定\n   *\n   * @param {Date} date - 判定する日付\n   * @param {Date} start - 期間開始日\n   * @param {Date} end - 期間終了日\n   * @returns {boolean} 期間内ならtrue\n   */\n  function isDateInRange(date, start, end) {\n    return date >= start && date <= end;\n  }\n\n  /**\n   * getDispatchStatus\n   * - 派遣者の使用状況を判定\n   * - フォームの日付とDISPATCH_OUTPUTの日付が一致していれば「派遣中」\n   *\n   * @param {Object} record - 派遣状況レコード\n   * @returns {Object} { status: string, canSelect: boolean, preChecked: boolean }\n   */\n  function getDispatchStatus(record) {\n    var dispatchResultId = String(record.ResultId || '');\n\n    // フォームから日付を取得\n    var formDate = $('#fn-formDate').val();\n\n    // 派遣不可期間チェック (UNAVAILABLE_FROM ~ UNAVAILABLE_TO)\n    var unavailableStart = record[TABLES.DISPATCH_STATUS.COLUMNS.UNAVAILABLE_FROM] ? new Date(record[TABLES.DISPATCH_STATUS.COLUMNS.UNAVAILABLE_FROM]) : null;\n    var unavailableEnd = record[TABLES.DISPATCH_STATUS.COLUMNS.UNAVAILABLE_TO] ? new Date(record[TABLES.DISPATCH_STATUS.COLUMNS.UNAVAILABLE_TO]) : null;\n\n    if (unavailableStart && unavailableEnd) {\n      unavailableStart.setHours(0, 0, 0, 0);\n      unavailableEnd.setHours(0, 0, 0, 0);\n\n      // フォームの日付が派遣不可期間内かチェック\n      if (formDate) {\n        var formDateObj = new Date(formDate);\n        formDateObj.setHours(0, 0, 0, 0);\n\n        if (isDateInRange(formDateObj, unavailableStart, unavailableEnd)) {\n          return { status: '派遣不可期間', canSelect: false, preChecked: false };\n        }\n      }\n    }\n\n    // DISPATCH_OUTPUT（253132）の予約データと日付一致チェック\n    // 同店舗で使用中の場合はpreCheckedフラグを立てる\n    var preChecked = false;\n    var formShopName = $('#fn-formShop').val() || '';\n\n    if (formDate && window.dispatchOutputRecords.length > 0) {\n      var formDateObj = new Date(formDate);\n      formDateObj.setHours(0, 0, 0, 0);\n\n      // 更新モード時は自分自身のレコードを識別するためのID\n      var currentRecordId = !window.isCreateMode ? String(window.existingRecordId || $p.id()) : '';\n\n      for (var i = 0; i < window.dispatchOutputRecords.length; i++) {\n        var outputRecord = window.dispatchOutputRecords[i];\n\n        // DISPATCH_IDS（JSON配列）に該当派遣者が含まれているかチェック\n        var dispatchIdsRaw = outputRecord[TABLES.DISPATCH_OUTPUT.COLUMNS.DISPATCH_IDS];\n        var dispatchIds = [];\n\n        if (Array.isArray(dispatchIdsRaw)) {\n          // すでに配列の場合\n          dispatchIds = dispatchIdsRaw;\n        } else if (typeof dispatchIdsRaw === 'string') {\n          // 文字列の場合はJSONパースを試みる\n          try {\n            dispatchIds = JSON.parse(dispatchIdsRaw || '[]');\n          } catch (e) {\n            dispatchIds = [];\n          }\n        }\n\n        // 配列でない場合はスキップ\n        if (!Array.isArray(dispatchIds)) {\n          continue;\n        }\n\n        if (dispatchIds.indexOf(dispatchResultId) < 0 && dispatchIds.indexOf(Number(dispatchResultId)) < 0) {\n          continue;\n        }\n\n        // 日付一致チェック（派遣は単日）\n        var reservedDate = outputRecord[TABLES.DISPATCH_OUTPUT.COLUMNS.DATE] ? new Date(outputRecord[TABLES.DISPATCH_OUTPUT.COLUMNS.DATE]) : null;\n\n        if (reservedDate) {\n          reservedDate.setHours(0, 0, 0, 0);\n\n          if (isDateMatch(formDateObj, reservedDate)) {\n            var shopName = outputRecord[TABLES.DISPATCH_OUTPUT.COLUMNS.SHOP_NAME] || '他店舗';\n\n            // 自分自身のレコード、または同店舗・同日の場合は使用可能＋チェック済みとする\n            if (currentRecordId && String(outputRecord.ResultId) === currentRecordId) {\n              // 自分自身のレコード → preChecked\n              preChecked = true;\n              continue;\n            }\n\n            if (shopName === formShopName) {\n              // 同店舗・同日の別レコード → preChecked\n              preChecked = true;\n              continue;\n            }\n\n            return { status: shopName + 'で選択中', canSelect: false, preChecked: false };\n          }\n        }\n      }\n    }\n\n    // 上記以外は派遣可能\n    return { status: '派遣可能', canSelect: true, preChecked: preChecked };\n  }\n\n  /**\n   * renderDispatchTable\n   * - 派遣者一覧をテーブルに描画\n   *\n   * @param {Array} records - 派遣状況レコード配列\n   */\n  function renderDispatchTable(records) {\n    var $tbody = $('#sdt-dispatch-table .sdt-table__body');\n    if ($tbody.length === 0) {\n      $tbody = $('#sdt-dispatch-table tbody');\n      if ($tbody.length === 0) {\n        window.force && console.error('renderDispatchTable: tbody not found');\n        return;\n      }\n    }\n\n    var $template = $tbody.children('tr.fn-tableColumn-loop').first();\n    if ($template.length === 0) {\n      window.force && console.error('renderDispatchTable: template row not found');\n      return;\n    }\n\n    // テンプレートは非表示のまま保持\n    $template.hide();\n\n    // 既存の出力行（テンプレート以外）を削除\n    $tbody.find('tr').not($template).remove();\n\n    // 派遣者名で昇順ソート\n    var sortedRecords = records.slice().sort(function (a, b) {\n      var nameA = a[TABLES.DISPATCH_STATUS.COLUMNS.NAME] || '';\n      var nameB = b[TABLES.DISPATCH_STATUS.COLUMNS.NAME] || '';\n      return nameA.localeCompare(nameB, 'ja');\n    });\n\n    // DocumentFragment を使ってパフォーマンス向上\n    var fragment = document.createDocumentFragment();\n\n    sortedRecords.forEach(function (record) {\n      var $row = $template.clone().removeClass('fn-tableColumn-loop').show();\n\n      // 派遣者名\n      var name = record[TABLES.DISPATCH_STATUS.COLUMNS.NAME] || '';\n      $row.find('[data-target=\"fn-table-name\"]').text(name);\n\n      // 使用状況を判定\n      var statusInfo = getDispatchStatus(record);\n      $row.find('[data-target=\"fn-table-status\"]').text(statusInfo.status);\n\n      // チェックボックスの設定（valueはResultId、表示は派遣者名）\n      var $checkbox = $row.find('[data-target=\"fn-table-checkbox\"] .fn-pick');\n      if ($checkbox.length) {\n        // valueにはResultIdを設定（ClassCに登録する値）\n        $checkbox.val(record.ResultId || '');\n\n        // 派遣不可の場合はdisabled\n        if (!statusInfo.canSelect) {\n          $checkbox.prop('disabled', true);\n          $row.addClass('sdt-table__row--disabled');\n        }\n\n        // チェック状態の設定\n        var resultId = String(record.ResultId || '');\n        if (!window.isUrlCreateMode && window.existingDispatchIds.length > 0) {\n          // 更新モード初期表示時: 既存のDISPATCH_IDSに含まれていればチェック\n          if (window.existingDispatchIds.indexOf(resultId) >= 0 || window.existingDispatchIds.indexOf(Number(resultId)) >= 0) {\n            $checkbox.prop('checked', true);\n          }\n        } else if (statusInfo.preChecked && window.isUrlCreateMode) {\n          // 登録モードで店舗切替時: 同店舗で既に使用中の場合はチェック\n          $checkbox.prop('checked', true);\n        }\n      }\n\n      fragment.appendChild($row.get(0));\n    });\n\n    $tbody.get(0).appendChild(fragment);\n\n    // ボタン活性状態を更新\n    if (typeof window.updateSubmitButtonState === 'function') {\n      window.updateSubmitButtonState();\n    }\n  }\n\n  /* ========================================\n   * 初期化\n   * ======================================== */\n\n  // loadDispatchStatusをグローバルに公開（店舗・日付変更時に呼び出し）\n  window.loadDispatchStatus = loadDispatchStatus;\n\n  document.addEventListener('DOMContentLoaded', function () {\n    // 作成モード（URL=NEW）時はテーブルを非表示（店舗・日付選択後に表示）\n    // 更新モード（URL=Edit）時は既存データがあるので表示\n    if (window.isUrlCreateMode) {\n      $('#sdt-dispatch-table').hide();\n    }\n  });\n\n})(jQuery);\n",
            "Id": 4
          },
          {
            "Title": "【データ処理】派遣者登録保存削除",
            "New": true,
            "Edit": true,
            "Body": "(function ($) {\n  'use strict';\n\n  /************************************************************************\n   * 既存データ読み込み・バリデーション・登録/更新処理\n   ************************************************************************/\n\n  /* ========================================\n   * 既存データ読み込み（更新モード用）\n   * ======================================== */\n\n  // 注: 既存データの読み込み（店舗・日付・EVENT_ID）は03_初期表示.jsのloadShopOptions()で行われる\n  // チェックボックスの初期状態は04_使用可能判定.jsのpreCheckedで処理される\n\n  /* ========================================\n   * 登録処理\n   * ======================================== */\n\n  /**\n   * validateForm\n   * - フォームのバリデーション\n   *\n   * @returns {Object|null} エラーがあればnull、なければフォームデータ\n   */\n  function validateForm() {\n    var shop = $('#fn-formShop').val();\n    var date = $('#fn-formDate').val();\n    var selectedDispatches = [];\n\n    // 選択された派遣者を取得\n    $('.fn-pick:checked:not(:disabled)').each(function () {\n      selectedDispatches.push($(this).val());\n    });\n\n    var errors = [];\n\n    if (!shop) {\n      errors.push('店舗を選択してください');\n    }\n    if (!date) {\n      errors.push('日付を入力してください');\n    }\n    if (errors.length > 0) {\n      alert(errors.join('\\n'));\n      return null;\n    }\n\n    // チェックボックスの選択チェックはボタンのdisabledで制御するため、ここではチェックしない\n    if (selectedDispatches.length === 0) {\n      return null;\n    }\n\n    return {\n      shop: shop,\n      date: date,\n      selectedDispatches: selectedDispatches\n    };\n  }\n\n  /**\n   * handleSubmit\n   * - 登録/更新ボタンクリック時の処理\n   * - isCreateMode: true → 作成、false → 更新（$p.idを使用）\n   */\n  async function handleSubmit() {\n    var formData = validateForm();\n    if (!formData) return;\n\n    try {\n      var api = new PleasanterAPI(location.origin, { logging: window.force });\n\n      // 派遣者ResultIdは複数選択をJSON配列形式で登録\n      var dispatchIds = JSON.stringify(formData.selectedDispatches);\n\n      var data = {};\n      data[TABLES.DISPATCH_OUTPUT.COLUMNS.SHOP_NAME] = formData.shop;\n      data[TABLES.DISPATCH_OUTPUT.COLUMNS.DISPATCH_IDS] = dispatchIds;\n      data[TABLES.DISPATCH_OUTPUT.COLUMNS.DATE] = formData.date;\n\n      window.force && console.log('モード:', window.isCreateMode ? '作成' : '更新');\n      window.force && console.log('データ:', data);\n\n      var result;\n      if (window.isCreateMode) {\n        // 作成モード時のみEVENT_ID（LinkId/イベントID）とSHOP_RESULT_ID（店舗ResultId）をセット\n        // URLにLinkIdがない場合（更新パターン＋登録モード）は既存レコードのEVENT_IDを使用\n        var linkId = window.getUrlParam('LinkId') || window.existingEventId || '';\n        data[TABLES.DISPATCH_OUTPUT.COLUMNS.EVENT_ID] = linkId;\n\n        var selectedShop = window.shopRecords.find(function (record) {\n          return record[TABLES.PERIOD.COLUMNS.NAME] === formData.shop;\n        });\n\n        if (selectedShop && selectedShop.ResultId) {\n          data[TABLES.DISPATCH_OUTPUT.COLUMNS.SHOP_RESULT_ID] = String(selectedShop.ResultId);\n          window.force && console.log('店舗ResultId:', selectedShop.ResultId);\n        } else {\n          alert('店舗のResultIdが取得できません。');\n          return;\n        }\n\n        result = await api.createRecord($p.siteId(), data);\n        window.force && console.log('作成結果:', result);\n        alert('派遣者を登録しました');\n      } else {\n        // 更新モード（existingRecordId または $p.id() を使用）\n        var recordId = window.existingRecordId || $p.id();\n        if (!recordId) {\n          alert('レコードIDが取得できません。');\n          return;\n        }\n        window.force && console.log('recordId:', recordId);\n        // updateRecordは (recordId, updateData) の2引数\n        result = await api.updateRecord(recordId, data);\n        window.force && console.log('更新結果:', result);\n        alert('派遣者を更新しました');\n      }\n\n      // 処理後は画面を閉じる（または元の画面に戻る）\n      handleCancel();\n\n    } catch (error) {\n      window.force && console.error('処理エラー:', error);\n      alert((window.isCreateMode ? '登録' : '更新') + 'に失敗しました: ' + (error.message || error));\n    }\n  }\n\n  /**\n   * handleCancel\n   * - キャンセルボタンクリック時の処理\n   * - 前の画面に戻る\n   */\n  function handleCancel() {\n    history.back();\n  }\n\n  /**\n   * handleDelete\n   * - 削除ボタンクリック時の処理\n   * - existingRecordId または $p.id() で現在のレコードを削除\n   */\n  async function handleDelete() {\n    var recordId = window.existingRecordId || $p.id();\n    if (!recordId) {\n      alert('レコードIDが取得できません。');\n      return;\n    }\n\n    if (!confirm('この派遣者を削除しますか？')) {\n      return;\n    }\n\n    try {\n      var api = new PleasanterAPI(location.origin, { logging: window.force });\n      var result = await api.deleteRecord(recordId);\n      window.force && console.log('削除結果:', result);\n      alert('派遣者を削除しました');\n      handleCancel();\n    } catch (error) {\n      window.force && console.error('削除エラー:', error);\n      alert('削除に失敗しました: ' + (error.message || error));\n    }\n  }\n\n  /* ========================================\n   * ボタン活性制御\n   * ======================================== */\n\n  /**\n   * updateSubmitButtonState\n   * - チェックボックスの選択状態に応じて登録/更新ボタンの活性状態を更新\n   */\n  function updateSubmitButtonState() {\n    var hasChecked = $('.fn-pick:checked:not(:disabled)').length > 0;\n    $('#fn-submitButton').prop('disabled', !hasChecked);\n  }\n\n  // グローバルに公開（04から呼び出し）\n  window.updateSubmitButtonState = updateSubmitButtonState;\n\n  /* ========================================\n   * 初期化\n   * ======================================== */\n\n  document.addEventListener('DOMContentLoaded', function () {\n    // 更新モード時は削除ボタンを表示\n    // 注: 既存データの読み込みは03_初期表示.jsで行われる\n    if (!window.isCreateMode) {\n      $('#fn-deleteButton').show();\n    }\n\n    // 初期状態でボタンをdisabledに\n    $('#fn-submitButton').prop('disabled', true);\n\n    // ボタンイベント設定（重複防止のため.off()で既存イベント解除）\n    $('#fn-submitButton').off('click').on('click', handleSubmit);\n    $('#fn-deleteButton').off('click').on('click', handleDelete);\n    $('#fn-cancelButton').off('click').on('click', handleCancel);\n\n    // チェックボックス変更時にボタン活性状態を更新\n    $(document).on('change', '.fn-pick', updateSubmitButtonState);\n  });\n\n})(jQuery);\n",
            "Id": 5
          }
        ],
        "Htmls": [
          {
            "Title": "【表示制御】派遣者登録HTML",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "        <div id=\"fn-dispatch\" class=\"sdt-dispatch\">\n            <!-- 派遣者選択画面全体ラップ -->\n            <div class=\"sdt-dispatch-wrap\">\n\n                <!-- 画面タイトル -->\n                <h2 class=\"sdt-dispatch-title\">\n                    <span class=\"sdt-dispatch-title__text\">派遣者登録</span>\n                </h2>\n\n                <!-- 入力フォーム -->\n                <div class=\"sdt-dispatch-form\">\n                    <form id=\"fn-dispatch-form\" class=\"sdt-dispatch-form__area\">\n                        <!-- 店舗 -->\n                        <div class=\"sdt-form-box sdt-form-shop\">\n                            <label class=\"sdt-form-label\" for=\"fn-formShop\">\n                                <span class=\"sdt-text\">店舗</span>\n                                <span class=\"sdt-required\">*</span>\n                            </label>\n                            <div class=\"sdt-form-inputArea\">\n                                <div class=\"sdt-selector\">\n                                    <select id=\"fn-formShop\" class=\"sdt-selector-content\">\n                                        <option value=\"\" disabled selected style=\"display:none;\">選択してください</option>\n                                    </select>\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- 日付（単日） -->\n                        <div class=\"sdt-form-box sdt-form-date\">\n                            <label class=\"sdt-form-label\" for=\"fn-formDate\">\n                                <span class=\"sdt-text\">日付</span>\n                                <span class=\"sdt-required\">*</span>\n                            </label>\n                            <div class=\"sdt-form-inputArea sdt-form-inputArea--date\">\n                                <input id=\"fn-formDate\" type=\"date\" class=\"sdt-input sdt-input--date\">\n                            </div>\n                        </div>\n                    </form>\n                </div>\n\n                <!-- 派遣者一覧テーブル -->\n                <div id=\"sdt-dispatch-table\" class=\"sdt-dispatch-table\">\n                    <div class=\"sdt-dispatch-table__wrap\">\n                        <table class=\"sdt-table\">\n                            <thead class=\"sdt-table__head\">\n                                <tr class=\"sdt-table__row\">\n                                    <th class=\"sdt-table__cell sdt-table__cell-head\" style=\"width:50%;\">派遣者</th>\n                                    <th class=\"sdt-table__cell sdt-table__cell-head\" style=\"width:35%;\">派遣状況</th>\n                                    <th class=\"sdt-table__cell sdt-table__cell-head\" style=\"width:15%;\">選択</th>\n                                </tr>\n                            </thead>\n                            <!-- ループ開始 -->\n                            <tbody class=\"sdt-table__body\">\n                                <tr class=\"sdt-table__row fn-tableColumn-loop\" style=\"display:none;\">\n                                    <td class=\"sdt-table__cell\" data-target=\"fn-table-name\">[派遣者名が入ります]</td>\n                                    <td class=\"sdt-table__cell\" data-target=\"fn-table-status\">[派遣状況が入ります]</td>\n                                    <td class=\"sdt-table__cell\" data-target=\"fn-table-checkbox\">\n                                        <input type=\"checkbox\" class=\"sdt-checkbox fn-pick\" value=\"\">\n                                    </td>\n                                </tr>\n                            </tbody>\n                            <!-- ループ終了 -->\n                        </table>\n                    </div>\n                </div>\n\n                <!-- アクションボタン -->\n                <div class=\"sdt-form-buttonArea\">\n                    <button class=\"sdt-button sdt-button--primary\" type=\"button\" id=\"fn-submitButton\">\n                        <span class=\"sdt-button__text\">登録</span>\n                    </button>\n                    <button class=\"sdt-button sdt-button--danger\" type=\"button\" id=\"fn-deleteButton\" style=\"display:none;\">\n                        <span class=\"sdt-button__text\">削除</span>\n                    </button>\n                    <button class=\"sdt-button sdt-button--secondary\" type=\"button\" id=\"fn-cancelButton\">\n                        <span class=\"sdt-button__text\">キャンセル</span>\n                    </button>\n                </div>\n            </div>\n        </div>\n",
            "Id": 1
          }
        ],
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    }
  ],
  "Data": [],
  "Permissions": [
    {
      "SiteId": 255686,
      "Permissions": [
        {
          "ReferenceId": 255686,
          "DeptId": 0,
          "GroupId": 0,
          "UserId": -1,
          "PermissionType": 511
        },
        {
          "ReferenceId": 255686,
          "DeptId": 0,
          "GroupId": 0,
          "UserId": 1,
          "PermissionType": 511
        }
      ]
    }
  ],
  "PermissionIdList": {
    "DeptIdList": [],
    "GroupIdList": [],
    "UserIdList": [
      {
        "UserId": 1,
        "LoginId": "Administrator"
      }
    ]
  }
}