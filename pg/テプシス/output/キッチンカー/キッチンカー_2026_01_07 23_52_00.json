{
  "HeaderInfo": {
    "AssemblyVersion": "1.4.1.1",
    "BaseSiteId": 253143,
    "Server": "http://192.168.10.67",
    "CreatorName": "Administrator",
    "PackageTime": "2026-01-07T14:52:00.4957473+00:00",
    "Convertors": [
      {
        "SiteId": 253143,
        "SiteTitle": "キッチンカー",
        "ReferenceType": "Results",
        "IncludeData": false
      }
    ],
    "IncludeSitePermission": true,
    "IncludeRecordPermission": true,
    "IncludeColumnPermission": true,
    "IncludeNotifications": true,
    "IncludeReminders": true
  },
  "Sites": [
    {
      "TenantId": 1,
      "SiteId": 253143,
      "Title": "キッチンカー",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 253128,
      "InheritPermission": 253093,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassC",
          "ClassB",
          "ClassA",
          "ClassD"
        ],
        "EditorColumnHash": {
          "General": [
            "ResultId",
            "ClassC",
            "ClassA",
            "DateA",
            "DateB",
            "ClassD",
            "_Links-253125",
            "ClassB",
            "ClassY"
          ]
        },
        "LinkColumns": [
          "ClassC",
          "ClassA",
          "ClassD"
        ],
        "Columns": [
          {
            "ColumnName": "ResultId",
            "LabelText": "キッチンカー予定Id",
            "Hide": true
          },
          {
            "ColumnName": "ClassA",
            "LabelText": "キッチンカー名",
            "ChoicesText": "[[253125,NoAddButton]]",
            "MultipleSelections": true,
            "NoWrap": true,
            "Link": true
          },
          {
            "ColumnName": "DateA",
            "LabelText": "開催期間 開始日",
            "NoWrap": true
          },
          {
            "ColumnName": "DateB",
            "LabelText": "開催期間 終了日"
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "イベント予定一覧",
            "ChoicesText": "[[253123]]",
            "Hide": true,
            "Link": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "店舗名",
            "NoWrap": true
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "その他詳細",
            "NoWrap": true,
            "MaxLength": 50.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassY",
            "LabelText": "イベント店舗ID",
            "ValidateRequired": true,
            "EditorReadOnly": true
          }
        ],
        "Links": [
          {
            "ColumnName": "ClassB",
            "SiteId": 253123
          },
          {
            "ColumnName": "ClassA",
            "SiteId": 253125,
            "NoAddButton": true
          }
        ],
        "Exports": [
          {
            "Name": "一括アップロード用",
            "Columns": [
              {
                "Id": 1,
                "ColumnName": "ClassC"
              },
              {
                "Id": 2,
                "ColumnName": "ClassB"
              },
              {
                "Id": 3,
                "ColumnName": "ClassA"
              },
              {
                "Id": 4,
                "ColumnName": "DateA"
              },
              {
                "Id": 5,
                "ColumnName": "DateB"
              },
              {
                "Id": 6,
                "ColumnName": "ClassD"
              }
            ],
            "Type": 0,
            "DelimiterType": 0,
            "ExecutionType": 0,
            "Id": 1
          }
        ],
        "Styles": [
          {
            "Title": "【表示制御】キッチンカー画面スタイル",
            "New": true,
            "Edit": true,
            "Body": "@charset \"UTF-8\";\n/* ===================\n    色定義\n==================*/\n/* ===================\n    縦スペース定義\n==================*/\n/* ===================\n    横スペース定義\n==================*/\n/* ===================\n    テキストサイズ定義\n==================*/\n.kc-kitchen-car {\n  position: absolute;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  overflow: auto;\n  background-color: #F2F2F2;\n  z-index: 705;\n}\n.kc-kitchen-car .kc-kitchen-car-wrap {\n  position: relative;\n  display: block;\n  width: 100%;\n  height: 100%;\n  padding: 20px;\n  background-color: #F2F2F2;\n}\n.kc-kitchen-car .kc-kitchen-car-title {\n  margin: 0;\n}\n.kc-kitchen-car .kc-kitchen-car-title__text {\n  font-weight: bold;\n  font-size: 1.2em;\n}\n.kc-kitchen-car .kc-kitchen-car-form {\n  margin-top: 20px;\n}\n@media screen and (max-width: 760px) {\n  .kc-kitchen-car .kc-kitchen-car-form {\n    margin-top: 15px;\n  }\n}\n.kc-kitchen-car .kc-kitchen-car-form__area {\n  position: relative;\n  display: flex;\n  flex-wrap: wrap;\n  width: 100%;\n  padding: 20px;\n  border-radius: 10px;\n  background-color: #fff;\n}\n@media screen and (max-width: 760px) {\n  .kc-kitchen-car .kc-kitchen-car-form__area {\n    padding: 15px;\n  }\n}\n.kc-kitchen-car .kc-kitchen-car-form .kc-form-title {\n  width: 100%;\n  margin: 0;\n  padding: 0;\n  margin-bottom: 12px;\n}\n@media screen and (max-width: 760px) {\n  .kc-kitchen-car .kc-kitchen-car-form .kc-form-title {\n    margin-bottom: 9px;\n  }\n}\n.kc-kitchen-car .kc-form-box {\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n  min-width: 30%;\n  max-width: 50%;\n  height: 30px;\n  padding-right: 12px;\n  margin-bottom: 12px;\n}\n@media screen and (max-width: 760px) {\n  .kc-kitchen-car .kc-form-box {\n    min-width: 100%;\n    max-width: 100%;\n    padding-right: 9px;\n    margin-bottom: 9px;\n  }\n}\n.kc-kitchen-car .kc-form-label {\n  position: relative;\n  min-width: 120px;\n  height: auto;\n}\n.kc-kitchen-car .kc-required {\n  color: #E80000;\n  margin-left: 4px;\n}\n.kc-kitchen-car .kc-form-inputArea {\n  width: calc(100% - 120px);\n  height: 100%;\n}\n.kc-kitchen-car .kc-form-inputArea--date {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.kc-kitchen-car .kc-date-separator {\n  color: #3B3B3B;\n}\n.kc-kitchen-car .kc-input {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  padding: 0 12px;\n  border-radius: 5px;\n  border: none;\n  box-shadow: 0 0 0 1px #78818F inset;\n  -webkit-appearance: none;\n     -moz-appearance: none;\n          appearance: none;\n  font-size: 14px;\n  background-color: #fff;\n}\n.kc-kitchen-car .kc-input--date {\n  width: 140px;\n}\n@media screen and (max-width: 760px) {\n  .kc-kitchen-car .kc-input {\n    padding: 0 9px;\n    font-size: 14px;\n  }\n  .kc-kitchen-car .kc-input--date {\n    width: 120px;\n  }\n}\n.kc-kitchen-car .kc-input::-moz-placeholder {\n  color: #C4C9D0;\n}\n.kc-kitchen-car .kc-input::placeholder {\n  color: #C4C9D0;\n}\n.kc-kitchen-car .kc-input:focus {\n  outline: 0;\n  box-shadow: 0 0 0 2px #2F80ED inset;\n  color: #3B3B3B;\n}\n.kc-kitchen-car .kc-selector {\n  position: relative;\n  width: 100%;\n}\n.kc-kitchen-car .kc-selector:before {\n  content: \"\";\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  margin: auto;\n  width: 0;\n  height: 0;\n  right: 8px;\n  border-left: 6px solid transparent;\n  border-right: 6px solid transparent;\n  border-top: 10px solid #C4C9D0;\n  pointer-events: none;\n}\n@media screen and (max-width: 760px) {\n  .kc-kitchen-car .kc-selector:before {\n    right: 6px;\n    border-left: 5px solid transparent;\n    border-right: 5px solid transparent;\n    border-top: 8px solid #C4C9D0;\n  }\n}\n.kc-kitchen-car .kc-selector-content {\n  width: 100%;\n  height: 30px;\n  padding: 0 38px 0 8px;\n  border-radius: 4px;\n  border: none;\n  box-shadow: 0 0 0 1px #C4C9D0 inset;\n  -webkit-appearance: none;\n     -moz-appearance: none;\n          appearance: none;\n  cursor: pointer;\n  font-size: 14px;\n}\n@media screen and (max-width: 760px) {\n  .kc-kitchen-car .kc-selector-content {\n    font-size: 12px;\n    height: 30px;\n    padding: 0 25px 0 6px;\n  }\n}\n.kc-kitchen-car .kc-selector-content:focus {\n  outline: 0;\n  box-shadow: 0 0 0 2px #2F80ED inset;\n}\n/* フォーム項目の幅調整 */\n.kc-kitchen-car .kc-form-shop {\n  width: 100%;\n  max-width: 100%;\n}\n.kc-kitchen-car .kc-form-shop .kc-form-inputArea {\n  width: 200px;\n}\n.kc-kitchen-car .kc-form-period {\n  width: 100%;\n  max-width: 100%;\n}\n.kc-kitchen-car .kc-form-note {\n  width: 100%;\n  max-width: 100%;\n}\n.kc-kitchen-car .kc-form-note .kc-form-inputArea {\n  width: 50%;\n}\n/* キッチンカー一覧テーブル */\n.kc-kitchen-car .kc-kitchen-car-table {\n  position: relative;\n  margin-top: 20px;\n}\n@media screen and (max-width: 760px) {\n  .kc-kitchen-car .kc-kitchen-car-table {\n    margin-top: 15px;\n  }\n}\n.kc-kitchen-car .kc-kitchen-car-table__wrap {\n  position: relative;\n  width: 100%;\n  max-height: 300px;\n  overflow: auto;\n  border-radius: 8px;\n  border: 1px solid #C4C9D0;\n  background-color: #fff;\n}\n.kc-kitchen-car .kc-table {\n  width: 100%;\n  border-collapse: collapse;\n}\n.kc-kitchen-car .kc-table__head {\n  background-color: #F8F9FA;\n  position: sticky;\n  top: 0;\n  z-index: 1;\n}\n.kc-kitchen-car .kc-table__cell {\n  padding: 12px;\n  box-sizing: border-box;\n  border-bottom: solid 1px #E0E0E0;\n  text-align: left;\n  vertical-align: middle;\n}\n.kc-kitchen-car .kc-table__cell-head {\n  font-weight: bold;\n  background-color: #F8F9FA;\n}\n@media screen and (max-width: 760px) {\n  .kc-kitchen-car .kc-table__cell {\n    padding: 9px;\n  }\n}\n.kc-kitchen-car .kc-checkbox {\n  width: 18px;\n  height: 18px;\n  cursor: pointer;\n}\n.kc-kitchen-car .kc-checkbox:disabled {\n  cursor: not-allowed;\n  opacity: 0.5;\n}\n/* 使用不可行のスタイル */\n.kc-kitchen-car .kc-table__row--disabled {\n  background-color: #f5f5f5;\n  color: #999;\n}\n/* その他詳細 */\n.kc-kitchen-car .kc-kitchen-car-note {\n  margin-top: 20px;\n  padding: 20px;\n  border-radius: 10px;\n  background-color: #fff;\n}\n@media screen and (max-width: 760px) {\n  .kc-kitchen-car .kc-kitchen-car-note {\n    margin-top: 15px;\n    padding: 15px;\n  }\n}\n/* アクションボタン */\n.kc-kitchen-car .kc-form-buttonArea {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 20px;\n  width: 100%;\n  margin-top: 20px;\n}\n@media screen and (max-width: 760px) {\n  .kc-kitchen-car .kc-form-buttonArea {\n    gap: 15px;\n    margin-top: 15px;\n  }\n}\n.kc-kitchen-car .kc-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 150px;\n  height: 40px;\n  border-radius: 8px;\n  padding: 12px 20px;\n  border: none;\n  cursor: pointer;\n  transition: opacity 0.2s;\n}\n.kc-kitchen-car .kc-button:hover {\n  opacity: 0.8;\n}\n.kc-kitchen-car .kc-button--primary {\n  background-color: #2F80ED;\n}\n.kc-kitchen-car .kc-button--primary .kc-button__text {\n  color: #fff;\n}\n.kc-kitchen-car .kc-button--secondary {\n  background-color: #f8f8f8;\n  border: 1px solid #C4C9D0;\n}\n.kc-kitchen-car .kc-button--secondary .kc-button__text {\n  color: #3B3B3B;\n}\n@media screen and (max-width: 760px) {\n  .kc-kitchen-car .kc-button {\n    min-width: 120px;\n    padding: 9px 15px;\n  }\n}\n",
            "Id": 1
          }
        ],
        "Scripts": [
          {
            "Title": "【設定】サイトID",
            "All": true,
            "Body": "\n  /* ========================================\n   * 定数・変数\n   * ======================================== */\n  var KITCHEN_CAR_OUTPUT_SITE_ID = 253143;\n  var KITCHEN_CAR_STATUS_SITE_ID = 253125;\n  var PERIOD_SITE_ID = 253154;\n  window.force = true;\n\n  // テーブル・カラム定義\n  var TABLES = {\n    // キッチンカーテーブル\n    KITCHEN_CAR_OUTPUT: {\n      SITE_ID: KITCHEN_CAR_OUTPUT_SITE_ID,\n      COLUMNS: {\n        KITCHEN_CAR_IDS: 'ClassA',   // キッチンカーResultId（JSON配列）\n        EVENT_ID: 'ClassB',          // LinkId/イベントID（作成時のみ）\n        SHOP_NAME: 'ClassC',         // 店舗名\n        NOTE: 'ClassD',              // その他詳細\n        SHOP_RESULT_ID: 'ClassY',    // 店舗ResultId（作成時のみ）\n        DATE_FROM: 'DateA',          // 開催期間（開始日）\n        DATE_TO: 'DateB'             // 開催期間（終了日）\n      }\n    },\n    // キッチンカー状況テーブル\n    KITCHEN_CAR_STATUS: {\n      SITE_ID: KITCHEN_CAR_STATUS_SITE_ID,\n      COLUMNS: {\n        NAME: 'ClassA',              // キッチンカー名\n        EVENT_NAME: 'ClassB',        // 使用先イベント名称\n        RESERVED_FROM: 'DateA',      // 直近の予約期間（開始日）\n        RESERVED_TO: 'DateB',        // 直近の予約期間（終了日）\n        UNAVAILABLE_FROM: 'DateC',   // 使用不可期間（開始日）\n        UNAVAILABLE_TO: 'DateD'      // 使用不可期間（終了日）\n      }\n    },\n    // 開始～終了期間テーブル\n    PERIOD: {\n      SITE_ID: PERIOD_SITE_ID,\n      COLUMNS: {\n        NAME: 'ClassA',              // 店舗名\n        EVENT_ID: 'ClassB',          // イベントID（LinkId）\n        START_DATE: 'DateA',         // 開始日\n        END_DATE: 'DateB'            // 終了日\n      }\n    }\n  };\n",
            "Id": 4
          },
          {
            "Title": "【共通処理】PleasanterAPI",
            "All": true,
            "Body": "/**\n * Pleasanter API ユーティリティクラス（バニラJS版）\n * Python FastAPI の pleasanter/service.py を JavaScript に移植\n */\n\n/**\n * 定数\n */\nconst EMPTY_DATE = '1899-12-30T00:00:00';\nconst PAGE_SIZE = 200;\n\n/**\n * Pleasanter API クライアント\n */\nclass PleasanterAPI {\n  /**\n   * @param {string} baseUrl - PleasanterのベースURL (例: location.origin)\n   * @param {Object} options - オプション\n   * @param {string} [options.apiKey] - APIキー（認証が必要な場合）\n   * @param {string} [options.apiVersion] - APIバージョン（デフォルト: 1.1）\n   * @param {boolean} [options.logging] - ログ出力（デフォルト: false）\n   */\n  constructor(baseUrl, options = {}) {\n    if (!baseUrl) throw new Error('baseUrl は必須です');\n\n    this.baseUrl = baseUrl;\n    this.apiKey = options.apiKey || null;\n    this.apiVersion = options.apiVersion || 1.1;\n    this.logging = options.logging === true;\n  }\n\n  /**\n   * 基本リクエストボディ\n   * @private\n   */\n  _baseBody() {\n    const body = { ApiVersion: this.apiVersion };\n    if (this.apiKey) {\n      body.ApiKey = this.apiKey;\n    }\n    return body;\n  }\n\n  /**\n   * update_dict を 5 つのハッシュに分類\n   * @private\n   */\n  _splitHash(update) {\n    const classHash = {};\n    const numHash = {};\n    const dateHash = {};\n    const descriptionHash = {};\n    const checkHash = {};\n    const other = {};\n\n    for (const [k, v] of Object.entries(update)) {\n      if (k.includes('Class')) {\n        classHash[k] = v;\n      } else if (k.includes('Num')) {\n        numHash[k] = v;\n      } else if (k.includes('Date')) {\n        dateHash[k] = v || EMPTY_DATE;\n      } else if (k.includes('Description')) {\n        descriptionHash[k] = v;\n      } else if (k.includes('Check')) {\n        checkHash[k] = v;\n      } else {\n        other[k] = v;\n      }\n    }\n\n    return {\n      ClassHash: classHash,\n      NumHash: numHash,\n      DateHash: dateHash,\n      DescriptionHash: descriptionHash,\n      CheckHash: checkHash,\n      ...other,\n    };\n  }\n\n  /**\n   * View セクション構築\n   * @private\n   */\n  _buildView(columns, options = {}) {\n    const { setLabelText = true, setDisplayValue = 'DisplayValue' } = options;\n\n    const cols = columns || ['ClassA', 'NumA'];\n\n    return {\n      ApiDataType: 'KeyValues',\n      ApiColumnKeyDisplayType: setLabelText ? 'LabelText' : 'ColumnName',\n      ApiColumnValueDisplayType: setDisplayValue,\n      GridColumns: cols,\n    };\n  }\n\n  /**\n   * HTTP POST リクエスト送信\n   * @private\n   */\n  async _request(endpoint, body, options = {}) {\n    const { ignoreErrors = false } = options;\n\n    const headers = {\n      'Content-Type': 'application/json',\n    };\n\n    try {\n      const res = await fetch(`${this.baseUrl}${endpoint}`, {\n        method: 'POST',\n        headers,\n        body: JSON.stringify(body),\n      });\n\n      if (!res.ok) {\n        if (ignoreErrors) {\n          console.error(`Pleasanter API Error: ${res.status}`);\n          return null;\n        }\n        throw new Error(`HTTP Error: ${res.status} ${res.statusText}`);\n      }\n\n      const data = await res.json();\n      return data;\n    } catch (error) {\n      if (ignoreErrors) {\n        console.error('Pleasanter API Request Failed:', error);\n        return null;\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * 単一レコード取得\n   * @param {number|string} recordId - レコードID\n   * @param {Object} [options] - オプション\n   * @param {string[]} [options.columns] - 取得するカラム\n   * @param {boolean} [options.setLabelText] - カラムキーをラベル名で表示（デフォルト: true）\n   * @param {'DisplayValue'|'Value'|'Both'} [options.setDisplayValue] - 値の表示形式（デフォルト: 'DisplayValue'）\n   * @param {boolean} [options.ignoreErrors] - エラーを無視（デフォルト: false）\n   * @returns {Promise<Object>} レコードデータ\n   */\n  async getRecord(recordId, options = {}) {\n    if (!recordId) throw new Error('recordId は必須です');\n\n    const {\n      columns = null,\n      setLabelText = true,\n      setDisplayValue = 'DisplayValue',\n      ignoreErrors = false,\n    } = options;\n\n    if (setDisplayValue === 'Both') {\n      // DisplayValueとValueの両方を取得してマージ\n      const displayRecord = await this.getRecord(recordId, {\n        ...options,\n        setDisplayValue: 'DisplayValue',\n      });\n      const valueRecord = await this.getRecord(recordId, {\n        ...options,\n        setDisplayValue: 'Value',\n      });\n\n      // マージ\n      const merged = {};\n      for (const key of Object.keys(displayRecord)) {\n        merged[key] = {\n          Display: displayRecord[key],\n          Value: valueRecord[key],\n        };\n      }\n      return merged;\n    }\n\n    // 単一形式で取得\n    const view = this._buildView(columns, { setLabelText, setDisplayValue });\n    const body = { ...this._baseBody(), View: view };\n\n    const resp = await this._request(`/api/items/${recordId}/get`, body, { ignoreErrors });\n\n    if (!resp) {\n      return {};\n    }\n\n    return resp.Response?.Data?.[0] || {};\n  }\n\n  /**\n   * レコード一覧取得（ページネーション対応・全件取得）\n   * @param {number|string} tableId - テーブル（サイト）ID\n   * @param {Object} [options] - オプション\n   * @param {string[]} [options.columns] - 取得するカラム\n   * @param {boolean} [options.setLabelText] - カラムキーをラベル名で表示（デフォルト: true）\n   * @param {'DisplayValue'|'Value'|'Both'} [options.setDisplayValue] - 値の表示形式（デフォルト: 'DisplayValue'）\n   * @param {boolean} [options.ignoreErrors] - エラーを無視（デフォルト: false）\n   * @returns {Promise<Object[]>} レコード配列\n   */\n  async getRecords(tableId, options = {}) {\n    if (!tableId) throw new Error('tableId は必須です');\n\n    const {\n      columns = null,\n      setLabelText = true,\n      setDisplayValue = 'DisplayValue',\n      ignoreErrors = false,\n    } = options;\n\n    if (setDisplayValue === 'Both') {\n      // DisplayValueとValueの両方を取得してマージ\n      const displayRecords = await this.getRecords(tableId, {\n        ...options,\n        setDisplayValue: 'DisplayValue',\n      });\n      const valueRecords = await this.getRecords(tableId, {\n        ...options,\n        setDisplayValue: 'Value',\n      });\n\n      // マージ\n      const merged = displayRecords.map((displayRec, index) => {\n        const valueRec = valueRecords[index];\n        const mergedRec = {};\n        for (const key of Object.keys(displayRec)) {\n          mergedRec[key] = {\n            Display: displayRec[key],\n            Value: valueRec[key],\n          };\n        }\n        return mergedRec;\n      });\n\n      if (this.logging) {\n        console.log(`テーブル(${this.baseUrl}/items/${tableId}/index)から ${merged.length} 件取得しました(Both形式)`);\n        console.table(merged);\n      }\n      return merged;\n    }\n\n    // 単一形式で取得（ページネーション対応）\n    const view = this._buildView(columns, { setLabelText, setDisplayValue });\n    const records = [];\n    let offset = 0;\n\n    while (true) {\n      const body = {\n        ...this._baseBody(),\n        Offset: offset,\n        PageSize: PAGE_SIZE,\n        View: view,\n      };\n\n      const resp = await this._request(`/api/items/${tableId}/get`, body, { ignoreErrors });\n\n      if (!resp) {\n        break;\n      }\n\n      const page = resp.Response?.Data || [];\n      records.push(...page);\n\n      if (page.length < PAGE_SIZE) {\n        break;\n      }\n\n      offset += PAGE_SIZE;\n    }\n\n    if (this.logging) {\n      console.log(`テーブル(${this.baseUrl}/items/${tableId}/index)から ${records.length} 件取得しました`);\n      console.table(records);\n    }\n    return records;\n  }\n\n  /**\n   * レコード作成\n   * @param {number|string} tableId - テーブル（サイト）ID\n   * @param {Object} createData - 作成するレコードデータ\n   * @returns {Promise<Object>} 作成結果\n   */\n  async createRecord(tableId, createData = {}) {\n    if (!tableId) throw new Error('tableId は必須です');\n    if (!createData || Object.keys(createData).length === 0) {\n      throw new Error('createData は必須です');\n    }\n\n    const payload = {\n      ...this._baseBody(),\n      ...this._splitHash(createData),\n    };\n\n    const data = await this._request(`/api/items/${tableId}/create`, payload);\n\n    if (!data) {\n      return {};\n    }\n\n    if (this.logging) {\n      console.log('登録内容:', data);\n    }\n    return data;\n  }\n\n  /**\n   * レコード更新\n   * @param {number|string} recordId - 更新するレコードID\n   * @param {Object} updateData - 更新データ\n   * @returns {Promise<Object>} 更新結果\n   */\n  async updateRecord(recordId, updateData = {}) {\n    if (!recordId) throw new Error('recordId は必須です');\n    if (!updateData || Object.keys(updateData).length === 0) {\n      throw new Error('updateData は必須です');\n    }\n\n    const payload = {\n      ...this._baseBody(),\n      ...this._splitHash(updateData),\n    };\n\n    const data = await this._request(`/api/items/${recordId}/update`, payload);\n\n    if (!data) {\n      return {};\n    }\n\n    if (this.logging) {\n      console.log('更新内容:', data);\n    }\n    return data;\n  }\n\n  /**\n   * レコード削除\n   * @param {number|string} recordId - 削除するレコードID\n   * @returns {Promise<Object>} 削除結果\n   */\n  async deleteRecord(recordId) {\n    if (!recordId) throw new Error('recordId は必須です');\n\n    const payload = this._baseBody();\n\n    const data = await this._request(`/api/items/${recordId}/delete`, payload);\n\n    if (!data) {\n      return {};\n    }\n\n    if (this.logging) {\n      console.log(`削除完了: レコードID ${recordId}`);\n    }\n    return data;\n  }\n}\n\n/* ========= 使用例 ========= */\n/*\nconst siteId = 24;  // 対象サイトのID\nconst api = new PleasanterAPI(location.origin, {\n  apiKey: 'your-api-key',  // 認証が必要な場合\n  logging: true,           // ログ出力\n});\n\n// レコード一覧取得（全件・ページネーション対応）\nconst records = await api.getRecords(siteId, {\n  columns: ['ResultId', 'Title', 'Body', 'UpdatedTime'],\n  setLabelText: true,\n  setDisplayValue: 'DisplayValue',  // 'DisplayValue' | 'Value' | 'Both'\n});\nconsole.table(records);\n\n// 単一レコード取得\nconst record = await api.getRecord(123, {\n  columns: ['Title', 'Body'],\n  setDisplayValue: 'Both',  // DisplayとValue両方取得\n});\nconsole.log(record);\n\n// レコード作成（ClassA, NumB などは自動分類される）\nconst created = await api.createRecord(siteId, {\n  Title: '新規タイトル',\n  ClassA: '分類A',\n  NumA: 100,\n  DateA: '2025-01-01',\n  CheckA: true,\n});\nconsole.log(created);\n\n// レコード更新\nconst updated = await api.updateRecord(123, {\n  Title: '更新後タイトル',\n  ClassB: '分類B更新',\n});\nconsole.log(updated);\n\n// レコード削除\nconst deleted = await api.deleteRecord(123);\nconsole.log(deleted);\n*/\n",
            "Id": 3
          },
          {
            "Title": "【画面作成】キッチンカー初期表示",
            "New": true,
            "Edit": true,
            "Body": "(function ($) {\n  'use strict';\n\n  /************************************************************************\n   * 画面読み込み時に一度だけ実行する初期表示処理\n   *\n   * 目的：\n   *  - ヘッダー（#Header）の高さを取得して、その高さ分だけ\n   *    #fn-kitchen-car の top をずらします（重なり防止）。\n   *  - さらに #fn-kitchen-car の高さを CSS の calc() を使って\n   *    calc(100% - {headerHeight}px) に設定します。\n   *  - 店舗マスタ（SiteId: 253154）からデータを取得し、セレクトボックスに設定\n   *\n   * 注意：\n   *  - この処理は「読み込み時に一度だけ実行」されます。\n   *  - #fn-kitchen-car に top を効かせるには position が必要です。\n   ************************************************************************/\n\n  // 店舗データを保持（セレクトボックス変更時に参照）\n  window.shopRecords = [];\n\n  // 編集モード判定（初期化時に設定）\n  window.isCreateMode = false;\n\n  /* ========================================\n   * レイアウト関連\n   * ======================================== */\n\n  /**\n   * getHeaderHeight\n   * - #Header 要素の「見た目の高さ」をピクセル単位で返します。\n   * - 要素が見つからなければ 0 を返します。\n   *\n   * @returns {number} headerHeightPx - 整数ピクセル\n   */\n  function getHeaderHeight() {\n    var $header = $('#Header');\n\n    if ($header.length === 0) {\n      return 0;\n    }\n\n    var rect = $header[0].getBoundingClientRect();\n    var h = Math.round(rect.height || 0);\n\n    return (h > 0) ? h : 0;\n  }\n\n  /**\n   * buildCalcHeightCss\n   * - ヘッダーのピクセル値を受け取り、CSS の calc() 文字列を返します。\n   *\n   * @param {number} px - ヘッダー高さ（ピクセル）\n   * @returns {string} CSS の値\n   */\n  function buildCalcHeightCss(px) {\n    var n = (typeof px === 'number' && !isNaN(px)) ? px : 0;\n    return 'calc(100% - ' + String(n) + 'px)';\n  }\n\n  /**\n   * applyKitchenCarLayout\n   * - 実際に DOM に対して style を当てる関数\n   *\n   * @param {number} headerHeightPx - ヘッダーの高さ（ピクセル）\n   */\n  function applyKitchenCarLayout(headerHeightPx) {\n    var $target = $('#fn-kitchen-car');\n\n    if ($target.length === 0) {\n      return;\n    }\n\n    $target.css('top', String(headerHeightPx) + 'px');\n    $target.css('height', buildCalcHeightCss(headerHeightPx));\n  }\n\n  /**\n   * initKitchenCarLayout\n   * - レイアウト初期化\n   */\n  function initKitchenCarLayout() {\n    var headerH = getHeaderHeight();\n    applyKitchenCarLayout(headerH);\n  }\n\n  /* ========================================\n   * URLパラメータ取得\n   * ======================================== */\n\n  /**\n   * getUrlParam\n   * - URLから指定したパラメータの値を取得\n   *\n   * @param {string} name - パラメータ名\n   * @returns {string|null} パラメータ値（存在しない場合はnull）\n   */\n  window.getUrlParam = function (name) {\n    var params = new URLSearchParams(window.location.search);\n    return params.get(name);\n  };\n\n  /* ========================================\n   * 店舗セレクトボックス初期化\n   * ======================================== */\n\n  /**\n   * loadShopOptions\n   * - 店舗マスタからデータを取得し、セレクトボックスに設定\n   * - URLのLinkIdパラメータとClassBを突合してフィルタリング\n   */\n  async function loadShopOptions() {\n    var $select = $('#fn-formShop');\n    if ($select.length === 0) {\n      return;\n    }\n\n    // 既存のオプションをクリア（placeholder以外）\n    $select.find('option:not([disabled])').remove();\n\n    // URLからLinkIdを取得\n    var linkId = window.getUrlParam('LinkId');\n    window.force && console.log('LinkId:', linkId);\n\n    try {\n      var api = new PleasanterAPI(location.origin, { logging: window.force });\n\n      var records = await api.getRecords(PERIOD_SITE_ID, {\n        columns: [TABLES.PERIOD.COLUMNS.NAME, TABLES.PERIOD.COLUMNS.EVENT_ID, TABLES.PERIOD.COLUMNS.START_DATE, TABLES.PERIOD.COLUMNS.END_DATE, 'ResultId'],\n        setLabelText: false,\n        setDisplayValue: 'Value',\n      });\n\n      if (!records || records.length === 0) {\n        window.force && console.warn('店舗データが取得できませんでした');\n        return;\n      }\n\n      // LinkIdとEVENT_IDを突合してフィルタリング\n      var filteredRecords = linkId\n        ? records.filter(function (record) {\n            return String(record[TABLES.PERIOD.COLUMNS.EVENT_ID]) === String(linkId);\n          })\n        : records;\n\n      window.force && console.log('フィルタ後の店舗データ:', filteredRecords);\n\n      // 店舗データを保持\n      window.shopRecords = filteredRecords;\n\n      filteredRecords.forEach(function (record) {\n        var name = record[TABLES.PERIOD.COLUMNS.NAME] || '';\n\n        if (name) {\n          var $option = $('<option></option>').val(name).text(name);\n          $select.append($option);\n        }\n      });\n\n      // セレクトボックス変更時のイベントハンドラ\n      $select.off('change.shop').on('change.shop', handleShopChange);\n\n    } catch (error) {\n      window.force && console.error('店舗データ取得エラー:', error);\n    }\n  }\n\n  /**\n   * handleShopChange\n   * - 店舗セレクトボックス変更時に開催期間を設定\n   */\n  function handleShopChange() {\n    var selectedValue = $(this).val();\n    if (!selectedValue) return;\n\n    // 選択された店舗のレコードを検索\n    var selectedRecord = window.shopRecords.find(function (record) {\n      return record[TABLES.PERIOD.COLUMNS.NAME] === selectedValue;\n    });\n\n    if (!selectedRecord) {\n      window.force && console.warn('選択された店舗のデータが見つかりません:', selectedValue);\n      return;\n    }\n\n    window.force && console.log('選択された店舗データ:', selectedRecord);\n\n    // START_DATE → 開始日、END_DATE → 終了日\n    var dateFrom = selectedRecord[TABLES.PERIOD.COLUMNS.START_DATE] || '';\n    var dateTo = selectedRecord[TABLES.PERIOD.COLUMNS.END_DATE] || '';\n\n    // 日付形式を input[type=\"date\"] 用に変換 (YYYY-MM-DD)\n    $('#fn-formDateFrom').val(window.formatDateForInput(dateFrom));\n    $('#fn-formDateTo').val(window.formatDateForInput(dateTo));\n  }\n\n  /**\n   * formatDateForInput\n   * - 日付文字列を input[type=\"date\"] 用のフォーマット (YYYY-MM-DD) に変換\n   *\n   * @param {string} dateStr - 日付文字列\n   * @returns {string} YYYY-MM-DD 形式の日付\n   */\n  window.formatDateForInput = function (dateStr) {\n    if (!dateStr) return '';\n\n    // ISO形式 (2025-01-07T00:00:00) の場合\n    if (dateStr.includes('T')) {\n      return dateStr.split('T')[0];\n    }\n\n    // すでに YYYY-MM-DD 形式の場合\n    if (/^\\d{4}-\\d{2}-\\d{2}$/.test(dateStr)) {\n      return dateStr;\n    }\n\n    // その他の形式の場合はDateオブジェクトで変換を試みる\n    try {\n      var d = new Date(dateStr);\n      if (!isNaN(d.getTime())) {\n        return d.toISOString().split('T')[0];\n      }\n    } catch (e) {\n      window.force && console.warn('日付変換エラー:', dateStr, e);\n    }\n\n    return '';\n  };\n\n  /* ========================================\n   * 初期化\n   * ======================================== */\n\n  document.addEventListener('DOMContentLoaded', function () {\n    try {\n      // 編集モード判定（$p.action() が 'NEW' なら作成モード、それ以外は更新モード）\n      var action = $p.action();\n      window.isCreateMode = String(action).toUpperCase() === 'NEW';\n      window.force && console.log('$p.action():', action);\n      window.force && console.log('isCreateMode:', window.isCreateMode);\n\n      // レイアウト初期化\n      initKitchenCarLayout();\n\n      // モードに応じてタイトル・ボタンテキストを変更\n      var modeText = window.isCreateMode ? 'キッチンカー登録' : 'キッチンカー更新';\n      $('.kc-kitchen-car-title__text').text(modeText);\n      $('#fn-submitButton .kc-button__text').text(modeText);\n\n      // 店舗セレクトボックス初期化\n      loadShopOptions();\n\n    } catch (e) {\n      window.force && console.error('initKitchenCarLayout error', e);\n    }\n  });\n\n})(jQuery);\n",
            "Id": 1
          },
          {
            "Title": "【表示制御】キッチンカー使用可能判定",
            "New": true,
            "Edit": true,
            "Body": "(function ($) {\n  'use strict';\n\n  /************************************************************************\n   * キッチンカー状況テーブルの取得・判定・描画\n   ************************************************************************/\n\n  // キッチンカー状況データを保持\n  window.kitchenCarStatusRecords = [];\n\n  /* ========================================\n   * キッチンカー状況テーブル初期化\n   * ======================================== */\n\n  /**\n   * loadKitchenCarStatus\n   * - キッチンカー状況テーブルからデータを取得し、テーブルに表示\n   */\n  async function loadKitchenCarStatus() {\n    try {\n      var api = new PleasanterAPI(location.origin, { logging: window.force });\n\n      var records = await api.getRecords(KITCHEN_CAR_STATUS_SITE_ID, {\n        columns: [TABLES.KITCHEN_CAR_STATUS.COLUMNS.NAME, TABLES.KITCHEN_CAR_STATUS.COLUMNS.EVENT_NAME, TABLES.KITCHEN_CAR_STATUS.COLUMNS.RESERVED_FROM, TABLES.KITCHEN_CAR_STATUS.COLUMNS.RESERVED_TO, TABLES.KITCHEN_CAR_STATUS.COLUMNS.UNAVAILABLE_FROM, TABLES.KITCHEN_CAR_STATUS.COLUMNS.UNAVAILABLE_TO, 'ResultId'],\n        setLabelText: false,\n        setDisplayValue: 'Value',\n      });\n\n      if (!records || records.length === 0) {\n        window.force && console.warn('キッチンカー状況データが取得できませんでした');\n        return;\n      }\n\n      window.force && console.log('キッチンカー状況データ:', records);\n\n      // データを保持\n      window.kitchenCarStatusRecords = records;\n\n      // テーブルに描画\n      renderKitchenCarTable(records);\n\n    } catch (error) {\n      window.force && console.error('キッチンカー状況データ取得エラー:', error);\n    }\n  }\n\n  /**\n   * getKitchenCarStatus\n   * - キッチンカーの使用状況を判定\n   *\n   * @param {Object} record - キッチンカー状況レコード\n   * @returns {Object} { status: string, canSelect: boolean }\n   */\n  function getKitchenCarStatus(record) {\n    var today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    // 使用不可期間チェック (UNAVAILABLE_FROM ~ UNAVAILABLE_TO)\n    var unavailableStart = record[TABLES.KITCHEN_CAR_STATUS.COLUMNS.UNAVAILABLE_FROM] ? new Date(record[TABLES.KITCHEN_CAR_STATUS.COLUMNS.UNAVAILABLE_FROM]) : null;\n    var unavailableEnd = record[TABLES.KITCHEN_CAR_STATUS.COLUMNS.UNAVAILABLE_TO] ? new Date(record[TABLES.KITCHEN_CAR_STATUS.COLUMNS.UNAVAILABLE_TO]) : null;\n\n    if (unavailableStart && unavailableEnd) {\n      unavailableStart.setHours(0, 0, 0, 0);\n      unavailableEnd.setHours(0, 0, 0, 0);\n\n      if (today >= unavailableStart && today <= unavailableEnd) {\n        return { status: '使用不可期間', canSelect: false };\n      }\n    }\n\n    // 直近の予約期間チェック (RESERVED_FROM ~ RESERVED_TO)\n    var reservedStart = record[TABLES.KITCHEN_CAR_STATUS.COLUMNS.RESERVED_FROM] ? new Date(record[TABLES.KITCHEN_CAR_STATUS.COLUMNS.RESERVED_FROM]) : null;\n    var reservedEnd = record[TABLES.KITCHEN_CAR_STATUS.COLUMNS.RESERVED_TO] ? new Date(record[TABLES.KITCHEN_CAR_STATUS.COLUMNS.RESERVED_TO]) : null;\n\n    if (reservedStart && reservedEnd) {\n      reservedStart.setHours(0, 0, 0, 0);\n      reservedEnd.setHours(0, 0, 0, 0);\n\n      if (today >= reservedStart && today <= reservedEnd) {\n        var eventName = record[TABLES.KITCHEN_CAR_STATUS.COLUMNS.EVENT_NAME] || '他イベント';\n        return { status: eventName + 'で使用中', canSelect: false };\n      }\n    }\n\n    // 上記以外は使用可能\n    return { status: '使用可能', canSelect: true };\n  }\n\n  /**\n   * renderKitchenCarTable\n   * - キッチンカー一覧をテーブルに描画\n   *\n   * @param {Array} records - キッチンカー状況レコード配列\n   */\n  function renderKitchenCarTable(records) {\n    var $tbody = $('#kc-kitchen-car-table .kc-table__body');\n    if ($tbody.length === 0) {\n      $tbody = $('#kc-kitchen-car-table tbody');\n      if ($tbody.length === 0) {\n        window.force && console.error('renderKitchenCarTable: tbody not found');\n        return;\n      }\n    }\n\n    var $template = $tbody.children('tr.fn-tableColumn-loop').first();\n    if ($template.length === 0) {\n      window.force && console.error('renderKitchenCarTable: template row not found');\n      return;\n    }\n\n    // テンプレートは非表示のまま保持\n    $template.hide();\n\n    // 既存の出力行（テンプレート以外）を削除\n    $tbody.find('tr').not($template).remove();\n\n    // DocumentFragment を使ってパフォーマンス向上\n    var fragment = document.createDocumentFragment();\n\n    records.forEach(function (record) {\n      var $row = $template.clone().removeClass('fn-tableColumn-loop').show();\n\n      // キッチンカー名\n      var name = record[TABLES.KITCHEN_CAR_STATUS.COLUMNS.NAME] || '';\n      $row.find('[data-target=\"fn-table-name\"]').text(name);\n\n      // 使用状況を判定\n      var statusInfo = getKitchenCarStatus(record);\n      $row.find('[data-target=\"fn-table-status\"]').text(statusInfo.status);\n\n      // チェックボックスの設定（valueはResultId、表示はキッチンカー名）\n      var $checkbox = $row.find('[data-target=\"fn-table-checkbox\"] .fn-pick');\n      if ($checkbox.length) {\n        // valueにはResultIdを設定（ClassAに登録する値）\n        $checkbox.val(record.ResultId || '');\n\n        // 使用不可の場合はdisabled\n        if (!statusInfo.canSelect) {\n          $checkbox.prop('disabled', true);\n          $row.addClass('kc-table__row--disabled');\n        }\n      }\n\n      fragment.appendChild($row.get(0));\n    });\n\n    $tbody.get(0).appendChild(fragment);\n  }\n\n  /* ========================================\n   * 初期化\n   * ======================================== */\n\n  document.addEventListener('DOMContentLoaded', function () {\n    // キッチンカー状況テーブル初期化\n    loadKitchenCarStatus();\n  });\n\n})(jQuery);\n",
            "Id": 5
          },
          {
            "Title": "【データ処理】キッチンカー登録保存",
            "New": true,
            "Edit": true,
            "Body": "(function ($) {\n  'use strict';\n\n  /************************************************************************\n   * 既存データ読み込み・バリデーション・登録/更新処理\n   ************************************************************************/\n\n  /* ========================================\n   * 既存データ読み込み（更新モード用）\n   * ======================================== */\n\n  /**\n   * loadExistingData\n   * - 更新モード時に既存レコードのデータを取得してフォームにセット\n   */\n  async function loadExistingData() {\n    var recordId = $p.id();\n    if (!recordId) {\n      window.force && console.warn('レコードIDが取得できません');\n      return;\n    }\n\n    try {\n      var api = new PleasanterAPI(location.origin, { logging: window.force });\n\n      var record = await api.getRecord(recordId, {\n        columns: [TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.SHOP_NAME, TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.KITCHEN_CAR_IDS, TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.DATE_FROM, TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.DATE_TO, TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.NOTE, TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.EVENT_ID],\n        setLabelText: false,\n        setDisplayValue: 'Value',\n      });\n\n      if (!record || Object.keys(record).length === 0) {\n        window.force && console.warn('既存データが取得できませんでした');\n        return;\n      }\n\n      window.force && console.log('既存データ:', record);\n\n      // 店舗セレクトボックスに値をセット\n      if (record[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.SHOP_NAME]) {\n        $('#fn-formShop').val(record[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.SHOP_NAME]);\n      }\n\n      // 開催期間をセット\n      if (record[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.DATE_FROM]) {\n        $('#fn-formDateFrom').val(window.formatDateForInput(record[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.DATE_FROM]));\n      }\n      if (record[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.DATE_TO]) {\n        $('#fn-formDateTo').val(window.formatDateForInput(record[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.DATE_TO]));\n      }\n\n      // その他詳細をセット\n      if (record[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.NOTE]) {\n        $('#fn-formNote').val(record[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.NOTE]);\n      }\n\n      // キッチンカー選択をセット（JSON配列形式のResultId）\n      if (record[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.KITCHEN_CAR_IDS]) {\n        var selectedCarIds = [];\n        try {\n          selectedCarIds = JSON.parse(record[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.KITCHEN_CAR_IDS]);\n        } catch (e) {\n          // JSON形式でない場合はカンマ区切りとして処理（後方互換）\n          selectedCarIds = String(record[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.KITCHEN_CAR_IDS]).split(',').map(function (s) {\n            return s.trim();\n          });\n        }\n\n        // チェックボックスにチェックを入れる（valueはResultId）\n        $('.fn-pick').each(function () {\n          var $checkbox = $(this);\n          var carId = String($checkbox.val());\n          if (selectedCarIds.indexOf(carId) >= 0 && !$checkbox.prop('disabled')) {\n            $checkbox.prop('checked', true);\n          }\n        });\n      }\n\n    } catch (error) {\n      window.force && console.error('既存データ取得エラー:', error);\n    }\n  }\n\n  /* ========================================\n   * 登録処理\n   * ======================================== */\n\n  /**\n   * validateForm\n   * - フォームのバリデーション\n   *\n   * @returns {Object|null} エラーがあればnull、なければフォームデータ\n   */\n  function validateForm() {\n    var shop = $('#fn-formShop').val();\n    var dateFrom = $('#fn-formDateFrom').val();\n    var dateTo = $('#fn-formDateTo').val();\n    var selectedCars = [];\n\n    // 選択されたキッチンカーを取得\n    $('.fn-pick:checked:not(:disabled)').each(function () {\n      selectedCars.push($(this).val());\n    });\n\n    var errors = [];\n\n    if (!shop) {\n      errors.push('店舗を選択してください');\n    }\n    if (!dateFrom) {\n      errors.push('開催期間（開始日）を入力してください');\n    }\n    if (!dateTo) {\n      errors.push('開催期間（終了日）を入力してください');\n    }\n    if (dateFrom && dateTo && dateFrom > dateTo) {\n      errors.push('開催期間の開始日は終了日より前の日付を指定してください');\n    }\n    if (selectedCars.length === 0) {\n      errors.push('キッチンカーを1台以上選択してください');\n    }\n\n    if (errors.length > 0) {\n      alert(errors.join('\\n'));\n      return null;\n    }\n\n    return {\n      shop: shop,\n      dateFrom: dateFrom,\n      dateTo: dateTo,\n      selectedCars: selectedCars,\n      note: $('#fn-formNote').val() || ''\n    };\n  }\n\n  /**\n   * handleSubmit\n   * - 登録/更新ボタンクリック時の処理\n   * - isCreateMode: true → 作成、false → 更新（$p.idを使用）\n   */\n  async function handleSubmit() {\n    var formData = validateForm();\n    if (!formData) return;\n\n    try {\n      var api = new PleasanterAPI(location.origin, { logging: window.force });\n\n      // キッチンカーResultIdは複数選択をJSON配列形式で登録\n      var kitchenCarIds = JSON.stringify(formData.selectedCars);\n\n      var data = {};\n      data[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.SHOP_NAME] = formData.shop;\n      data[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.KITCHEN_CAR_IDS] = kitchenCarIds;\n      data[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.DATE_FROM] = formData.dateFrom;\n      data[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.DATE_TO] = formData.dateTo;\n      data[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.NOTE] = formData.note;\n\n      window.force && console.log('モード:', window.isCreateMode ? '作成' : '更新');\n      window.force && console.log('データ:', data);\n\n      var result;\n      if (window.isCreateMode) {\n        // 作成モード時のみEVENT_ID（LinkId/イベントID）とSHOP_RESULT_ID（店舗ResultId）をセット\n        var linkId = window.getUrlParam('LinkId');\n        data[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.EVENT_ID] = linkId || '';\n\n        var selectedShop = window.shopRecords.find(function (record) {\n          return record[TABLES.PERIOD.COLUMNS.NAME] === formData.shop;\n        });\n\n        if (selectedShop && selectedShop.ResultId) {\n          data[TABLES.KITCHEN_CAR_OUTPUT.COLUMNS.SHOP_RESULT_ID] = String(selectedShop.ResultId);\n          window.force && console.log('店舗ResultId:', selectedShop.ResultId);\n        } else {\n          alert('店舗のResultIdが取得できません。');\n          return;\n        }\n\n        result = await api.createRecord($p.siteId(), data);\n        window.force && console.log('作成結果:', result);\n        alert('キッチンカーを登録しました');\n      } else {\n        // 更新モード（$p.id()を使用）\n        var recordId = $p.id();\n        if (!recordId) {\n          alert('レコードIDが取得できません。');\n          return;\n        }\n        window.force && console.log('recordId:', recordId);\n        // updateRecordは (recordId, updateData) の2引数\n        result = await api.updateRecord(recordId, data);\n        window.force && console.log('更新結果:', result);\n        alert('キッチンカーを更新しました');\n      }\n\n      // 処理後は画面を閉じる（または元の画面に戻る）\n      handleCancel();\n\n    } catch (error) {\n      window.force && console.error('処理エラー:', error);\n      alert((window.isCreateMode ? '登録' : '更新') + 'に失敗しました: ' + (error.message || error));\n    }\n  }\n\n  /**\n   * handleCancel\n   * - キャンセルボタンクリック時の処理\n   * - 前の画面に戻る\n   */\n  function handleCancel() {\n    history.back();\n  }\n\n  /* ========================================\n   * 初期化\n   * ======================================== */\n\n  document.addEventListener('DOMContentLoaded', function () {\n    // 更新モード時は既存データを読み込み（テーブル描画後に実行）\n    if (!window.isCreateMode) {\n      // テーブル描画完了を待ってから既存データをセット\n      setTimeout(function () {\n        loadExistingData();\n      }, 500);\n    }\n\n    // ボタンイベント設定（重複防止のため.off()で既存イベント解除）\n    $('#fn-submitButton').off('click').on('click', handleSubmit);\n    $('#fn-cancelButton').off('click').on('click', handleCancel);\n  });\n\n})(jQuery);\n",
            "Id": 6
          }
        ],
        "Htmls": [
          {
            "Title": "【表示制御】キッチンカー登録HTML",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "        <div id=\"fn-kitchen-car\" class=\"kc-kitchen-car\">\n            <!-- キッチンカー選択画面全体ラップ -->\n            <div class=\"kc-kitchen-car-wrap\">\n\n                <!-- 画面タイトル -->\n                <h2 class=\"kc-kitchen-car-title\">\n                    <span class=\"kc-kitchen-car-title__text\">キッチンカー登録</span>\n                </h2>\n\n                <!-- 入力フォーム -->\n                <div class=\"kc-kitchen-car-form\">\n                    <form id=\"fn-kitchen-car-form\" class=\"kc-kitchen-car-form__area\">\n                        <!-- 店舗 -->\n                        <div class=\"kc-form-box kc-form-shop\">\n                            <label class=\"kc-form-label\" for=\"fn-formShop\">\n                                <span class=\"kc-text\">店舗</span>\n                                <span class=\"kc-required\">*</span>\n                            </label>\n                            <div class=\"kc-form-inputArea\">\n                                <div class=\"kc-selector\">\n                                    <select id=\"fn-formShop\" class=\"kc-selector-content\">\n                                        <option value=\"\" disabled selected style=\"display:none;\">選択してください</option>\n                                    </select>\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- 開催期間 -->\n                        <div class=\"kc-form-box kc-form-period\">\n                            <label class=\"kc-form-label\" for=\"fn-formDateFrom\">\n                                <span class=\"kc-text\">開催期間</span>\n                                <span class=\"kc-required\">*</span>\n                            </label>\n                            <div class=\"kc-form-inputArea kc-form-inputArea--date\">\n                                <input id=\"fn-formDateFrom\" type=\"date\" class=\"kc-input kc-input--date\">\n                                <span class=\"kc-date-separator\">〜</span>\n                                <input id=\"fn-formDateTo\" type=\"date\" class=\"kc-input kc-input--date\">\n                            </div>\n                        </div>\n                    </form>\n                </div>\n\n                <!-- キッチンカー一覧テーブル -->\n                <div id=\"kc-kitchen-car-table\" class=\"kc-kitchen-car-table\">\n                    <div class=\"kc-kitchen-car-table__wrap\">\n                        <table class=\"kc-table\">\n                            <thead class=\"kc-table__head\">\n                                <tr class=\"kc-table__row\">\n                                    <th class=\"kc-table__cell kc-table__cell-head\" style=\"width:50%;\">キッチンカー</th>\n                                    <th class=\"kc-table__cell kc-table__cell-head\" style=\"width:35%;\">使用状況</th>\n                                    <th class=\"kc-table__cell kc-table__cell-head\" style=\"width:15%;\">選択</th>\n                                </tr>\n                            </thead>\n                            <!-- ループ開始 -->\n                            <tbody class=\"kc-table__body\">\n                                <tr class=\"kc-table__row fn-tableColumn-loop\" style=\"display:none;\">\n                                    <td class=\"kc-table__cell\" data-target=\"fn-table-name\">[キッチンカー名が入ります]</td>\n                                    <td class=\"kc-table__cell\" data-target=\"fn-table-status\">[使用状況が入ります]</td>\n                                    <td class=\"kc-table__cell\" data-target=\"fn-table-checkbox\">\n                                        <input type=\"checkbox\" class=\"kc-checkbox fn-pick\" value=\"\">\n                                    </td>\n                                </tr>\n                            </tbody>\n                            <!-- ループ終了 -->\n                        </table>\n                    </div>\n                </div>\n\n                <!-- その他詳細 -->\n                <div class=\"kc-kitchen-car-note\">\n                    <div class=\"kc-form-box kc-form-note\">\n                        <label class=\"kc-form-label\" for=\"fn-formNote\">\n                            <span class=\"kc-text\">その他詳細</span>\n                        </label>\n                        <div class=\"kc-form-inputArea\">\n                            <input id=\"fn-formNote\" type=\"text\" class=\"kc-input\" placeholder=\"\">\n                        </div>\n                    </div>\n                </div>\n\n                <!-- アクションボタン -->\n                <div class=\"kc-form-buttonArea\">\n                    <button class=\"kc-button kc-button--primary\" type=\"button\" id=\"fn-submitButton\">\n                        <span class=\"kc-button__text\">キッチンカー登録</span>\n                    </button>\n                    <button class=\"kc-button kc-button--secondary\" type=\"button\" id=\"fn-cancelButton\">\n                        <span class=\"kc-button__text\">キャンセル</span>\n                    </button>\n                </div>\n            </div>\n        </div>\n",
            "Id": 1
          }
        ],
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    }
  ],
  "Data": [],
  "Permissions": [
    {
      "SiteId": 253143,
      "Permissions": []
    }
  ],
  "PermissionIdList": {
    "DeptIdList": [],
    "GroupIdList": [],
    "UserIdList": []
  }
}