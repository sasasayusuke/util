{
  "HeaderInfo": {
    "AssemblyVersion": "1.4.1.1",
    "BaseSiteId": 253123,
    "Server": "http://192.168.10.67",
    "CreatorName": "Administrator",
    "PackageTime": "2026-01-07T13:58:11.6137862+00:00",
    "Convertors": [
      {
        "SiteId": 253123,
        "SiteTitle": "イベント予定一覧",
        "ReferenceType": "Results",
        "IncludeData": false
      }
    ],
    "IncludeSitePermission": true,
    "IncludeRecordPermission": true,
    "IncludeColumnPermission": true,
    "IncludeNotifications": true,
    "IncludeReminders": true
  },
  "Sites": [
    {
      "TenantId": 1,
      "SiteId": 253123,
      "Title": "イベント予定一覧",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 253088,
      "InheritPermission": 253093,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridView": 4,
        "AllowViewReset": false,
        "GridColumns": [
          "ResultId",
          "ClassA",
          "ClassF",
          "DescriptionB",
          "ClassC",
          "ClassJ",
          "ClassB~~253154,DateA",
          "ClassB~~253154,DateB",
          "Status",
          "ClassB",
          "CheckA",
          "CheckC",
          "CheckD"
        ],
        "FilterColumns": [
          "ResultId",
          "ClassA",
          "ClassF",
          "DescriptionB",
          "ClassC",
          "ClassJ",
          "ClassA~~253154,DateA",
          "Status",
          "ClassB",
          "CheckA",
          "CheckC",
          "CheckD",
          "DateC"
        ],
        "EditorColumnHash": {
          "General": [
            "_Section-1",
            "ResultId",
            "ClassA",
            "ClassB",
            "ClassC",
            "ClassM",
            "ClassI",
            "_Links-2819877",
            "ClassJ",
            "ClassK",
            "NumR",
            "ClassL",
            "_Links-253154",
            "ClassF",
            "DescriptionB",
            "NumA",
            "NumB",
            "ClassG",
            "ClassH",
            "_Links-253143",
            "_Links-253148",
            "_Section-6",
            "_Links-253149",
            "CheckA",
            "_Links-253132",
            "_Links-253141",
            "ClassD",
            "ClassE",
            "Comments",
            "_Section-3",
            "_Links-253137",
            "_Links-253150",
            "_Section-4",
            "CheckB",
            "_Links-253139",
            "_Section-5",
            "_Links-253151",
            "_Links-253145",
            "_Links-253152",
            "_Links-253142",
            "_Links-253153",
            "_Links-253138",
            "_Links-253146",
            "_Links-253630",
            "_Links-253147",
            "Title"
          ]
        },
        "SectionLatestId": 7,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "イベント予定",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 6,
            "LabelText": "品目",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 3,
            "LabelText": "イベント実績",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 4,
            "LabelText": "メディア",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 5,
            "LabelText": "実績",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassC"
        ],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "イベントカテゴリ",
            "GridLabelText": "カテゴリ",
            "ChoicesText": "小売\nイベント\nキッチンカー\nマルシェ\n飲食\n展示会\n小売（自主取扱）\n飲食（自主取扱）\nキッチンカー（自主取扱）\nその他\n",
            "NoWrap": true,
            "ValidateRequired": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ResultId",
            "LabelText": "イベント番号"
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "主管グループ",
            "ChoicesText": "[[253122,NoAddButton]]",
            "Link": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "イベント名称・出店先",
            "NoWrap": true,
            "MaxLength": 100.0
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "要請元",
            "ChoicesText": "1,国\n2,県\n3,市区町村\n4,議員\n5,その他\n",
            "NoWrap": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassE",
            "LabelText": "その他要請元",
            "MaxLength": 30.0
          },
          {
            "ColumnName": "ClassF",
            "LabelText": "開催エリア",
            "ChoicesText": "1,首都圏\n2,福島県内\n3,北海道\n4,中部\n5,関西\n6,中国\n7,九州\n8,沖縄\n9,東北\n10,北陸\n11,四国\n12,タイ\n13,ベトナム\n14,シンガポール\n15,インドネシア\n16,アメリカ\n17,メキシコ\n18,イギリス\n19,その他\n20,その他海外",
            "NoWrap": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "DescriptionB",
            "LabelText": "開催エリア詳細",
            "MaxLength": 30.0,
            "FieldCss": "field-normal"
          },
          {
            "ColumnName": "DateA",
            "LabelText": "イベント開始日",
            "NoWrap": true,
            "DateFilterFy": false,
            "DateFilterHalf": false,
            "DateFilterQuarter": false
          },
          {
            "ColumnName": "DateB",
            "LabelText": "イベント終了日",
            "DateFilterFy": false,
            "DateFilterHalf": false,
            "DateFilterQuarter": false
          },
          {
            "ColumnName": "CheckA",
            "LabelText": "LINE発信要否",
            "NoWrap": true
          },
          {
            "ColumnName": "CheckB",
            "LabelText": "メディア掲載有無",
            "NoWrap": true
          },
          {
            "ColumnName": "NumA",
            "LabelText": "予算額",
            "NoWrap": true
          },
          {
            "ColumnName": "NumB",
            "LabelText": "契約額"
          },
          {
            "ColumnName": "ClassG",
            "LabelText": "委託先情報（社名）",
            "ChoicesText": "[[253120,NoAddButton]]",
            "NoWrap": true,
            "Link": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassH",
            "LabelText": "委託先情報（契約形態）",
            "ChoicesText": "1,競争\n2,匿名",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "NumC",
            "LabelText": "委託先情報（契約料）"
          },
          {
            "ColumnName": "Comments",
            "LabelText": "自由記入欄（イベント）",
            "MaxLength": 1000.0
          },
          {
            "ColumnName": "NumD",
            "LabelText": "米　総売上",
            "NoWrap": true,
            "Unit": "円"
          },
          {
            "ColumnName": "NumE",
            "LabelText": "米　総取扱量",
            "Unit": "kg"
          },
          {
            "ColumnName": "NumF",
            "LabelText": "桃　総売上",
            "NoWrap": true,
            "Unit": "円"
          },
          {
            "ColumnName": "NumG",
            "LabelText": "桃　総取扱量",
            "Unit": "kg"
          },
          {
            "ColumnName": "NumH",
            "LabelText": "牛肉　総売上",
            "NoWrap": true,
            "Unit": "円"
          },
          {
            "ColumnName": "NumI",
            "LabelText": "牛肉　総取扱量",
            "Unit": "kg"
          },
          {
            "ColumnName": "NumJ",
            "LabelText": "水産品　総売上",
            "NoWrap": true,
            "Unit": "円"
          },
          {
            "ColumnName": "NumK",
            "LabelText": "水産品　総取扱量",
            "Unit": "kg"
          },
          {
            "ColumnName": "NumL",
            "LabelText": "ホタテ　総売上",
            "NoWrap": true,
            "Unit": "円"
          },
          {
            "ColumnName": "NumM",
            "LabelText": "ホタテ　総取扱量",
            "Unit": "kg"
          },
          {
            "ColumnName": "NumN",
            "LabelText": "その他禁輸対象　総売上",
            "NoWrap": true,
            "Unit": "円"
          },
          {
            "ColumnName": "NumO",
            "LabelText": "その他禁輸対象　総取扱量",
            "Unit": "kg"
          },
          {
            "ColumnName": "NumP",
            "LabelText": "その他　総売上",
            "NoWrap": true,
            "Unit": "円"
          },
          {
            "ColumnName": "NumQ",
            "LabelText": "その他　総取扱量",
            "Unit": "kg"
          },
          {
            "ColumnName": "CheckC",
            "LabelText": "派遣有無",
            "GridLabelText": "派遣要否"
          },
          {
            "ColumnName": "CheckD",
            "LabelText": "ノベルティ有無",
            "GridLabelText": "ノベルティ配布"
          },
          {
            "ColumnName": "ClassI",
            "LabelText": "店舗管理方法",
            "ChoicesText": "1,店舗ごと入力\n2,店舗数",
            "ChoicesControlType": "Radio",
            "NoWrap": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassJ",
            "LabelText": "事業名・店舗名",
            "ChoicesText": "[[253115,NoAddButton]]",
            "MultipleSelections": true,
            "NoWrap": true,
            "ExtendedHtmlBeforeField": "<div style=\"clear:both;  color:black; margin-bottom:3px; font-size:12px;\">店舗ごと入力</div>",
            "Link": true
          },
          {
            "ColumnName": "ClassK",
            "LabelText": "事業名・店舗名",
            "MaxLength": 50.0,
            "ExtendedHtmlBeforeField": "<div style=\"clear:both;  color:black; margin-bottom:3px; font-size:12px;\">店舗数</div>"
          },
          {
            "ColumnName": "ClassM",
            "LabelText": "担当者",
            "ChoicesText": "[[253130]]",
            "Link": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassN",
            "LabelText": "店舗名",
            "ChoicesText": "[[253115,NoAddButton]]",
            "Link": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassO",
            "LabelText": "イベント店舗",
            "ChoicesText": "[[253137]]",
            "Link": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "NumR",
            "LabelText": "店舗数"
          },
          {
            "ColumnName": "DateC",
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "ClassL",
            "LabelText": "対応状況",
            "ChoicesText": "1,対応中\n2,完了\n3,中止",
            "NoWrap": true,
            "ValidateRequired": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "Title",
            "Hide": true
          }
        ],
        "Links": [
          {
            "ColumnName": "ClassM",
            "SiteId": 253130
          },
          {
            "ColumnName": "ClassO",
            "SiteId": 253137
          },
          {
            "ColumnName": "ClassB",
            "SiteId": 253122,
            "NoAddButton": true
          },
          {
            "ColumnName": "ClassN",
            "SiteId": 253115,
            "NoAddButton": true
          },
          {
            "ColumnName": "ClassJ",
            "SiteId": 253115,
            "NoAddButton": true
          },
          {
            "ColumnName": "ClassG",
            "SiteId": 253120,
            "NoAddButton": true
          }
        ],
        "Formulas": [
          {
            "CalculationMethod": "Extended",
            "Target": "DateC",
            "FormulaScript": "$TODAY()",
            "FormulaMapping": "{}",
            "Id": 1
          }
        ],
        "ViewLatestId": 4,
        "Views": [
          {
            "Id": 4,
            "Name": "イベント予定一覧",
            "ColumnSorterHash": {
              "ClassB~~253154-ClassZ~~253140,DateA": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "CalendarTimePeriod": "Monthly",
            "CalendarFromTo": "DateA",
            "CrosstabGroupByX": "ClassA",
            "CrosstabGroupByY": "ClassA",
            "CrosstabAggregateType": "Total",
            "CrosstabValue": "NumA",
            "CrosstabTimePeriod": "Monthly",
            "KambanAggregateType": "Count",
            "ApiDataType": 0
          },
          {
            "Id": 1,
            "Name": "イベント当日",
            "DefaultMode": "Index",
            "GridColumns": [
              "ClassA",
              "ClassC",
              "ClassJ",
              "ClassF",
              "DescriptionB",
              "DateA",
              "DateB",
              "ClassF~~253148,ClassB",
              "ClassF~~253148,ClassC",
              "ClassF~~253148,ClassD",
              "ClassF~~253148,ClassE",
              "ClassC~~253140,DateA",
              "ClassC~~253140,DateB",
              "ClassC~~253140,ClassB",
              "ClassC~~253140,DescriptionA"
            ],
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "CalendarTimePeriod": "Monthly",
            "CalendarFromTo": "DateA",
            "CrosstabGroupByX": "Status",
            "CrosstabGroupByY": "ClassA",
            "CrosstabAggregateType": "Total",
            "CrosstabValue": "NumA",
            "CrosstabTimePeriod": "Monthly",
            "KambanAggregateType": "Count",
            "ApiDataType": 0
          },
          {
            "Id": 2,
            "Name": "イベント実績一覧",
            "DefaultMode": "Index",
            "GridColumns": [
              "ResultId",
              "ClassA",
              "ClassC",
              "ClassJ~253115,ResultId",
              "ClassJ",
              "ClassK",
              "ClassA~~253154,ClassB",
              "ClassA~~253154,DateA",
              "ClassA~~253154,DateB",
              "Status",
              "ClassA~~253149,ClassD",
              "ClassA~~253149,ClassC"
            ],
            "FilterColumns": [
              "ResultId",
              "ClassA",
              "ClassC",
              "ClassJ",
              "ClassA~~2796828,DateA",
              "Status",
              "ClassB",
              "ClassA~~2796829,ClassD"
            ],
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "CalendarTimePeriod": "Monthly",
            "CalendarFromTo": "DateA",
            "CrosstabGroupByX": "Status",
            "CrosstabGroupByY": "ClassA",
            "CrosstabAggregateType": "Total",
            "CrosstabValue": "NumA",
            "CrosstabTimePeriod": "Monthly",
            "KambanAggregateType": "Count",
            "ApiDataType": 0
          },
          {
            "Id": 3,
            "Name": "開催イベント一覧",
            "GridColumns": [
              "DateC",
              "ClassA",
              "ClassF",
              "DescriptionB",
              "ClassC",
              "ClassJ",
              "DateA",
              "DateB",
              "ClassC~~253140,DateA",
              "ClassC~~253140,DateB"
            ],
            "FilterColumns": [
              "DateC"
            ],
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "CalendarTimePeriod": "Monthly",
            "CalendarFromTo": "DateA",
            "CrosstabGroupByX": "Status",
            "CrosstabGroupByY": "ClassA",
            "CrosstabAggregateType": "Total",
            "CrosstabValue": "NumA",
            "CrosstabTimePeriod": "Monthly",
            "KambanAggregateType": "Count",
            "ApiDataType": 0
          }
        ],
        "Styles": [
          {
            "Title": "【画面】実績集計",
            "All": true,
            "Body": ".Sdt-table-wrap {\n  margin-top: 12px;\n}\n\n.Sdt-summary-table {\n  width: 100%;\n  border-collapse: collapse;\n}\n\n.Sdt-summary-table .Sdt-title-top th {\n  color: #444;          /* 濃い目のグレー */\n  font-weight: 800;     /* 太文字 */\n  padding: 12px 0;      /* 上下余白 */\n}\n\n.Sdt-text-normal th,\n.Sdt-text-normal td,\n.Sdt-text-normal span {\n  color: #555;\n}\n\n.Sdt-sales-row td {\n  padding-bottom: 16px;\n}\n\n",
            "Id": 1
          },
          {
            "Title": "【画面制御】福島県内処理",
            "All": true,
            "Body": ".required-mark {\n  color: #f00;   /* 赤 */\n\n}",
            "Id": 2
          },
          {
            "Title": "【画面制御】キッチンカーリンクフィールド非表示化",
            "New": true,
            "Edit": true,
            "Body": "#Results_Source253143Field{\n  display: none;\n}",
            "Id": 3
          }
        ],
        "Scripts": [
          {
            "Title": "【設定】　サイトID",
            "All": true,
            "Body": "//開催イベント一覧サイトID\nconst LIST_SCREEN_SITE_ID = '2832883';\nconst event_Site_Id = '253123';  //イベント予定一覧\nconst store_Site_Id = '253115';  //店舗名\nconst period_Site_Id = '253154';  //開始～終了\nconst dispatch_Site_Id= '253132';  //派遣要否\nconst novelty_Site_Id = '253141';  //ノベルティ配布\n\n// 各画面URL（相対パス）\n// サイトID、URLに合わせて修正要\nconst urlA = `/items/253123/edit`;\nconst urlB = `/items/253382?back=1&FromTabIndex=0",
            "Id": 4
          },
          {
            "Title": "リンク項目継承処理",
            "All": true,
            "Body": "// 親画面に置くコード（1回だけ実行されるように）\n(function(){\n  // sessionStorage のキー名（必要に応じて変更）\n  const STORAGE_KEY = 'pleasanter.linkPayload';\n\n  // ペイロードを生成する関数（必要ならこの関数をカスタマイズ）\n  // targetBtn: DOM element（クリックされたボタン）\n  // ev: MouseEvent\n  function buildPayload(targetBtn, ev) {\n    // 例：ボタンの data-* 属性を渡す + タイムスタンプ + 任意パラメータ\n    return {\n      fromDataId: targetBtn.dataset.id || null,\n      fromSiteId: targetBtn.dataset.fromSiteId || null,\n      toSiteId: targetBtn.dataset.toSiteId || null,\n      // ここに任意のパラメータを追加（例：現在ログインユーザーID等）\n      StoreManageMethodId: $p.getControl('ClassI').val(),\n      StoreManageMethod: commonGetVal('ClassI'),\n      PerStoreId: $p.getControl('ClassJ').val(),\n      PerStoreName: commonGetVal('ClassJ'),\n      NumberOfStoreId: $p.getControl('ClassK').val(),\n      NumberOfStoreName: commonGetVal('ClassK'),\n      customParam: window.myCustomParam || null,\n      ts: Date.now()\n    };\n  }\n\n\n  //分類項目の値取得ヘルパー関数\n  function commonGetVal(label, valueFlg = false) {\n    let value = \"\"\n    try {\n        if ($p.getControl(label).prop(\"tagName\") === \"SELECT\") {\n            if ($p.getControl(label).attr(\"multiple\")) {\n                value = valueFlg ? $p.getControl(label).val() : $p.getControl(label).next().children().last().text()\n            } else {\n                value = valueFlg ? $p.getControl(label).children(':selected').val() : $p.getControl(label).children(':selected').text()\n            }\n        } else if ($p.getControl(label).prop(\"tagName\") === \"INPUT\") {\n            value = $p.getControl(label).val()\n        } else if ($p.getControl($p.getColumnName(label)).prop(\"tagName\") === \"TEXTAREA\") {\n            value = $p.getControl(label).val()\n        }\n    } catch (e) {\n        console.log(label)\n        console.log(e)\n        value = \"\"\n    } finally {\n        return value\n    }\n  }\n\n  // キャプチャフェーズでクリックを捕まえる（既存 onclick より先に実行される）\n  document.addEventListener('click', function(ev){\n    try {\n      const btn = ev.target.closest && ev.target.closest('button[data-id]');\n      if (!btn) return; // 対象外のクリックは無視\n\n      // 一定の条件のみ処理したい場合はここで判定（例：class 名や data-icon 等）\n      // if (!btn.classList.contains('applied')) return;\n\n      // ペイロード生成（アプリ側が独自に payload を構築できるようにフックも用意）\n      let payload;\n      if (typeof window.__pleasanterLinkPayloadProvider === 'function') {\n        // もしホストページが独自の provider を定義していればそれを使う\n        payload = window.__pleasanterLinkPayloadProvider(btn, ev);\n      } else {\n        payload = buildPayload(btn, ev);\n      }\n\n      // 書き込み（JSON 文字列化）\n      sessionStorage.setItem(STORAGE_KEY, JSON.stringify(payload));\n\n      // 重要：ここで何も返さない → 以降に $p.new($(this)) の onclick ハンドラが実行される\n    } catch (e) {\n      // ログのみ。既存処理を阻害しない。\n      console.error('pleasanter: link payload write error', e);\n    }\n  }, /* useCapture = */ true);\n})();",
            "Id": 1
          },
          {
            "Title": "【試験】大衡試験ジャンプスクリプト　代理クリック",
            "Edit": true,
            "Disabled": true,
            "Body": "$(function () {\n  $('tr.grid-row[data-id=\"2841751\"] td').first().trigger('click');\n});",
            "Id": 2
          },
          {
            "Title": "イベント当日ジャンプスクリプト",
            "All": true,
            "Disabled": true,
            "Body": "(function(){\n  // sessionStorage のキー名\n  const STORAGE_KEY = 'pleasanter.linkPayload';\n\n  // ペイロードを生成する関数（必要ならこの関数をカスタマイズ）\n  // targetBtn: DOM element（クリックされたボタン）\n  // ev: MouseEvent\n  function buildPayload(targetBtn, ev) {\n    // ボタンの所属行\n    const $row = $(targetBtn).closest('tr');\n\n    // 例：ボタンの data-* 属性を渡す + タイムスタンプ + 任意パラメータ\n    return {\n      fromDataId: targetBtn.dataset.id || null,\n      fromSiteId: targetBtn.dataset.fromSiteId || null,\n      toSiteId: targetBtn.dataset.toSiteId || null,\n\n      StoreManageMethodId: $p.getControl('ClassI').val(),\n      StoreManageMethod: commonGetVal('ClassI'),\n      PerStoreId: $p.getControl('ClassJ').val(),\n      PerStoreName: commonGetVal('ClassJ'),\n      NumberOfStoreId: $p.getControl('ClassK').val(),\n      NumberOfStoreName: commonGetVal('ClassK'),\n      EventDate: $p.getControl('DateC').val(),\n\n      dateA: $row.find('td[data-name=\"ClassB~~2832879,DateA\"]').text().trim(),\n      dateB: $row.find('td[data-name=\"ClassB~~2832879,DateB\"]').text().trim(),\n\n      listSiteId: $p.siteId,\n\n      customParam: window.myCustomParam || null,\n      ts: Date.now()\n    };\n  }\n\n  // 分類項目の値取得ヘルパー関数\n  function commonGetVal(label, valueFlg = false) {\n    let value = \"\";\n    try {\n      if ($p.getControl(label).prop(\"tagName\") === \"SELECT\") {\n        if ($p.getControl(label).attr(\"multiple\")) {\n          value = valueFlg ? $p.getControl(label).val() : $p.getControl(label).next().children().last().text();\n        } else {\n          value = valueFlg ? $p.getControl(label).children(':selected').val() : $p.getControl(label).children(':selected').text();\n        }\n      } else if ($p.getControl(label).prop(\"tagName\") === \"INPUT\") {\n        value = $p.getControl(label).val();\n      } else if ($p.getControl($p.getColumnName(label)).prop(\"tagName\") === \"TEXTAREA\") {\n        value = $p.getControl(label).val();\n      }\n    } catch (e) {\n      console.log(label, e);\n      value = \"\";\n    } finally {\n      return value;\n    }\n  }\n\n  // オーバーレイの作成\n  function showOverlay() {\n    if(document.getElementById('overlay-screen')) return;\n    const overlay = document.createElement('div');\n    overlay.id = 'overlay-screen';\n    overlay.style.position = 'fixed';\n    overlay.style.top = 0;\n    overlay.style.left = 0;\n    overlay.style.width = '100%';\n    overlay.style.height = '100%';\n    overlay.style.backgroundColor = '#fff';\n    overlay.style.zIndex = 9999;\n    document.body.appendChild(overlay);\n  }\n\n  // オーバーレイ解除（siteID 判定）\n  function removeOverlay(payload) {\n    const currentSiteId = $p.siteId;\n    const targetSiteId = payload.toSiteId || payload.listSiteId;\n\n    if(currentSiteId === targetSiteId || currentSiteId === LIST_SCREEN_SITE_ID){\n      const overlayEl = document.getElementById('overlay-screen');\n      if(overlayEl) overlayEl.remove();\n    }\n  }\n\n  // 画面遷移の処理\n  function processScreens(payload) {\n    showOverlay();\n\n    // まず個別イベント管理のテーブルをチェック\n    $.get(urlA, function(dataA){\n      const docA = $(dataA);\n      const rowA = docA.find('td[data-name=\"ClassB~~2832879,DateA\"], td[data-name=\"ClassB~~2832879,DateB\"]');\n      const matchA = rowA.filter(function(i, td){\n        const val = $(td).text().trim();\n        return val === payload.dateA || val === payload.dateB;\n      });\n\n      if(matchA.length === 0){\n        console.log('条件不一致: 個別イベント管理');\n        removeOverlay(payload);\n        window.location.href = `/items/${LIST_SCREEN_SITE_ID}/index`;\n        return;\n      }\n\n      // 条件一致 → 開始～終了期間画面へ\n      $.get(urlB, function(dataB){\n        const docB = $(dataB);\n        const rowB = docB.find('td[data-name=\"ClassB~~2832879,DateA\"], td[data-name=\"ClassB~~2832879,DateB\"]');\n        const matchB = rowB.filter(function(i, td){\n          const val = $(td).text().trim();\n          return val === payload.dateA || val === payload.dateB;\n        });\n\n        if(matchB.length > 0){\n          // 条件一致 → レコードをクリックして最終画面へ\n          const recordId = matchB.first().closest('tr.grid-row').data('id');\n          $(function () {\n            $('tr.grid-row[data-id=' + recordId + '] td').first().trigger('click');\n          });\n        } else {\n          // 条件不一致 → 作成ボタンを押下\n          $(docB).find('button[data-id=\"2842211\"]').trigger('click');\n        }\n\n        removeOverlay(payload);\n      });\n    });\n  }\n\n  // キャプチャフェーズでクリックを捕まえる（既存 onclick より先に実行される）\n  document.addEventListener('click', function(ev){\n    try {\n      const btn = ev.target.closest && ev.target.closest('button[data-id]');\n      if (!btn) return; // 対象外のクリックは無視\n\n      // 一定の条件のみ処理したい場合はここで判定（例：class 名や data-icon 等）\n      // if (!btn.classList.contains('applied')) return;\n\n      // ペイロード生成（アプリ側が独自に payload を構築できるようにフックも用意）\n      let payload;\n      if (typeof window.__pleasanterLinkPayloadProvider === 'function') {\n        // もしホストページが独自の provider を定義していればそれを使う\n        payload = window.__pleasanterLinkPayloadProvider(btn, ev);\n      } else {\n        payload = buildPayload(btn, ev);\n      }\n\n      // 書き込み（JSON 文字列化）\n      sessionStorage.setItem(STORAGE_KEY, JSON.stringify(payload));\n\n      // 画面遷移処理\n      processScreens(payload);\n\n      // 重要：ここで何も返さない → 以降に $p.new($(this)) の onclick ハンドラが実行される\n    } catch (e) {\n      // ログのみ。既存処理を阻害しない。\n      console.error('pleasanter: link payload write error', e);\n    }\n  }, /* useCapture = */ true);\n\n})();",
            "Id": 3
          },
          {
            "Title": "店舗別　ポップアップスクリプト",
            "All": true,
            "Disabled": true,
            "Body": "(function () {\n  \"use strict\";\n\n  if (!window.$p || typeof $p.apiGet !== \"function\" || !$p.events) return;\n\n  let all = [];\n  let getFlag = false;\n  let clickBound = false;\n  let storeAll = [];\n  let storeFlag = false;\n  let periodAll = [];\n  let periodFlag = false;\n  let dispatchAll = [];\n  let dispatchReady = false;\n  let noveltyAll = [];\n  let noveltyReady = false;\n\n  // ============================================================\n  // HTML\n  // ============================================================\n  function fnPopupHtml(params) {\n    const title = params?.title || \"店舗ごと入力\";\n    const bodyHtml = params?.bodyHtml || \"\";\n\n    return `\n      <div class=\"sdt-popup-overlay\" data-sdt-popup-overlay=\"1\">\n        <div class=\"sdt-popup\" role=\"dialog\" aria-modal=\"true\">\n          <div class=\"sdt-popup__header\">\n\t\t  <div class=\"sdt-popup__title\">店舗詳細</div>\n            <button type=\"button\" class=\"sdt-popup__close\" data-sdt-popup-close=\"1\" aria-label=\"閉じる\">×</button>\n          </div>\n          <div class=\"sdt-popup__body\">\n            ${bodyHtml}\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  // ============================================================\n  // ポップアップ表示/閉じる\n  // ============================================================\n  let fnPopupRootEl = null;\n  function fnPopupClose() {\n    if (!fnPopupRootEl) return;\n    fnPopupRootEl.remove();\n    fnPopupRootEl = null;\n    document.removeEventListener(\"keydown\", fnPopupOnKeydown, true);\n  }\n\n  function fnPopupOnKeydown(e) {\n    if (e.key === \"Escape\") fnPopupClose();\n  }\n  function fnPopupOpen(params) {\n    fnPopupClose();\n    const wrap = document.createElement(\"div\");\n    wrap.className = \"sdt-popup-root\";\n    wrap.innerHTML = fnPopupHtml(params);\n    wrap.addEventListener(\"click\", function (e) {\n      const overlay =\n        e.target.closest && e.target.closest('[data-sdt-popup-overlay=\"1\"]');\n      if (overlay && e.target === overlay) fnPopupClose();\n    });\n    wrap.addEventListener(\"click\", function (e) {\n      const btn =\n        e.target.closest && e.target.closest('[data-sdt-popup-close=\"1\"]');\n      if (btn) fnPopupClose();\n    });\n    document.body.appendChild(wrap);\n    fnPopupRootEl = wrap;\n  }\n\n  // ============================================================\n  // クリックされた要素から ResultId を拾う\n  // ============================================================\n  function fnPickId(target) {\n    const tr = target.closest && target.closest(\"tr\");\n    if (!tr) return null;\n    const cand = tr.getAttribute(\"data-id\");\n    return cand ? String(cand) : null;\n  }\n\n  // ============================================================\n  // キャッシュ(all)から ResultId 一致でレコードを引く\n  // ============================================================\n  function fnFindByResultId(resultId) {\n    if (!resultId) return null;\n    const rid = String(resultId);\n    return all.find((r) => String(r?.ResultId ?? \"\") === rid) || null;\n  }\n\n  // ============================================================\n  // JSON文字列→配列\n  // ============================================================\n  function fnParseIdList(jsonStr) {\n    if (!jsonStr) return [];\n    try {\n      const v = JSON.parse(jsonStr);\n      return Array.isArray(v) ? v.map(String) : [];\n    } catch (e) {\n      console.log(\"ClassJのJSON.parseに失敗\", { jsonStr, e });\n      return [];\n    }\n  }\n\n  // ============================================================\n  // 店舗ID → 店舗名(ClassA)\n  // ============================================================\n  function fnFindStoreNameByResultId(resultId) {\n    if (!resultId) return null;\n    const rid = String(resultId);\n    const rec = storeAll.find((s) => String(s?.ResultId ?? \"\") === rid) || null;\n    return rec?.ClassHash?.ClassA || null;\n  }\n\n  // ============================================================\n  // 文字列正規化\n  // ============================================================\n  function fnNormalizeName(name) {\n    return String(name || \"\")\n      .replace(/\\r?\\n/g, \"\")\n      .replace(/\\u3000/g, \" \")\n      .replace(/\\s+/g, \" \")\n      .trim();\n  }\n\n  // ============================================================\n  // ClassB が JSON文字列/空白混入でも一致させる\n  // ============================================================\n  function fnNormalizeIdValue(v) {\n    const s = String(v ?? \"\").trim();\n    if (!s) return \"\";\n    if (s.startsWith(\"[\")) {\n      try {\n        const arr = JSON.parse(s);\n        if (Array.isArray(arr) && arr.length) return String(arr[0]).trim();\n      } catch (e) {\n        /* noop */\n      }\n    }\n    return s;\n  }\n\n  function fnFindPeriodsByEventId(eventResultId) {\n    const eid = String(eventResultId).trim();\n    return periodAll.filter(\n      (p) => fnNormalizeIdValue(p?.ClassHash?.ClassB) === eid\n    );\n  }\n\n  // ============================================================\n  // 店舗名をキーに、開始/終了を作る\n  // ============================================================\n  function fnBuildPeriodMap(periodRows) {\n    const map = {}; // { 店舗名: { start, end } }\n    periodRows.forEach((pe) => {\n      const storeName = fnNormalizeName(pe?.ClassHash?.ClassA);\n      if (!storeName) return;\n      const start = pe?.DateHash?.DateA || \"\";\n      const end = pe?.DateHash?.DateB || \"\";\n      if (!map[storeName]) {\n        map[storeName] = { start, end };\n        return;\n      }\n      if (start && (!map[storeName].start || start < map[storeName].start))\n        map[storeName].start = start;\n      if (end && (!map[storeName].end || end > map[storeName].end))\n        map[storeName].end = end;\n    });\n    return map;\n  }\n\n  function fnFormatDate(v) {\n    const s = String(v || \"\");\n    // 2025-12-24T00:00:00 → 2025-12-24\n    if (s.includes(\"T\")) return s.split(\"T\")[0];\n    return s;\n  }\n\n  // ============================================================\n  // 遷移を強制停止\n  // ============================================================\n  function fnStop(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (typeof e.stopImmediatePropagation === \"function\")\n      e.stopImmediatePropagation();\n  }\n\n  // ============================================================\n  // apiGet を Promise 化\n  // ============================================================\n  function fnApiGetAsPromise(siteId) {\n    return new Promise((resolve, reject) => {\n      $p.apiGet({\n        id: siteId,\n        done: function (data) {\n          resolve(data?.Response?.Data || []);\n        },\n        fail: function (err) {\n          reject(err);\n        },\n      });\n    });\n  }\n\n  // ============================================================\n  // ============================================================\n  // 派遣者：イベントIDで行を集める（ClassB=イベントResultId）\n  // ============================================================\n  // ============================================================\n  function fnFindDispatchersByEventId(eventResultId) {\n    const eid = String(eventResultId ?? \"\").trim();\n    if (!eid) return [];\n    return dispatchAll.filter(\n      (d) => fnNormalizeIdValue(d?.ClassHash?.ClassB) === eid\n    );\n  }\n\n  // ============================================================\n  // ============================================================\n  // 派遣Map作成（店舗名キー → true）\n  // ============================================================\n  // ============================================================\n  // ・派遣者テーブルの ClassA を「店舗名」として扱う\n  // ・比較ブレ防止のため、必ず fnNormalizeName で正規化してキーにする\n  // ・同一店舗が複数あっても true のまま（存在判定だけ）\n  // ============================================================\n  function fnBuildDispatchMapByStoreName(dispatchRows) {\n    const map = {}; // { 正規化店舗名: true }\n\n    dispatchRows.forEach((d) => {\n      const storeNameRaw = d?.ClassHash?.ClassA; // ★店舗名\n      const storeKey = fnNormalizeName(storeNameRaw);\n      if (!storeKey) return;\n      map[storeKey] = true;\n    });\n\n    return map;\n  }\n\n  // ============================================================\n  // ノベルティ：イベントIDで行を集める（ClassB=イベントResultId）\n  // ============================================================\n  function fnFindNoveltiesByEventId(eventResultId) {\n    const eid = String(eventResultId ?? \"\").trim();\n    if (!eid) return [];\n    return noveltyAll.filter(\n      (n) => fnNormalizeIdValue(n?.ClassHash?.ClassB) === eid\n    );\n  }\n\n  // ============================================================\n  // ノベルティMap作成（店舗名キー → true）\n  // ============================================================\n  function fnBuildNoveltyMapByStoreName(noveltyRows) {\n    const map = {};\n    noveltyRows.forEach((n) => {\n      const storeNameRaw = fnNormalizeIdValue(n?.ClassHash?.ClassA);\n      const storeKey = fnNormalizeName(storeNameRaw);\n      if (!storeKey) return;\n      map[storeKey] = true;\n    });\n    return map;\n  }\n\n  // ============================================================\n  // ポップアップ内 店舗名リンク押下 → 詳細・編集画面へ遷移\n  // ============================================================\n  document.addEventListener(\n    \"click\",\n    function (e) {\n      const link =\n        e.target.closest && e.target.closest(\".sdt-popup-event-link\");\n      if (!link) return;\n      const eventResultId = link.getAttribute(\"data-event-resultid\");\n      if (!eventResultId) return;\n      const url = `/items/${eventResultId}`;\n      e.preventDefault();\n      e.stopPropagation();\n      window.location.href = url;\n    },\n    true\n  );\n\n  // ============================================================\n  // レコード押下時：ClassHash.ClassI を見て、条件一致なら遷移停止\n  // ============================================================\n  function fnPush(e) {\n    const grid = document.getElementById(\"Grid\");\n    const clickedId = fnPickId(e.target);\n    const row = fnFindByResultId(clickedId);\n    const classI = row?.ClassHash?.ClassI;\n\n    if (!getFlag || !all.length) return;\n    if (!grid || !grid.contains(e.target)) return;\n    if (!clickedId) return;\n    if (!row) return;\n    if (classI !== \"店舗ごと入力\") return;\n\n    fnStop(e);\n    if (!storeFlag) {\n      fnPopupOpen({\n        title: \"店舗ごと入力（ポップアップ）\",\n        bodyHtml: `<div class=\"sdt-popup__note\">店舗情報を読込中です。もう一度クリックしてください。</div>`,\n      });\n      return;\n    }\n    if (!periodFlag) {\n      fnPopupOpen({\n        title: \"店舗ごと入力（ポップアップ）\",\n        bodyHtml: `<div class=\"sdt-popup__note\">期間情報を読込中です。もう一度クリックしてください。</div>`,\n      });\n      return;\n    }\n    if (!dispatchReady) {\n      fnPopupOpen({\n        title: \"店舗ごと入力（ポップアップ）\",\n        bodyHtml: `<div class=\"sdt-popup__note\">派遣者情報を読込中です。もう一度クリックしてください。</div>`,\n      });\n      return;\n    }\n    if (!noveltyReady) {\n      fnPopupOpen({\n        title: \"店舗ごと入力（ポップアップ）\",\n        bodyHtml: `<div class=\"sdt-popup__note\">ノベルティ情報を読込中です。もう一度クリックしてください。</div>`,\n      });\n      return;\n    }\n\n    const eventResultId = String(row?.ResultId ?? \"\");\n    const storeIds = fnParseIdList(row?.ClassHash?.ClassJ);\n    const periodRows = fnFindPeriodsByEventId(row?.ResultId);\n    const periodMap = fnBuildPeriodMap(periodRows);\n    const dispatchRows = fnFindDispatchersByEventId(row?.ResultId);\n    const dispatchMap = fnBuildDispatchMapByStoreName(dispatchRows);\n    const noveltyRows = fnFindNoveltiesByEventId(row?.ResultId);\n    const noveltyMap = fnBuildNoveltyMapByStoreName(noveltyRows);\n    const rowsHtml = storeIds\n      .map((id) => {\n        const storeName =\n          fnFindStoreNameByResultId(id) || `店舗名が同一ではありません`;\n        const key = fnNormalizeName(storeName);\n        const period = periodMap[key] || {};\n        const start = fnFormatDate(period.start || \"\");\n        const end = fnFormatDate(period.end || \"\");\n        const dispatchChecked = !!dispatchMap[key];\n        const noveltyChecked = !!noveltyMap[key];\n\n        return `\n        <tr class=\"sdt-popup-table__tr\" data-store-resultid=\"${id}\">\n          <td class=\"sdt-popup-table__td\">\n            <span\n              class=\"sdt-popup-event-link\"\n              data-event-resultid=\"${eventResultId}\"\n            >${storeName}</span>\n          </td>\n          <td class=\"sdt-popup-table__td\">${start}</td>\n          <td class=\"sdt-popup-table__td\">${end}</td>\n          <td class=\"sdt-popup-table__td\">\n            <input class=\"sdt-popup-checkbox\" type=\"checkbox\" ${\n              dispatchChecked ? \"checked\" : \"\"\n            } disabled>\n          </td>\n          <td class=\"sdt-popup-table__td\">\n            <input class=\"sdt-popup-checkbox\" type=\"checkbox\" ${\n              noveltyChecked ? \"checked\" : \"\"\n            } disabled>\n          </td>\n        </tr>\n      `;\n      })\n      .join(\"\");\n\n    const safeRowsHtml =\n      rowsHtml ||\n      `<tr><td class=\"sdt-popup-table__td\" colspan=\"5\">店舗が選択されていません</td></tr>`;\n\n    fnPopupOpen({\n      bodyHtml: `\n        <table class=\"sdt-popup-table\">\n          <thead>\n            <tr>\n              <th class=\"sdt-popup-table__th\">店舗名</th>\n              <th class=\"sdt-popup-table__th\">開始日</th>\n              <th class=\"sdt-popup-table__th\">終了日</th>\n              <th class=\"sdt-popup-table__th\">派遣要否</th>\n              <th class=\"sdt-popup-table__th\">ノベルティ配布</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${safeRowsHtml}\n          </tbody>\n        </table>\n      `,\n    });\n  }\n\n  // ============================================================\n  // 一覧ロード：全件取得\n  // ============================================================\n  $p.events.on_grid_load = function () {\n    getFlag = false;\n    all = [];\n    storeFlag = false;\n    storeAll = [];\n    periodFlag = false;\n    periodAll = [];\n    dispatchReady = false;\n    dispatchAll = [];\n    noveltyReady = false;\n    noveltyAll = [];\n\n    Promise.all([\n      fnApiGetAsPromise(event_Site_Id),\n      fnApiGetAsPromise(store_Site_Id),\n      fnApiGetAsPromise(period_Site_Id),\n      fnApiGetAsPromise(dispatch_Site_Id),\n      fnApiGetAsPromise(novelty_Site_Id),\n    ])\n      .then(([eventRows, storeRows, periodRows, dispatchRows, noveltyRows]) => {\n        all = eventRows;\n        storeAll = storeRows;\n        periodAll = periodRows;\n        dispatchAll = dispatchRows;\n        noveltyAll = noveltyRows;\n\n        getFlag = true;\n        storeFlag = true;\n        periodFlag = true;\n        dispatchReady = true;\n        noveltyReady = true;\n\n        console.log(\"イベント予定一覧の全レコード\", all);\n        console.log(\"店舗の全レコード\", storeAll);\n        console.log(\"開始～終了全レコード\", periodAll);\n        console.log(\"派遣者の全レコード\", dispatchAll);\n        console.log(\"ノベルティの全レコード\", noveltyAll);\n      })\n      .catch((err) => {\n        getFlag = false;\n        storeFlag = false;\n        periodFlag = false;\n        dispatchReady = false;\n        noveltyReady = false;\n        all = [];\n        storeAll = [];\n        periodAll = [];\n        dispatchAll = [];\n        noveltyAll = [];\n\n        console.warn(\"一覧ロード取得失敗\", err);\n      });\n\n    if (!clickBound) {\n      clickBound = true;\n      document.addEventListener(\"click\", fnPush, true);\n    }\n  };\n})();\n",
            "Id": 5
          },
          {
            "Title": "【画面作成】実績集計",
            "Edit": true,
            "Body": "insertSummaryTable();\n\nfunction insertSummaryTable() {\n    let DataList = getStoreRecors();\n    console.log(\"DataList\");\n    console.log(DataList);\n\n\n  // 二重生成防止\n  if ($('.summary-table-wrap').length > 0) {\n    return;\n  }\n\n  const html = `\n    <div class=\"Sdt-table-wrap\">\n      <table class=\"Sdt-summary-table\">\n        <tr class=\"Sdt-title-top\">\n          <th  colspan=\"3\">全店舗‐実績</th>\n        </tr>\n        <tr class=\"Sdt-text-normal\">\n          <th>米</th>\n          <th>桃</th>\n          <th>牛肉</th>\n        </tr>\n        <tr class=\"Sdt-text-normal\">\n          <td>総取扱量 <span class=\"num rice-qty\">${DataList.totalNumA}</span> kg</td>\n          <td>総取扱量 <span class=\"num peach-qty\">${DataList.totalNumC}</span> kg</td>\n          <td>総取扱量 <span class=\"num beef-qty\">${DataList.totalNumB}</span> kg</td>\n        </tr>\n        <tr class=\"Sdt-text-normal Sdt-sales-row\">\n          <td>総売上 <span class=\"num rice-sales\">${DataList.totalNumD}</span> 円</td>\n          <td>総売上 <span class=\"num peach-sales\">${DataList.totalNumE}</span> 円</td>\n          <td>総売上 <span class=\"num beef-sales\">${DataList.totalNumF}</span> 円</td>\n        </tr>\n        <tr class=\"Sdt-text-normal\">\n          <th>水産品</th>\n          <th>ホタテ</th>\n          <th>その他禁輸対象品</th>\n        </tr>\n        <tr class=\"Sdt-text-normal\">\n          <td>総取扱量 <span class=\"num sea-qty\">${DataList.totalNumG}</span> kg</td>\n          <td>総取扱量 <span class=\"num scallops-qty\">${DataList.totalNumH}</span> kg</td>\n          <td>総取扱量 <span class=\"num embargo-qty\">${DataList.totalNumI}</span> kg</td>\n        </tr>\n        <tr class=\"Sdt-text-normal Sdt-sales-row\">\n          <td>総売上 <span class=\"num sea-sales\">${DataList.totalNumJ}</span> 円</td>\n          <td>総売上 <span class=\"num scallops-sales\">${DataList.totalNumK}</span> 円</td>\n          <td>総売上 <span class=\"num embargo-sales\">${DataList.totalNumL}</span> 円</td>\n        </tr>\n        <tr class=\"Sdt-text-normal\">\n          <th>その他</th>\n          <th>メニュー/品物</th>\n        </tr>\n        <tr class=\"Sdt-text-normal\">\n          <td>総取扱量 <span class=\"num other-qty\">${DataList.totalNumM}</span> kg</td>\n          <td>食数/点数（合計） <span class=\"num menu-qty\">${DataList.totalNumN}</span> 食/点</td>\n        </tr>\n        <tr class=\"Sdt-text-normal Sdt-sales-row\">\n          <td>総売上 <span class=\"num other-sales\">${DataList.totalNumO}</span> 円</td>\n          <td>売上（合計） <span class=\"num menu-sales\">${DataList.totalNumP}</span> 円</td>\n        </tr>\n        <tr class=\"Sdt-text-normal\">\n          <th>合計</th>\n        </tr>\n        <tr class=\"Sdt-text-normal\">\n          <td>総取扱量 <span class=\"num all-qty\">${DataList.totalNumQ}</span> kg</td>\n        </tr>\n        <tr class=\"Sdt-text-normal Sdt-sales-row\">\n          <td>総売上 <span class=\"num all-sales\">${DataList.totalNumR}</span> 円</td>\n        </tr>\n      </table>\n    </div>\n  `;\n\n  // ▼ ここがポイント\n  $('#Results_Source253630Field').after(html);\n}\n\n// =====================================\n// レコード取得\n// =====================================\n\nfunction getStoreRecors() {\n  let DataList = [];\n\n    $('#Results_Source253630 tbody tr.grid-row').each(function () {\n        const $tds = $(this).find('td');\n        DataList.push({\n\n            NumA: $tds.eq(2).text().trim(), \n            NumD: $tds.eq(3).text().trim(), \n            NumC: $tds.eq(4).text().trim(), \n            NumE: $tds.eq(5).text().trim(), \n            NumB: $tds.eq(6).text().trim(), \n            NumF: $tds.eq(7).text().trim(), \n            NumG: $tds.eq(8).text().trim(), \n            NumJ: $tds.eq(9).text().trim(), \n            NumH: $tds.eq(10).text().trim(), \n            NumK: $tds.eq(11).text().trim(), \n            NumI: $tds.eq(12).text().trim(), \n            NumL: $tds.eq(13).text().trim(), \n            NumM: $tds.eq(14).text().trim(), \n            NumO: $tds.eq(15).text().trim(), \n            NumN: $tds.eq(16).text().trim(), \n            NumP: $tds.eq(17).text().trim(), \n            NumQ: $tds.eq(18).text().trim(), \n            NumR: $tds.eq(19).text().trim()\n        });\n\n    });\n\n  DataList = calculateTotal(DataList);\n  return DataList;\n}\n\n// =====================================\n// 共通：数値文字列 → 数値変換\n// 例：\"20kg\" / \"10円\" → 20\n// =====================================\nfunction parseNumber(value) {\n  if (!value) return 0;\n\n  const num = parseFloat(\n    value.replace(/[^0-9.-]/g, '')\n  );\n\n  return isNaN(num) ? 0 : num;\n}\n\n// =====================================\n// 共通：NumA / NumD 合計計算\n// =====================================\nfunction calculateTotal(rowDataList) {\n  let totalNumA = 0;\n  let totalNumD = 0;\n  let totalNumC = 0;\n  let totalNumE = 0;\n  let totalNumB = 0;\n  let totalNumF = 0;\n  let totalNumG = 0;\n  let totalNumJ = 0;\n  let totalNumH = 0;\n  let totalNumK = 0;\n  let totalNumI = 0;\n  let totalNumL = 0;\n  let totalNumM = 0;\n  let totalNumO = 0;\n  let totalNumN = 0;\n  let totalNumP = 0;\n  let totalNumQ = 0;\n  let totalNumR = 0;\n\n\n\n  rowDataList.forEach(function (row) {\n    totalNumA += parseNumber(row.NumA);\n    totalNumD += parseNumber(row.NumD);\n    totalNumC += parseNumber(row.NumC);\n    totalNumE += parseNumber(row.NumE);\n    totalNumB += parseNumber(row.NumB);\n    totalNumF += parseNumber(row.NumF);\n    totalNumG += parseNumber(row.NumG);\n    totalNumJ += parseNumber(row.NumJ);\n    totalNumH += parseNumber(row.NumH);\n    totalNumK += parseNumber(row.NumK);\n    totalNumI += parseNumber(row.NumI);\n    totalNumL += parseNumber(row.NumL);\n    totalNumM += parseNumber(row.NumM);\n    totalNumO += parseNumber(row.NumO);\n    totalNumN += parseNumber(row.NumN);\n    totalNumP += parseNumber(row.NumP);\n    totalNumQ += parseNumber(row.NumQ);\n    totalNumR += parseNumber(row.NumR);\n  });\n\n  return {\n    totalNumA,\n    totalNumD,\n    totalNumA,\n    totalNumD,\n    totalNumC,\n    totalNumE,\n    totalNumB,\n    totalNumF,\n    totalNumG,\n    totalNumJ,\n    totalNumH,\n    totalNumK,\n    totalNumI,\n    totalNumL,\n    totalNumM,\n    totalNumO,\n    totalNumN,\n    totalNumP,\n    totalNumQ,\n    totalNumR\n  };\n}",
            "Id": 6
          },
          {
            "Title": "【画面制御】開催エリア‐福島県内処理",
            "New": true,
            "Edit": true,
            "Body": "// =====================================\n// 開催エリア：福島県内 → 開催エリア詳細 必須制御\n// =====================================\n\ncheckClassF();\n\nfunction checkClassF() {\n\n  // change は委譲\n  $(document)\n    .off('change', '#Results_ClassF')\n    .on('change', '#Results_ClassF', toggleRequired);\n\n  // DOM再描画監視（更新後対応）\n  observeEditDom();\n\n  // 初期\n  toggleRequired();\n}\n\nfunction toggleRequired() {\n\n  const $area = $('#Results_ClassF');\n  const $desc = $('#Results_DescriptionB');\n  const $label = $('label[for=\"Results_DescriptionB\"]');\n\n  // DOM未生成なら何もしない\n  if ($area.length === 0 || $desc.length === 0) return;\n\n  if ($area.val() === '2') {\n\n    // 必須\n    $desc\n      .attr('data-validate-required', '1')\n      .addClass('required');\n\n    if ($label.find('.required-mark').length === 0) {\n      $label.append('<span class=\"required-mark\"> *</span>');\n    }\n\n  } else {\n\n    $desc\n      .removeAttr('data-validate-required')\n      .removeClass('required');\n\n    $label.find('.required-mark').remove();\n  }\n}\n\nfunction observeEditDom() {\n\n  const observer = new MutationObserver(function () {\n    toggleRequired();\n  });\n\n  observer.observe(document.body, {\n    childList: true,\n    subtree: true\n  });\n}\n",
            "Id": 7
          },
          {
            "Title": "【画面制御】新規作成・詳細　項目表示　共通制御",
            "New": true,
            "Edit": true,
            "Body": "(function () {\n    /**\n     * アプリ共通の名前空間\n     * 他スクリプトはすべてここ経由で after_set に登録する\n     */\n    window.AppTriggers = window.AppTriggers || {};\n\n    /**\n     * after_set に安全に処理を追加するユーティリティ\n     * - 既存処理を壊さない\n     * - 複数スクリプト共存可能\n     */\n    AppTriggers.afterSetHandlers = AppTriggers.afterSetHandlers || [];\n\n    /**\n     * after_set 登録関数\n     */\n    AppTriggers.registerAfterSet = function (fn) {\n        if (typeof fn === 'function') {\n            AppTriggers.afterSetHandlers.push(fn);\n        }\n    };\n\n    /**\n     * Pleasanter after_set を1回だけラップ\n     */\n    if (window.$p && $p.events && !$p.events.__appTriggersWrapped__) {\n        var originalAfterSet = $p.events.after_set;\n\n        $p.events.after_set = function (args) {\n            // 既存 after_set を先に実行\n            if (typeof originalAfterSet === 'function') {\n                try {\n                    originalAfterSet(args);\n                } catch (e) {\n                    console.error('original after_set error', e);\n                }\n            }\n\n            // 登録されたハンドラを順番に実行\n            AppTriggers.afterSetHandlers.forEach(function (handler) {\n                try {\n                    handler(args);\n                } catch (e) {\n                    console.error('after_set handler error', e);\n                }\n            });\n        };\n\n        $p.events.__appTriggersWrapped__ = true;\n    }\n})();",
            "Id": 8
          },
          {
            "Title": "【画面制御】キッチンカーリンクフィールド　表示制御",
            "New": true,
            "Edit": true,
            "Disabled": true,
            "Body": "(function () {\n    /**\n     * キッチンカーリンクフィールド制御\n     * Results_ClassA → Results_Source253143Field\n     */\n\n    /**\n     * トリガー判定\n     * ClassA(イベントカテゴリー)が「3:キッチンカー」または「10:キッチンカー（自主取扱）」の場合\n     * キッチンカーリンクフィールドを表示する\n     */\n    function checkClassATrigger(value) {\n        if (value === '3' || value === '10') {\n            setVisibility(true);\n        } else {\n            setVisibility(false);\n        }\n    }\n\n\n    /**\n     * 表示制御\n     */\n    function setVisibility(isVisible) {\n        var field = document.getElementById('Results_Source253143Field');\n        if (!field) return;\n        field.style.display = isVisible ? 'block' : 'none';\n    }\n\n\n    /**\n     * 初期バインド\n     */\n    function bind() {\n        var select = document.getElementById('Results_ClassA');\n        if (!select || select.__classA_bound__) return;\n\n        select.addEventListener('change', function () {\n            checkClassATrigger(select.value);\n        });\n\n        select.__classA_bound__ = true;\n        checkClassATrigger(select.value);\n    }\n\n    document.addEventListener('DOMContentLoaded', bind);\n\n    if (window.AppTriggers) {\n        AppTriggers.registerAfterSet(function () {\n            setTimeout(bind, 50);\n        });\n    }\n})();\n",
            "Id": 9
          },
          {
            "Title": "【画面制御】メディアリンクフィールド表示制御",
            "New": true,
            "Edit": true,
            "Body": "(function () {\n    /**\n     * メディアリンクフィールド制御\n     * Results_CheckB → Results_Source253139Field\n     */\n\n    /**\n     * トリガー判定\n     * CheckB(メディア掲載有無)がの場合\n     * メディアリンクフィールドを表示する\n     */\n    function checkCheckBTrigger(isChecked) {\n        if (isChecked) {\n            setVisibility(true);\n        } else {\n            setVisibility(false);\n        }\n    }\n\n\n    /**\n     * 表示制御\n     */\n    function setVisibility(isVisible) {\n        var field = document.getElementById('Results_Source253139Field');\n        if (!field) return;\n        field.style.display = isVisible ? 'block' : 'none';\n    }\n\n\n    /**\n     * 初期バインド\n     */\n    function bind() {\n        var checkbox = document.getElementById('Results_CheckB');\n        if (!checkbox || checkbox.__checkB_bound__) return;\n\n        checkbox.addEventListener('change', function () {\n            checkCheckBTrigger(checkbox.checked);\n        });\n\n        checkbox.__CheckB_bound__ = true;\n        checkCheckBTrigger(checkbox.checked);\n    }\n\n    document.addEventListener('DOMContentLoaded', bind);\n\n    if (window.AppTriggers) {\n        AppTriggers.registerAfterSet(function () {\n            setTimeout(bind, 50);\n        });\n    }\n})();\n",
            "Id": 11
          },
          {
            "Title": "【画面制御】更新‐品目を店舗実績に受け渡し",
            "Edit": true,
            "Body": "$(function () {\n\n  $(document).on(\n    'click',\n    '#Results_Source253630 tbody tr.grid-row',\n    function (e) {\n\n      if ($(e.target).closest('button, a').length) return;\n\n      // ===== ① クリックした行の0列目（ID）を取得 =====\n      const itemId = $(this).find('td').eq(0).text().trim();\n\n      if (!itemId) {\n        alert('レコードIDが取得できません');\n        return;\n      }\n\n      // ===== ② 店舗名取得 =====\n      const shopName = $(this).find('td').eq(1).text().trim();\n\n      const data = getShopItemsByShopName(shopName);\n\n      if (data.length === 0) {\n        alert('この店舗にはチェックされた品目がありません');\n        return;\n      }\n\n      // ===== ③ パラメータ生成 =====\n      const param = encodeURIComponent(JSON.stringify(data));\n\n      // ===== ④ URL生成（★要件どおり） =====\n      const url =\n        `/items/${itemId}`\n        + `?back=1`\n        + `&FromTabIndex=0`\n        + `&SelectedShops=${param}`;\n\n      location.href = url;\n    }\n  );\n\n});\n\nfunction getShopItemsByShopName(shopName) {\n\n  const result = [];\n  const $table  = $('#Results_Source253149Field');\n  const headers = $table.find('thead th');\n\n  $table.find('tbody tr.grid-row').each(function () {\n\n    const $row = $(this);\n    const rowShopName = $row.find('td').eq(0).text().trim();\n\n    if (rowShopName !== shopName) return;\n\n    const rowData = {\n      shop: rowShopName,\n      items: []\n    };\n\n    $row.find('td').each(function (index) {\n\n      if (index === 0) return;\n\n      if ($(this).find('.ui-icon-circle-check').length > 0) {\n        const itemName = headers.eq(index).text().trim();\n        rowData.items.push(itemName);\n      }\n\n    });\n\n    if (rowData.items.length > 0) {\n      result.push(rowData);\n    }\n\n  });\n\n  return result;\n}\n",
            "Id": 10
          }
        ],
        "UseIncompleteFilter": false,
        "UseSearchFilter": false,
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    }
  ],
  "Data": [],
  "Permissions": [
    {
      "SiteId": 253123,
      "Permissions": []
    }
  ],
  "PermissionIdList": {
    "DeptIdList": [],
    "GroupIdList": [],
    "UserIdList": []
  }
}