{
  "HeaderInfo": {
    "AssemblyVersion": "1.4.3.1",
    "BaseSiteId": 1841974,
    "Server": "http://192.168.10.54",
    "CreatorName": "Administrator",
    "PackageTime": "2025-03-31T18:03:34.1998771+09:00",
    "Convertors": [
      {
        "SiteId": 1841974,
        "SiteTitle": "マスタ",
        "ReferenceType": "Sites",
        "IncludeData": false,
        "Order": "[1841992,1841989,1480503,1841987,1841990,1841977,1841983,1841985,1841975,1841978,1841981,3064531,1841980,1841991,3064556,2190740,2190749,1841982,1841986,1841988,1841993,1841997,1841984,1841994,3066123,1841976,1841996,3064532]"
      },
      {
        "SiteId": 1480503,
        "SiteTitle": "郵便番号マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841975,
        "SiteTitle": "ヤオコー製品変換マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841976,
        "SiteTitle": "三研実績入力",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841977,
        "SiteTitle": "仕入先マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841978,
        "SiteTitle": "会社マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841980,
        "SiteTitle": "科目マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841981,
        "SiteTitle": "税率マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841982,
        "SiteTitle": "請求金額マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841983,
        "SiteTitle": "配送先マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841984,
        "SiteTitle": "ウエルシア物件内容マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841985,
        "SiteTitle": "売上仕入単価マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841986,
        "SiteTitle": "売掛金額マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841987,
        "SiteTitle": "得意先マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841988,
        "SiteTitle": "支払金額マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841989,
        "SiteTitle": "棚番マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841990,
        "SiteTitle": "納入先マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841991,
        "SiteTitle": "補助科目マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841992,
        "SiteTitle": "製品マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841993,
        "SiteTitle": "買掛金額マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841994,
        "SiteTitle": "工事担当マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 1841996,
        "SiteTitle": "三和サービス実績入力",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 2190740,
        "SiteTitle": "入金区分マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 2190749,
        "SiteTitle": "支払区分マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 3064531,
        "SiteTitle": "担当者マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 3064532,
        "SiteTitle": "物件入力",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 3064556,
        "SiteTitle": "部署マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      },
      {
        "SiteId": 3066123,
        "SiteTitle": "人数按分マスタ",
        "ReferenceType": "Results",
        "IncludeData": false
      }
    ],
    "IncludeSitePermission": false,
    "IncludeRecordPermission": false,
    "IncludeColumnPermission": false,
    "IncludeNotifications": false,
    "IncludeReminders": false
  },
  "Sites": [
    {
      "TenantId": 1,
      "SiteId": 1841974,
      "Title": "マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Sites",
      "ParentId": 1920840,
      "InheritPermission": 1841974,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Sites",
        "Scripts": [
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝閲覧権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n",
            "Id": 6
          },
          {
            "Title": "11_保存時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// 保存押下時に実行するメソッドを格納する\nbeforeCreateFuncs = []\nbeforeUpdateFuncs = []\n\n$p.events.before_send_Create = function (e) {\n    console.log(\"start!! beforeCreateFuncs!!!\")\n    // falseをreturnするまで繰り返す\n    return beforeCreateFuncs.every(func => {\n        console.log(func)\n        return func(e)\n    })\n}\n\n$p.events.before_send_Update = function (e) {\n    console.log(\"start!! beforeUpdateFuncs!!!\")\n    // falseをreturnするまで繰り返す\n    return beforeUpdateFuncs.every(func => {\n        console.log(func)\n        return func(e)\n    })\n}",
            "Id": 7
          }
        ],
        "Htmls": [
          {
            "Title": "アセット読込　開発環境　最初",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/00_共通.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time() ?'></script>",
            "Id": 2
          },
          {
            "Title": "アセット読込　本番環境　最初",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/00_共通.js'></script>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'></script>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>\n",
            "Id": 3
          },
          {
            "Title": "アセット読込　開発環境　最後",
            "PositionType": 9010,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/20_ダイアログテンプレート.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/21_検索ダイアログテンプレート.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/22_ダイアログ共通.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/30_帳票系.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/40_住所検索.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/41_自動入力変換.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/99_CDN配信対象外/10_マスタ/Scripts/三和サービス実績入力ダイアログ.js?ts=<?= time() ?'></script>",
            "Id": 1
          },
          {
            "Title": "アセット読込　本番環境　最後",
            "PositionType": 9010,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/20_ダイアログテンプレート.js'></script>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/21_検索ダイアログテンプレート.js'></script>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/22_ダイアログ共通.js'></script>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/30_帳票系.js'></script>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/40_住所検索.js'></script>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/41_自動入力変換.js'></script>\n<script src='http://192.168.0.7:8000/pleasanter/99_CDN配信対象外/10_マスタ/Scripts/三和サービス実績入力ダイアログ.js'></script>",
            "Id": 4
          }
        ],
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1480503,
      "Title": "郵便番号マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "最新の郵便番号を取得し、定期的なメンテナンスをお願いします。\n\n手順\n① 下記にアクセスしデータをダウンロード　\nhttps://www.post.japanpost.jp/zipcode/dl/utf/zip/utf_ken_all.zip\n② Zipファイルを解凍\n③ 解凍した utf_ken_all.csvをUTF-8で開き、１行目（ヘッダー行）に下記文言を加える\n\"全国地方公共団体コード\",\"旧郵便番号\",\"郵便番号\",\"都道府県名（カナ）\",\"市区町村名（カナ）\",\"町域名（カナ）\",\"都道府県名\",\"市区町村名\",\"町域名\",\"複数番地\",\"小字毎に番地が起番されている町域\",\"丁目を持つ町域\",\"一つの郵便番号で二以上の町域を表す場合\",\"-\",\"-\"\n④ ファイルを保存して閉じる\n④ 左上の全チェックをして、画面下の一括削除をクリック\n④ 本当に削除してもよろしいですか？に対して、はいをクリック\n⑤ 画面下のインポートボタンをクリック\n⑥ CSVファイルを解凍した utf_ken_all.csv を設定\n⑦ 文字コードをUTF-8 を設定\n➉ ダイアログのインポートをクリック",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1480503,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassH",
          "ClassI",
          "ClassA",
          "ClassC",
          "ClassE",
          "ClassG",
          "ClassB",
          "ClassD",
          "ClassF",
          "CheckA",
          "CheckB",
          "CheckC",
          "CheckD"
        ],
        "EditorColumnHash": {
          "General": [
            "Title",
            "ClassA",
            "_Section-1",
            "ClassC",
            "ClassB",
            "ClassE",
            "ClassD",
            "ClassG",
            "ClassF",
            "ClassH",
            "ClassI",
            "CheckA",
            "CheckB",
            "CheckC",
            "CheckD"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "郵便番号",
            "ImportKey": true
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "都道府県名（カナ）"
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "市区町村名（カナ）"
          },
          {
            "ColumnName": "ClassE",
            "LabelText": "市区町村名",
            "NoWrap": true
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "都道府県名"
          },
          {
            "ColumnName": "ClassF",
            "LabelText": "町域名（カナ）"
          },
          {
            "ColumnName": "ClassG",
            "LabelText": "町域名",
            "NoWrap": true
          },
          {
            "ColumnName": "ClassH",
            "LabelText": "全国地方公共団体コード"
          },
          {
            "ColumnName": "ClassI",
            "LabelText": "旧郵便番号"
          },
          {
            "ColumnName": "CheckA",
            "LabelText": "複数番地",
            "NoWrap": true
          },
          {
            "ColumnName": "CheckB",
            "LabelText": "小字毎に番地が起番されている町域"
          },
          {
            "ColumnName": "CheckC",
            "LabelText": "丁目を持つ町域"
          },
          {
            "ColumnName": "CheckD",
            "LabelText": "一つの郵便番号で二以上の町域を表す場合"
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "CalendarTimePeriod": "Monthly",
            "CalendarFromTo": "DateA",
            "CrosstabGroupByX": "CreatedTime",
            "CrosstabGroupByY": "Columns",
            "CrosstabAggregateType": "Total",
            "CrosstabTimePeriod": "Monthly",
            "KambanAggregateType": "Count",
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "ClassA",
        "Scripts": [
          {
            "Title": "共通",
            "All": true,
            "Body": "\n\n/**\n * Null判定する関数です。\n * @param {object} obj オブジェクト\n * @returns {boolean} 判定結果\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonIsNull(obj) {\n    try {\n        if (Array.isArray(obj)) {\n            return obj.filter(v => String(v).trim() !== '').length == 0;\n        } else if (typeof obj === 'object') {\n            return !obj || Object.keys(obj).length === 0 && obj.constructor === Object;\n        } else {\n            return !obj && obj !== 0 || String(obj).trim() == '';\n        }\n    } catch (err) {\n        // 再スロー\n        throw err;\n    }\n}\n\n/**\n * 入力されたラベルに一致する項目の選択した値を返却する。\n * @param {String} label ラベル\n * @param {Number} valueFlg 0: 値 1: 表示\n * @returns {*} 選択された値または表示テキスト\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonGetValue(label, valueFlg = 0) {\n    try {\n        const control = $p.getControl($p.getColumnName(label));\n        const tagName = control.prop(\"tagName\");\n\n        let value;\n\n        switch (tagName) {\n            case \"SELECT\":\n                value = commonHandleSelect(control, valueFlg);\n                break;\n            case \"INPUT\":\n                value = commonHandleInput(control, label, valueFlg);\n                break;\n            case \"TEXTAREA\":\n                value = document.getElementById(commonGetId(label) + \".viewer\").innerText;\n                break;\n            default:\n                value = commonHandleDefault(control, valueFlg);\n        }\n\n        return commonParseIfJson(value);\n    } catch (err) {\n        // 再スロー\n        throw err;\n    }\n}\n\n/**\n * 入力されたラベルのIDを返却する。\n * @param {String} label ラベル\n * @param {Boolean} [prefix=true] プレフィックス（テーブル名）を付けるかどうか\n * @param {Boolean} [suffix=false] サフィックス（'Field'）を付けるかどうか\n * @returns {String} 生成されたID\n * @throws {Error} ラベルが不正な場合やその他のエラー\n */\nfunction commonGetId(label, prefix = true, suffix = false) {\n    try {\n        let id = $p.getColumnName(label);\n        if (commonIsNull(id)) {\n            throw new Error(`共通関数commonGetId：ラベル不正。${label}`);\n        }\n        id = prefix ? `${$p.tableName()}_${id}` : id;\n        id = suffix ? `${id}Field` : id;\n        return id;\n    } catch (err) {\n        // 再スロー\n        throw err;\n    }\n}\n\n/**\n * SELECT要素の値を処理する。\n * @param {jQuery} control jQuery対象のSELECT要素\n * @param {Number} valueFlg 0: 値 1: 表示\n * @returns {*} 選択された値または表示テキスト\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonHandleSelect(control, valueFlg) {\n    try {\n        if (control.attr(\"multiple\")) {\n            return valueFlg === 0 ? control.val() : control.next().children().last().text();\n        }\n        const selectedOption = control.children(':selected');\n        return valueFlg === 0 ? selectedOption.val() : selectedOption.text();\n    } catch (err) {\n        // 再スロー\n        throw err;\n    }\n}\n\n/**\n * INPUT要素の値を処理する。\n * @param {jQuery} control jQuery対象のINPUT要素\n * @param {String} label ラベル\n * @param {Number} valueFlg 0: 値 1: 表示\n * @returns {*} 入力された値または表示テキスト\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonHandleInput(control, label, valueFlg) {\n    try {\n        const inputId = commonGetId(label);\n        if (inputId.indexOf(\"Check\") > 0) {\n            const checked = document.getElementById(inputId).checked;\n            return valueFlg === 0 ? +checked : checked;\n        }\n        let value = valueFlg === 0 ? control.attr('data-value') : control[0].innerHTML;\n        return commonIsNull(value) ? control.val() : value;\n    } catch (err) {\n        // 再スロー\n        throw err;\n    }\n}\n\n/**\n * デフォルトの要素処理を行う。\n * @param {jQuery} control jQuery対象の要素\n * @param {Number} valueFlg 0: 値 1: 表示\n * @returns {*} 要素の値または表示テキスト\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonHandleDefault(control, valueFlg) {\n    try {\n        let value = valueFlg === 0 ? (control.attr('data-value') ?? control[0].innerHTML) : control[0].innerHTML;\n        return commonIsNull(value) ? control.val() : value;\n    } catch (err) {\n        // 再スロー\n        throw err;\n    }\n}\n\n/**\n * 値がJSON文字列の場合はパースし、そうでない場合は元の値を返す。\n * @param {*} value パース対象の値\n * @returns {*} パースされた値または元の値\n * @throws {Error} JSON.parse()で発生したエラー（ただし、通常は捕捉されて元の値が返される）\n */\nfunction commonParseIfJson(value) {\n    if (typeof value !== 'string') return value;\n    try {\n        return JSON.parse(value);\n    } catch (err) {\n        return value;\n    }\n}\n\n/**\n * 指定された文言と完全に一致する最初のリンクを検索し、href属性を'#'に変更して、クリック時にカスタム関数を実行する関数\n * @param {string} searchText - リンクを検索するための文言（完全一致）\n * @param {function} customClickHandler - クリック時に実行されるカスタム関数\n * @returns {boolean} - リンクが見つかって修正されたかどうか\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonModifyLink(searchText, customClickHandler) {\n    try {\n        const link = Array.from(document.getElementsByTagName('a')).find(a =>\n            a.textContent.trim() === searchText.trim()\n        );\n\n        if (link) {\n            const dataValue = link.closest('[data-value]')?.getAttribute('data-value');\n            link.setAttribute('href', '#');\n            link.onclick = function(event) {\n                event.preventDefault();\n                customClickHandler(dataValue, link.textContent);\n                return false;\n            };\n            return true;\n        } else {\n            console.warn(`\"${searchText}\" と完全に一致するリンクが見つかりませんでした。`);\n            return false;\n        }\n    } catch (err) {\n        // 再スロー\n        throw err;\n    }\n}\n\n/**\n * コマンドエリアにボタンを追加する関数です。\n * @param {String} buttonId     ボタンID\n * @param {Function} clickFunc  click時関数\n * @param {String} label        ラベル\n * @param {String} title        タイトル\n * @param {String} style        スタイル\n * @param {String} icon         アイコン（empty指定でアイコンなし）\n * @param {String} appendId     appendする要素ID\n * @param {Array} applys        適用するステータス\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonAddButton(buttonId, clickFunc, label, title, style, icon = \"ui-icon-disk\", appendId = \"MainCommands\", applys = \"all\") {\n    try {\n        if (!commonCheckStatus(applys)) return;\n\n        const target = document.getElementById(appendId);\n        const elem = document.createElement('button');\n        elem.id = buttonId;\n        elem.className = 'button button-icon ui-button ui-corner-all ui-widget applied';\n        elem.onclick = clickFunc;\n        if (!commonIsNull(title)) elem.title = title;\n        if (!commonIsNull(style)) elem.style = style;\n        elem.innerText = label;\n        if (icon !== \"empty\") {\n            const span = document.createElement('span');\n            span.className = `ui-button-icon ui-icon ${icon}`;\n            elem.appendChild(span);\n        }\n        const space = document.createElement('span');\n        space.className = \"ui-button-icon-space\";\n        elem.appendChild(space);\n\n        target.appendChild(elem);\n    } catch (err) {\n        // 再スロー\n        throw err;\n    }\n}\n\n/**\n * ステータスをチェックする関数です。\n * @param {Array|string} applys 適用するステータス\n * @returns {boolean} チェック結果\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonCheckStatus(applys = \"all\") {\n    try {\n        let allFlg = false;\n        if (!Array.isArray(applys)) {\n            if (applys === \"all\") {\n                allFlg = true;\n            } else {\n                applys = [applys];\n            }\n        }\n        return allFlg || applys.map(v => +v).includes(+commonGetValue(\"Status\", true));\n    } catch (err) {\n        // 再スロー\n        throw err;\n    }\n}\n",
            "Id": 2
          },
          {
            "Title": "ロード時処理",
            "All": true,
            "Body": "\n// 各画面ロード時に実行するメソッドを格納する\n$p.events.on_grid_load_arr = []\n$p.events.on_editor_load_arr = []\n\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = function () {\n    console.log(\"start!! on_grid_load_arr!!!\")\n    $p.events.on_grid_load_arr.forEach(func => {\n        console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = function () {\n    console.log(\"start!! on_editor_load_arr!!!\")\n    $p.events.on_editor_load_arr.forEach(func => {\n        console.log(func)\n        func()\n    })\n}\n\n\n// 共通gridロード処理\n$p.events.on_grid_load_arr.push(function () {\n    try {\n        // サイトタイトル編集\n        document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n\n    } catch (err) {\n        console.log(err)\n    }\n})\n\n// 共通editorロード処理\n$p.events.on_editor_load_arr.push(function () {\n    try {\n        // サイトタイトル編集\n        document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n\n    } catch (err) {\n        console.log(err)\n    }\n})\n",
            "Id": 1
          },
          {
            "Title": "API",
            "All": true,
            "Body": "let API_VERSION = \"1.0\"\n\n/**\n * 取得APIを呼び出す関数です。\n *\n * @param {Number}    id テーブルID\n * @param {Array}     columns 取得列\n * @param {Object}    filterHash フィルター条件\n * @param {Object}    sorterHash ソート条件\n * @param {Object}    filterSearchTypes 検索条件\n * @param {Boolean}   valueFlg true : value値 false : display値\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonGetData(id = $p.siteId(), columns = [\"ClassA\", \"NumA\"], filterHash = {}, sorterHash = { \"ResultId\": \"asc\" }, filterSearchTypes = {}, valueFlg = true, addFunc) {\n    if (!Array.isArray(columns)) {\n        columns = [columns]\n    }\n    let offset = 0\n    let data = []\n    let temp = {}\n    do {\n        temp = await commonGetInnner(id, columns, filterHash, sorterHash, filterSearchTypes, valueFlg, offset, addFunc)\n        data = [...data, ...temp.Response.Data]\n        offset += temp.Response.PageSize\n    } while (offset < temp.Response.TotalCount)\n    return data\n\n    /**\n     * 取得APIを呼び出す関数内関数です。(TotalCount 200)\n     *\n     * @param {Number}    id テーブルID\n     * @param {Array}     columns 取得列\n     * @param {Object}    filterHash フィルター条件\n     * @param {Object}    sorterHash ソート条件\n     * @param {Object}    filterSearchTypes 検索条件\n     * @param {Boolean}   valueFlg true : value値 false : display値\n     * @param {Number}    offset オフセット条件\n     * @param {Function}  addFunc 最後に実行したい関数\n     */\n    async function commonGetInnner(id, columns, filterHash, sorterHash, filterSearchTypes, valueFlg, offset, addFunc) {\n        return await $p.apiGet({\n            'id': id,\n            'data': {\n                'Offset': offset,\n                'View': {\n                    'ApiDataType': \"KeyValues\",\n                    'ApiColumnValueDisplayType': valueFlg ? \"Value\" : \"DisplayValue\",\n                    'GridColumns': columns,\n                    \"ColumnFilterHash\": filterHash,\n                    \"ColumnSorterHash\": sorterHash,\n                    \"ColumnFilterSearchTypes\": filterSearchTypes,\n                }\n            },\n            'done': function (data) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n                return data.Response.Data\n            }\n        })\n    }\n}\n\n/**\n * エクスポートAPIを呼び出す関数です。\n *\n * @param {String}    tableId 取得テーブルID\n * @param {Array}     columns 取得列\n * @param {Object}    filterHash フィルター条件\n * @param {Object}    sorterHash ソート条件\n * @param {Object}    filterSearchTypes 検索条件\n * @param {Boolean}   jsonFlg trueならjson　falseならcsvで取得\n * @param {Boolean}   headerFlg trueならheaderも取得\n * @param {Boolean}   overFlg trueなら超過分のみ取得\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonExportData(tableId = $p.siteId(), columns = [\"ClassA\", \"NumA\"], filterHash = {}, sorterHash = {\"ResultId\": \"asc\"}, filterSearchTypes = {}, jsonFlg = true, headerFlg = true, overFlg = false, addFunc) {\n    if (!Array.isArray(columns)) {\n        columns = [columns]\n    }\n        columns.unshift(\"ResultId\")\n    let data = await commonExportInner(tableId, columns, filterHash, sorterHash, filterSearchTypes, jsonFlg, headerFlg, overFlg, addFunc)\n    if (jsonFlg) {\n        // json整形\n        data = JSON.parse(data.Response.Content)\n    } else {\n        // csv整形\n        data = commonConvertCsvTo2D(data.Response.Content)\n    }\n\n    return data\n    /**\n     * エクスポートAPIを呼び出す関数内関数です。\n     *\n     * @param {String}    tableId 取得テーブルID\n     * @param {Array}     columns 取得列\n     * @param {Object}    filterHash フィルター条件\n     * @param {Object}    sorterHash ソート条件\n     * @param {Object}    filterSearchTypes 検索条件\n     * @param {Boolean}   jsonFlg trueならjson　falseならcsvで取得\n     * @param {Boolean}   headerFlg trueならheaderも取得\n     * @param {Boolean}   overFlg trueなら超過分のみ取得\n     * @param {Function}  addFunc 最後に実行したい関数\n     */\n    async function commonExportInner(tableId, columns, filterHash, sorterHash, filterSearchTypes, jsonFlg, headerFlg, overFlg, addFunc) {\n\n        let col = []\n        columns.forEach(v => col.push({ \"ColumnName\": v }))\n        let data = JSON.stringify({\n            \"ApiVersion\": API_VERSION ,\n            \"Export\": {\n                \"Columns\": col,\n                \"Header\": headerFlg,\n                \"Type\": jsonFlg ? \"json\" : \"csv\"\n            },\n            \"View\": {\n                \"Overdue\": overFlg,\n                \"ColumnFilterHash\": filterHash,\n                \"ColumnSorterHash\": sorterHash,\n                \"ColumnFilterSearchTypes\": filterSearchTypes,\n            }\n        })\n\n        return new Promise((resolve, reject) => {\n            $.ajax({\n                type: \"POST\",\n                url: `/api/items/${tableId}/export`,\n                contentType: 'application/json',\n                data: data\n            }).then(\n                function (result) {\n                    if (addFunc && typeof addFunc === 'function') {\n                        // 渡されたオブジェクトが関数なら実行する\n                        addFunc(data)\n                    }\n                    // 正常終了\n                    resolve(result)\n                },\n                function () {\n                    // エラー\n                    reject()\n                }\n            )\n        })\n    }\n}\n\n/**\n * 登録APIを呼び出す関数です。\n *\n * @param {String}    tableId 登録テーブルID\n * @param {Object}    Hash 更新項目\n * @param {String}    Status 登録ステータス\n * @param {String}    Comments 登録コメント\n * @param {Boolean}   pushFlg updated_idsに（default）pushする\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonCreate(tableId, Hash = {}, Status, Comments, pushFlg = true, addFunc) {\n\n    // 登録項目\n    let ClassHash = {}\n    let NumHash = {}\n    let DateHash = {}\n    let DescriptionHash = {}\n    let CheckHash = {}\n    for (let key in Hash) {\n        if (key.includes(\"Class\")) ClassHash[key] = Hash[key]\n        else if (key.includes(\"Num\")) NumHash[key] = commonConvertCTo1(Hash[key])\n        else if (key.includes(\"Date\")) DateHash[key] = commonIsNull(Hash[key]) ? commonGetDateEmpty() : Hash[key]\n        else if (key.includes(\"Description\")) DescriptionHash[key] = Hash[key]\n        else if (key.includes(\"Check\")) CheckHash[key] = Hash[key]\n    }\n\n    let data = JSON.stringify({\n        \"ApiVersion\": API_VERSION ,\n        Status,\n        Comments,\n        ClassHash,\n        NumHash,\n        DateHash,\n        DescriptionHash,\n        CheckHash\n    })\n    if (!commonIsNull(Status)) {\n        delete data[\"Status\"]\n    }\n    if (!commonIsNull(Comments)) {\n        delete data[\"Comments\"]\n    }\n\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            type: \"POST\",\n            url: `/api/items/${tableId}/create`,\n            contentType: 'application/json',\n            data: data\n        }).then(\n            function (result) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n                if (pushFlg) {\n                    created_ids.push(result.Id)\n                    created_ids = [...new Set(created_ids.map(v => String(v)))]\n                }\n                // 正常終了\n                resolve(result)\n            },\n            function () {\n                // エラー\n                reject()\n            }\n        )\n    })\n}\n\n/**\n * 更新APIを呼び出す関数です。\n *\n * @param {String}    recordId 更新レコードID\n * @param {Object}    Hash 更新項目\n * @param {String}    Status 更新ステータス\n * @param {String}    Comments 更新コメント\n * @param {Boolean}   pushFlg created_idsに（default）pushする\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonUpdate(recordId, Hash = {}, Status, Comments, pushFlg = true, addFunc) {\n\n    // 更新項目\n    let ClassHash = {}\n    let NumHash = {}\n    let DateHash = {}\n    let DescriptionHash = {}\n    let CheckHash = {}\n    for (let key in Hash) {\n        if (key.includes(\"Class\")) ClassHash[key] = Hash[key]\n        else if (key.includes(\"Num\")) NumHash[key] = commonConvertCTo1(Hash[key])\n        else if (key.includes(\"Date\")) DateHash[key] = commonIsNull(Hash[key]) ? commonGetDateEmpty() : Hash[key]\n        else if (key.includes(\"Description\")) DescriptionHash[key] = Hash[key]\n        else if (key.includes(\"Check\")) CheckHash[key] = Hash[key]\n    }\n    let data = JSON.stringify({\n        \"ApiVersion\": API_VERSION ,\n        Status,\n        Comments,\n        ClassHash,\n        NumHash,\n        DateHash,\n        DescriptionHash,\n        CheckHash\n    })\n    if (!commonIsNull(Status)) {\n        delete data[\"Status\"]\n    }\n    if (!commonIsNull(Comments)) {\n        delete data[\"Comments\"]\n    }\n\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            type: \"POST\",\n            url: `/api/items/${recordId}/update`,\n            contentType: 'application/json',\n            data: data\n        }).then(\n            function (result) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n                if (pushFlg) {\n                    updated_ids.push(result.Id)\n                    updated_ids = [...new Set(updated_ids.map(v => String(v)))]\n                }\n\n                // 正常終了\n                resolve(result)\n            },\n            function () {\n                // エラー\n                reject()\n            }\n        )\n    })\n}\n\n/**\n * ユーザー取得APIを呼び出す関数です。\n *\n * @param {Array}     userIds 取得UserId\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonExportUser(userIds, addFunc) {\n    let users = []\n    if (Array.isArray(userIds)) {\n        users = userIds\n    } else {\n        users = [userIds]\n    }\n    let data = JSON.stringify({\n        \"ApiVersion\": API_VERSION ,\n        \"View\": {\n            \"ColumnFilterHash\": {\n                \"UserId\": JSON.stringify(users)\n            }\n        }\n    })\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            type: \"POST\",\n            url: \"/api/users/get\",\n            contentType: 'application/json',\n            data: data\n        }).then(\n            function (result) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n                // 正常終了\n                resolve(result)\n            },\n            function () {\n                // エラー\n                reject()\n            }\n        )\n    })\n}\n\n/**\n * グループ取得APIを呼び出す関数です。\n *\n * @param {Array}     groupIds 取得GroupId\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonExportGroup(groupIds, addFunc) {\n    let groups = []\n    if (Array.isArray(groupIds)) {\n        groups = groupIds\n    } else {\n        groups = [groupIds]\n    }\n    let data = JSON.stringify({\n        \"ApiVersion\": API_VERSION ,\n        \"View\": {\n            \"ColumnFilterHash\": {\n                \"GroupId\": JSON.stringify(groups)\n            }\n        }\n    })\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            type: \"POST\",\n            url: \"/api/groups/get\",\n            contentType: 'application/json',\n            data: data\n        }).then(\n            function (result) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n                // 正常終了\n                resolve(result)\n            },\n            function () {\n                // エラー\n                reject()\n            }\n        )\n    })\n}\n\n/**\n * レコード複製を行う関数です。（編集画面で使用を想定）\n *\n * @param {Object}    editItems 変更項目\n * @param {String}    Status 登録ステータス\n * @param {String}    Comments 登録コメント\n * @param {Number}    expand 最大拡張項目数\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonCopyRecord(editItems = {}, Status, Comments, expand = 0, addFunc) {\n\n    try {\n        if ($p.action() !== \"edit\") {\n            let message = STATUS_ERROR_MESSAGE_EDIT\n            commonMessage(message, STATUS_ERROR)\n            throw new Error(message)\n        }\n\n        let Hash = {}\n\n        //項目Aから項目Z\n        let alphabet = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n        for (let char of alphabet) {\n            let clsKey = \"Class\" + char\n            let numKey = \"Num\" + char\n            let datKey = \"Date\" + char\n            let dscKey = \"Description\" + char\n            let chkKey = \"Check\" + char\n            Hash[clsKey] = commonIsNull(commonGetVal(clsKey)) ? \"\" : (Array.isArray(commonGetVal(clsKey, true)) ? convertArrayToMalti(commonGetVal(clsKey, true)) : commonGetVal(clsKey, true))\n            Hash[numKey] = commonIsNull(commonGetVal(numKey)) ? 0 : commonConvertCTo1(commonGetVal(numKey))\n            Hash[datKey] = commonIsNull(commonGetVal(datKey)) ? commonGetDateEmpty() : commonGetVal(datKey)\n            Hash[dscKey] = commonIsNull(commonGetVal(dscKey)) ? \"\" : commonGetVal(dscKey)\n            Hash[chkKey] = commonIsNull(commonGetVal(chkKey)) ? false : commonGetVal(chkKey)\n        }\n\n        //項目001から項目999\n        for (let i = 1; i <= expand; i++) {\n            let clsKey = \"Class\" + String(i).padStart(3, \"0\")\n            let numKey = \"Num\" + String(i).padStart(3, \"0\")\n            let datKey = \"Date\" + String(i).padStart(3, \"0\")\n            let dscKey = \"Description\" + String(i).padStart(3, \"0\")\n            let chkKey = \"Check\" + String(i).padStart(3, \"0\")\n            Hash[clsKey] = commonIsNull(commonGetVal(clsKey)) ? \"\" : (Array.isArray(commonGetVal(clsKey, true)) ? convertArrayToMalti(commonGetVal(clsKey, true)) : commonGetVal(clsKey, true))\n            Hash[numKey] = commonIsNull(commonGetVal(numKey)) ? 0 : commonConvertCTo1(commonGetVal(numKey))\n            Hash[datKey] = commonIsNull(commonGetVal(datKey)) ? commonGetDateEmpty() : commonGetVal(datKey)\n            Hash[dscKey] = commonIsNull(commonGetVal(dscKey)) ? \"\" : commonGetVal(dscKey)\n            Hash[chkKey] = commonIsNull(commonGetVal(chkKey)) ? false : commonGetVal(chkKey)\n        }\n\n        // 変更項目を上書き\n        for (let key in editItems) {\n            Hash[key] = editItems[key]\n        }\n\n        // ステータスを取得\n        if (commonIsNull(Status)) {\n            Status = commonGetVal(\"Status\", true)\n        }\n\n        return commonCreate(\n            $p.siteId()\n            , Hash\n            , Status\n            , Comments\n            , addFunc\n        )\n    } catch (err) {\n        // 再スロー\n        throw err\n    }\n}\n\n/**\n * レコード保存を行う関数です。（編集画面で使用を想定）\n *\n * @param {Object}    editItems 変更項目\n * @param {String}    Status 更新ステータス\n * @param {String}    Comments 更新コメント\n * @param {Boolean}   reload リロードするかどうか\n * @param {Number}    expand 最大拡張項目数\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonSaveRecord(editItems = {}, Status, Comments, reload = false, expand = 0, addFunc) {\n\n    try {\n        if ($p.action() !== \"edit\") {\n            let message = STATUS_ERROR_MESSAGE_EDIT\n            commonMessage(message, STATUS_ERROR)\n            throw new Error(message)\n        }\n\n        let Hash = {}\n\n        //項目Aから項目Z\n        let alphabet = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n        for (let char of alphabet) {\n            let clsKey = \"Class\" + char\n            let numKey = \"Num\" + char\n            let datKey = \"Date\" + char\n            let dscKey = \"Description\" + char\n            let chkKey = \"Check\" + char\n            Hash[clsKey] = commonIsNull(commonGetVal(clsKey)) ? \"\" : (Array.isArray(commonGetVal(clsKey, true)) ? convertArrayToMalti(commonGetVal(clsKey, true)) : commonGetVal(clsKey, true))\n            Hash[numKey] = commonIsNull(commonGetVal(numKey)) ? 0 : commonConvertCTo1(commonGetVal(numKey))\n            Hash[datKey] = commonIsNull(commonGetVal(datKey)) ? commonGetDateEmpty() : commonGetVal(datKey)\n            Hash[dscKey] = commonIsNull(commonGetVal(dscKey)) ? \"\" : commonGetVal(dscKey)\n            Hash[chkKey] = commonIsNull(commonGetVal(chkKey)) ? false : commonGetVal(chkKey)\n        }\n\n        //項目001から項目999\n        for (let i = 1; i <= expand; i++) {\n            let clsKey = \"Class\" + String(i).padStart(3, \"0\")\n            let numKey = \"Num\" + String(i).padStart(3, \"0\")\n            let datKey = \"Date\" + String(i).padStart(3, \"0\")\n            let dscKey = \"Description\" + String(i).padStart(3, \"0\")\n            let chkKey = \"Check\" + String(i).padStart(3, \"0\")\n            Hash[clsKey] = commonIsNull(commonGetVal(clsKey)) ? \"\" : (Array.isArray(commonGetVal(clsKey, true)) ? convertArrayToMalti(commonGetVal(clsKey, true)) : commonGetVal(clsKey, true))\n            Hash[numKey] = commonIsNull(commonGetVal(numKey)) ? 0 : commonConvertCTo1(commonGetVal(numKey))\n            Hash[datKey] = commonIsNull(commonGetVal(datKey)) ? commonGetDateEmpty() : commonGetVal(datKey)\n            Hash[dscKey] = commonIsNull(commonGetVal(dscKey)) ? \"\" : commonGetVal(dscKey)\n            Hash[chkKey] = commonIsNull(commonGetVal(chkKey)) ? false : commonGetVal(chkKey)\n        }\n\n        // 変更項目を上書き\n        for (let key in editItems) {\n            Hash[key] = editItems[key]\n        }\n\n        // ステータスを取得\n        if (commonIsNull(Status)) {\n            Status = commonGetVal(\"Status\", true)\n        }\n\n        let u = await commonUpdate(\n            $p.id()\n            , Hash\n            , Status\n            , Comments\n            , addFunc\n        )\n        if (reload) {\n            $(window).off('beforeunload');\n            location.reload()\n        }\n        return u\n    } catch (err) {\n        // 再スロー\n        throw err\n    }\n\n}\n/**\n * 添付項目にExcelを添付し更新する共通関数です。\n *\n * @param {string} targetID 更新対象のアイテムID\n * @param {string} className 添付ファイルのクラス名\n * @param {Object} excel Excelワークブックオブジェクト\n * @param {string} filename 添付ファイルの名前\n */\nasync function commonUpdateExcel(targetID, className, workbook, filename) {\n    const fileBuffer = await workbook.xlsx.writeBuffer()\n    const base64 = commonGetBufferToBase64(fileBuffer)\n\n    let url = `/api/items/${targetID}/update`\n    let method_name = \"POST\"\n    let data = {\n        \"ApiVersion\": API_VERSION ,\n        \"AttachmentsHash\": {\n            [className]: [\n                {\n                    \"ContentType\": \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\n                    \"Name\": filename,\n                    \"Base64\": base64\n                }\n            ]\n        }\n    }\n    await $.ajax({\n        type: method_name,\n        url: url,\n        data: JSON.stringify(data),\n        contentType: 'application/json',\n        dataType: 'json',\n        scriptCharset: 'utf-8',\n        success: function (data) {\n            // Success\n            console.log(\"success\")\n            console.log(JSON.stringify(data))\n        },\n        error: function (data) {\n            // Error\n            console.log(\"error\")\n            console.log(JSON.stringify(data))\n        }\n    })\n}\n\nfunction commonGetBufferToBase64(buffer) {\n    let binary\n    let bytes = new Uint8Array(buffer)\n    for (let i = 0; i < bytes.byteLength; i++) {\n        binary += String.fromCharCode(bytes[i])\n    }\n    return window.btoa(binary)\n}\n",
            "Id": 3
          }
        ],
        "ServerScripts": [
          {
            "Title": "同期",
            "Name": "同期",
            "BeforeCreate": true,
            "BeforeUpdate": true,
            "BeforeDelete": true,
            "Body": "\nlet filteredModel = {};\n\n// model から必要なフィールドだけを抽出する\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        filteredModel[key] = model[key];\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {\n    \"pleasanter_table_name\": context.SiteTitle,\n    \"record_data\": filteredModel\n};\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/\" + context.Action;\n\n// POST メソッドでリクエストを送信する\nlet response = httpClient.Post();\n\n// レスポンスの結果をチェックする\nif (!httpClient.IsSuccess) {\n    // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n    context.Log(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response);\n    throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n\n}\n\n// 成功時、レスポンス内容をログに出力する\ncontext.Log(\"成功: \" + response);\n",
            "Id": 1
          }
        ],
        "HideLink": true,
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841975,
      "Title": "ヤオコー製品変換マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841975,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB",
          "ClassI",
          "ClassD",
          "ClassE",
          "NumA",
          "NumB",
          "NumC",
          "NumD",
          "NumE",
          "NumF",
          "NumG",
          "ClassG",
          "ClassH"
        ],
        "FilterColumns": [
          "ClassA",
          "ClassB",
          "ClassI",
          "ClassD",
          "ClassE",
          "ClassF",
          "ClassG",
          "ClassH"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "ClassB",
            "ClassI",
            "ClassD",
            "ClassG",
            "_Section-1",
            "NumA",
            "NumB",
            "NumC",
            "NumD",
            "NumE",
            "NumF",
            "NumG",
            "ClassE",
            "ClassH",
            "Title",
            "Class100"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "得意先CD",
            "ChoicesText": "[\n    {\n        \"SiteId\": 1841987,\n        \"SearchFormat\": \"[ClassA] __ [ClassB] __ [ClassC]\",\n        \"Value\": \"[ClassA]\",\n        \"NoAddButton\" : true,\n        \"Lookups\": [\n              {\n                \"From\": \"ClassB\",\n                \"To\": \"ClassB\"\n              },\n         ]\n    }\n]",
            "UseSearch": true,
            "DefaultInput": "1853607",
            "ValidateRequired": true,
            "ClientRegexValidation": "^[a-zA-Z0-9]*$",
            "RegexValidationMessage": "英数字のみ入力可能です。",
            "CopyByDefault": true,
            "EditorReadOnly": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassB",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "得意先名",
            "DefaultInput": "株式会社ヤオコー",
            "CopyByDefault": true,
            "EditorReadOnly": true,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "仕様NO",
            "ExtendedFieldCss": "sdt_disabled",
            "MaxLength": 7.0,
            "ClientRegexValidation": "^[a-zA-Z0-9ｦ-ﾟ]*$",
            "RegexValidationMessage": "英数字半角カナのみ入力可能です。"
          },
          {
            "ColumnName": "ClassE",
            "LabelText": "名称",
            "NoWrap": true,
            "ExtendedFieldCss": "sdt_disabled",
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassG",
            "LabelText": "部門CD",
            "MaxLength": 4.0,
            "ClientRegexValidation": "^[a-zA-Z0-9ｦ-ﾟ]*$",
            "RegexValidationMessage": "英数字半角カナのみ入力可能です。"
          },
          {
            "ColumnName": "ClassH",
            "LabelText": "他社製品CD",
            "MaxLength": 13.0,
            "ClientRegexValidation": "^[a-zA-Z0-9]*$",
            "RegexValidationMessage": "英数字のみ入力可能です。"
          },
          {
            "ColumnName": "Title",
            "Hide": true
          },
          {
            "ColumnName": "NumA",
            "LabelText": "W",
            "NoWrap": true,
            "ExtendedFieldCss": "sdt_disabled"
          },
          {
            "ColumnName": "NumB",
            "LabelText": "D",
            "NoWrap": true,
            "ExtendedFieldCss": "sdt_disabled"
          },
          {
            "ColumnName": "NumC",
            "LabelText": "H",
            "NoWrap": true,
            "ExtendedFieldCss": "sdt_disabled"
          },
          {
            "ColumnName": "NumD",
            "LabelText": "D1",
            "ExtendedFieldCss": "sdt_disabled"
          },
          {
            "ColumnName": "NumE",
            "LabelText": "D2",
            "ExtendedFieldCss": "sdt_disabled"
          },
          {
            "ColumnName": "NumF",
            "LabelText": "H1",
            "NoWrap": true,
            "ExtendedFieldCss": "sdt_disabled"
          },
          {
            "ColumnName": "NumG",
            "LabelText": "H2",
            "ExtendedFieldCss": "sdt_disabled"
          },
          {
            "ColumnName": "ClassI",
            "LabelText": "製品NO",
            "ExtendedFieldCss": "sdt_disabled",
            "ValidateRequired": true,
            "ExtendedHtmlAfterControl": "<div class=\"ui-icon ui-icon-search \" id=\"productSearch\" tabindex=\"0\"></div>\n<div class=\"ui-icon ui-icon-close textClear\" id=\"productDelete\" onclick=\"initialize()\" tabindex=\"0\"></div>"
          },
          {
            "ColumnName": "Class100",
            "LabelText": "主キー項目",
            "ImportKey": true,
            "Hide": true
          }
        ],
        "Links": [
          {
            "ColumnName": "ClassA",
            "SiteId": 1841987,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB] __ [ClassC]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassB"
              }
            ],
            "JsonFormat": true
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc",
              "ClassB": "asc",
              "ClassI": "asc",
              "ClassD": "asc",
              "ClassG": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "Class100",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          }
        ],
        "Scripts": [
          {
            "Title": "sdt_disabled",
            "New": true,
            "Edit": true,
            "Body": "// =================================================\n// フィールドCSSに'sdt_disabled'クラスが設定されているフィールドを\n// disabledにします。\n// $p.set()は稼働しますが、手動での操作を制限します。\n// -------------------------------------------------\n// 引数：disabledにするかreadonlyにするか\n// =================================================\n\nfunction setDisabled(type){\n  //該当の入力エリアをdisabled / readonlyにする\n  $('.sdt_disabled input').prop(type, true); // 一般的なinput要素\n  $('.sdt_disabled input[type=\"number\"]').prop(type, true); // 数値用のinput要素\n  $('.sdt_disabled textarea').prop(type, true); // textarea要素\n  $('.sdt_disabled select').prop(type, true); // select要素\n\n  // selectはreadonlyが効かないのでoptionをdisabledにする\n  // $('.sdt_disabled option').prop('disabled', true);\n  // $('.sdt_disabled option:selected').prop('disabled', false);\n\n  //コントロールアイコンを削除する\n  $('.sdt_disabled div.field-control div.ui-icon').remove();\n}\n\n\n\nonEditorLoadFuncs.push(\n   function () {\n    setDisabled('disabled');\n  }\n)\n",
            "Id": 3
          },
          {
            "Title": "主キー設定",
            "All": true,
            "Body": "$(document).on('change', '#Results_ClassA, #Results_ClassI, #Results_ClassD, #Results_ClassG', function() {\n    var A = $('#Results_ClassA').val();\n    var I = $('#Results_ClassI').val();\n    var D = $('#Results_ClassD').val();\n    var G = $('#Results_ClassG').val();\n\n   $p.set($('#Results_Class100'), A + '__' + I + '__' + D + '__' + G);\n});",
            "Id": 4
          },
          {
            "Title": "00_共通.js",
            "New": true,
            "Edit": true,
            "Body": "// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝コード値系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\nconst SUCCESS_MESSAGE_CODE = {\n    // 成功メッセージ\n    'SUCCESS_CREATE_FILE': 'ファイルの作成に成功しました',\n    'SUCCESS_UPDATE': '更新に成功しました',\n    'SUCCESS_DELETE': '削除に成功しました',\n    'SUCCESS_UPLOAD': 'アップロードに成功しました',\n    'SUCCESS_DOWNLOAD': 'ダウンロードに成功しました',\n    'SUCCESS_SAVE': '保存に成功しました',\n    'SUCCESS_CHECK': 'チェックが完了しました',\n    'NOT_FOUND': '該当データ無し',\n}\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝判定系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n/**\n * Null判定する関数です。\n * @param {object} obj オブジェクト\n * @returns {boolean} 判定結果\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonIsNull(obj) {\n    if (Array.isArray(obj)) {\n        return obj.filter(v => String(v).trim() !== '').length == 0;\n    } else if (typeof obj === 'object') {\n        return !obj || Object.keys(obj).length === 0 && obj.constructor === Object;\n    } else {\n        return !obj && obj !== 0 || String(obj).trim() == '';\n    }\n}\n\n/**\n * ステータスをチェックする関数です。\n * @param {Array|string} applyStatuses 適用するステータス\n * @returns {boolean} チェック結果\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonCheckStatus(applyStatuses = \"all\") {\n    if ($p.action() !== \"edit\" && $p.action() !== \"new\") {\n        let message = \"編集画面で使用を想定\"\n        alert(message)\n        throw new Error(message)\n    }\n    let allFlg = false;\n    if (!Array.isArray(applyStatuses)) {\n        if (applyStatuses === \"all\") {\n            allFlg = true;\n        } else {\n            applyStatuses = [applyStatuses];\n        }\n    }\n    return allFlg || applyStatuses.map(v => +v).includes(+commonGetValue(\"Status\", false));\n}\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝値取得&値設定系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n/**\n * 日付を出力する関数です。\n *\n * yyyy引数なしで現在日付\n * 月末はddに0を入力\n *\n * @param {Number} yyyy   年(またはDateオブジェクト)\n * @param {Number} mm     月\n * @param {Number} dd     日\n * @param {String} format フォーマット\n *\n * @return {String} フォーマット加工された日付文字列\n *\n * 例1. yyyy = 2022, mm = 4, dd = 18, format = 'YYYY-MM-DD'\n *            ⇓\n *     '2022-04-18'\n * 例2. yyyy = 2021, mm = 13, dd = 10, format = 'YYYY-MM-DD'\n *            ⇓\n *     '2022-01-10'\n * 例3. yyyy = 2021, mm = 11, dd = 0, format = 'YYYY-MM-DD'\n *            ⇓\n *     '2022-10-31'\n * 例4. yyyy = 2020\n *            ⇓\n *     '2020-01-01T00:00:00'\n * 例5. 引数なし\n *            ⇓\n *     現在日付の'YYYY-MM-DD'\n * 例6. yyyy = \"\", mm = \"\", dd = \"\", format = 'YYYYMM'\n *            ⇓\n *     現在日付の'YYYYMM'\n */\nfunction commonGetDate(yyyy, mm = 1, dd = 1, format = 'YYYY-MM-DD') {\n    let date\n    if (typeof yyyy === 'undefined' || commonIsNull(yyyy)) {\n        date = new Date()\n    } else if (typeof yyyy === 'object') {\n        date = yyyy\n    } else {\n        date = new Date(yyyy, mm - 1, dd)\n    }\n    return format\n        .replace(/YYYY/, String(date.getFullYear()).padStart(4, \"0\"))\n        .replace(/MM/, String(date.getMonth() + 1).padStart(2, \"0\"))\n        .replace(/DD/, String(date.getDate()).padStart(2, \"0\"))\n        .replace(/hh/, String(date.getHours()).padStart(2, \"0\"))\n        .replace(/mm/, String(date.getMinutes()).padStart(2, \"0\"))\n        .replace(/ss/, String(date.getSeconds()).padStart(2, \"0\"))\n\n}\n\n\n/**\n * 入力されたラベルに一致する項目の選択した値を返却する。\n * @param {String} label ラベル\n * @param {Boolean} valueFlg true : value値 false : display値\n * @returns {*} 選択された値または表示テキスト\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonGetValue(label, valueFlg = true) {\n    if ($p.action() !== \"edit\" && $p.action() !== \"new\") {\n        let message = \"編集画面で使用を想定\"\n        alert(message)\n        throw new Error(message)\n    }\n    const control = $p.getControl($p.getColumnName(label));\n    const tagName = control.prop(\"tagName\");\n\n    let value;\n\n    switch (tagName) {\n        case \"SELECT\":\n            value = commonHandleSelect(control, valueFlg);\n            break;\n        case \"INPUT\":\n            value = commonHandleInput(control, label, valueFlg);\n            break;\n        case \"TEXTAREA\":\n            value = document.getElementById(commonGetId(label) + \".viewer\").innerText;\n            break;\n        default:\n            value = commonHandleDefault(control, valueFlg);\n    }\n\n    return commonParseIfJson(value);\n}\n\n/**\n * 入力されたラベルに一致する項目の選択した値を入力する。\n * @param {String} label ラベル\n * @param {object} value 値\n */\nfunction commonSetValue(label, value) {\n    if ($p.action() !== \"edit\" && $p.action() !== \"new\") {\n        let message = \"編集画面で使用を想定\"\n        alert(message)\n        throw new Error(message)\n    }\n\n    // 値が変更されている場合\n    if (commonGetValue(label, true) != value) {\n        if ($p.getColumnName(label).startsWith(\"Check\")) {\n            // changeイベントを動かす\n            $p.getControl(label).click()\n        } else {\n            value = (value == commonGetDateEmpty()) ? \"\" : value\n            $p.set($p.getControl(label), value)\n        }\n    }\n}\n\n/**\n * 入力されたラベルのIDを返却する。\n * @param {String} label ラベル\n * @param {Boolean} [prefix=true] プレフィックス（テーブル名）を付けるかどうか\n * @param {Boolean} [suffix=false] サフィックス（'Field'）を付けるかどうか\n * @returns {String} 生成されたID\n * @throws {Error} ラベルが不正な場合やその他のエラー\n */\nfunction commonGetId(label, prefix = true, suffix = false) {\n    if ($p.action() !== \"edit\" && $p.action() !== \"new\") {\n        let message = \"編集画面で使用を想定\"\n        alert(message)\n        throw new Error(message)\n    }\n\n    let id = $p.getColumnName(label);\n    if (commonIsNull(id)) {\n        let message = `commonGetId ：ラベル不正。${label}`\n        alert(message)\n        throw new Error(message)\n    }\n    id = prefix ? `${$p.tableName()}_${id}` : id;\n    id = suffix ? `${id}Field` : id;\n    return id;\n\n}\n\n/**\n * SELECT要素の値を処理する。\n * @param {jQuery} control jQuery対象のSELECT要素\n * @param {Boolean} valueFlg true : value値 false : display値\n * @returns {*} 選択された値または表示テキスト\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonHandleSelect(control, valueFlg) {\n    if (control.attr(\"multiple\")) {\n        return valueFlg ? control.val() : control.next().children().last().text();\n    }\n    const selectedOption = control.children(':selected');\n    return valueFlg ? selectedOption.val() : selectedOption.text();\n}\n\n/**\n * INPUT要素の値を処理する。\n * @param {jQuery} control jQuery対象のINPUT要素\n * @param {String} label ラベル\n * @param {Boolean} valueFlg true : value値 false : display値\n * @returns {*} 入力された値または表示テキスト\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonHandleInput(control, label, valueFlg) {\n    const inputId = commonGetId(label);\n    if (inputId.indexOf(\"Check\") > 0) {\n        const checked = document.getElementById(inputId).checked;\n        return valueFlg ? +checked : checked;\n    }\n    let value = valueFlg ? control.attr('data-value') : control[0].innerHTML;\n    return commonIsNull(value) ? control.val() : value;\n\n}\n\n/**\n * デフォルトの要素処理を行う。\n * @param {jQuery} control jQuery対象の要素\n * @param {Boolean} valueFlg true : value値 false : display値\n * @returns {*} 要素の値または表示テキスト\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonHandleDefault(control, valueFlg) {\n    let value = valueFlg ? (control.attr('data-value') ?? control[0].innerHTML) : control[0].innerHTML;\n    return commonIsNull(value) ? control.val() : value;\n}\n\n/**\n * 空日付を出力する関数です。\n *\n * @return {String} 空日付\n */\nfunction commonGetDateEmpty() {\n    return '1899-12-30T00:00:00'\n}\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝値変換系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n/**\n * 値がJSON文字列の場合はパースし、そうでない場合は元の値を返す。\n * @param {*} value パース対象の値\n * @returns {*} パースされた値または元の値\n */\nfunction commonParseIfJson(value) {\n    if (typeof value !== 'string') return value;\n    try {\n        return JSON.parse(value);\n    } catch (err) {\n        return value;\n    }\n}\n\n/**\n * file を Base64 文字列に変換する。\n * @param {ArrayBuffer} file 変換する file\n * @returns {string} Base64 エンコードされた文字列\n */\nasync function commonToBase64(file) {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = () => {\n            const base64String = reader.result.split(\",\")[1];\n            resolve(base64String);\n        };\n        reader.onerror = (err) => reject(err);\n        reader.readAsDataURL(file);\n    });\n}\n\n/**\n   * 引数の2次元配列をUTF-8のCSVに変換する関数です。\n   * @param {Array} array 2次元配列\n   *\n   * @return {String} csvData\n   * 例. [\n   *      ['数量', '単価', '合計'],\n   *      ['1', '2', '2'],\n   *      ['4', '5', '20'],\n   *      ['7', '8', '56'],\n   *     ]\n   *            ⇓\n   * 'data:text/csvcharset=utf-8,\"数量\",\"単価\",\"合計\"\\r\\n\"1\",\"2\",\"2\"\\r\\n\"4\",\"5\",\"20\"\\r\\n\"7\",\"8\",\"56\"\\r\\n'\n   */\nfunction commonConvert2DToCsv(d2array) {\n    // csvDataに出力方法を追加\n    let csvOutput = 'data:text/csvcharset=utf-8,'\n    let csvData = csvOutput\n    d2array.forEach(v => {\n        const row = '\"' + v.join('\",\"') + '\"'\n        csvData += row + '\\r\\n'\n    })\n    return csvData\n}\n\n/**\n   * 引数の2次元配列をUTF-8のCSVに変換する関数です。\n   * @param {String} csvData\n   *\n   * @return {Array} array 2次元配列\n   * 例. 'data:text/csvcharset=utf-8,\"数量\",\"単価\",\"合計\"\\r\\n\"1\",\"2\",\"2\"\\r\\n\"4\",\"5\",\"20\"\\r\\n\"7\",\"8\",\"56\"\\r\\n'\n   *            ⇓\n   *     [\n   *      ['数量', '単価', '合計'],\n   *      ['1', '2', '2'],\n   *      ['4', '5', '20'],\n   *      ['7', '8', '56'],\n   *     ]\n   */\nfunction commonConvertCsvTo2D(csvData) {\n    // 行の分割\n    let rows = csvData.split(/\\r?\\n/);\n\n    // 空行の除去\n    let filteredRows = rows.filter(row => row.trim() !== '');\n\n    // 各行を処理\n    let processedData = filteredRows.map(row => {\n        // カラムに分割\n        let columns = row.split(',');\n\n        // 各値ごとに型変換処理\n        return columns.map(value => {\n            let trimmed = value.trim();\n            let num = Number(trimmed);\n\n            if (!isNaN(num) && trimmed !== '') {\n                return num;\n            }\n            return trimmed;\n        });\n    });\n\n    return processedData;\n}\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝要素追加&要素編集系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n/**\n * 指定された文言と完全に一致する最初のリンクを検索し、href属性を'#'に変更して、クリック時にカスタム関数を実行する関数\n * @param {string} searchText - リンクを検索するための文言（完全一致）\n * @param {function} customClickHandler - クリック時に実行されるカスタム関数\n * @returns {boolean} - リンクが見つかって修正されたかどうか\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonModifyLink(searchText, customClickHandler) {\n    const link = Array.from(document.getElementsByTagName('a')).find(a =>\n        a.textContent.trim() === searchText.trim()\n    );\n\n    if (link) {\n        const dataValue = link.closest('[data-value]')?.getAttribute('data-value');\n        link.setAttribute('href', '#');\n        link.style.color = 'black';\n        link.style.textDecoration = 'none';\n        link.onclick = function (event) {\n            event.preventDefault();\n            customClickHandler(dataValue, link.textContent);\n            return false;\n        };\n        return true;\n    } else {\n        console.warn(`\"${searchText}\" と完全に一致するリンクが見つかりませんでした。`);\n        return false;\n    }\n}\n\n/**\n * メインコマンドエリアにボタンを追加する関数です。\n * @param {String} buttonId     ボタンID\n * @param {String} buttonLabel  ラベル\n * @param {Function} clickFunc  click時関数\n * @param {String} icon         アイコン（empty指定でアイコンなし）\n * @throws {Error}              処理中に発生したエラー\n */\nfunction commonAddButtonToMainCommands(buttonId, buttonLabel, clickFunc, icon = \"ui-icon-disk\") {\n    const target = document.getElementById(\"MainCommands\");\n    const elem = document.createElement('button');\n    elem.id = buttonId;\n    elem.className = 'button button-icon ui-button ui-corner-all ui-widget applied customized';\n    elem.onclick = clickFunc;\n    elem.innerText = buttonLabel;\n    if (icon !== \"empty\") {\n        const span = document.createElement('span');\n        span.className = `ui-button-icon ui-icon ${icon}`;\n        elem.appendChild(span);\n    }\n    const space = document.createElement('span');\n    space.className = \"ui-button-icon-space\";\n    elem.appendChild(space);\n\n    target.appendChild(elem);\n}\n\n/**\n * 指定項目横にボタンを追加する関数です。\n * @param {String} buttonId     ボタンID\n * @param {String} buttonLabel  ラベル\n * @param {Function} clickFunc  click時関数\n * @param {String} icon         アイコン（empty指定でアイコンなし）\n * @param {Array} applys        適用するステータス\n * @throws {Error}              処理中に発生したエラー\n */\nfunction commonAddButtonToNextField(ItemLabel, buttonId, buttonLabel, clickFunc, icon = \"ui-icon-disk\", applys = \"all\") {\n    if (!commonCheckStatus(applys)) return;\n\n    // 対象のフィールドを取得\n    const targetField = document.getElementById(commonGetId(ItemLabel));\n    if (!targetField) {\n        let message = `commonAddButtonToNextField :対象項目が見つかりません。${ItemLabel}`\n        alert(message)\n        throw new Error(message)\n    }\n\n    // container-normal クラスを持つ親要素を見つける\n    const containerElement = targetField.closest('.container-normal');\n    if (!containerElement) {\n        let message = `commonAddButtonToNextField :container-normalクラスを持つ親要素が見つかりません。`\n        alert(message)\n        throw new Error(message)\n    }\n\n    // 新しいボタン要素を作成\n    const elem = document.createElement('button');\n    elem.id = buttonId;\n    elem.className = 'button button-icon ui-button ui-corner-all ui-widget applied customized';\n    elem.onclick = clickFunc;\n\n    if (icon !== \"empty\") {\n        const span = document.createElement('span');\n        span.className = `ui-button-icon ui-icon ${icon}`;\n        elem.insertBefore(span, elem.firstChild);\n    }\n\n    const space = document.createElement('span');\n    space.className = \"ui-button-icon-space\";\n    elem.appendChild(space);\n\n    const textNode = document.createTextNode(buttonLabel);\n    elem.appendChild(textNode);\n\n    // ボタンをcontainer-normal要素内に挿入\n    containerElement.appendChild(elem);\n\n    // レイアウトとスタイルを調整\n    containerElement.style.display = 'flex';\n    containerElement.style.alignItems = 'center';\n    containerElement.style.flexWrap = 'nowrap';\n\n    targetField.style.flexGrow = '1';\n    targetField.style.flexShrink = '1';\n    targetField.style.flexBasis = 'auto';\n    targetField.style.minWidth = '0';\n\n    elem.style.flexGrow = '0';\n    elem.style.flexShrink = '0';\n    elem.style.flexBasis = 'auto';\n    elem.style.marginLeft = '10px';\n    elem.style.whiteSpace = 'nowrap';\n\n}\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝API系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet API_VERSION = \"1.0\"\n\n/**\n * 取得APIを呼び出す関数です。\n *\n * @param {Number}    id テーブルID\n * @param {Array}     columns 取得列\n * @param {Object}    filterHash フィルター条件\n * @param {Object}    sorterHash ソート条件\n * @param {Object}    filterSearchTypes 検索条件\n * @param {Boolean}   keyFlg true : 表示名 false : カラム名\n * @param {Boolean}   valueFlg true : value値 false : display値\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonGetData(id = $p.siteId(), columns = [\"ClassA\", \"NumA\"], filterHash = {}, sorterHash = { \"ResultId\": \"asc\" }, filterSearchTypes = {}, keyFlg = true, valueFlg = true, addFunc) {\n    let offset = 0\n    let data = []\n    let temp = {}\n    do {\n        temp = await commonGetInnner(id, columns, filterHash, sorterHash, filterSearchTypes, keyFlg, valueFlg, offset, addFunc)\n        data = [...data, ...temp.Response.Data]\n        offset += temp.Response.PageSize\n    } while (offset < temp.Response.TotalCount)\n    return data\n\n    /**\n     * 取得APIを呼び出す関数内関数です。(TotalCount 200)\n     *\n     * @param {Number}    id テーブルID\n     * @param {Array}     columns 取得列\n     * @param {Object}    filterHash フィルター条件\n     * @param {Object}    sorterHash ソート条件\n     * @param {Object}    filterSearchTypes 検索条件\n     * @param {Boolean}   keyFlg true : 表示名 false : カラム名\n     * @param {Boolean}   valueFlg true : value値 false : display値\n     * @param {Number}    offset オフセット条件\n     * @param {Function}  addFunc 最後に実行したい関数\n     */\n    async function commonGetInnner(id, columns, filterHash, sorterHash, filterSearchTypes, keyFlg, valueFlg, offset, addFunc) {\n        let payload = {\n            'id': id,\n            'data': {\n                'Offset': offset,\n                'View': {\n                    'ApiDataType': \"KeyValues\",\n                    'ApiColumnKeyDisplayType': keyFlg ? 'LabelText' : 'ColumnName',\n                    'ApiColumnValueDisplayType': valueFlg ? \"Value\" : \"DisplayValue\",\n                    \"ColumnFilterHash\": filterHash,\n                    \"ColumnSorterHash\": sorterHash,\n                    \"ColumnFilterSearchTypes\": filterSearchTypes,\n                }\n            },\n            'done': function (data) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n                return data.Response.Data\n            }\n        }\n\n        if (!Array.isArray(columns)) {\n            columns = [columns]\n        }\n        if (columns.length > 0) {\n            payload['data']['View']['GridColumns'] = columns\n        }\n\n\n\n        return await $p.apiGet(payload)\n    }\n}\n\n/**\n * エクスポートAPIを呼び出す関数です。\n *\n * @param {String}    tableId 取得テーブルID\n * @param {Array}     columns 取得列\n * @param {Object}    filterHash フィルター条件\n * @param {Object}    sorterHash ソート条件\n * @param {Object}    filterSearchTypes 検索条件\n * @param {Boolean}   jsonFlg trueならjson　falseならcsvで取得\n * @param {Boolean}   headerFlg trueならheaderも取得\n * @param {Boolean}   overFlg trueなら超過分のみ取得\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonExportData(tableId = $p.siteId(), columns = [\"ClassA\", \"NumA\"], filterHash = {}, sorterHash = { \"ResultId\": \"asc\" }, filterSearchTypes = {}, jsonFlg = true, headerFlg = true, overFlg = false, addFunc) {\n    if (!Array.isArray(columns)) {\n        columns = [columns]\n    }\n    columns.unshift(\"ResultId\")\n    let data = await commonExportInner(tableId, columns, filterHash, sorterHash, filterSearchTypes, jsonFlg, headerFlg, overFlg, addFunc)\n    if (jsonFlg) {\n        // json整形\n        data = JSON.parse(data.Response.Content)\n    } else {\n        // csv整形\n        data = commonConvertCsvTo2D(data.Response.Content)\n    }\n\n    return data\n    /**\n     * エクスポートAPIを呼び出す関数内関数です。\n     *\n     * @param {String}    tableId 取得テーブルID\n     * @param {Array}     columns 取得列\n     * @param {Object}    filterHash フィルター条件\n     * @param {Object}    sorterHash ソート条件\n     * @param {Object}    filterSearchTypes 検索条件\n     * @param {Boolean}   jsonFlg trueならjson　falseならcsvで取得\n     * @param {Boolean}   headerFlg trueならheaderも取得\n     * @param {Boolean}   overFlg trueなら超過分のみ取得\n     * @param {Function}  addFunc 最後に実行したい関数\n     */\n    async function commonExportInner(tableId, columns, filterHash, sorterHash, filterSearchTypes, jsonFlg, headerFlg, overFlg, addFunc) {\n\n        let col = []\n        columns.forEach(v => col.push({ \"ColumnName\": v }))\n        let data = JSON.stringify({\n            \"ApiVersion\": API_VERSION,\n            \"Export\": {\n                \"Columns\": col,\n                \"Header\": headerFlg,\n                \"Type\": jsonFlg ? \"json\" : \"csv\"\n            },\n            \"View\": {\n                \"Overdue\": overFlg,\n                \"ColumnFilterHash\": filterHash,\n                \"ColumnSorterHash\": sorterHash,\n                \"ColumnFilterSearchTypes\": filterSearchTypes,\n            }\n        })\n\n        return new Promise((resolve, reject) => {\n            $.ajax({\n                type: \"POST\",\n                url: `/api/items/${tableId}/export`,\n                contentType: 'application/json',\n                data: data\n            }).then(\n                function (result) {\n                    if (addFunc && typeof addFunc === 'function') {\n                        // 渡されたオブジェクトが関数なら実行する\n                        addFunc(data)\n                    }\n                    // 正常終了\n                    resolve(result)\n                },\n                function () {\n                    // エラー\n                    reject()\n                }\n            )\n        })\n    }\n}\n\n/**\n * 登録APIを呼び出す関数です。\n *\n * @param {String}    tableId 登録テーブルID\n * @param {Object}    Hash 更新項目\n * @param {String}    Status 登録ステータス\n * @param {String}    Comments 登録コメント\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonCreate(tableId, Hash = {}, Status, Comments, addFunc) {\n\n    // 登録項目\n    let ClassHash = {}\n    let NumHash = {}\n    let DateHash = {}\n    let DescriptionHash = {}\n    let CheckHash = {}\n    for (let key in Hash) {\n        if (key.includes(\"Class\")) ClassHash[key] = Hash[key]\n        else if (key.includes(\"Num\")) NumHash[key] = commonConvertCTo1(Hash[key])\n        else if (key.includes(\"Date\")) DateHash[key] = commonIsNull(Hash[key]) ? commonGetDateEmpty() : Hash[key]\n        else if (key.includes(\"Description\")) DescriptionHash[key] = Hash[key]\n        else if (key.includes(\"Check\")) CheckHash[key] = Hash[key]\n    }\n\n    let data = JSON.stringify({\n        \"ApiVersion\": API_VERSION,\n        Status,\n        Comments,\n        ClassHash,\n        NumHash,\n        DateHash,\n        DescriptionHash,\n        CheckHash\n    })\n    if (!commonIsNull(Status)) {\n        delete data[\"Status\"]\n    }\n    if (!commonIsNull(Comments)) {\n        delete data[\"Comments\"]\n    }\n\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            type: \"POST\",\n            url: `/api/items/${tableId}/create`,\n            contentType: 'application/json',\n            data: data\n        }).then(\n            function (result) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n                // 正常終了\n                resolve(result)\n            },\n            function () {\n                // エラー\n                reject()\n            }\n        )\n    })\n}\n\n/**\n * 更新APIを呼び出す関数です。\n *\n * @param {String}    recordId 更新レコードID\n * @param {Object}    Hash 更新項目\n * @param {String}    Status 更新ステータス\n * @param {String}    Comments 更新コメント\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonUpdate(recordId, Hash = {}, Status, Comments, addFunc) {\n\n    // 更新項目\n    let ClassHash = {}\n    let NumHash = {}\n    let DateHash = {}\n    let DescriptionHash = {}\n    let CheckHash = {}\n    for (let key in Hash) {\n        if (key.includes(\"Class\")) ClassHash[key] = Hash[key]\n        else if (key.includes(\"Num\")) NumHash[key] = commonConvertCTo1(Hash[key])\n        else if (key.includes(\"Date\")) DateHash[key] = commonIsNull(Hash[key]) ? commonGetDateEmpty() : Hash[key]\n        else if (key.includes(\"Description\")) DescriptionHash[key] = Hash[key]\n        else if (key.includes(\"Check\")) CheckHash[key] = Hash[key]\n    }\n    let data = JSON.stringify({\n        \"ApiVersion\": API_VERSION,\n        Status,\n        Comments,\n        ClassHash,\n        NumHash,\n        DateHash,\n        DescriptionHash,\n        CheckHash\n    })\n    if (!commonIsNull(Status)) {\n        delete data[\"Status\"]\n    }\n    if (!commonIsNull(Comments)) {\n        delete data[\"Comments\"]\n    }\n\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            type: \"POST\",\n            url: `/api/items/${recordId}/update`,\n            contentType: 'application/json',\n            data: data\n        }).then(\n            function (result) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n\n                // 正常終了\n                resolve(result)\n            },\n            function () {\n                // エラー\n                reject()\n            }\n        )\n    })\n}\n\n/**\n * ユーザー取得APIを呼び出す関数です。\n *\n * @param {Array}     userIds 取得UserId\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonExportUser(userIds, addFunc) {\n    let users = []\n    if (Array.isArray(userIds)) {\n        users = userIds\n    } else {\n        users = [userIds]\n    }\n    let data = JSON.stringify({\n        \"ApiVersion\": API_VERSION,\n        \"View\": {\n            \"ColumnFilterHash\": {\n                \"UserId\": JSON.stringify(users)\n            }\n        }\n    })\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            type: \"POST\",\n            url: \"/api/users/get\",\n            contentType: 'application/json',\n            data: data\n        }).then(\n            function (result) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n                // 正常終了\n                resolve(result)\n            },\n            function () {\n                // エラー\n                reject()\n            }\n        )\n    })\n}\n\n/**\n * グループ取得APIを呼び出す関数です。\n *\n * @param {Array}     groupIds 取得GroupId\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonExportGroup(groupIds, addFunc) {\n    let groups = []\n    if (Array.isArray(groupIds)) {\n        groups = groupIds\n    } else {\n        groups = [groupIds]\n    }\n    let data = JSON.stringify({\n        \"ApiVersion\": API_VERSION,\n        \"View\": {\n            \"ColumnFilterHash\": {\n                \"GroupId\": JSON.stringify(groups)\n            }\n        }\n    })\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            type: \"POST\",\n            url: \"/api/groups/get\",\n            contentType: 'application/json',\n            data: data\n        }).then(\n            function (result) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n                // 正常終了\n                resolve(result)\n            },\n            function () {\n                // エラー\n                reject()\n            }\n        )\n    })\n}\n\n/**\n * 添付項目にExcelを添付し更新する共通関数です。\n *\n * @param {string} targetID 更新対象のアイテムID\n * @param {string} className 添付ファイルのクラス名\n * @param {Object} excel Excelワークブックオブジェクト\n * @param {string} filename 添付ファイルの名前\n */\nasync function commonUpdateExcel(targetID, className, workbook, filename) {\n    const fileBuffer = await workbook.xlsx.writeBuffer()\n    const base64 = commonToBase64(fileBuffer)\n\n    let url = `/api/items/${targetID}/update`\n    let method_name = \"POST\"\n    let data = {\n        \"ApiVersion\": API_VERSION,\n        \"AttachmentsHash\": {\n            [className]: [\n                {\n                    \"ContentType\": \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\n                    \"Name\": filename,\n                    \"Base64\": base64\n                }\n            ]\n        }\n    }\n    await $.ajax({\n        type: method_name,\n        url: url,\n        data: JSON.stringify(data),\n        contentType: 'application/json',\n        dataType: 'json',\n        scriptCharset: 'utf-8',\n        success: function (data) {\n            // Success\n            console.log(\"success\")\n            console.log(JSON.stringify(data))\n        },\n        error: function (data) {\n            // Error\n            console.log(\"error\")\n            console.log(JSON.stringify(data))\n        }\n    })\n}\n\n",
            "Id": 10
          },
          {
            "Title": "20_ダイアログテンプレート.js",
            "New": true,
            "Edit": true,
            "Body": "// ダイアログを作成し、ページに追加する関数\nhtmls = {};\nfunction createAndAddDialog(dialogId, title, fields, btnFields = [], submitHandler) {\n    if (document.getElementById(dialogId)) {\n        let message = `ダイアログID \"${dialogId}\" は既に存在します。一意のIDを使用してください。`;\n        alert(message)\n        throw new Error(message);\n    }\n\n    // 何行になるかを計算し、配列に格納\n    let columnCountArr = [];\n    let rowCount = 0;\n    let newLineFlg = false;\n    for(let field of fields){\n        if(typeof(field.options) == 'object' && 'newLine' in field.options && field.options.newLine){\n            newLineFlg = true;\n            rowCount++;\n        }\n        else if(typeof(field.options) == 'object' && \"newLine\" in field.options && !field.options.newLine){\n            if(newLineFlg){\n                columnCountArr.push(rowCount);\n                rowCount = 0;\n            }\n            else{\n                newLineFlg = true;\n            }\n        }\n    }\n\n    let content = '';\n    newLineFlg = false;\n    let arrCount = 0;\n    for(let field of fields){\n        sqlArrayPush(field,dialogId);\n        if(typeof(field.options) == 'object' && 'newLine' in field.options && field.options.newLine){\n            if(newLineFlg){\n                content += \"</div>\";\n            }\n            let conteiner_width = Math.floor(100 / columnCountArr[arrCount]);\n            content += `<div style=\"display: inline-block;width: ${conteiner_width}%;vertical-align: top;\">`;\n            content += createField(dialogId, field.type, field.id, field.label, field.options);\n            newLineFlg = true;\n        }\n        else if(typeof(field.options) == 'object' && \"newLine\" in field.options && !field.options.newLine){\n            if(newLineFlg){\n                content += \"</div>\";\n                content += `<div style=\"display: block;\">`;\n                content += createField(dialogId, field.type, field.id, field.label, field.options);\n                newLineFlg = true;\n                arrCount++;\n            }\n        }\n        else{\n            content += createField(dialogId, field.type, field.id, field.label, field.options);\n        }\n\n    }\n    if(newLineFlg)content += \"</div>\";\n\n    let btnContent = '';\n    if(btnFields.length > 0){\n        btnContent = btnFields.map(e => createButton(e.label,e.options.onclick ? e.options.onclick : '',e.options.icon,dialogId,e.id,e.options.hidden ? true:false)).join('');\n    }\n    const dialogHTML = createDialogHTML(dialogId, title, content,btnContent);\n    $('#Application').append(dialogHTML);\n\n    \n    htmls[dialogId] = dialogHTML;\n\n    // バリデーションイベント登録\n    // for(let field of fields){\n    //     create_varidate_event(dialogId,field.id,field.type,field.options);\n    // }\n\n    createLookups(dialogId, title, fields);\n    // submitHandlerを設定\n    $(`#${dialogId}_submit`).on('click', function() {\n        submitDialog(dialogId, submitHandler);\n    });\n\n    // searchArr作成\n    let search_items = fields.filter(e => e.type == 'search-table');\n    if(search_items.length == 0)return;\n    for(item of search_items){\n        let tmp_searchObj = {dialogId:dialogId,tableId:item.id,searchTableId:item.options.searchTableId,multiple:item.options.multiple ? true:false};\n        // toColumns作成\n        tmp_searchObj.toColumns = item.options.t_heads.map(e =>{\n            tmp = {ColumnName:e.ColumnName};\n\n            if('specialTerms'in e)tmp[\"specialTerms\"] = e.specialTerms;\n            if('alignment' in e)tmp[\"alignment\"] = e.alignment;\n            if(e.hidden)tmp[\"hidden\"] = true;\n            if(e.type)tmp[\"type\"] = e.type;\n            return tmp;\n\n        });\n        // options作成\n        tmp_searchObj.options = [];\n        let tmpArr;\n        fields.forEach(e => {\n            if('forColumnName' in e){\n                tmpArr = {searchColumn:e.forColumnName,type:e.type,id:e.id};\n                if(\"digitsNum\" in e.options)tmpArr[\"digitsNum\"] = e.options.digitsNum;\n                if(\"alignment\" in e.options)tmpArr[\"alignment\"] = e.options.alignment;\n                tmp_searchObj.options.push(tmpArr);\n            }\n        });\n        searchArr.push(tmp_searchObj);\n\n    }\n    $(`#${dialogId}_searchButton`).on('click',function(e){\n        create_searchList($(this));\n    })\n\n\n\n}\n\n// ダイアログのベース構造を定義\nconst createDialogHTML = (dialogId, title, content, btnContent) => `\n    <div id=\"${dialogId}\" class=\"dialog\" title=\"${title}\">\n        ${content}\n        <div class=\"command-center\">\n            ${btnContent}\n            <button id=\"${dialogId}_close\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" type=\"button\" onclick=\"closeDialog('${dialogId}',true);\"style='position:relative;'>\n                <span class=\"ui-button-icon ui-icon ui-icon-cancel\"></span>\n                <span class=\"ui-button-icon-space\"> </span>終了\n            </button>\n        </div>\n    </div>\n`;\n\nfunction createButton(label,onclick,icon,dialogId,id,hiddenFlg){\n    return `\n        <button id=\"${dialogId}_${id}\" style=\"${hiddenFlg ? \"display:none\":''}\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" type=\"button\" onclick=\"${onclick == '' ? '':onclick}\">\n                    <span class=\"ui-button-icon ui-icon ui-icon-${icon}\"></span>\n                    <span class=\"ui-icon-${icon}\"> </span>${label}\n        </button>\n    `\n}\n\n// ダイアログを開く関数\nfunction openDialog(dialogId,width='550',unit = 'px',func = null) {\n\n    $(`#${dialogId}`).dialog({\n        modal:true,\n        width: `${width}${unit}`,\n        resizable: true,\n        closeOnEscape:false,\n    })\n    $(`#${dialogId}`).css('max-height',\"90vh\");\n    dialog_openTime = getJPISOTime()\n\n    if(typeof func == 'function'){\n        func();\n    }\n    \n}\n// ダイアログ固有の送信処理を格納するオブジェクト\nconst dialogSubmitHandlers = {};\n\n// ダイアログ内のフォームをSubmitする関数\nfunction submitDialog(dialogId, submitHandler) {\n    // バリデーションを実行\n    if (!validateDialog(dialogId)) {\n        return;\n    }\n\n    // 送信ハンドラを設定\n    if (typeof submitHandler === 'function') {\n        dialogSubmitHandlers[dialogId] = submitHandler;\n    }\n\n    // ダイアログ固有の送信処理を実行\n    if (dialogSubmitHandlers[dialogId]) {\n        dialogSubmitHandlers[dialogId](dialogId);\n    }\n    closeDialog(dialogId);\n}\n\n// ダイアログのバリデーションを行う関数\nfunction validateDialog(dialogId) {\n    let isValid = true;\n    $(`#${dialogId} [required]`).each(function() {\n        const field = $(this);\n        const errorElement = $(`#${field.attr('id').replace(/(From|To)$/, '')}-error`);\n        if (!field.val()) {\n            isValid = false;\n            field.addClass('error');\n            errorElement.text('この項目は必須です');\n        } else {\n            field.removeClass('error');\n            errorElement.text('');\n        }\n    });\n    return isValid;\n}\n\nfunction editMarkdown(dialogId, id) {\n\n    const fullId = `${dialogId}_${id}`;\n    $(`#${fullId}`).show().focus();\n    $(`#${fullId}_viewer`).hide();\n}\n\n// フィールドの有効/無効を切り替える関数\nfunction toggleFieldDisabled(fieldId, disabled) {\n    const field = $(`#${fieldId}`);\n    field.prop('disabled', disabled);\n\n    if (disabled) {\n        field.addClass('disabled');\n    } else {\n        field.removeClass('disabled');\n    }\n}\n\nfunction sqlArrayPush(field,dialogId){\n    if(field.type == 'search-table' && field.options.sql)useSqlDialogs.push(dialogId);\n    if(field.type == 'search-table' && field.options.individualSql)useIndividualSqlDialogs.push(dialogId);\n}\n\n/**\n * 現在の日本時間を ISO 8601 形式 (YYYY-MM-DDTHH:mm:ss) で取得する\n * @returns {string} 日本時間の ISO 8601 形式の文字列 (例: \"2024-12-11T01:41:33\")\n */\nfunction getJPISOTime() {\n    const now = new Date();\n    const jpISOTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000)\n        .toISOString()\n        .slice(0, 19);  // 秒まで切り取り\n    return jpISOTime;\n}\n\n/**\n * 前回出力履歴を取得する\n * @param {string} listName     帳票名\n * @param {number} number       番号（見積番号等）\n * @param {string} id           結果を入力するid\n *  */\nasync function get_history(listName,number,id){\n    try{\n        const sql = `\n            SELECT CreateDate, PCName\n            From TW見積出力履歴\n            WHERE ListName = '${listName}'\n            AND Number = ${number}\n        `;\n\n        let res = await fetchSql(sql);\n        res = res.results;\n\n        if(res.length == 0){\n            $(`#${id} .input-container span`).text('');\n            return;\n        }\n\n        // 入力\n        let tmp = formatDate_for_japanese(res[0].CreateDate) + \"　\" + formatTime_for_japanese(res[0].CreateDate) + \"　\" + res[0].PCName;\n\n        $(`#${id} .input-container span`).text(tmp);\n\n    }catch(err){\n        $(`#${id} .input-container span`).text('');\n        console.error('前回出力情報取得処理',err);\n        return;\n    }\n}",
            "Id": 12
          },
          {
            "Title": "21_検索ダイアログテンプレート.js",
            "New": true,
            "Edit": true,
            "Body": "/**\n * 検索ダイアログ\n * @param {string} dialogId 検索ダイアログID\n * @param {string} tableId 検索先テーブルID\n * @param {Array} fields 項目ごとのパラメータ\n * @param {Array} btnFields ダイアログ下部に表示するボタン\n * @param {string} width ダイアログのwidthを指定\n */\nlet useSqlDialogs = [];\nlet useIndividualSqlDialogs = [];\nasync function create_searchDialog(dialogId,tableId,fields,btnFields = [],width = '750px'){\n    if (document.getElementById(dialogId)) {\n        let message = `ダイアログID \"${dialogId}\" は既に存在します。一意のIDを使用してください。`;\n        alert(message)\n        throw new Error(message);\n    }\n\n    let multipleFlg = false;\n    for(i = 0; i < 2; i++){\n        if(multipleFlg)dialogId += \"_multiple\";\n        // 何行になるかを計算し、配列に格納\n        let columnCountArr = [];\n        let rowCount = 0;\n        let newLineFlg = false;\n        for(let field of fields){\n            if(typeof(field.options) == 'object' && 'newLine' in field.options && field.options.newLine){\n                newLineFlg = true;\n                rowCount++;\n            }\n            else if(typeof(field.options) == 'object' && \"newLine\" in field.options && !field.options.newLine){\n                if(newLineFlg){\n                    columnCountArr.push(rowCount);\n                    rowCount = 0;\n                }\n                else{\n                    newLineFlg = true;\n                }\n            }\n        }\n\n        let filterHTML = '';\n        newLineFlg = false;\n        let arrCount = 0;\n        for(let field of fields){\n            if(field.type == 'search-table' && field.options.sql)useSqlDialogs.push(dialogId);\n            if(field.type == 'search-table' && field.options.individualSql)useIndividualSqlDialogs.push(dialogId);\n            if(typeof(field.options) == 'object' && 'newLine' in field.options && field.options.newLine){\n                if(newLineFlg){\n                    filterHTML += \"</div>\";\n                }\n                let conteiner_width = Math.floor(100 / columnCountArr[arrCount]);\n                filterHTML += `<div style=\"display: inline-block;width: ${conteiner_width}%;vertical-align: top;\">`;\n                filterHTML += createField(dialogId, field.type, field.id, field.label, field.options,multipleFlg);\n                newLineFlg = true;\n            }\n            else if(typeof(field.options) == 'object' && \"newLine\" in field.options && !field.options.newLine){\n                if(newLineFlg){\n                    filterHTML += \"</div>\";\n                    filterHTML += `<div style=\"display: block;\">`;\n                    filterHTML += createField(dialogId, field.type, field.id, field.label, field.options,multipleFlg);\n                    newLineFlg = true;\n                    arrCount++;\n                }\n            }\n            else{\n                filterHTML += createField(dialogId, field.type, field.id, field.label, field.options,multipleFlg);\n            }\n        }\n        if(newLineFlg)filterHTML += \"</div>\";\n\n        const btnHTML = btnFields.map(field => createField(dialogId, field.type, field.id, field.label, field.options,multipleFlg)).join('');\n        const dialogHTML      = searchDialogTemplate(dialogId,filterHTML,multipleFlg,btnHTML);\n        $('#Application').append(dialogHTML);\n\n        // 検索用のイベント登録\n        $(`#${dialogId}_searchButton`).on('click',function(e){\n            create_searchList($(this));\n        })\n\n        // searchArr作成（検索に必要な情報を格納）\n        const searchTable_items = fields.filter(e => e.type == 'search-table');\n        for(item of searchTable_items){\n            let tmp_searchObj = {dialogId:dialogId,searchTableId:tableId,tableId:item.id,width:width};\n            // toColumns作成\n            tmp_searchObj.toColumns = item.options.t_heads.map(e =>{\n                tmp = {ColumnName:e.ColumnName};\n\n                if('specialTerms'in e)tmp[\"specialTerms\"] = e.specialTerms;\n                if('alignment' in e)tmp[\"alignment\"] = e.alignment;\n                if(e.hidden)tmp[\"hidden\"] = true;\n                if(e.type)tmp['type'] = e.type;\n                return tmp;\n\n            });\n            // options作成\n            tmp_searchObj.options = [];\n            let tmpArr;\n            fields.forEach(e => {\n                if('forColumnName' in e){\n                    tmpArr = {searchColumn:e.forColumnName,type:e.type,id:e.id};\n                    if(\"digitsNum\" in e.options)tmpArr[\"digitsNum\"] = e.options.digitsNum;\n                    if(\"alignment\" in e.options)tmpArr[\"alignment\"] = e.options.alignment;\n                    tmp_searchObj.options.push(tmpArr);\n                }\n            });\n            searchArr.push(tmp_searchObj);\n        }\n\n        // lookups作成\n        createLookups(dialogId,'',fields);\n\n        multipleFlg = true;\n    }\n}\n\n// ダイアログテンプレート\nfunction searchDialogTemplate(id,filterHTML,multipleFlg,btnHTML){\n\n    return `\n        <div id=\"${id}Dialog\" class=\"searchDialog\" style=\"display: none; margin-top: 10px;\">\n            ${filterHTML}\n            <div class=\"command-center\">\n                ${multipleFlg ? btnHTML : ''}\n                <button id=\"${id}_close\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" type=\"button\" onclick=\"closeDialog('${id}Dialog',false);\"style='position:relative;'>\n                    <span class=\"ui-button-icon ui-icon ui-icon-cancel\"></span>\n                    <span class=\"ui-button-icon-space\"> </span>終了\n                </button>\n            </div>\n        </div>\n    `;\n}\n\n// ③ダイアログを表示する\n$(document).on('click','.dialogSearch',function(){\n\n    // テーブルの検索機能は各ダイアログファイルに記載\n    if($(this).parent().prop('tagName') == 'TD')return;\n\n    let id = $(this).prev().attr('id');\n\n    const parentClass = $(this).parent().attr('class');\n    let type = '';\n    if(parentClass == 'text-set'){\n        id = id.slice(0,-2);\n        type = 'text-set';\n    }\n    else if(parentClass == 'range-text-container'){\n        id = id.slice(-2) == 'om' ? id.slice(0,-4) : id.slice(0,-2);\n        type = 'range-text';\n    }\n\n\n    let lookup = lookups.find(e => e.id == id);\n    let dialogId = lookup.searchDialog.id;\n    if(dialogId == \"recipientNoSearch\")return;  //納入先CD検索は個別処理\n    if(lookup.searchDialog.multiple)dialogId += \"_multiple\";\n    let title = lookup.searchDialog.title;\n    const width = searchArr.find(e => dialogId == e.dialogId).width;\n\n    if(parentClass == 'text-set'){\n        id += 'From';\n    }\n    else if(parentClass == 'range-text-container'){\n        id = $(this).prev().attr('id');\n    }\n\n    openDialog_for_searchDialog(dialogId,id,width,title)\n\n})\n\nfunction openDialog_for_searchDialog(dialogId,id,width,title){\n    searchOutputId.push({id:id,dialogId:dialogId});\n    $(`#${dialogId}Dialog td`).remove();\n    $(`#${dialogId}Dialog input`).val('');\n    $(`#${dialogId}Dialog`).dialog({\n        modal: true,\n        width: width,\n        resizable: true,\n        title:title,\n    });\n    $(`#${dialogId}Dialog`).css('max-height',\"90vh\");\n    $(`#${dialogId}Dialog`).focus();\n}\n\n\n// 検索ボタンが押されたら検索し、tableに表示\nasync function create_searchList(event){\n\n    showLoading()\n\n    let dialogId = '';\n    if(searchOutputId.length == 0){\n        dialogId = $(event).closest('div.dialog').attr('id');\n    }else{\n        dialogId = searchOutputId[searchOutputId.length -1].dialogId;\n    }\n\n    // アクティブな検索ダイアログの情報を取得\n    let searchDialogData = searchArr.find(e => e.dialogId == dialogId);\n\n    let arr = [];\n    // 簡単なSQL・joinなど複雑なSQL・Pleasanterのテーブルに取得できる処理で分け\n    if(useSqlDialogs.includes(dialogId)){\n        try{\n            arr = await requestSQL(searchDialogData);\n        }catch{\n            return;\n        }\n    }\n    else if(useIndividualSqlDialogs.includes(dialogId)){\n        arr = await requestIndividualSQL(searchDialogData);\n        if(arr == null)return;\n    }\n    else{\n    // それ以外の場合\n        // 検索対象テーブルID\n        let tableId = searchDialogData.searchTableId;\n\n        if(tableId == ''){\n            alert('検索先IDが指定されていません。');\n            return;\n        }\n\n        let columns = [];\n        let filter = {};\n        let filterSearchType = {};\n        // 複数回Getしなきゃいけないテーブルは処理を分ける\n        if(searchDialogData.dialogId == 'auxiliarySubjectSearch'){\n\n            let tmpData = await commonGetData(MASTER_TABLES[\"科目マスタ\"],['ResultId'],{ClassA:$(`#auxiliarySubjectSearch_subjectCD`).val()},{},{ClassA:'ExactMatch'},false,false);\n            if(tmpData.length != 1){\n                alert('科目CDを入力してください。');\n                return;\n            }\n            let KAMOKUCD_resultId = tmpData[0].ResultId;\n            columns = ['ClassC','ClassD'];\n            filter = {\n                ClassA:JSON.stringify([KAMOKUCD_resultId]),\n                ClassC:$('#auxiliarySubjectSearch_auxiliarySubjectCD').val(),\n                ClassD:$('#auxiliarySubjectSearch_teamName').val()\n            };\n            filterSearchType = {\n                ClassA:'ExactMatch',\n                ClassC:'ExactMatch',\n                ClassD:'PartialMatchMultiple',\n            }\n        }\n        else if(searchDialogData.dialogId == 'recipientNoSearch'){\n            let tmpData = await commonGetData(MASTER_TABLES[\"得意先マスタ\"],['ResultId'],{ClassA:$(`#recipientNoSearch_custmerFrom`).val()},{},{ClassA:'ExactMatch'},false,false);\n            if(tmpData.length != 1){\n                alert('得意先CDを入力してください。');\n                return;\n            }\n            columns = ['ClassD','ClassE','ClassF'];\n            const custmerResultId = tmpData[0].ResultId;\n            const receptNo = $('#recipientNoSearch_recipientCD').val();\n            const receptName = $('#recipientNoSearch_recipientName1').val();\n            const furigana = $('#recipientNoSearch_furigana').val();\n            filter = {\n                // ClassA:JSON.stringify(custmerResultId)\n                ClassA:\"223515\"\n            };\n            if(receptNo != \"\")filter[\"ClassD\"] = receptNo;\n            if(receptName != \"\")filter[\"ClassE\"] = receptName;\n            if(furigana != \"\")filter[\"ClassI\"] = furigana;\n\n            filterSearchType = {\n                ClassA:'ExactMatch',\n                ClassD:'PartialMatch',\n                ClassE:'PartialMatch',\n                ClassI:'PartialMatch',\n            }\n        }\n        else{\n            // gridColumns作成\n            columns = searchDialogData.toColumns.map(e => e.ColumnName);\n\n            // ColumnFilterHashとColumnFilterSearchTypes作成\n            searchDialogData.options.forEach(e => {\n                let res = create_filter(e,dialogId);\n                // res = {column:'ClassA',text:''}見本\n                if(Object.keys(res).length == 0){\n                    hideLoading();\n                    return;\n                }\n                filter[res.column] = res.text;\n                filterSearchType[res.column] = res.searchType;\n            });\n        }\n        tableData = await commonGetData(tableId,columns,filter,{},filterSearchType,false,false);\n        tableData.sort((a,b) => a.ClassA-b.ClassA)\n\n\n        if(tableData.length == 0){\n            alert('フィルター条件に合致するデータがありません。');\n            hideLoading();\n            return;\n        }\n        for(record of tableData){\n\n            // 日付はyyyy/mm/dd形式にして代入、Numでnullの場合は0に置換して代入\n            columns.forEach(e =>{\n                switch(e.substring(0,3)){\n                    case 'Num':\n                        record[e] = record[e] == null ? 0:record[e].toLocaleString();\n                        break;\n                    case 'Dat':\n                        // 1899-12-30だったら空文字を返し、それ以外なyyyy/mm/dd形式に置換\n                        if(record[e].substring(0,10) == ''){\n                            record[e] = '';\n                        }else{\n                            let dt = new Date(record[e]);\n                            record[e] = new Intl.DateTimeFormat('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit' }).format(dt);\n                        }\n                        break;\n                    default:\n                        record[e] = record[e];\n                }\n            });\n        }\n        arr = tableData;\n    }\n    let html = '';\n    for(item of arr){\n        if(searchDialogData.multiple  || searchDialogData.dialogId.includes('_multiple')){\n            html += '<tr tabindex=\"0\"><td class=\"searchTd bgc\"><input type=\"checkbox\" ></td>';\n        }else{\n            html += '<tr tabindex=\"0\">';\n        }\n        searchDialogData.toColumns.forEach((e,i) => {\n            if('alignment' in e && 'hidden' in e){\n                html += `<td class=\"searchTd bgc\" style='display:none; text-align:${e.alignment}' >${item[e.ColumnName]}</td>`\n            }\n            else if('alignment' in e){\n                html += `<td class=\"searchTd bgc\" style='text-align:${e.alignment}' >${item[e.ColumnName]}</td>`\n            }\n            else if('hidden' in e){\n                html += `<td class=\"searchTd bgc\" style='display:none;' >${item[e.ColumnName]}</td>`\n            }\n            else{\n                html += `<td class=\"searchTd bgc\">${item[e.ColumnName]}</td>`\n            }\n        });\n        html += \"</tr>\";\n    }\n\n    // 追加する\n    $(`#${dialogId}_${searchDialogData.tableId}_readTable tbody tr`).remove();\n    $(`#${dialogId}_${searchDialogData.tableId}_readTable tbody`).append(html);\n    $(`#${dialogId}_${searchDialogData.tableId}_readTable tbody`).children().eq(0).focus();\n\n    hideLoading();\n}\n\nconst fetchSql = async (query) => {\n    try {\n        showLoading()\n\n        const response = await fetch(SQL_URL, {\n            method: 'POST',\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n                query: query\n            })\n        });\n\n        if (!response.ok) {\n            // レスポンスがエラーの場合\n            throw new Error(`HTTP error! status: ${response.status}`);\n        }\n\n        const data = await response.json();\n        return data;\n    } catch (err) {\n        alert('SQLでエラーが発生しました。' + err);\n        console.error(\"SQLエラー:\", err);\n        return { err: \"Failed to execute SQL query.\" };\n    } finally {\n        hideLoading();\n    }\n\n};\nconst fetchStored = async (param) =>{\n    try {\n        showLoading()\n\n        let response =  await fetch(STORED_PROCEDURE_URL,{\n            method:\"POST\",\n            headers:{\n                \"content-type\":'application/json',\n            },\n            body:JSON.stringify(param)\n        })\n        if(!response.ok){\n            throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        response =  await response.json();\n        return response\n    } catch(err) {\n        alert('ストアドプロシージャでエラーが発生しました。' + err);\n        console.error(\"ストアドエラー:\", err);\n        return { err: \"Failed to execute stored query.\" };\n    } finally {\n        hideLoading();\n    }\n\n}\n\nconst fetchRenderForm = async (param) => {\n    try {\n        showLoading()\n        // クエリーパラメータに変換\n        const queryString = new URLSearchParams(param).toString();\n        const url = `${RENDER_FORM_URL}?${queryString}`;\n\n        // APIの状態チェック\n        const response = await fetch(url);\n        if (!response.ok) {\n            throw new Error(`API error: ${response.status}`);\n        }\n\n        // APIが正常な場合のみ新しいタブを開く\n        window.open(url, '_blank');\n\n    } catch (err) {\n        alert('入力画面生成でエラーが発生しました。' + err);\n        console.error(\"入力画面生成エラー:\", err);\n        return { err: \"Failed to execute input form.\" };\n    } finally {\n        hideLoading();\n    }\n}\n\nconst createWhere = obj =>{\n    let whereStr = 'WHERE 0=0 ';\n    Object.keys(obj).forEach(e =>{\n        if(obj[e] == '' || typeof(obj[e]) === \"undefined\"){\n            return '';\n        }\n        else if(typeof(obj[e]) == 'object'){\n            // fromよりtoのほうが大きい場合は入れ替え\n            let from = obj[e][\"from\"];\n            let to = obj[e][\"to\"];\n            if(from != '' && to != '' && from > to) [from,to] = [to,from];\n\n            // from,toに値がある場合はbetween,片方の場合は比較演算子\n            if(from != '' && to != ''){\n                whereStr += `AND ${e} BETWEEN '${from}' AND '${to}'`;\n            }else if(from != ''){\n                whereStr += `AND ${e} >= '${from}'`;\n            }else if(to != ''){\n                whereStr += `AND ${e} <= '${to}'`;\n            }\n        }\n        else{\n            whereStr += `AND ${e} LIKE '%${obj[e]}%'`;\n        }\n    })\n    return whereStr;\n}\n\nconst resMold = (res,dialogData) => {\n    for(record of res){\n        // 日付はyyyy/mm/dd形式にして代入、Numでnullの場合は0に置換して代入\n        dialogData.toColumns.forEach(e =>{\n            if(record[e.ColumnName] === null){\n                record[e.ColumnName] = '';\n            }\n            else if(typeof record[e.ColumnName] === \"undefined\"){\n                record[e.ColumnName] = '';\n            }\n            else if(e.type == 'time'){\n                record[e.ColumnName] = new Date(record[e.ColumnName]).toLocaleString('sv-SE').replaceAll('-','/');\n            }\n            else if(/^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:\\.\\d+)?$/.test(record[e.ColumnName])){\n                let tmpDt = new Date(record[e.ColumnName]);\n                record[e.ColumnName] = new Intl.DateTimeFormat('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit' }).format(tmpDt);\n            }\n            else if(\"alignment\" in e){\n                record[e.ColumnName] = record[e.ColumnName].toLocaleString();\n                // record[e.ColumnName] = Number(record[e.ColumnName]).toLocaleString();\n            }\n            else{\n                record[e.ColumnName] = record[e.ColumnName];\n            }\n        });\n    }\n    return res;\n}\n\n\nconst createWhereParam = (dialogData) =>{\n    let tmp     = {};\n    dialogData.options.forEach(e =>{\n        let fullId =  'fullId' in e ? e.fullId : dialogData.dialogId + \"_\" + e.id;\n        if(e.type == 'range-text' && \"alignment\" in e){\n            let fromVal = $(`#${fullId}From`).val().replaceAll(',','');\n            let toVal   = $(`#${fullId}To`).val().replaceAll(',','');\n            if((fromVal == '' && toVal == '') || !/^\\d*$/.test(fromVal) || !/^\\d*$/.test(toVal)){\n                tmp[e.searchColumn] = '';\n            }else{\n                tmp[e.searchColumn] = {from:Number(fromVal),to:Number(toVal)};\n            }\n        }\n        else if(e.type.slice(0,5) == 'range'){\n            let fromVal = $(`#${fullId}From`).val();\n            let toVal   = $(`#${fullId}To`).val();\n            if(fromVal == '' && toVal == ''){\n                tmp[e.searchColumn] = '';\n            }else{\n                tmp[e.searchColumn] = {from:fromVal,to:toVal};\n            }\n        }\n        else if(e.type == 'text-set'){\n            tmp[e.searchColumn] = $(`#${fullId}From`).val();\n        }\n        else{\n            tmp[e.searchColumn] = $(`#${fullId}`).val();\n        }\n    })\n    return tmp;\n}\n\n// 簡単なsql用の変数（汎用）\nasync function requestSQL(dialogData){\n\n    // sql文作成\n    // 足し算やcase句など特殊な処理はspecialTermsというパラメータがあるのでそちらを使用\n    let select  = 'selectStr' in dialogData ? dialogData.selectStr :dialogData.toColumns.map(e => {\n        if('specialTerms' in e){\n            return e.specialTerms;\n        }else{\n            return e.ColumnName;\n        }\n    }).join(',');\n    let from    = 'fromStr' in dialogData ? dialogData.fromStr : dialogData.searchTableId;\n\n    // where作成\n    let tmp     = createWhereParam(dialogData);\n    let where = createWhere(tmp);\n\n    if(dialogData.dialogId.includes('estimateNoSearch')){\n        where += \"ORDER BY 見積日付 DESC, 見積番号 DESC\";\n    }\n    let sql = `SELECT TOP 1000 ${select} FROM ${from} ${where}`;\n\n    let res;\n    try{\n        res = await fetchSql(sql);\n    }catch{\n        return;\n    }\n\n    res = res.results;\n\n    // 成形\n    return resMold(res,dialogData);\n\n}\n\n// 複雑なsql用の関数（個別作成）\nasync function requestIndividualSQL(dialogData){\n    // where作成\n    let tmp     = createWhereParam(dialogData);\n    let where = createWhere(tmp);\n    let sql;\n    // if('estimateNoSearch3'.includes(dialogData.dialogId)){\n    if(['estimateNoSearch3','estimateNoSearch3_multiple'].includes(dialogData.dialogId)){\n\n        let copy_dialogData = JSON.stringify(dialogData);\n        copy_dialogData = JSON.parse(copy_dialogData);\n        copy_dialogData.options = [\n            {searchColumn: 'MS.仕入先CD', type: 'range-text', id: 'supplierCD'}\n        ];\n        where2_param = createWhereParam(copy_dialogData);\n        let where2 = createWhere(where2_param);\n\n        sql = estimateNoSearch3_baseSQL(where,where2).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['estimateNoSearch4','estimateNoSearch4_multiple'].includes(dialogData.dialogId)){\n        sql = estimateNoSearch4_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['estimateNoSearch5','estimateNoSearch5_multiple'].includes(dialogData.dialogId)){\n        sql = estimateNoSearch5_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['mirrorSearch',\"mirrorSearch_multiple\"].includes(dialogData.dialogId)){\n        sql = mirrorSearch_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['urikakeKakuninSearch'].includes(dialogData.dialogId)){\n        sql = urikakeKakunin_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['productSearch1'].includes(dialogData.dialogId)){\n        sql = productSearch1_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['productSearch2'].includes(dialogData.dialogId)){\n        sql = productSearch2_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if('progressCheck'.includes(dialogData.dialogId)){\n        // 売上種別\n        let salesType = '';\n        switch($('#progressCheck_processingCategoryFrom').val()){\n            case '0':\n                salesType = ' AND (MHK.発注書発行日付 IS NULL AND MT.仕入日付 IS NULL)';\n                break;\n            case '1':\n                salesType = 'AND MHK.発注書発行日付 IS NOT NULL';\n                break;\n            case '2':\n                salesType = \"AND MT.売上日付 IS NOT NULL\";\n                break;\n        }\n\n        // 見積確定区分\n        let finalClassification = '';\n        switch($('#progressCheck_confirmationEstimateDatesFrom').val()){\n            case '0':\n                finalClassification = \"AND ISNULL(MHK.見積確定区分,0) = 0\";\n                break;\n            case '1':\n                finalClassification = \"AND ISNULL(MHK.見積確定区分,0) = 1\";\n        }\n        where += salesType + finalClassification;\n        sql = progressCheck_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    // 入金消込入力はストアドのため特殊処理\n    else if('ReceiptEntry'.includes(dialogData.dialogId)){\n\n        await receiptEntry_stored();\n        return null;\n    }\n    // 売上入力\n    else if('salesInput'.includes(dialogData.dialogId)){\n\n    }\n    // 売掛消費税調整入力\n    else if(['ReceivableSalesTaxAdjustmentEntrySearch'].includes(dialogData.dialogId)){\n        sql = ReceivableSalesTaxAdjustmentEntrySearch_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n\n    // 売掛消費税調整入力\n    else if(['ReceivableSalesTaxAdjustmentEntry'].includes(dialogData.dialogId)){\n        sql = ReceivableSalesTaxAdjustmentEntry_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    \n    // 経費入力\n    else if(['ExpenseEntrySearch'].includes(dialogData.dialogId)){\n\n        let personCD = '';\n        let personCDFrom = $('#ExpenseEntrySearch_personCDFrom').val();\n        let personCDTo = $('#ExpenseEntrySearch_personCDTo').val();\n        \n        // 担当者Fromのみ入力\n        if(!personCDFrom == '' && personCDTo == ''){\n            personCD = `AND KH.経費番号 IN (SELECT DISTINCT 経費番号 FROM TD経費明細 WHERE 担当者CD >= '${personCDFrom}')`;\n        }\n        // 担当者Toのみ入力\n        else if(personCDFrom == '' && !personCDTo == ''){\n            personCD = `AND KH.経費番号 IN (SELECT DISTINCT 経費番号 FROM TD経費明細 WHERE 担当者CD <= '${personCDTo}')`;\n        }\n        // 担当者FromTo\n        else if(!personCDFrom == '' && !personCDTo == ''){\n            personCD = `AND KH.経費番号 IN (SELECT DISTINCT 経費番号 FROM TD経費明細 WHERE 担当者CD BETWEEN '${personCDFrom}' AND '${personCDTo}')`;\n        }\n        \n        where += personCD\n\n        sql = ExpenseEntrySearch_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n\n\n    }\n\n    let res;\n    try{\n        res = await fetchSql(sql);\n    }catch{\n        return;\n    }\n\n    res = res.results;\n    return resMold(res,dialogData);\n}\n\n// apiget用のColumnFilterHashとColumnFilterSearchTypesを作成する関数\nfunction create_filter(e,dialogId){\n    let res = {};\n    switch(e.type){\n        case 'text':\n            let val = $(`#${dialogId}_${e.id}`).val();\n            // エラー処理\n            if(val == ''){\n                return {};\n            }\n            res =  {column:e.searchColumn,text:val,searchType:'PartialMatch'};\n            break;\n        case 'number':\n            num = $(`#${dialogId}_${e.id}`).val().replaceAll(',','');\n            // エラー処理\n            if(num == ''){\n                return {};\n            }\n            res =  {column:e.searchColumn,text:num,searchType:'ExactMatch'};\n            break;\n        case 'range-text':\n            let fromVal = $(`#${dialogId}_${e.id}From`).val();\n            let toVal = $(`#${dialogId}_${e.id}To`).val();\n\n            if(fromVal == '' && toVal == ''){\n                return {};\n            }\n\n            // 検索先項目がNumかどうかで処理を分ける\n            let arr = [];\n            if(e.searchColumn.substring(0,3) == 'Num'){\n                arr = JSON.stringify([`${fromVal},${toVal}`]);\n\n            }\n            else{\n                // 数値項目ではない場合。数値化して全パターン取得\n                fromVal = fromVal == '' ? \"0\".repeat(e.digitsNum) : fromVal;\n                toVal = toVal == '' ? \"9\".repeat(e.digitsNum):toVal;\n\n                for(i = Number(fromVal); i <= Number(toVal); i++){\n                    arr.push(String(i).padStart(e.digitsNum,'0').slice(`-${e.digitsNum}`));\n                }\n                arr = JSON.stringify(arr);\n            }\n            res = {column:e.searchColumn,text:arr,searchType:'ExactMatchMultiple'}\n            break;\n        case 'range-number':\n            let fromNum = $(`#${dialogId}_${e.id}From`).val();\n            let toNum = $(`#${dialogId}_${e.id}To`).val();\n\n            if(fromNum == '' && toNum == ''){\n                return {};\n            }\n            let numArr = JSON.stringify([`${fromNum},${toNum}`]);\n            res = {column:e.searchColumn,text:numArr,searchType:'ExactMatchMultiple'}\n\n\n            break;\n        case 'datepicker':\n\n            let dt = $(`#${dialogId}_${e.id}`).val();\n            if(dt == ''){\n                return {};\n            }\n            res = {column:e.searchColumn,text:JSON.stringify([dt.replace('-','/')]),searchType:'ExactMatch'}\n            break;\n        case 'range-date':\n            let dtFrom = $(`#${dialogId}_${e.id}From`).val();\n            let dtTo = $(`#${dialogId}_${e.id}To`).val();\n\n            if(dtFrom == '' && dtTo == ''){\n                return {};\n            }\n\n            let dates = JSON.stringify([`${dtFrom.replaceAll('-','/')},${dtTo.replaceAll('-','/')}`]);\n            res =  {column:e.searchColumn,text:dates,searchType:'ExactMatchMultiple'};\n            break;\n    }\n    return res;\n}\n\n// 選択されたときの処理\n$(document).on('click','tr:has(\".searchTd\")',function(e){\n\n\n    let item = $(this);\n\n    // ふくすう選択ダイアログなら処理終了\n    if(item.children().eq(0).children().eq(0).attr('type')){\n        // inputがクリックされていたら処理終了\n        if($(e.target).is('input')){\n            return;\n        }\n        item.find('input:first').prop('checked', function( index, prop ){\n            return !prop;\n        });\n        return;\n    }\n\n    if(searchOutputId.length == 0 || searchOutputId[searchOutputId.length -1].id == \"\")return;\n\n    if(searchOutputId[searchOutputId.length - 1].id == \"changeProductDialog_productNo\"){\n        $(`#changeProductDialog_productNo`).val(item.children().eq(0).text().replaceAll(' ',''));\n        $(`#changeProductDialog_methodNo`).val(item.children().eq(1).text().replaceAll(' ',''));\n        $(`#changeProductDialog_productName`).val(item.children().eq(2).text().replaceAll(' ',''));\n    }\n    else if(searchOutputId[searchOutputId.length - 1].id == \"changeProductDialog_AfterChangeNo\" ){\n        $(`#changeProductDialog_AfterChangeNo`).val(item.children().eq(0).text().replaceAll(' ',''));\n        $(`#changeProductDialog_AfterMethodNo`).val(item.children().eq(1).text().replaceAll(' ',''));\n        $(`#changeProductDialog_AfterProductName`).val(item.children().eq(2).text().replaceAll(' ',''));\n    }\n    else{\n        $(`#${searchOutputId[searchOutputId.length -1].id}`).val(item.children()[0].textContent).trigger('input');\n    }\n\n    $(`#${searchOutputId[searchOutputId.length -1].dialogId}Dialog tbody`).html('');\n    $(`#${searchOutputId[searchOutputId.length -1].dialogId}Dialog`).dialog('close');\n    searchOutputId.pop();\n})\n\n// マウスオーバー時のイベント\n$(document).on('mouseover','.bgc',function(){\n    $('.bgc').parent().css('background-color','');\n    $(this).parent().css('background-color','silver')\n})\n$(document).on('mouseout','.bgc',function(){\n    $('.bgc').parent().css('background-color','');\n})\n\n// ダイアログを閉じるボタンが押された時の処理\n$(document).on('click','.ui-dialog-titlebar-close',function(){\n    let elem = $(this).parent().parent().next();\n    var prevObjectElement = elem.prevObject[0];\n\n    // prevObjectElementの子要素の中に'searchDialog'クラスを持つ要素があるかをチェック\n    var hasSearchDialogClass = $(prevObjectElement).children().hasClass('searchDialog');\n    if(hasSearchDialogClass){\n        searchOutputId.pop();\n    }\n})\n\n// エスケープで閉じる機能を廃止のためコメントアウト\n// escapeが押されたらsearchOutputIdの末尾を削除\n// $(document).keydown(async function(e){\n//     const key = e.keyCode;\n//     if(key != 27){\n//         return;\n//     }\n//     // dialogでエスケープキーを閉じるときのバリデーション対策\n//     now_varidate_flg = true;\n//     await sleep(0);\n//     now_varidate_flg = false;\n//     searchOutputId.pop();\n\n//     // 閉じたdialogを削除\n// })\n\n// 複数選択ダイアログで、チェックマークが入っている項目をカンマ区切りで呼出元項目に入力する関数\nfunction resultInput(event){\n\n\n    let items = Array.from($(`#${searchOutputId[searchOutputId.length-1].dialogId}Dialog tbody input[type=\"checkbox\"]:checked`));\n\n    if(items.length == 0){\n        alert('選択されていません。');\n        return;\n    }\n\n    let resText = items.map(e => $(e).parent().parent().children().eq(1).text()).join(',');\n    $(`#${searchOutputId[searchOutputId.length -1].id}`).val(resText).trigger('input');\n    $(`#${searchOutputId[searchOutputId.length -1].dialogId}Dialog`).dialog('close');\n    searchOutputId.pop();\n}\n\n$(document).on('click','.ui-dialog-titlebar-close',function(){\n    let element = $(this).parent().parent();\n    element.find('table.searchTable tbody').html('');\n})\n\n$(document).on('keydown','tr:has(\".searchTd\")',function(e){\n    if(e.which == 13){\n        $(this).trigger('click');\n    }\n})",
            "Id": 13
          },
          {
            "Title": "22_ダイアログ共通.js",
            "New": true,
            "Edit": true,
            "Body": "//lookupするための情報と、どの検索ダイアログを開くかの情報を格納\nlet lookups = [];\n\n// 現在開いているダイアログの情報（古い順に入ってる）\nlet searchOutputId = [];\n\n// 各検索ダイアログの情報。ダイアログ作成時に作成\nlet searchArr = [\n    // {dialogId:'estimateNoSearch',searchTableId:'1273239',options:[\n    //         {type:\"range-text\",id:'estimateNo',searchColumn:'ClassA',digitsNum:6},\n    //         {type:\"range-date\",id:'billingDate',searchColumn:'DateB'},\n    //         {type:\"text\",id:'custmerCD',searchColumn:'ClassP'},\n    //         {type:\"range-number\",id:'AllMoney',searchColumn:'NumA'},\n    //         {type:\"range-date\",id:'estimateDate',searchColumn:'DateA'},\n    //         {type:\"text\",id:'estimateName',searchColumn:'ClassJ'},\n    //     ]\n    // }\n];\n\n// ダイアログが開かれた時間を格納\nlet dialog_openTime;\n\nconst styleElement = document.createElement('style');\nstyleElement.textContent = `\n    .loading-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.5);\n        z-index: 9999;\n        display: none;\n        justify-content: center;\n        align-items: center;\n    }\n\n    .loading-spinner {\n        width: 50px;\n        height: 50px;\n        border: 5px solid #f3f3f3;\n        border-top: 5px solid #3498db;\n        border-radius: 50%;\n        animation: spin 1s linear infinite;\n    }\n\n    @keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n    }\n\n    .searchDialog input:disabled,\n    .dialog input:disabled,\n    .dialog select:disabled,\n    .dialog textarea:disabled {\n        background-color: #f0f0f0;\n        color: #888;\n        cursor: not-allowed;\n    }\n    .dialog .error {\n        border: 1px solid red;\n    }\n    .dialog .error-message {\n        color: red;\n        font-size: 0.8em;\n        margin-top: 5px;\n    }\n    .field-wide {\n        width: 100%;\n        max-width:800px;\n    }\n    .field-normal {\n        width: 60%;\n        max-width:450px;\n    }\n    .both {\n        clear: both;\n        min-height:37px;\n        padding-bottom:5px;\n        height:37px;\n    }\n    .range-container {\n        display: flex;\n        align-items: center;\n    }\n    .range-input {\n        flex-grow: 1;\n        margin: 0 10px;\n        -webkit-appearance: none;\n        width: 100%;\n        height: 5px;\n        background: #d3d3d3;\n        outline: none;\n        opacity: 0.7;\n        transition: opacity .2s;\n    }\n    .range-input:hover {\n        opacity: 1;\n    }\n    .range-input::-webkit-slider-thumb {\n        -webkit-appearance: none;\n        appearance: none;\n        width: 15px;\n        height: 15px;\n        background: #4CAF50;\n        cursor: pointer;\n        border-radius: 50%;\n    }\n    .range-input::-moz-range-thumb {\n        width: 15px;\n        height: 15px;\n        background: #4CAF50;\n        cursor: pointer;\n        border-radius: 50%;\n    }\n    .range-label {\n        min-width: 30px;\n        text-align: center;\n    }\n    .range-text-container {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .oneItem{\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .text-set{\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .range-text-input {\n        width: 45%;\n    }\n    .range-text-separator {\n        margin: 0 10px;\n    }\n    .SdtRequired::after {\n        content: \"*\";\n        color: red;\n        margin-left: 3px;\n    }\n    .radioButton{\n        padding-top:7px;\n    }\n    .radioButton input[type=\"radio\"]{\n        vertical-align: sub;\n    }\n    .inputText{\n        width:20%;\n    }\n    .disableText{\n        width:80%;\n    }\n    .SdtTime{\n        /* position: absolute;\n        top:9px;\n        right:-17px;\n        z-index: 10; */\n        cursor:pointer;\n    }\n    .ui-icon-search{\n        position: absolute;\n        top:9px;\n        right:-17px;\n        z-index: 10;\n        cursor:pointer;\n    }\n    .ui-icon-close{\n        position: absolute;\n        top:9px;\n        right:-33px;\n        z-index: 10;\n        cursor: pointer;\n    }\n    .search{\n        position:static;\n    }\n    .button-small {\n        background: linear-gradient(145deg, #f8f8f8, #efefef);\n        border-radius: 5px;\n        color: #555;\n        text-align: center;\n        cursor: pointer;\n        transition: all 0.15s ease;\n    }\n    .button-small:hover {\n        background: linear-gradient(145deg, #f2f2f2, #e8e8e8);\n    }\n    .button-small:active {\n        background: linear-gradient(145deg, #e8e8e8, #f2f2f2);\n        transform: translateY(0.5px);\n    }\n    td > input:focus{\n        border:none;\n        background-color:white;\n    }\n    td > input:focus-visible {\n        outline:none;\n        box-shadow:none;\n    }\n    tr:focus{\n        border:none;\n        background-color: #d3d3d3;\n    }\n    tr:focus-visible{\n        outline: none;\n    }\n    .table {\n        border-collapse: separate;/*collapseから変更*/\n        border-spacing: 0;\n        border-radius: 5px 5px 0 0;\n        /* overflow: hidden; */\n    }\n\n    .table thead th,\n    .table tbody td {\n        border-bottom: 1px solid rgb(192, 192, 192);/*一括指定せず、border-bottomのみ*/\n        border-left: 1px solid rgb(192, 192, 192);\n    }\n    .table tr th:first-child,\n    .table tbody tr td:first-child {\n        border-left: none;\n    }\n    td{\n        width:auto;\n    }\n    .input_table input:disabled{\n        background-color:white;\n    }\n\n`;\n// スタイルを追加\ndocument.head.appendChild(styleElement);\n\n// フィールド作成の関数\nconst createField = (dialogId, type, id, label, options = {},multipleFlg = false) => {\n    const fullId = `${dialogId}_${id}`;\n    if (document.getElementById(fullId)) {\n        let message = `フィールドID \"${fullId}\" は既に存在します。一意のIDを使用してください。`;\n        alert(message)\n        throw new Error(message);\n    }\n\n    const hiddenAttr = options.hidden ? 'display:none':\"\";\n    const disabledAttr = options.disabled ? 'disabled' : '';\n    const requiredAttr = options.required ? 'required' : '';\n    const additionalAttrs = Object.entries(options.attributes || {})\n        .map(([key, value]) => `${key}=\"${value}\"`)\n        .join(' ');\n    const widthClass = options.width === 'wide' ? 'field-wide' : 'field-normal';\n    const requiredClass = requiredAttr == 'required' ? \"SdtRequired\" : '';\n    const maxLength = options.varidate && 'maxlength' in options.varidate ? options.varidate.maxlength : null;\n    const maxlengthForNumberClass = type == 'number' && options.varidate && 'maxlength' in options.varidate ? `maxlength_for_number` : \"\";\n    \n    // バリデーション\n    let varidateClass = \"\";\n    let numOnlyClass = \"\";\n    if(options.varidate && options.varidate.type == \"int\"){\n        varidateClass = 'varidate_int';\n        numOnlyClass = options.searchDialog || ('alignment' in options && options.alignment == 'end') ? \"numOnly\" : \"\";\n    }\n    else if(options.varidate && options.varidate.type == 'zeroPadding'){\n        varidateClass = 'varidate_zeroPadding';\n        numOnlyClass = options.searchDialog ? \"numOnly\" : \"\";\n    }\n    else if(options.varidate && options.varidate.type == 'str'){\n        varidateClass = 'varidate_str';\n    }\n\n    if(['text-set','select','radio'].includes(type) && !('values' in options) && !('searchDialog' in options)  && !(options.disabled)){\n        let message = `ダイアログ名:\"${dialogId}\"　項目ID:\"${id}\" の選択肢（values）を指定してください`;\n        alert(message)\n        throw new Error(message);\n    }\n\n    let t_head = '';\n    let fieldHTML = '';\n    switch(type) {\n        case 'text':\n        case 'number':\n        case 'email':\n\n            const initializeClass = options.value ? 'initialize_target':'';\n\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\" >\n                        <div class=\"container-normal\">\n                            <div class=\"oneItem\">\n                                <input id=\"${fullId}\" name=\"${fullId}\" class=\"control-textbox ${numOnlyClass} ${initializeClass} ${'alignment' in options && options.alignment == 'end' ? 'input-Number' :''} ${maxlengthForNumberClass} ${varidateClass}\" type=\"${type}\"\n                                    ${options.placeholder ? `placeholder=\"${options.placeholder}\"` : ''}\n                                    ${options.value ? `value=\"${options.value}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}\n                                    ${maxLength != null ? `maxlength='${maxLength}'` : ''}\n                                    style='${'alignment' in options ? `text-align:${options.alignment}` : ''}'\n                                >\n                                ${options.unit ?`<div style=\"font-size:12px; padding-left: 3px;\">${options.unit}</div>`: ''}\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-search dialogSearch ${varidateClass}\" style=\"position:static\" tabindex=\"0\"></div>`: ''}\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}')\"style=\"position:static\"></div>`: ''}\n                        </div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'select':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <select id=\"${fullId}\" name=\"${fullId}\" class=\"control-dropdown\"\n                                ${options.onchange ? `onchange=\"${options.onchange}('${dialogId}', '${id}')\"` : ''}\n                                ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                                <option value=\"\">&nbsp;</option>\n                                ${options.values ? options.values.map(opt => `<option value=\"${opt.value}\" ${opt.selected ? 'selected' : ''}>${opt.text}</option>`).join('') : ''}\n                            </select>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'datepicker':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"${fullId}\" name=\"${fullId}\" class=\"control-textbox ${varidateClass}\" type=${options.format ? options.format : \"date\"} max=\"${options.format && options.format == 'month' ? '9999-12':'9999-12-31'}\"\n                                ${options.placeholder ? `placeholder=\"${options.placeholder}\"` : ''}\n                                ${options.value ? `value=\"${options.value}\"` : ''}\n                                autocomplete=\"off\"\n                                ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                            <div class=\"ui-icon ui-icon-clock SdtTime\" style=\"position:static\"></div>\n                        </div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'textarea':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"field-wide both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <div id=\"${fullId}_viewer\" class=\"control-markup not-send\" ondblclick=\"editMarkdown('${dialogId}', '${id}');\">\n                                <pre>${options.value ? options.value : '<br>'}</pre>\n                            </div>\n                            <div id=\"${fullId}.editor\" class=\"ui-icon ui-icon-pencil button-edit-markdown\" onclick=\"editMarkdown('${dialogId}', '${id}');\">\n                            </div>\n                            <textarea id=\"${fullId}\" name=\"${fullId}\" class=\"control-markdown\" tabindex=\"-1\"\n                                ${options.placeholder ? `placeholder=\"${options.placeholder}\"` : ''}\n                                style=\"height: 100px; display: none;\"\n                                ${disabledAttr} ${requiredAttr} ${additionalAttrs}>${options.value ? options.value : ''}</textarea>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'checkbox':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <input id=\"${fullId}\" name=\"${fullId}\" type=\"checkbox\"\n                                ${options.checked ? 'checked' : ''}\n                                ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                            <label for=\"${fullId}\" class=\"${requiredClass}\">${label}</label>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'radio':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label ${requiredClass}\" >${label}</p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal radioButton\">\n                            ${options.values ? options.values.map(opt => `\n                                <input type=\"radio\" id=\"${fullId}_${opt.value}\" name=\"${fullId}\" value=\"${opt.value}\"\n                                    ${opt.checked ? 'checked' : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                                <label for=\"${fullId}_${opt.value}\">${opt.text}</label>\n                            `).join('') : ''}\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'range':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}\"  class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <div class=\"range-container\">\n                                <span class=\"range-label\">${options.min || 0}</span>\n                                <input id=\"${fullId}\" name=\"${fullId}\" class=\"range-input\" type=\"range\"\n                                    min=\"${options.min || 0}\" max=\"${options.max || 100}\"\n                                    value=\"${options.value || options.min || 0}\"\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}\n                                    oninput=\"document.getElementById('${fullId}Value').textContent = this.value\">\n                                <span class=\"range-label\">${options.max || 100}</span>\n                            </div>\n                            <div id=\"${fullId}Value\" style=\"text-align: center;\">${options.value || options.min || 0}</div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'range-text':\n        case 'range-number':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}From\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <div class=\"range-text-container\">\n                                <input id=\"${fullId}From\" name=\"${fullId}From\" class=\"control-textbox range-text-input ${numOnlyClass} ${'alignment' in options && options.alignment == 'end' ? 'input-Number' :''} ${maxlengthForNumberClass} ${varidateClass}\" type=\"${type=='range-text'?'text':'number'}\"\n                                    ${options.placeholderFrom ? `placeholder=\"${options.placeholderFrom}\"` : ''}\n                                    ${options.valueFrom ? `value=\"${options.valueFrom}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}\n                                    style='${'alignment' in options ? `text-align:${options.alignment}` : ''}'\n                                    ${maxLength != null ? `maxlength='${maxLength}'` : ''}\n                                >\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-search dialogSearch ${varidateClass}\" style=\"position:static\" tabindex=\"0\"></div>`: ''}\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}From')\"  style=\"position:static\"></div>`: ''}\n                                <span class=\"range-text-separator\">${options.betweenString ? options.betweenString : '～'}</span>\n                                <input id=\"${fullId}To\" name=\"${fullId}To\" class=\"control-textbox range-text-input ${numOnlyClass} ${'alignment' in options && options.alignment == 'end' ? 'input-Number' :''} ${maxlengthForNumberClass} ${varidateClass}\" type=\"${type=='range-text'?'text':'number'}\"\n                                    ${options.placeholderTo ? `placeholder=\"${options.placeholderTo}\"` : ''}\n                                    ${options.valueTo ? `value=\"${options.valueTo}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}\n                                    style='${'alignment' in options ? `text-align:${options.alignment}` : ''}'\n                                    ${maxLength != null ? `maxlength='${maxLength}'` : ''}\n                                >\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-search dialogSearch ${varidateClass}\" style=\"position:static\" tabindex=\"0\"></div>`: ''}\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}To')\"  style=\"position:static\"></div>`: ''}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'range-date':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}From\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <div class=\"range-text-container\">\n                                <input id=\"${fullId}From\" name=\"${fullId}From\" class=\"control-textbox ${varidateClass}\" type=${options.format ? options.format : \"date\"} max=\"${options.format && options.format == 'month' ? '9999-12':'9999-12-31'}\"\n                                    ${options.placeholderFrom ? `placeholder=\"${options.placeholderFrom}\"` : ''}\n                                    ${options.valueFrom ? `value=\"${options.valueFrom}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                                <span class=\"range-text-separator\">～</span>\n                                <input id=\"${fullId}To\" name=\"${fullId}To\" class=\"control-textbox ${varidateClass}\" type=${options.format ? options.format : \"date\"} max=\"${options.format && options.format == 'month' ? '9999-12':'9999-12-31'}\"\n                                    ${options.placeholderTo ? `placeholder=\"${options.placeholderTo}\"` : ''}\n                                    ${options.valueTo ? `value=\"${options.valueTo}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'text-set':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"field-wide both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}From\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <div class=\"text-set\">\n                                <input id=\"${fullId}From\" name=\"${fullId}From\" class=\"control-textbox inputText ${varidateClass}\" type=\"${'type' in options ? options.type : 'text'}\"\n                                    ${options.placeholderFrom ? `placeholder=\"${options.placeholderFrom}\"` : ''}\n                                    ${options.valueFrom ? `value=\"${options.valueFrom}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}\n                                    ${maxLength != null ? `maxlength='${maxLength}'` : ''}\n                                >\n                                <input id=\"${fullId}To\" name=\"${fullId}To\" value=\"${options.values ? options.values.map(e => e.value + \":\" + e.text).join(' '):''}\" class=\"control-textbox disableText\" type=\"text\" disabled>\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-search dialogSearch ${varidateClass}\" style=\"position: static;\" tabindex=\"0\"></div>`: ''}\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}From')\"style=\"position: static;\"></div>`: ''}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'button_block':\n            fieldHTML = `\n                <div style=\"width:80%; display: flex;justify-content: end; margin-bottom:10px;\">\n                    <button id=${fullId} class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" data-icon=\"ui-icon-disk\" type=\"button\" style=\"z-index: 9999;\" onclick=\"${options.onclick}\">\n                        <span class=\"ui-button-icon ui-icon ui-icon-disk \" style=\"position: static;\"></span>\n                        <span class=\"ui-button-icon-space\"> </span>${label}\n                    </button>\n                </div>\n            `\n            break;\n        case 'button_inline':\n            fieldHTML = `\n                <button id=${fullId} class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" data-icon=\"ui-icon-disk\" type=\"button\" style=\"z-index: 9999; ${hiddenAttr}\" onclick=\"${'onclick' in options ? options.onclick : ''}\">\n                    <span class=\"ui-button-icon ui-icon ui-icon-disk \" style=\"position: static;\"></span>\n                    <span class=\"ui-button-icon-space\"> </span>${label}\n                </button>\n            `\n            break;\n        case 'buttonTextSet':\n            fieldHTML = `\n                <div class=\"input-button-container\" style=\"clear: both; padding: 10px; border:1px solid #ccc; border-radius: 5px; width: 95%; margin: 0 auto; margin-bottom: 20px;\">\n                    <label for=\"my-input\" class=\"label\" style=\"top:-20px; left:10px; background-color: rgb(254,238,189); padding:0 10px;\">${label}</label>\n                    <span style=\"display: none;\">\n                        <input style=\"display: inline-block; left: 30px; position: absolute;border: 1px solid rgb(192,192,192); width: 75%; height: 24px; border-radius: 5px;\">\n                        <button class=\"button button-icon ui-button ui-corner-all ui-widget applied changePath customized\" type=\"button\" style=\"float: right; top:-4px;\" >\n                            <span class=\"ui-button-icon ui-icon ui-icon-disk\"></span>\n                            <span class=\"ui-icon-disk\"> </span>登録\n                        </button>\n                    </span>\n                    <span>\n                        <span style=\"display: inline-block; left: 30px; position: absolute;\"></span>\n                        <button class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" type=\"button\" style=\"float: right; top:-4px;\" onclick=\"${options.onclick ? options.onclick : ''}\">\n                            <span class=\"ui-button-icon ui-icon ui-icon-disk\"></span>\n                            <span class=\"ui-icon-disk\"> </span>${options.btnLabel}\n                        </button>\n                    </span>\n                </div>\n            `\n            break;\n        case 'ImportFile':\n            fieldHTML = `\n                <div class=\"input-button-container\" style=\"clear: both; padding: 10px; border:1px solid #ccc; border-radius: 5px; width: 95%; margin: 0 auto; margin-bottom: 20px;\">\n                    <label for=\"my-input\" class=\"label\" style=\"top:-20px; left:10px; background-color: rgb(254,238,189); padding:0 10px;\">${label}</label>\n                    <input type=\"file\" id=\"${id}\" accept=\"${options.fileType}\">\n                </div>\n            `\n            break;\n        case 'borderText':\n            fieldHTML = `\n                <div class=\"input-container\" style=\"clear: both; padding: 10px; border:1px solid #ccc; border-radius: 5px; width: 95%; margin: 0 auto;\">\n                    <label for=\"my-input\" class=\"label\" style=\"top:-20px; left:10px; background-color: rgb(254,238,189); padding:0 10px;\">${label}</label>\n                    <span style=\"display: inline-block; left: 30px; position: absolute;\"></span>\n                </div>\n            `\n            break;\n        case 'input-table':\n            // thead作成\n            t_head = '';\n            if(options.multiple || multipleFlg)t_head += `<th style=\"text-align: center;border-collapse: collapse;\" class='inversion'><input type=\"checkbox\" class=\"allCheck\"></th>`;\n            if(options.lineNumber)t_head += `<th>No</th>`\n            t_head += options.t_heads.map(e => `<th style=\"text-align: center;border-collapse: collapse; ${e.width ?'width:'+ e.width + \";\":''}\">${e.label}</th>`).join('');\n            // tbody作成\n            let t_body = '';\n            columnCou = options.t_heads.length;\n            for(i = 0;i < options.row;i++){\n                t_body += \"<tr style='background-color:white !important'>\";\n                t_body += options.multiple || multipleFlg ?  `<td class='inversion'><input type='checkbox'></td>` : ``;\n                t_body += options.lineNumber ? `<td style=\"text-align:center;\">${i + 1}</td>` : '';\n                options.t_heads.forEach((e,j) =>{\n                    let for_numItem = false;\n                    if('alignment' in e)for_numItem = true;\n\n                    const maxlength = e.varidate && 'maxLength' in e.varidate ? `maxlength=\"${e.varidate.maxLength}\" `: \"\";\n                    const maxlengthFrom = e.varidateFrom && 'maxLength' in e.varidateFrom ? `maxlength=\"${e.varidateFrom.maxLength}\" `: \"\";\n                    const maxlengthTo = e.varidateTo && 'maxLength' in e.varidateTo ? `maxlength=\"${e.varidateTo.maxLength}\" `: \"\";\n\n                    let varidateClass = \"\";\n                    if(e.varidate && e.varidate.type == \"int\"){\n                        varidateClass = 'varidate_int';\n                    }\n                    else if(e.varidate && e.varidate.type == 'zeroPadding'){\n                        varidateClass = 'varidate_zeroPadding';\n                    }\n                    else if(e.varidate && e.varidate.type == 'str'){\n                        varidateClass = 'varidate_str';\n                    }\n\n                    let varidateFromClass = \"\";\n                    if(e.varidateFrom && e.varidateFrom.type == \"int\"){\n                        varidateFromClass = 'varidate_int';\n                    }\n                    else if(e.varidateFrom && e.varidateFrom.type == 'zeroPadding'){\n                        varidateFromClass = 'varidate_zeroPadding';\n                    }\n                    else if(e.varidateFrom && e.varidateFrom.type == 'str'){\n                        varidateFromClass = 'varidate_str';\n                    }\n\n                    let varidateToClass = \"\";\n                    if(e.varidateTo && e.varidateTo.type == \"int\"){\n                        varidateToClass = 'varidate_int';\n                    }\n                    else if(e.varidateTo && e.varidateTo.type == 'zeroPadding'){\n                        varidateToClass = 'varidate_zeroPadding';\n                    }\n                    else if(e.varidateTo && e.varidateTo.type == 'str'){\n                        varidateToClass = 'varidate_str';\n                    }\n\n\n                    const table_requiredAttr_from = e.requiredFrom ? 'required':'';\n                    const table_requiredAttr_to = e.requiredTo ? 'required':'';\n                    const table_requiredAttr = e.required ? 'required':'';\n                    switch (e.type){\n                        case 'text-set':\n                            const disabled_from   = e.disabled ? 'disabled' : '';\n                            const disabled_to     = 'to_disabled' in e && !e.to_disabled ? '':'disabled';\n                            \n                            t_body += `\n                                <td id=\"${fullId}_${i}_${j}\">\n                                    <input id=\"${fullId}_${i}_${j}_From\" class=\"${`${fullId}_${j}`} ${varidateFromClass} ${for_numItem ? 'input-Number':''}\" type=\"text\" style='border:none; height:50%; \n                                        width:${e.search ? \"calc(100% - 39px)\":'100%'}; ${for_numItem ? `text-align:${e.alignment}`:''}' ${disabled_from} ${maxlengthFrom} ${table_requiredAttr_from}\n                                    >\n                                    ${e.search ? `<div class=\"ui-icon ui-icon-search tableInSearch ${varidateFromClass}\" style=\"position: static;\" tabindex=\"0\"></div>`: ''}\n                                    ${e.search ? `<div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}_${i}_${j}_From')\"style=\"position: static;\"></div>`:''}\n                                    <input type=\"text\" id=\"${fullId}_${i}_${j}_To\" class=\"${for_numItem ? 'input-Number':''} ${varidateToClass} ${`${fullId}_${j}_to`}\"\n                                        style='border: none; border-top:dashed rgb(192,192,192) 1px; height:50%; width:100%; background-color: white;${for_numItem ? `text-align:${e.alignment}`:''}' ${disabled_to}\n                                        ${table_requiredAttr_to}${maxlengthTo}\n                                    >\n                                </td>\n                            `;\n                            break;\n                        case 'date':\n                            t_body += `\n                                <td id=\"${fullId}_${i}_${j}\">\n                                    <input type=\"date\" style='border:none; height:100%; width:100%' ${e.disabled ? 'disabled':''} max=\"9999-12-31\" class=\"${varidateFromClass} ${`${fullId}_${j}`} \"${table_requiredAttr_from}>\n                                    <input type='text' class=\"${`${fullId}_${j}`} ${`${fullId}_${j}_to`} ${varidateToClass}\" style=\"border:none;border-top:dashed rgb(192,192,192) 1px;width:100%;\" ${e.disabled ? 'disabled':''} ${maxlengthTo} ${table_requiredAttr_to}>\n                                </td>`;\n                            break;\n                        case 'dateOnly':\n                            t_body += `\n                                <td id=\"${fullId}_${i}_${j}\">\n                                    <input type=\"date\" style='border:none; height:100%; width:100%'  ${e.disabled ? 'disabled':''} max=\"9999-12-31\" class=\"${`${fullId}_${j}`} ${varidateClass}\" ${table_requiredAttr}>\n                                </td>`;\n                            break;\n                        case 'button':\n                            t_body += `\n                                <td id=\"${fullId}_${i}_${j}\" class=\"button-small\">\n                                    <button\n                                        style=\"width:100%;\"\n                                        ${e.disabled ? 'disabled':''}\n                                    >\n                                        ${e.btn_label ? e.btn_label : 'ボタン'}\n                                    </button>\n                                </td>`;\n                            break;\n                        default:\n                            if(e.search) {\n                                t_body += `\n                                    <td id=\"${fullId}_${i}_${j}\" style=\"height:100%\">\n                                        <input id=\"${fullId}_${i}_${j}_From\" class=\"${`${fullId}_${j}`} ${varidateClass}\" type=\"text\" style='border:none;width:calc(100% - 39px); height:100%; ${for_numItem ? `text-align:${e.alignment}`:''}'  ${e.disabled ? 'disabled':''} ${maxlength} ${table_requiredAttr}>\n                                        <div class=\"ui-icon ui-icon-search tableInSearch ${varidateClass}\" style=\"position: static;\" tabindex=\"0\"></div>\n                                        <div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}_${i}_${j}')\"style=\"position: static;\"></div>\n                                    </td>`;\n                            } else {\n                                t_body += `\n                                    <td id=\"${fullId}_${i}_${j}\" style=\"height:100%\">\n                                        <input type=\"text\"  class=\"${`${fullId}_${j}`} ${varidateClass} ${for_numItem ? 'input-Number':''}\" style='border:none; height:100%; width:100%; background-color:white;${for_numItem ? `text-align:${e.alignment}`:''} ' ${e.disabled ? 'disabled': ''} ${maxlength} ${table_requiredAttr}>\n                                    </td>`;\n                            }\n                            break;\n                    }\n                })\n                t_body += \"</tr>\";\n            }\n            fieldHTML = `\n                <div id=\"${fullId}_inputTable\" class=\"input_table ui-dialog-content ui-widget-content\" style=\"display: inline-block; margin-top:20px; width: 98%;margin-left:1%;\">\n                    <div class=\"field-vertical \" style=\"width: 100%;\">\n                        <div class=\"field-control\">\n                            <div class=\"container-selectable\">\n                                <div class=\"wrapper h300\">\n                                    <table class=\"table inputTable\" style=\"height:100%;\">\n                                        <thead style=\"position: sticky; top:0; background-color: gold; z-index:9999\">\n                                            <tr>\n                                                ${t_head}\n                                            </tr>\n                                        <tbody>\n                                            ${t_body}\n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `;\n            break;\n        case 'search-table':\n            t_head = '';\n            if(options.multiple || multipleFlg)t_head += `<th style=\"text-align: center;border-collapse: collapse;\" class='inversion'><input type=\"checkbox\" class=\"allCheck\"></th>`;\n            t_head += options.t_heads.map(e => `<th style=\"text-align: center;border-collapse: collapse; ${e.hidden ? 'display:none;':''}\">${e.label}</th>`).join('');\n            fieldHTML = `\n                <div style=\"width:80%; display: flex;justify-content: end;\">\n                    <button id=\"${fullId}_searchButton\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" data-icon=\"ui-icon-search\" type=\"button\" style=\"z-index: 9999;\" onclick='create_searchList($(this));'>\n                        <span class=\"ui-button-icon ui-icon ui-icon-search search\" style=\"position: static;\"></span>\n                        <span class=\"ui-button-icon-space\"> </span>検索\n                    </button>\n                </div>\n                <div id=\"${fullId}_readTable\" class=\"ui-dialog-content ui-widget-content\" style=\"display: inline-block; margin-top:20px; width: 98%;margin-left:1%;\">\n                    <div class=\"field-vertical \" style=\"width: 100%;\">\n                        <div class=\"field-control\">\n                            <div class=\"container-selectable\">\n                                <div class=\"wrapper h300\">\n                                    <table class=\"table searchTable\">\n                                        <thead style=\"position: sticky; top:0; background-color: gold; z-index:9999\">\n                                            <tr>\n                                                ${t_head}\n                                            </tr>\n                                        </thead>\n                                        <tbody>\n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `;\n            break;\n        case 'free':\n            fieldHTML = options.str;\n            break;\n    }\n    return fieldHTML;\n};\n\n\n//時計マークがクリックされたら現在日付を入力\n$(document).on('click','.SdtTime',function(){\n\n    //フォーマットを取得\n    const format = $(this).prev().prop('type');\n    //現在日付を取得\n    let dt = new Date();\n    //typeがmonthの場合は「yyyy-mm」、dateの場合は「yyyy-mm-dd」形式に文字列成型\n    let formatDt = dt.toLocaleDateString('sv-SE');\n    if(format == \"month\"){\n        formatDt = formatDt.slice(0,7);\n    }\n    $(this).prev().val(formatDt);\n})\n\n// lookups作成\nfunction createLookups(dialogId, title, fields){\n\n    //キー項目を取得\n    let keyObjs = fields.filter(e => e.options && typeof(e.options) == \"object\" && ( e.options.lookupOrigin || e.options.searchDialog));\n\n    for(let keyObj of keyObjs){\n\n        // id作成\n        let key_fullId = dialogId + \"_\" + keyObj.id;\n        // 転記先項目を取得\n        let lookpupList = fields.filter(e => e.options.lookupFor  && e.options.lookupFor[0].id == keyObj.id);\n\n        let tmp_lookups = {};\n\n        // キー項目の値を代入\n        tmp_lookups.id              = key_fullId;\n        tmp_lookups.type            = keyObj.type;\n        tmp_lookups.tableId         = keyObj.options.lookupOrigin ? keyObj.options.lookupOrigin.tableId : '';\n        tmp_lookups.keyColumnName   = keyObj.options.lookupOrigin ? keyObj.options.lookupOrigin.keyColumnName : '';\n        tmp_lookups.digitsNum       = keyObj.options.digitsNum ? keyObj.options.digitsNum:'';\n        tmp_lookups.searchDialog    = {id:keyObj.options.searchDialog ? keyObj.options.searchDialog.id:'',title:keyObj.options.searchDialog ? keyObj.options.searchDialog.title:'',multiple:keyObj.options.searchDialog.multiple ? true : false};\n        if(keyObj.options.lookupOrigin && 'base_sql' in keyObj.options.lookupOrigin)tmp_lookups.base_sql = keyObj.options.lookupOrigin.base_sql;\n        // 転記先項目のパラメータ設定\n        if(keyObj.options.lookupOrigin && keyObj.type == 'text-set'){\n            let tmp = [{type:'text',id:key_fullId + 'To',columnName:keyObj.options.lookupOrigin.forColumnName}];\n            if(keyObj.options.lookupOrigin.specialTerms)tmp[0].specialTerms = keyObj.options.lookupOrigin.specialTerms;\n            tmp_lookups.toParam = tmp;\n        }\n        else if(keyObj.options.lookupOrigin){\n            tmp_lookups.toParam = lookpupList.map(e => {\n                let param = {};\n                param.type = e.type;\n                param.id = e.type == 'text-set' ? dialogId + \"_\" + e.id + 'From' :dialogId + \"_\" + e.id;\n                param.columnType = e.options.lookupFor[0].columnType;\n                param.columnName = e.options.lookupFor[0].columnName;\n                if('specialTerms' in e.options.lookupFor[0])param.specialTerms = e.options.lookupFor[0].specialTerms;\n                if('func' in e.options.lookupFor[0])param.func = e.options.lookupFor[0].func;\n                return param;\n            })\n        }\n\n        // 前回出力情報\n        if(\"get_lastTime_output\" in keyObj.options){\n            tmp_lookups.get_lastTime_output = {dialogId:dialogId,name:keyObj.options.get_lastTime_output};\n        }\n\n        lookups.push(tmp_lookups);\n\n        // イベント登録\n        if(keyObj.options.lookupOrigin){\n            if(keyObj.type == 'text-set')key_fullId += 'From';\n            $(document).on('input',`#${key_fullId}`,function(e){\n\n                if(now_IME)return;\n\n                // 数字以外を入力できないようにする\n                if(/[^\\uFF10-\\uFF19\\u0030-\\u0039]/.test($(this).val()) && $(this).val() != \"\"){\n                    let tmp = $(this).val().replace(/[^０-９0-9]/g, '');\n                    $(this).val(tmp);\n                    return;\n                }\n\n                let inputValue = $(this).val().length;\n                let id = $(this).attr('id');\n                let parentClass = $(this).parent().attr('class');\n                if(parentClass == 'text-set'){\n                    id = id.slice(0,-4);\n                }\n                let tmp = lookups.find(e => e.id == id);\n                if(inputValue != tmp.digitsNum) return;\n\n                dialogLookups($(this),parentClass);\n            })\n            // 桁以外でフォーカスが外れたらクリア処理\n            $(document).on('blur',`#${key_fullId}`,function(){\n\n                let inputValue = $(this).val().length;\n                let parentClass = $(this).parent().attr('class');\n                let id = $(this).attr('id');\n                if(parentClass == 'text-set')id = id.slice(0,-4);\n                let tmp = lookups.find(e => e.id == id);\n                if(inputValue == tmp.digitsNum) return;\n                // クリア処理\n                $(this).val('');\n                let lookup = lookups.filter(e => e.id == id)[0];\n                let prm = lookup.toParam ? lookup.toParam : [];\n\n                prm.forEach(e => {\n                    $(`#${e.id}`).val('').trigger('blur');\n                });\n\n                // 前回出力情報削除\n                if('get_lastTime_output' in tmp){\n                    $(`#${tmp.get_lastTime_output.dialogId} .input-container span`).text('');\n                }\n            })\n        }\n    }\n}\n\n// 全角数字を半角数字に変換する関数\nconst convertFullWidthToHalfWidth = (str) => {\n    return str.replace(/[ー－]/g,'-').replace(/[０-９]/g, function(char) {\n        // '０' (全角) の文字コードは 65296、'0' (半角) の文字コードは 48\n        // 差分 (65296 - 48) を引いて半角に変換\n        return String.fromCharCode(char.charCodeAt(0) - 65248);\n    });\n}\n\n\n// ルックアップする\n// tableなど特殊なものは各ダイアログファイルに記載\nasync function dialogLookups(t,parentClass = ''){\n    try {\n        showLoading();\n\n        t.val(convertFullWidthToHalfWidth(t.val()));\n\n        let item_label = t.closest('.field-control').prev().children('label').text();\n\n        let keyId = t.attr('id');\n        if(parentClass == 'text-set') keyId = keyId.slice(0,-4);\n\n        let lookup = lookups.filter(e => e.id == keyId)[0];\n        let prm = lookup.toParam;\n        let columns = lookup.toParam.map(e => {\n            if('specialTerms' in e){\n                return e.specialTerms;\n            }else{\n                return e.columnName;\n            }\n        });\n\n        // SQLが必要かで処理を分ける\n        let tableData;\n        if(!/^[0-9]+$/.test(lookup.tableId)){\n\n            // 売上入力の場合は処理を分ける\n            if(\"salesInput_estimateNo\" == lookup.id){\n                where = `WHERE MH.見積番号 = ${$('#salesInput_estimateNo').val()}`;\n                let sql = salesInput_baseSQL(where);\n                tableData = await fetchSql(sql);\n                salesInput_lookup(tableData);\n                return;\n            }\n            else if('base_sql' in lookup){\n                const sql = lookup.base_sql + $('#'+ t.attr('id')).val();\n                tableData = await fetchSql(sql);\n                tableData = tableData.results;\n            }\n            else{\n                let sql = `SELECT ${columns} FROM ${lookup.tableId} WHERE ${lookup.keyColumnName} = ${$('#'+ t.attr('id')).val()}`;\n                tableData = await fetchSql(sql);\n                tableData = tableData.results;\n            }\n        }\n        else{\n            await $p.apiGet({\n                id: lookup.tableId,\n                data: {\n                    View: {\n                        'ApiDataType': \"KeyValues\",\n                        'ApiColumnKeyDisplayType':'ColumnName',\n                        'ApiColumnValueDisplayType':\"Value\",\n                        'GridColumns': columns,\n                        \"ColumnFilterHash\":{\n                            [lookup['keyColumnName']]:$(`#${t.attr('id')}`).val()\n                        },\n                        \"ColumnFilterSearchTypes\": {\n                            [lookup['keyColumnName']]: \"ExactMatch\"\n                        }\n                    },\n                },\n                done: function (data) {\n                    tableData = data.Response.Data;\n                }\n            });\n        }\n        if(tableData.length != 1) {\n            alert(`指定の${item_label}は存在しません`);\n            t.val('').trigger('blur');\n            t.focus();\n            return;\n        }\n\n        prm.forEach(e => {\n            let tmp = tableData[0][e.columnName];\n            let item = \"\";\n            if('func' in e){\n                tmp = e.func(tableData[0]);\n            }\n            if(e.type == \"datepicker\"){\n                $(`#${e.id}`).val(\n                    tableData[0][e.columnName] == \"\" ? \"\":\n                    new Date(tmp).toLocaleDateString('sv-SE')\n                ).trigger('input');\n            }else{\n                $(`#${e.id}`).val(tmp).trigger('input');\n            }\n        });\n\n        // 前回出力情報\n        if('get_lastTime_output' in lookup){\n            get_history(lookup.get_lastTime_output.name,$(`#${t.attr('id')}`).val(),lookup.get_lastTime_output.dialogId)\n        }\n\n    } catch(error) {\n        console.error('ルックアップエラー：', error);\n        alert('予期せぬエラーが発生しました。');\n    } finally {\n        hideLoading();\n    }\n}\n\n$(document).on('blur','textarea',function(){\n    $(this).hide();\n    $(this).prev().prev().text($(this).val());\n    $(this).prev().prev().show();\n})\n\n$(document).on('mousedown','button:has(.ui-icon-closethick)',function(){\n    const element = $(this).closest('div').next();\n    const id = element.attr('id');\n    if(element.hasClass('searchDialog'))return;\n    closeDialog(id,true);\n})\n\n// ダイアログを閉じる関数\nfunction closeDialog(dialogId,deleteFlg) {\n    $(`#${dialogId}`).dialog('close');\n    $(`#${dialogId} table.searchTable tbody`).html('');\n    searchOutputId.pop();\n\n    if(!deleteFlg)return;\n\n    \n    $(`#${dialogId}`).dialog(\"destroy\").remove();\n    $('#Application').append(htmls[dialogId]);\n\n}\n\n// ダイアログをモーダルにするための関数\nwindow.addEventListener(\"load\", async (event) => {\n    await sleep(1000);\n    $(document).off(\"click\", \".ui-widget-overlay\")\n\n    // ローディングオーバーレイ要素を作成\n    const loadingOverlay = document.createElement('div');\n    loadingOverlay.className = 'loading-overlay';\n    loadingOverlay.innerHTML = '<div class=\"loading-spinner\"></div>';\n    document.body.appendChild(loadingOverlay);\n\n\n});\n\n// 全件チェック\n$(document).on('change','.allCheck',function(){\n    const allCheckFlg = $(this).prop('checked');\n\n    let targetElements = $(this).closest('table').find('tbody').find('input[type=\"checkbox\"]');\n\n    targetElements.prop('checked',allCheckFlg);\n\n})\n\n// inputtableの複数選択画面で、tdデフラグを反転\n$(document).on('click','.inversion',function(){\n    let targetElement = $(this).find('input[type=\"checkbox\"]');\n    targetElement.prop('checked',!targetElement.prop('checked')).trigger('change');\n})\n$(document).on('click','.inversion > input',function(event){\n    event.stopPropagation();\n})\n\n// 検索ダイアログの横にある×ボタンが押されたときに実行\n// keyになるinput要素を削除\n// blurイベントを着火させてlookup対象項目も削除\nfunction textClear(id){\n    $(`#${id}`).val('').trigger('blur');\n}\n\n\n$(document).on('keydown','.ui-icon-search',function(e){\n    if(e.which == 13){\n        $(this).trigger('click');\n    }\n})\n$(document).on('keydown','.ui-icon-close',function(e){\n    if(e.which == 13){\n        $(this).trigger('click');\n    }\n})\n\n\n$(document).on('keydown', 'tr', function(e) {\n    let tbodyElement = $(this);\n    let idx = $(this).index();\n\n    // フォーカス移動\n    if (e.which == 38 && idx != 0) {\n        let prevElement = tbodyElement.prev();\n        prevElement.focus();\n        ensureElementVisible(prevElement);\n        e.preventDefault();\n    } else if (e.which == 40 && idx != (tbodyElement.siblings().length)) {\n        let nextElement = tbodyElement.next();\n        nextElement.focus();\n        ensureElementVisible(nextElement);\n        e.preventDefault();\n    }\n});\n\n// 表示領域内にフォーカスが収まっているか確認し、必要ならスクロール\nfunction ensureElementVisible(element) {\n    let elementTop = element.offset().top;\n    let elementBottom = elementTop + element.outerHeight();\n\n    let viewportTop = $(window).scrollTop();\n    let viewportBottom = viewportTop + $(window).height();\n\n    // 要素がビューの上に隠れている場合\n    if (elementTop < viewportTop) {\n        $('html, body').scrollTop(elementTop - 20); // 少し余裕をもたせてスクロール\n    }\n    // 要素がビューの下に隠れている場合\n    else if (elementBottom > viewportBottom) {\n        $('html, body').scrollTop(elementBottom - $(window).height() + 20); // 少し余裕をもたせてスクロール\n    }\n}\n\n//click出力先が変更された時の処理\n// 変更処理がないためコメントアウト\n// $(document).on('click','.input-button-container button',function(){\n//     // どちらのボタンが押されたかで処理を分ける\n//     if($(this).hasClass('changePath')){\n//         inputValue = $(this).prev().val();\n//         $(this).parent().next().children('span').text(inputValue);\n//         $(this).parent().css('display','none');\n//         $(this).parent().next().css('display','contents');\n//     }\n//     else{\n//         $(this).parent().css('display','none');\n//         $(this).parent().prev().css('display','contents');\n//     }\n// })\n\n// 数値入力用項目がフォーカスから外れたら3桁区切りにする\n$(document).on('blur','.input-Number',async function(){\n    await sleep(1);\n    let val = Number(convertFullWidthToHalfWidth($(this).val().replaceAll(',','').replace(/[ー－]/g,'-').replace(/[^-\\d０-９,]/g, '')));\n    if(/^-?[0-9]+$/.test(val)){\n        $(this).val(val.toLocaleString());\n    }\n})\n\n// 3桁区切り解除\n$(document).on('focus','.input-Number',async function(){\n    let val = Number($(this).val().replaceAll(',',''));\n    if(val == 0){\n        $(this).val('');\n    }\n    else if(/^-?[0-9]+$/.test(val)){\n        $(this).val(val);\n    }\n})\n\n$(document).on('input','.varidate_int',function(){\n    input_numberOnly($(this))\n})\n$(document).on('input','.varidate_zeroPadding',function(){\n    input_numberOnly($(this))\n})\n\n// マイナス符号、数字（半角・全角）のみ許可する\nfunction input_numberOnly(e){\n    if(now_IME)return;\n    const target_element = varidate_input_select(e);\n    const target_value = target_element.val();\n    \n    after_value = target_value.replace(/[^-ー－\\d０-９]/g, \"\");\n    target_element.val(after_value);\n}\n\n\n// バリデーション\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nnow_varidate_flg = false;\n\n// 固定長数字で0埋め（得意先CDなど）\n$(document).on('blur','.varidate_zeroPadding',function(){\n    varidate_zeroPadding($(this));\n})\nasync function varidate_zeroPadding(e){\n    if(now_varidate_flg)return;\n    now_varidate_flg = true;\n\n\n    // 検索ボタンのあるinput要素は処理終了（input_numberOnlyのみ動作させたいため。）\n    if(e.prop('tagName') == 'INPUT' && e.next().hasClass('ui-icon-search')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    const element = varidate_input_select(e);\n\n    const dialog_element = element.closest('.dialog');\n\n\n    await sleep(0);\n\n    // if(activeItem_check(e) || element.is(':focus') || !dialog_element.is(':visible')){\n    if(activeItem_check(e) || element.is(':focus') || dialog_element.is(':focus')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    const maxLength = element.prop('maxlength');\n    const required_flg = element.prop('required');\n\n    if(!required_flg && element.val() == ''){\n        now_varidate_flg = false;\n        return;\n    }\n    // 0-9 or ０-９の値以外が入力されていたらクリア処理とアラート\n    if((required_flg && element.val() == '') || /[^０-９\\d]/.test(element.val())){\n        element.focus();\n        element.val('');\n        alert(`${maxLength}桁の数字を入力してください`);\n\n        // alertで新しくイベント着火しちゃうから、新しく着火したイベントを先に進めて終了させる（now_varidate_flg）\n        await sleep(0);\n        now_varidate_flg = false;\n        return;\n    }\n\n    // 全角数字を半角数字に変換\n    let val = convertFullWidthToHalfWidth(element.val());\n    val = ('0000000' + val).slice(-(maxLength));\n    element.val(val);\n\n    now_varidate_flg = false;\n}\n\n$(document).on('blur','.varidate_int',function(){\n    varidate_number($(this));\n})\n// 半角数字のバリデーション（合計金額など）\nasync function varidate_number(e){\n\n    if(now_varidate_flg)return;\n    now_varidate_flg = true;\n    const element = varidate_input_select(e);\n    const dialog_element = element.closest('.dialog');\n\n    if(e.prop('tagName') == 'INPUT' && e.next().hasClass('ui-icon-search')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    await sleep(0);\n\n\n    // ブラウザからアクティブが外れた場合、検索ダイアログを開くときは処理終了\n    if(activeItem_check(e) || element.is(':focus') || dialog_element.is(':focus')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    const required_flg = element.prop('required');\n\n    //  0-9 or ０-９の値以外が入力されていたらクリア処理とアラート\n    // if((!required_flg)){\n    //     return;\n    // }\n    if(!/(^-?ー?－?[０-９\\d]+$|^$)/.test(element.val()) || (required_flg && element.val() == \"\")){\n    // if(!/^[\\d\\uFF10-\\uFF19]+(,\\d{3})*$/.test(element.val())){\n        element.focus();\n        element.val('');\n        alert(\"未入力項目があります。\");\n\n        // alertで新しくイベント着火しちゃうから、新しく着火したイベントを先に進めて終了させる（now_varidate_flg）\n        await sleep(0);\n        now_varidate_flg = false;\n        return;\n    }\n\n    // 全角数字を半角数字に変換\n    let val = convertFullWidthToHalfWidth(element.val());\n    element.val(val);\n    now_varidate_flg = false;\n\n}\n\n// 必須項目チェック\n$(document).on('blur','.varidate_str',function(){\n    varidate_fixedLength_str($(this));\n})\nasync function varidate_fixedLength_str(e){\n\n    if(now_varidate_flg)return;\n    now_varidate_flg = true;\n\n    const element = varidate_input_select(e);\n\n    const dialog_element = element.closest('.dialog');\n\n    if(e.prop('tagName') == 'INPUT' && e.next().hasClass('ui-icon-search')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    await sleep(0);\n\n    // フォーカスがinput or 検索ダイアログ or ブラウザ以外に移った時は処理終了\n    if(activeItem_check(e) || element.is(':focus') || dialog_element.is(':focus')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    const required_flg = element.prop('required');\n\n    // 必須チェック\n    if(element.val() == '' && required_flg){\n        alert('必須項目です。');\n        element.val('');\n        element.focus();\n        await sleep(0);\n        now_varidate_flg = false;\n        return;\n    }\n    now_varidate_flg = false;\n}\n\n// text-setのバリデーション\n$(document).on('input','.text-set input',async function(){\n    try{\n        if(now_IME)return;\n\n        // lookup項目は除外\n        if($(this).attr('id').slice(-2) == 'To')return;\n\n        let id = $(this).attr('id').slice(0,-4);\n        let tmp = lookups.filter(e => e.id == id);\n\n        if(tmp.length != 0)return;\n\n        let choices = $(this).next().val().split(' ').map(e => e.split(':')[0]);\n        choices.push(\"\");\n\n        if($(this).val().length > 1){\n            $(this).val($(this).val().slice(0,1));\n            return;\n        }\n\n        if(!choices.includes($(this).val())){\n            $(this).val('').focus();\n        }\n    }\n    catch(err){\n        return;\n    }\n})\n\n// input type=number はmaxlengthが働かないので指定桁以上を入力できないようにする\n$(document).on('input','.maxlength_for_number',function(){\n    let maxlength = $(this).attr('maxlength');\n    if(maxlength == \"\"){\n        return;\n    }\n    else{\n        maxlength = Number(maxlength);\n    }\n    let val = $(this).val();\n    if(val.length > maxlength){\n        $(this).val(val.slice(0,maxlength));\n    }\n\n})\n\n// divかinputかわからないため、input要素を返す\nfunction varidate_input_select(e){\n    if(e.parent().hasClass('text-set') && e.prop('tagName') == 'DIV'){\n        return e.prevAll().eq(1);\n    }\n    else if(e.prop('tagName') == 'DIV'){\n        return e.prev();\n    }else{\n        return e;\n    }\n}\n\n// ブラウザ自体からfocusが外れた、検索ダイアログを開いた場合、input,button要素以外がfocusになったらはtrueを返す\nfunction activeItem_check(e){\n    const after_focus_element = $(':focus');\n    const dialog_element = $(e).closest('.dialog');\n    const after_focus_dialog_element = after_focus_element.closest('.dialog');\n\n    if(after_focus_dialog_element.length == 0){\n        return true;\n    }\n    if(dialog_element.attr('id') != after_focus_dialog_element.attr('id')){\n        return true;\n    }\n\n    if(!isWindowActive || searchOutputId.length > 0 || !['INPUT'].includes(after_focus_element.prop('tagName'))){\n        return true;\n    }\n    return false;\n}\n\n// ブラウザのアクティブ状態を監視\nlet isWindowActive = true;\nwindow.addEventListener('blur', () => {\n    isWindowActive = false;\n});\n\nwindow.addEventListener('focus', () => {\n    isWindowActive = true;\n});\n\n// 指定したミリ秒待機する\nasync function sleep(s){\n    await new Promise((resolve,reject) => {\n        setTimeout(() => {\n            resolve();\n        }, s);\n    })\n}\n\n// ローディング制御関数\nfunction showLoading() {\n    //     document.querySelector('.loading-overlay').style.display = 'flex';\n    const element = document.querySelector('.loading-overlay');\n    if(element == null)return;\n    element.style.display = 'flex';\n}\n\nfunction hideLoading() {\n    //     document.querySelector('.loading-overlay').style.display = 'none';\n    const element = document.querySelector('.loading-overlay');\n    if(element == null)return;\n    element.style.display = 'none';\n}\n\n// 帳票をダウンロードする処理\nasync function download_report(param, fileName = \"\", accept=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\"){\n    try {\n        showLoading();\n        let res = await fetch(SERVICE_URL, {\n            method: \"POST\",\n            headers: {\n                \"content-type\": \"application/json\",\n                \"Accept\": accept,\n            },\n            body: JSON.stringify(param)\n        });\n\n        if (!res.ok) {\n            const errorData = await res.json();\n            console.error(errorData);\n            alert(errorData.message);\n            return;\n        }\n\n        // 成功メッセージをヘッダーから取得して表示\n        const messageCode = res.headers.get('Success-Message-Code');\n        if (messageCode) {\n            if (SUCCESS_MESSAGE_CODE[messageCode]) {\n                alert(SUCCESS_MESSAGE_CODE[messageCode]);\n            } else {\n                alert(`登録されていないメッセージコードです: ${messageCode}`);\n            }\n        }\n\n\n        // ファイルのダウンロードをするかどうか\n        const skip = res.headers.get('Download-Skip');\n        if (skip) {\n            console.log(\"ファイルのダウンロードをスキップします\")\n        } else {\n            // ダウンロードファイル名をクライアント側で上書きする場合\n            let downloadFileName = \"\"\n            if (fileName) {\n                downloadFileName = fileName;\n            // ダウンロードファイル名をサーバー側で指定する場合\n            } else {\n                let tmpText = res.headers.get('Content-Disposition').split('filename=')[1].replace(/\"/g, '')\n                downloadFileName = decodeString(tmpText)\n            }\n\n            const blob = await res.blob();\n            const url = window.URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = downloadFileName;\n            document.body.appendChild(a);\n            a.click();\n\n            // リンクを削除\n            document.body.removeChild(a);\n            window.URL.revokeObjectURL(url);\n            console.log(\"ファイルをダウンロードしました\")\n\n        }\n\n    } catch(error) {\n        console.error('予期せぬエラー：', error.message);\n        alert(`Error: 予期せぬエラーが発生しました。`);\n    } finally {\n        hideLoading();\n    }\n}\n\n/**\n * 指定された日付を特定のフォーマットで返す関数\n * @param {number} day          日付（1-31の数値、または99で月末日）\n * @param {string} type         出力形式（'month'で年月のみ、その他で年月日）\n * @returns {string}            YYYY-MM-DD または YYYY-MM 形式の日付文字列\n * @example\n * // 月の15日の完全な日付を取得\n * monthDateGein(15)    // => '2024-11-15'\n * // 月末日を取得\n * monthDateGein(99)    // => '2024-11-30'\n * // 年月のみを取得\n * monthDateGein(15, 'month')   // => '2024-11'\n */\nfunction monthDateGein(day,type){\n    let dt = new Date();\n    let resDate;\n    if(day == 99){\n        resDate = new Date(dt.getFullYear(),dt.getMonth()+1,0).toLocaleDateString('sv-SE');\n    }\n    else{\n        resDate = new Date(dt.getFullYear(),dt.getMonth(),day).toLocaleDateString('sv-SE');\n    }\n    resDate = type == 'month' ? resDate.slice(0,7) : resDate;\n    console.log(resDate);\n    return resDate;\n}\n\n/**\n * 文字列を変換する関数\n * @param {string} str          チェックしたい文字列\n * @param {string} replaceStr   変換したい文字列　規定値はnull\n */\nfunction SpcToNull(str,replaceStr = null){\n    if(str == ''){\n        return replaceStr;\n    }else{\n        return str.trim();\n    }\n}\n\n/**\n * 文字列を変換する関数\n * @param {string} encodedText   変換したい文字列\n */\nfunction decodeString(encodedText){\n    // Base64文字列をデコードしてUint8Arrayを取得\n    const binaryData = Uint8Array.from(atob(encodedText), c => c.charCodeAt(0));\n\n    // Uint8ArrayをUTF-8文字列にデコード\n    const decoder = new TextDecoder('utf-8');\n    return decoder.decode(binaryData);\n\n}\n\n// 日付をYYYY-MM-DD形式の文字列に変換するための関数\nfunction formatDate(date) {\n    date = new Date(date);\n    if(!date instanceof Date)return null;\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0'); // 月は0ベースのため+1\n    const day = String(date.getDate()).padStart(2, '0');\n    return `${year}-${month}-${day}`;\n}\n\n// 日付をYYYY年MM月DD日に変換する関数\nfunction formatDate_for_japanese(date){\n    date = new Date(date);\n    if(isNaN(date)){\n        throw new Error;\n    }\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    return `${year}年${month}月${day}日`;\n}\n\n// 時間をhh時mm分形式で返す\nfunction formatTime_for_japanese(date){\n    date = new Date(date);\n    if(!date instanceof Date){\n        return '';\n    }\n    return date.getHours() + \"時\" + date.getMinutes() + \"分\";\n}\n\n// dateオーバーフローさせない\nfunction not_date_overflow(old_date,new_date){\n    if(isNaN(new_date.getTime())){\n        return new_date;\n    }\n    else if(old_date.getMonth() == new_date.getMonth()){\n        return new_date;\n    }\n    else{\n        return new Date(new_date.setMonth(new_date.getMonth(),0));\n    }\n}\n\nfunction getFirstDateOfScope(wdate, wshime, defaultVal = \"\") {\n\n    wshime = Number(wshime);\n\n    // wdateが日付型かチェックし、日付型でなければ変換\n    const date = (wdate instanceof Date) ? wdate : new Date(wdate);\n\n    // 変換が失敗した場合、defaultValを返す\n    if (isNaN(date.getTime())) return defaultVal;\n\n    switch (wshime) {\n        case 0:\n            return formatDate(date);  // そのままの日付を返す\n        case 99:\n            return formatDate(new Date(date.getFullYear(), date.getMonth(), 1));  // 月初日を返す\n        default:\n            // 日付が締め日を超える場合とそれ以下の場合で分岐\n            let bufDate = new Date(`${date.getFullYear()}-${date.getMonth()+1}-${wshime}`);\n            if(isNaN(bufDate.getTime()) || new Date(date.getFullYear(),date.getMonth(),wshime).getMonth() != date.getMonth()){\n                return defaultVal;\n            }\n            if (date.getDate() > wshime) {\n                let after_date = new Date(bufDate.getFullYear(), bufDate.getMonth(), wshime + 1);\n                return formatDate(after_date);\n            }\n            else {\n                let tmp_date1 = new Date(bufDate);\n                let tmp_date2 = new Date(bufDate);\n\n                // 締日が月末だったら月初を返す\n                if(bufDate.getMonth() != new Date(tmp_date1.setDate(tmp_date1.getDate()+1)).getMonth()){\n                    return formatDate(new Date(bufDate.setDate(1)));\n                }\n                // 請求日付と締日から1か月前、1日を足した値が月をまたいでいないか\n                else if(bufDate.getMonth() == new Date(tmp_date2.getFullYear(),tmp_date2.getMonth()-1,tmp_date2.getDate()+1).getMonth()){\n                    return formatDate(new Date(bufDate.getFullYear(),bufDate.getMonth(),0));\n                }\n                else{\n                    return formatDate(new Date(bufDate.getFullYear(),bufDate.getMonth()-1,bufDate.getDate()+1));\n                }\n            }\n    }\n}\n\nfunction getLastDateOfScope(wdate, wshime, Default = '') {\n\n    wshime = Number(wshime);\n    let bufDate;\n\n    // wdateをDateオブジェクトとして変換\n    const date = new Date(wdate);\n    if (isNaN(date)) {\n        return Default;\n    }\n\n    switch (wshime) {\n        case 0:\n            // Case 0: そのまま日付を返す\n            return formatDate(date); // \"YYYY-MM-DD\" 形式\n\n        case 99:\n            // Case 99: 次月の初日から1日減らして末日を取得\n            const nextMonth = new Date(date.getFullYear(), date.getMonth() + 1, 1);\n            nextMonth.setDate(nextMonth.getDate() - 1);\n            return formatDate(nextMonth);\n        default:\n            // それ以外のケース\n            if(new Date(date.getFullYear(),date.getMonth(),wshime).getMonth() != date.getMonth()){\n                return Default;\n            }\n            if (date.getDate() > wshime) {\n                // 指定日の翌月にシメ日を設定\n                let tmp = new Date(`${date.getFullYear()}-${date.getMonth()+2}-1`);\n                bufDate = new Date(`${date.getFullYear()}-${date.getMonth()+2}-${wshime}`);\n                if (isNaN(bufDate.getTime())) {\n                    return Default;\n                }\n                else if(tmp.getMonth() != bufDate.getMonth()){\n                    return formatDate(new Date(bufDate.getFullYear(),bufDate.getMonth(),0));\n                }\n                else {\n                    return formatDate(bufDate);\n                }\n            } else {\n                // 指定日の月にシメ日を設定\n                let tmp = `${date.getFullYear()}-${date.getMonth()+1}-${wshime}`;\n                bufDate = new Date(tmp);\n                if (!isNaN(bufDate.getTime())) {\n                    return formatDate(bufDate);\n                } else {\n                    return Default;\n                }\n            }\n    }\n}\n\n\n// 日付の月間を計算する関数\nfunction DateDiff(date1, date2) {\n    const year1 = date1.getFullYear();\n    const month1 = date1.getMonth();  // 0-11の範囲\n    const year2 = date2.getFullYear();\n    const month2 = date2.getMonth();\n\n    // 年の差を12倍し、月の差を足し合わせる\n    const monthDifference = (year2 - year1) * 12 + (month2 - month1);\n    return monthDifference;\n}\n\nlet now_IME = false;\n// IME入力中か判断する関数（ルックアップで使用）\n$(document).on('compositionstart',function(){\n    now_IME = true;\n})\n$(document).on('compositionend',function(){\n    now_IME = false;\n    $(':focus').trigger('input');\n})\n\n\nclass cMitumoriH{\n    constructor(estimateNo){\n        this.estimateNo = estimateNo;\n        this.m_isDsp_estimate_category = 0; //見積区分\n        this.m_isDsp_inCompony_communication = 0; //社内伝\n    }\n    async isU_category(u_category){\n        let res_flg = false;\n        const sql = `\n            SELECT COUNT(U区分) AS 区分カウント\n            FROM TD見積シートM\n            WHERE 見積番号 = ${this.estimateNo}\n            AND U区分 = '${u_category}'\n            AND 見積数量 <> 0\n        `;\n        const res = await fetchSql(sql);\n        if(res.results.length == 0){\n            return false;\n        }\n        else{\n            if(res.results.区分カウント == 0){\n                return false;\n            }\n            else{\n                return true;\n            }\n        }\n    }\n    async GetById(){\n        const sql = `select * from TD見積 where 見積番号 = ${this.estimateNo}`;\n        const res = await fetchSql(sql);\n        if(res.results.length == 0){\n            return false;\n        }\n        res = res.results[0];\n        switch(this.m_isDsp_estimate_category){\n            case 0:\n                if(res.見積区分 == 1){\n                    alert('指定の見積番号は本見積ではありません。');\n                    return false;\n                }\n                break;\n            case 1:\n                if(res.見積区分 == 0){\n                    alert('指定の見積番号は仮見積もりではありません。');\n                    return false;\n                }\n        }\n        switch(this.m_isDsp_inCompony_communication){\n            case 1:\n                if(res.得意先CD == \"9999\"){\n                    alert('社内在庫分です。');\n                    return false;\n                }\n            case 2:\n                if(res.得意先CD == \"9999\"){\n                    alert('社内在庫意外です。');\n                    return false;\n                }\n        }\n\n        return true;\n    }\n}\n/*\n`m_isDsp_estimate_category\n仮見積 = 0\n本見積 = 1\n全て = 2\n`\n`m_isDsp_inCompony_communication\n全て = 0\n社内伝以外 = 1\n社内伝のみ = 2\n`*/\n\n\nclass clsDates{\n    constructor(dateID){\n        this.dateID = dateID;\n    }\n\n    async GetbyID(){\n        let dates = await fetchSql(`SELECT * FROM TMDates WHERE DateID = '${this.dateID}'`);\n        if(dates.results.length != 0){\n            this.updateDate = new Date(dates.results[0].更新日付);\n        }\n    }\n\n}\n\nfunction null_to_zero(value,defaultvalue = 0){\n    if(value == null || value == \"\"){\n        return defaultvalue;\n    }else{\n        return value;\n    }\n}\n\n\n",
            "Id": 14
          },
          {
            "Title": "62_製品検索マスタダイアログ.js",
            "New": true,
            "Edit": true,
            "Body": "// 製品検索ダイアログ作成\n{\n    const dialogId = 'productSearch1';\n    create_searchDialog(dialogId,'TM製品',[\n        {type:'text',id:'productNo',label:'製品No',forColumnName:'製品NO',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'methodNo',label:'仕様No',forColumnName:'仕様NO',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'KANJIName',label:'漢字名称',forColumnName:'漢字名称',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'mainSupplier',label:'主仕入先',forColumnName:'主仕入先CD',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'W',label:'W',forColumnName:'W',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'D',label:'D',forColumnName:'D',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H',label:'H',forColumnName:'H',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'D1',label:'D1',forColumnName:'D1',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'D2',label:'D2',forColumnName:'D2',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H1',label:'H1',forColumnName:'H1',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H2',label:'H2',forColumnName:'H2',options:{\n            width:'wide',\n        }},\n\n        { type: 'search-table', id: 'searchTable', label: '', options: {\n            newLine:false,\n            individualSql:true,\n            t_heads:[\n                {label:\"製品No\",type:'',ColumnName:'製品NO'},\n                {label:\"仕様No\",type:'',ColumnName:'仕様NO'},\n                {label:\"漢字名称\",type:'',ColumnName:'漢字名称'},\n                {label:\"主仕入先\",type:'',ColumnName:'主仕入先CD'},\n                {label:\"W\",type:'',ColumnName:'W'},\n                {label:\"D\",type:'',ColumnName:'D'},\n                {label:\"H\",type:'',ColumnName:'H'},\n                {label:\"D1\",type:'',ColumnName:'D1'},\n                {label:\"D2\",type:'',ColumnName:'D2'},\n                {label:\"H1\",type:'',ColumnName:'H1'},\n                {label:\"H2\",type:'',ColumnName:'H2'},\n                {label:\"仕入先名\",type:'',ColumnName:'仕入先名1'},\n            ]\n        }},\n    ],\n    [\n        { type: 'button_inline', id: 'create', label: 'OK', options: {\n            onclick:`resultInput('${dialogId}')`,\n            icon:'disk'\n        }},\n    ],\n    '1300px')\n}\n\nconst productSearch1_baseSQL = (e) => {\n    return `\n        SELECT TOP 1000 SE.製品NO,SE.仕様NO,SE.漢字名称,SE.主仕入先CD,SE.W,SE.D,SE.H,SE.D1,SE.D2,SE.H1,SE.H2,SI.仕入先名1\n        FROM TM製品 AS SE\n        INNER JOIN\n            TM仕入先 AS SI\n        ON\n            SE.主仕入先CD = SI.仕入先CD\n        ${e} and 廃盤FLG = 0\n        ORDER BY\n        SE.製品NO ASC , SE.仕様NO ASC\n    `\n}\n\n\n// 製品検索ダイアログ作成\n{\n    const dialogId = 'productSearch2';\n    create_searchDialog(dialogId,'TM製品',[\n        {type:'text',id:'productNo',label:'製品No',forColumnName:'製品NO',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'methodNo',label:'仕様No',forColumnName:'仕様NO',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'KANJIName',label:'漢字名称',forColumnName:'漢字名称',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'mainSupplier',label:'主仕入先',forColumnName:'主仕入先CD',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'W',label:'W',forColumnName:'W',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'D',label:'D',forColumnName:'D',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H',label:'H',forColumnName:'H',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'D1',label:'D1',forColumnName:'D1',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'D2',label:'D2',forColumnName:'D2',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H1',label:'H1',forColumnName:'H1',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H2',label:'H2',forColumnName:'H2',options:{\n            width:'wide',\n        }},\n\n        { type: 'search-table', id: 'searchTable', label: '', options: {\n            newLine:false,\n            individualSql:true,\n            t_heads:[\n                {label:\"\",ColumnName:'タイトル',hidden:true},\n                {label:\"製品No\",type:'',ColumnName:'製品NO'},\n                {label:\"仕様No\",type:'',ColumnName:'仕様NO'},\n                {label:\"漢字名称\",type:'',ColumnName:'漢字名称'},\n                {label:\"主仕入先\",type:'',ColumnName:'主仕入先CD'},\n                {label:\"W\",type:'',ColumnName:'W'},\n                {label:\"D\",type:'',ColumnName:'D'},\n                {label:\"H\",type:'',ColumnName:'H'},\n                {label:\"D1\",type:'',ColumnName:'D1'},\n                {label:\"D2\",type:'',ColumnName:'D2'},\n                {label:\"H1\",type:'',ColumnName:'H1'},\n                {label:\"H2\",type:'',ColumnName:'H2'},\n                {label:\"仕入先名\",type:'',ColumnName:'仕入先名1'},\n            ]\n        }},\n    ],\n    [\n        { type: 'button_inline', id: 'create', label: 'OK', options: {\n            onclick:`resultInput('${dialogId}')`,\n            icon:'disk'\n        }},\n    ],\n    '1300px')\n}\n\nconst productSearch2_baseSQL = (e) => {\n    return `\n        SELECT TOP 1000 \n            SE.製品NO + '___' + SE.仕様NO AS タイトル, \n            SE.製品NO,SE.仕様NO,SE.漢字名称,SE.主仕入先CD,SE.W,SE.D,SE.H,SE.D1,SE.D2,SE.H1,SE.H2,SI.仕入先名1\n        FROM TM製品 AS SE\n        INNER JOIN\n            TM仕入先 AS SI\n        ON\n            SE.主仕入先CD = SI.仕入先CD\n        ${e} and 廃盤FLG = 0\n        ORDER BY\n        SE.製品NO ASC , SE.仕様NO ASC\n    `\n}\n",
            "Id": 15
          },
          {
            "Title": "ヤオコー製品交換マスタ.js",
            "New": true,
            "Edit": true,
            "Body": "const styleElement2 = document.createElement('style');\nstyleElement2.textContent = `\n    .field-normal{\n        width:340px ;\n        max-width:340px ;\n        height:45px ;\n        padding:0 20px 10px 0 ;\n    }\n    .field-wide{\n        width:100%;\n        min-height:45px;\n        float:left;\n        padding:0 10px 10px 0;\n        clear both;\n            max-width:100%\n    }\n    .sdt_disabled input,\n    .sdt_disabled select,\n    .sdt_disabled textarea{\n        background:#f5f5f5;\n    }\n    #productSearch{\n        display:block;\n        position:static;\n        margin-left:320px;\n        margin-top:6px;\n        overflow:visible;\n    }\n    #productDelete{\n        position:sticky;\n        margin-left:335px;\n        overflow:visible;\n        margin-top:-50px;\n    }\n`;\ndocument.head.appendChild(styleElement2);\n\nlookups.push({\n    id:\"Results_ClassI\",\n    searchDialog:{id:\"productSearch2\",title:'製品No検索',multiple:false}\n})\n\n\n$(document).on('input','#Results_ClassI',async function(){\n    try{\n        const productNo = $('#Results_ClassI');\n        const siyouNo = $('#Results_ClassD');\n        if(productNo.val() == \"\"){\n            initialize();\n            return;\n        }\n        const arr = productNo.val().split('___');\n\n        $p.set($p.getControl('ClassI'),arr[0]);\n        $p.set($p.getControl('ClassD'),arr[1]);\n\n        const data = await commonGetData(MASTER_TABLES[\"製品マスタ\"],['ClassC','NumA','NumB','NumC','NumD','NumE','NumF','NumG'],{ClassA:productNo.val().replaceAll(' ',''),ClassB:siyouNo.val().replaceAll(' ','')},{},{ClassA:'ExactMatch',ClassB:'ExactMatch'},false,false);\n\n        if(data.length ==0 ){\n            alert('指定の製品Noは存在しません。');\n            initialize();\n            return;\n        }\n\n        $p.set($p.getControl('ClassE'),data[0].ClassC);\n        $p.set($p.getControl('NumA'),null_to_zero(data[0].NumA,0));\n        $p.set($p.getControl('NumB'),null_to_zero(data[0].NumD,0));\n        $p.set($p.getControl('NumC'),null_to_zero(data[0].NumG,0));\n        $p.set($p.getControl('NumD'),null_to_zero(data[0].NumB,0));\n        $p.set($p.getControl('NumE'),null_to_zero(data[0].NumE,0));\n        $p.set($p.getControl('NumF'),null_to_zero(data[0].NumC,0));\n        $p.set($p.getControl('NumG'),null_to_zero(data[0].NumF,0));\n    }catch(e){\n        alert('予期せぬエラーが発生しました。');\n        console.error(e);\n        return;\n    }\n})\n\nfunction initialize(){\n    $p.set($p.getControl('ClassI'),'');\n    $p.set($p.getControl('ClassD'),'');\n    $p.set($p.getControl('ClassE'),'');\n    $p.set($p.getControl('NumA'),'');\n    $p.set($p.getControl('NumB'),'');\n    $p.set($p.getControl('NumC'),'');\n    $p.set($p.getControl('NumD'),'');\n    $p.set($p.getControl('NumE'),'');\n    $p.set($p.getControl('NumF'),'');\n    $p.set($p.getControl('NumG'),'');\n}\n\n// $p.events.on_editor_load = function () {\n//     setDisabled('disabled');\n\n//     $('.dialogSearch').off('click');\n\n//     if($('#productSearch2Dialog').length == 0){\n//         $('#Application').append(productSearch_html);\n//     }\n\n//     $('#productSearch').on('click',function(){\n//         openDialog_for_searchDialog('productSearch2','Results_ClassI','1300px','製品検索ダイアログ');\n//     })\n// }\n\nonEditorLoadFuncs.push(\n  function () {\n    setDisabled('disabled');\n\n    $('.dialogSearch').off('click');\n\n    if($('#productSearch2Dialog').length == 0){\n        $('#Application').append(productSearch_html);\n    }\n\n    $('#productSearch').on('click',function(){\n        openDialog_for_searchDialog('productSearch2','Results_ClassI','1300px','製品検索ダイアログ');\n    })\n  }\n)\n\nconst productSearch_html = `\n\n<div id=\"productSearch2Dialog\" class=\"searchDialog ui-dialog-content ui-widget-content\" style=\"display:none; margin-top: 10px; width: auto; min-height: 89.25px; max-height: 90vh; height: auto;\">\n        <div style=\"display: inline-block;width: 33%;vertical-align: top;\">\n            <div id=\"productSearch2_productNoField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_productNo\" class=\"\">製品No</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_productNo\" name=\"productSearch2_productNo\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_productNo-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_methodNoField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_methodNo\" class=\"\">仕様No</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_methodNo\" name=\"productSearch2_methodNo\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_methodNo-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_KANJINameField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_KANJIName\" class=\"\">漢字名称</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_KANJIName\" name=\"productSearch2_KANJIName\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_KANJIName-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_mainSupplierField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_mainSupplier\" class=\"\">主仕入先</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_mainSupplier\" name=\"productSearch2_mainSupplier\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_mainSupplier-error\"></div>\n            </div>\n        </div><div style=\"display: inline-block;width: 33%;vertical-align: top;\">\n            <div id=\"productSearch2_WField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_W\" class=\"\">W</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_W\" name=\"productSearch2_W\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_W-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_DField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_D\" class=\"\">D</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_D\" name=\"productSearch2_D\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_D-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_HField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_H\" class=\"\">H</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_H\" name=\"productSearch2_H\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_H-error\"></div>\n            </div>\n        </div><div style=\"display: inline-block;width: 33%;vertical-align: top;\">\n            <div id=\"productSearch2_D1Field\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_D1\" class=\"\">D1</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_D1\" name=\"productSearch2_D1\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_D1-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_D2Field\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_D2\" class=\"\">D2</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_D2\" name=\"productSearch2_D2\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_D2-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_H1Field\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_H1\" class=\"\">H1</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_H1\" name=\"productSearch2_H1\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_H1-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_H2Field\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_H2\" class=\"\">H2</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_H2\" name=\"productSearch2_H2\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_H2-error\"></div>\n            </div>\n        \n            \n        </div><div style=\"display: block;\">\n            <div style=\"width:80%; display: flex;justify-content: end;\">\n                <button id=\"productSearch2_searchTable_searchButton\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" data-icon=\"ui-icon-search\" type=\"button\" style=\"z-index: 9999;\" onclick=\"create_searchList($(this));\">\n                    <span class=\"ui-button-icon ui-icon ui-icon-search search\" style=\"position: static;\"></span>\n                    <span class=\"ui-button-icon-space\"> </span>検索\n                </button>\n            </div>\n            <div id=\"productSearch2_searchTable_readTable\" class=\"ui-dialog-content ui-widget-content\" style=\"display: inline-block; margin-top:20px; width: 98%;margin-left:1%;\">\n                <div class=\"field-vertical \" style=\"width: 100%;\">\n                    <div class=\"field-control\">\n                        <div class=\"container-selectable\">\n                            <div class=\"wrapper h300\">\n                                <table class=\"table searchTable\">\n                                    <thead style=\"position: sticky; top:0; background-color: gold; z-index:9999\">\n                                        <tr>\n                                            <th style=\"text-align: center;border-collapse: collapse; display:none;\"></th><th style=\"text-align: center;border-collapse: collapse; \">製品No</th><th style=\"text-align: center;border-collapse: collapse; \">仕様No</th><th style=\"text-align: center;border-collapse: collapse; \">漢字名称</th><th style=\"text-align: center;border-collapse: collapse; \">主仕入先</th><th style=\"text-align: center;border-collapse: collapse; \">W</th><th style=\"text-align: center;border-collapse: collapse; \">D</th><th style=\"text-align: center;border-collapse: collapse; \">H</th><th style=\"text-align: center;border-collapse: collapse; \">D1</th><th style=\"text-align: center;border-collapse: collapse; \">D2</th><th style=\"text-align: center;border-collapse: collapse; \">H1</th><th style=\"text-align: center;border-collapse: collapse; \">H2</th><th style=\"text-align: center;border-collapse: collapse; \">仕入先名</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"command-center\">\n            \n            <button id=\"productSearch2_close\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" type=\"button\" onclick=\"closeDialog('productSearch2Dialog',false);\" style=\"position:relative;\">\n                <span class=\"ui-button-icon ui-icon ui-icon-cancel\"></span>\n                <span class=\"ui-button-icon-space\"> </span>終了\n            </button>\n        </div>\n    </div>\n`\n",
            "Id": 16
          },
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n    if($p.action() != 'edit'){\n        return;\n    }\n\n    $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_ClassI').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_ClassD').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_ClassG').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_ClassIField .ui-icon').css('display','none');\n})",
            "Id": 17
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 18
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 19
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841976,
      "Title": "三研実績入力",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841976,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "DateB",
          "NumA",
          "NumB",
          "NumC",
          "NumD",
          "NumE",
          "NumF",
          "NumG",
          "NumH",
          "NumI"
        ],
        "FilterColumns": [
          "DateB"
        ],
        "EditorColumnHash": {
          "General": [
            "ResultId",
            "DateB",
            "_Section-1",
            "NumA",
            "NumB",
            "NumC",
            "NumD",
            "_Section-2",
            "NumE",
            "_Section-3",
            "NumF",
            "NumG",
            "NumH",
            "NumI",
            "Title"
          ]
        },
        "SectionLatestId": 3,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 2,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 3,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ResultId"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "NumA",
            "LabelText": "売上税抜金額_元",
            "Format": "C",
            "DecimalPlaces": 2,
            "Min": 0.0,
            "Max": 99999999.99,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumB",
            "LabelText": "原価税抜金額_元",
            "Format": "C",
            "DecimalPlaces": 2,
            "Min": 0.0,
            "Max": 99999999.99,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumC",
            "LabelText": "人件一般費_元",
            "Format": "C",
            "DecimalPlaces": 2,
            "Min": 0.0,
            "Max": 99999999.99,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumD",
            "LabelText": "営業外費_元",
            "Format": "C",
            "DecimalPlaces": 2,
            "Min": 0.0,
            "Max": 99999999.99,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumE",
            "LabelText": "元円比率",
            "DecimalPlaces": 2,
            "Min": 0.0,
            "Max": 99.99,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumF",
            "LabelText": "売上税抜金額_円",
            "Format": "C",
            "ExtendedFieldCss": "sdt_disabled",
            "Min": 0.0,
            "Max": 99999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumG",
            "LabelText": "原価税抜金額_円",
            "Format": "C",
            "ExtendedFieldCss": "sdt_disabled",
            "Min": 0.0,
            "Max": 99999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumH",
            "LabelText": "人件一般費_円",
            "Format": "C",
            "ExtendedFieldCss": "sdt_disabled",
            "Min": 0.0,
            "Max": 99999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumI",
            "LabelText": "営業外費_円",
            "Format": "C",
            "ExtendedFieldCss": "sdt_disabled",
            "Min": 0.0,
            "Max": 99999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "Title",
            "Hide": true,
            "ValidateRequired": false
          },
          {
            "ColumnName": "DateB",
            "LabelText": "実績日付",
            "ValidateRequired": true,
            "NoDuplication": true,
            "DateFilterSetMode": 2
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ResultId": "asc",
              "DateB": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          }
        ],
        "Scripts": [
          {
            "Title": "元円計算",
            "New": true,
            "Edit": true,
            "Body": "$p.on('change', 'NumE', function () {\n    AA()\n    BB()\n    CC()\n    DD()\n});\n\n$p.on('change', 'NumA', function () {\n    AA()\n    A=$p.getControl('NumA').val()\n    $p.set($p.getControl('NumA'), EN(A));\n});\n\n$p.on('change', 'NumB', function () {\n    BB()\n    A=$p.getControl('NumB').val()\n    $p.set($p.getControl('NumB'), EN(A));\n});\n\n$p.on('change', 'NumC', function () {\n    CC()\n    A=$p.getControl('NumC').val()\n    $p.set($p.getControl('NumC'), EN(A));\n});\n\n$p.on('change', 'NumD', function () {\n    DD()\n    A=$p.getControl('NumD').val()\n    $p.set($p.getControl('NumD'), EN(A));\n});\n\n\nfunction AA(){\n    //製品Noから検索\n    Gen = $p.getControl('NumA').val()\n    Hiri = $p.getControl('NumE').val()\n    NumGen=parseInt(String(Gen).replace(/[^0-9]/g, ''), 10);\n    En =  NumGen * Hiri\n    $p.set($p.getControl('NumF'), EN(En));\nreturn En\n}\n\nfunction BB(){\n    //製品Noから検索\n    Gen = $p.getControl('NumB').val()\n    Hiri = $p.getControl('NumE').val()\n    NumGen=parseInt(String(Gen).replace(/[^0-9]/g, ''), 10);\n    En =  NumGen * Hiri\n    $p.set($p.getControl('NumG'), EN(En));\n}\n\nfunction CC(){\n    //製品Noから検索\n    Gen = $p.getControl('NumC').val()\n    Hiri = $p.getControl('NumE').val()\n    NumGen=parseInt(String(Gen).replace(/[^0-9]/g, ''), 10);\n    En =  NumGen * Hiri\n    $p.set($p.getControl('NumH'), EN(En));\n}\n\nfunction DD(){\n    //製品Noから検索\n    Gen = $p.getControl('NumD').val()\n    Hiri = $p.getControl('NumE').val()\n    NumGen=parseInt(String(Gen).replace(/[^0-9]/g, ''), 10);\n    En =  NumGen * Hiri\n    $p.set($p.getControl('NumI'), EN(En));\n}\n\n\nfunction EN(x) {\n    x = '\\xA5' + Math.round(x).toLocaleString();\n    return x;\n}",
            "Id": 1
          },
          {
            "Title": "sdt_disabled",
            "New": true,
            "Edit": true,
            "Body": "// =================================================\n// フィールドCSSに'sdt_disabled'クラスが設定されているフィールドを\n// disabledにします。\n// $p.set()は稼働しますが、手動での操作を制限します。\n// -------------------------------------------------\n// 引数：disabledにするかreadonlyにするか\n// =================================================\n\nfunction setDisabled(type){\n  //該当の入力エリアをdisabled / readonlyにする\n  $('.sdt_disabled input').prop(type, true); // 一般的なinput要素\n  $('.sdt_disabled input[type=\"number\"]').prop(type, true); // 数値用のinput要素\n  $('.sdt_disabled textarea').prop(type, true); // textarea要素\n  $('.sdt_disabled select').prop(type, true); // select要素\n\n  // selectはreadonlyが効かないのでoptionをdisabledにする\n  // $('.sdt_disabled option').prop('disabled', true);\n  // $('.sdt_disabled option:selected').prop('disabled', false);\n\n  //コントロールアイコンを削除する\n  $('.sdt_disabled div.field-control div.ui-icon').remove();\n}\n\n$p.events.on_editor_load = function () {\n  setDisabled('disabled');\n}",
            "Id": 2
          },
          {
            "Title": "日付変更",
            "New": true,
            "Edit": true,
            "Body": "$p.on('change', 'DateB', function () {\n    PP()\n})\n\n//日付を1日に変更する関数\nfunction PP() {\n\n    let Date = $p.getControl(\"DateB\").val()\n    let parts = Date.split(\"/\");\n    parts[2] = 1;\n    let newDate = parts.join(\"/\");\n    $p.set($p.getControl('DateB'), newDate)\n\n}",
            "Id": 3
          },
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n",
            "Id": 4
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 5
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 6
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841977,
      "Title": "仕入先マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841977,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassD",
          "ClassB",
          "ClassC",
          "ClassE",
          "ClassF",
          "ClassG",
          "ClassH",
          "ClassI",
          "ClassJ",
          "ClassK",
          "ClassL",
          "ClassM",
          "DateA",
          "ClassN",
          "ClassO",
          "ClassP",
          "ClassQ",
          "ClassR",
          "ClassS",
          "ClassT",
          "ClassU",
          "ClassV",
          "ClassW",
          "NumA",
          "Class007",
          "NumB",
          "ClassX",
          "ClassY",
          "ClassZ",
          "Class001",
          "Class002",
          "Class003",
          "Class004",
          "Class005",
          "Class006"
        ],
        "FilterColumns": [
          "ClassA",
          "ClassB",
          "ClassC"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "_Section-1",
            "ClassB",
            "ClassC",
            "ClassE",
            "ClassF",
            "ClassD",
            "ClassG",
            "ClassH",
            "ClassI",
            "ClassJ",
            "ClassK",
            "ClassL",
            "ClassM",
            "DateA",
            "ClassN",
            "ClassO",
            "_Section-2",
            "ClassP",
            "ClassQ",
            "ClassR",
            "ClassS",
            "ClassT",
            "ClassU",
            "ClassV",
            "ClassW",
            "NumA",
            "Class007",
            "NumB",
            "ClassX",
            "ClassY",
            "ClassZ",
            "_Section-3",
            "Class001",
            "Class002",
            "Class003",
            "Class004",
            "Class005",
            "Class006",
            "Title",
            "_Links-1841979"
          ]
        },
        "SectionLatestId": 3,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 2,
            "LabelText": "支払先情報",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 3,
            "LabelText": "区分情報",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "仕入先CD",
            "ImportKey": true,
            "ValidateRequired": true,
            "MaxLength": 4.0,
            "ClientRegexValidation": "^[a-zA-Z0-9]*$",
            "RegexValidationMessage": "英数字のみ入力可能です。"
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "仕入先名1",
            "NoWrap": true,
            "ValidateRequired": true,
            "MaxLength": 28.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "仕入先名2",
            "NoWrap": true,
            "MaxLength": 28.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "登録番号",
            "MaxLength": 14.0,
            "ClientRegexValidation": "^[a-zA-Z0-9]*$",
            "RegexValidationMessage": "英数字のみ入力可能です。"
          },
          {
            "ColumnName": "ClassE",
            "LabelText": "略称",
            "NoWrap": true,
            "ValidateRequired": true,
            "MaxLength": 8.0
          },
          {
            "ColumnName": "ClassF",
            "LabelText": "フリガナ",
            "NoWrap": true,
            "ValidateRequired": true,
            "MaxLength": 5.0,
            "ClientRegexValidation": "^[a-zA-Z0-9ｦ-ﾟ]*$",
            "RegexValidationMessage": "英数字半角カナのみ入力可能です。"
          },
          {
            "ColumnName": "ClassG",
            "LabelText": "郵便番号",
            "NoWrap": true,
            "MaxLength": 8.0,
            "ClientRegexValidation": "^\\d{3}-\\d{4}$",
            "RegexValidationMessage": "999-9999形式で入力して下さい。"
          },
          {
            "ColumnName": "ClassH",
            "LabelText": "住所１",
            "NoWrap": true,
            "MaxLength": 32.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassI",
            "LabelText": "住所２",
            "NoWrap": true,
            "MaxLength": 32.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassJ",
            "LabelText": "TEL",
            "NoWrap": true,
            "MaxLength": 15.0,
            "ClientRegexValidation": "^[0-9\\-]+$",
            "RegexValidationMessage": "半角数字またはハイフンのみ入力可能です。"
          },
          {
            "ColumnName": "ClassK",
            "LabelText": "FAX",
            "MaxLength": 15.0,
            "ClientRegexValidation": "^[0-9\\-]+$",
            "RegexValidationMessage": "半角数字またはハイフンのみ入力可能です。"
          },
          {
            "ColumnName": "ClassL",
            "LabelText": "仕入先担当者名",
            "NoWrap": true,
            "MaxLength": 40.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassM",
            "LabelText": "メモ",
            "NoWrap": true,
            "MaxLength": 40.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassN",
            "LabelText": "担当者CD",
            "ChoicesText": "[\n    {\n        \"SiteId\": 3064531,\n        \"SearchFormat\": \"[ClassA] __ [ClassB]\",\n        \"Value\": \"[ClassA]\",\n        \"NoAddButton\" : true,\n        \"Lookups\": [\n      {\n        \"From\": \"ClassB\",\n        \"To\": \"ClassO\"\n      }\n         ]\n    }\n]",
            "UseSearch": true,
            "NoWrap": true,
            "ValidateRequired": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassO",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassO",
            "LabelText": "担当者名",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassP",
            "LabelText": "締日",
            "NoWrap": true,
            "ValidateRequired": true,
            "MaxLength": 2.0,
            "ClientRegexValidation": "^[0-9]*$",
            "RegexValidationMessage": "数値のみ入力可能です。",
            "ExtendedHtmlAfterControl": "<div style=\"padding-left: 100%; margin-top : 10px; white-space:nowrap;\">\n(月末=99　都度請求＝00)\n</div>"
          },
          {
            "ColumnName": "ClassQ",
            "LabelText": "支払方法CD",
            "ChoicesText": "0\n1\n2\n3",
            "DefaultInput": "0",
            "NoWrap": true,
            "ValidateRequired": true,
            "MaxLength": 1.0,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassR",
            "LabelText": "支払方法",
            "DefaultInput": "0:振込,1:集金,2:郵送,3:その他",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassS",
            "LabelText": "決算月",
            "NoWrap": true,
            "MaxLength": 2.0,
            "ClientRegexValidation": "^(1[0-2]|[0-9])$",
            "RegexValidationMessage": "数値が不正です。"
          },
          {
            "ColumnName": "ClassT",
            "LabelText": "支払様式CD",
            "ChoicesText": "0\n1\n2\n3\n4",
            "DefaultInput": "0",
            "ValidateRequired": true,
            "MaxLength": 1.0,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassU",
            "LabelText": "支払様式",
            "DefaultInput": "0:当社請求書,1:検収請求書,2:EDP手書,3:手書明細式,4:手書一覧式",
            "ExtendedFieldCss": "width500",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassV",
            "LabelText": "支払サイクルCD",
            "NoWrap": true,
            "MaxLength": 2.0,
            "ClientRegexValidation": "^[0-9]*$",
            "RegexValidationMessage": "数値のみ入力可能です。"
          },
          {
            "ColumnName": "ClassW",
            "LabelText": "支払サイクル",
            "DefaultInput": "0:当月,1～99:指定ヶ月後",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassX",
            "LabelText": "支払区分CD",
            "ChoicesText": "[\n    {\n        \"SiteId\": 2190749,\n        \"SearchFormat\": \"[ClassA] __ [ClassB] __ [ClassC]\",\n        \"Value\": \"[ClassA]\",\n        \"NoAddButton\" : true,\n        \"Lookups\": [\n              {\n                \"From\": \"ClassB\",\n                \"To\": \"ClassY\"\n              },\n              {\n                \"From\": \"ClassC\",\n                \"To\": \"ClassZ\"\n              },\n         ]\n    }\n]",
            "UseSearch": true,
            "NoWrap": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassY,ClassZ",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassY",
            "LabelText": "支払区分1",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassZ",
            "LabelText": "支払区分2",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "NumA",
            "LabelText": "導入支払金額",
            "Format": "C",
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumB",
            "LabelText": "導入買掛金額",
            "Format": "C",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "DateA",
            "LabelText": "最終使用日"
          },
          {
            "ColumnName": "Class007",
            "LabelText": "支払予定日",
            "MaxLength": 2.0,
            "ClientRegexValidation": "^(0{2}|99|[1-9]|[12][0-9]|3[01])$",
            "RegexValidationMessage": "数値が不正です。",
            "ExtendedHtmlAfterControl": "<div style=\"padding-left: 100%; margin-top : 10px; white-space:nowrap;\">\n(月末=99　都度請求＝00)\n</div>"
          },
          {
            "ColumnName": "Class001",
            "LabelText": "税集計区分CD",
            "ChoicesText": "0\n1\n3",
            "DefaultInput": "0",
            "NoWrap": true,
            "ValidateRequired": true,
            "MaxLength": 1.0,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "Class002",
            "LabelText": "税集計区分",
            "DefaultInput": "0:伝票単位　1:支払単位　2:明細単位　3:税対象外",
            "ExtendedFieldCss": "width450",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "Class003",
            "LabelText": "仕入端数CD",
            "ChoicesText": "0\n1\n2",
            "DefaultInput": "0",
            "ValidateRequired": true,
            "MaxLength": 1.0,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "Class004",
            "LabelText": "仕入端数",
            "DefaultInput": "0:四捨五入　1:切り上げ　2:切り捨て",
            "ExtendedFieldCss": "width450",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "Class005",
            "LabelText": "消費税端数CD",
            "ChoicesText": "0\n1\n2",
            "DefaultInput": "0",
            "ValidateRequired": true,
            "MaxLength": 1.0,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "Class006",
            "LabelText": "消費税端数",
            "DefaultInput": "0:四捨五入　1:切り上げ　2:切り捨て",
            "ExtendedFieldCss": "width450",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "Title",
            "Hide": true
          }
        ],
        "Links": [
          {
            "ColumnName": "ClassX",
            "SiteId": 2190749,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB] __ [ClassC]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassY"
              },
              {
                "From": "ClassC",
                "To": "ClassZ"
              }
            ],
            "JsonFormat": true
          },
          {
            "ColumnName": "ClassN",
            "SiteId": 3064531,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassO"
              }
            ],
            "JsonFormat": true
          }
        ],
        "Processes": [
          {
            "Id": 1,
            "Name": "更新",
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassB',byte:28},         {item:'ClassC',byte:28},         {item:'ClassE',byte:8},         {item:'ClassH',byte:32},         {item:'ClassI',byte:32},         {item:'ClassL',byte:40},         {item:'ClassM',byte:40}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          },
          {
            "Id": 2,
            "Name": "作成",
            "ScreenType": 10,
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassB',byte:28},         {item:'ClassC',byte:28},         {item:'ClassE',byte:8},         {item:'ClassH',byte:32},         {item:'ClassI',byte:32},         {item:'ClassL',byte:40},         {item:'ClassM',byte:40}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "ClassA",
        "Styles": [
          {
            "Title": "width",
            "New": true,
            "Edit": true,
            "Body": ".width500{\n    width:500px;\n}\n.width450{\n    width:450px;\n}\n.width250{\n    width:250px;\n}\n.width800{\n    width:800px;\n}",
            "Id": 1
          },
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 2
          },
          {
            "Title": "作成・更新ボタン非表示",
            "New": true,
            "Edit": true,
            "Body": "#CreateCommand{\n    display:none !important\n}\n#UpdateCommand{\n    display:none !important\n}",
            "Id": 3
          }
        ],
        "Scripts": [
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n  if($p.action() != 'edit'){\n      return;\n  }\n\n  $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n\n})",
            "Id": 1
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 2
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 3
          },
          {
            "Title": "バイト数チェック",
            "New": true,
            "Edit": true,
            "Body": "/**\n * sjisで使えない文字列を返す\n * @param {string} text エンコード文字列\n * @returns {Array} 文字化けした文字列配列\n */\nfunction detectUnsupportedChars(text) {\n    const utf16Array = Encoding.stringToCode(text); // 文字列をコードポイントの配列に変換\n    const sjisArray = Encoding.convert(utf16Array, 'SJIS', 'UNICODE'); // Shift JIS に変換\n    const restoredArray = Encoding.convert(sjisArray, 'UNICODE', 'SJIS'); // 再び UTF-16 に戻す\n    const restoredText = Encoding.codeToString(restoredArray); // 文字列に変換\n    \n    console.log(text);\n    console.log(restoredText);\n\n    text = Array.from(text);\n\n    let unsupportedChars = [];\n    for (let i = 0; i < text.length; i++) {\n        if (text[i] !== restoredText[i]) {\n            unsupportedChars.push(text[i]); // 変換後に変化した文字をリストアップ\n        }\n    }\n    \n    return unsupportedChars;\n}\n\n/**\n * 全角文字かチェックします。\n * @param str チェック対象の文字列\n * @returns 全角文字の場合 true\n */\nfunction isFullWidth(str) {\n    return /^[^\\x01-\\x7E\\uFF65-\\uFF9F]+$/.test(str);\n}\n\n/**\n * 入力文字のバリデーション\n * @param {string} label 対象項目名\n * @param {string} text 対象文字列\n * @param {number} byte バイト数\n */\nfunction byte_check(label,text,byte){\n    const unsuported_string = detectUnsupportedChars(text);\n    if(unsuported_string.length > 0){\n        alert(`下記文字列は使用できません。\\n${unsuported_string.toString()}`);\n        return false;\n    }\n\n    const byte_count = Array.from(text).reduce((a,b) => a += isFullWidth(b) ? 2 : 1,0);\n    if(byte_count > byte){\n        alert(`${label}の文字数が多すぎます。`);\n        return false;\n    }\n    return true;\n}\n\n// マスタ用\n/*[\n    {item:'ClassA',byte:15},\n    {item:'ClassB',byte:15},\n    {item:'ClassC',byte:15},\n]*/\nfunction maste_byte_check(e,option){\n    for(item of option){\n        const label = $p.getControl(item[\"item\"]).parent().parent().prev().text();\n        const text = $p.getControl(item[\"item\"]).val();\n        if(!byte_check(label,text,item[\"byte\"])){\n            return;\n        }\n    }\n    // 登録処理\n    const commandId = $p.action() == \"new\" ? \"CreateCommand\" : \"UpdateCommand\";\n    $(`#${commandId}`).click();\n}\n\n",
            "Id": 4
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          },
          {
            "Title": "encodingjs読み込み",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js\"></script>",
            "Id": 3
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//担当者CD、支払区分CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassN']);\n    newData['ClassN'] = n_results1[0]['ClassA'];\n} catch(e) {\n    newData['ClassN'] = '';\n}\ntry {\n    let n_results2 = items.Get(model['ClassX']);\n    newData['ClassX'] = n_results2[0]['ClassA'];\n} catch(e) {\n    newData['ClassX'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//担当者CD、支払区分CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassN']);\n    newData['ClassN'] = n_results1[0]['ClassA'];\n} catch(e) {\n    newData['ClassN'] = '';\n}\ntry {\n    let n_results2 = items.Get(model['ClassX']);\n    newData['ClassX'] = n_results2[0]['ClassA'];\n} catch(e) {\n    newData['ClassX'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n//担当者CD、支払区分CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassN']);\n    oldData['ClassN'] = o_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassN'] = '';\n}\ntry {\n    let o_results2 = items.Get(results[0]['ClassX'])\n    oldData['ClassX'] = o_results2[0]['ClassA'];\n} catch(e) {\n    newData['ClassX'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//担当者CD、支払区分CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassN']);\n    newData['ClassN'] = n_results1[0]['ClassA'];\n} catch(e) {\n    newData['ClassN'] = '';\n}\ntry {\n    let n_results2 = items.Get(model['ClassX']);\n    newData['ClassX'] = n_results2[0]['ClassA'];\n} catch(e) {\n    newData['ClassX'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n//担当者CD、支払区分CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassN']);\n    oldData['ClassN'] = o_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassN'] = '';\n}\ntry {\n    let o_results2 = items.Get(results[0]['ClassX'])\n    oldData['ClassX'] = o_results2[0]['ClassA'];\n} catch(e) {\n    newData['ClassX'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841978,
      "Title": "会社マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841978,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB",
          "ClassC",
          "ClassD",
          "ClassE",
          "ClassF",
          "ClassG",
          "ClassH",
          "ClassL",
          "ClassI",
          "ClassJ",
          "DateA",
          "ClassK"
        ],
        "FilterColumns": [
          "ClassA",
          "ClassB"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "ClassB",
            "ClassC",
            "ClassD",
            "ClassE",
            "ClassF",
            "ClassG",
            "ClassH",
            "ClassL",
            "ClassI",
            "ClassJ",
            "DateA",
            "ClassK",
            "ClassM",
            "Title"
          ]
        },
        "TitleColumns": [
          "ClassM"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "社名1",
            "ValidateRequired": true,
            "MaxLength": 30.0
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "社名2",
            "MaxLength": 30.0
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "郵便番号",
            "MaxLength": 8.0,
            "ClientRegexValidation": "^\\d{3}-\\d{4}$",
            "RegexValidationMessage": "999-9999形式で入力して下さい。",
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "住所1",
            "NoWrap": true,
            "MaxLength": 40.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassE",
            "LabelText": "住所2",
            "NoWrap": true,
            "MaxLength": 40.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassF",
            "LabelText": "電話番号",
            "MaxLength": 15.0,
            "ClientRegexValidation": "^[0-9\\-]+$",
            "RegexValidationMessage": "半角数字またはハイフンのみ入力可能です。"
          },
          {
            "ColumnName": "ClassG",
            "LabelText": "FAX",
            "MaxLength": 15.0,
            "ClientRegexValidation": "^[0-9\\-]+$",
            "RegexValidationMessage": "半角数字またはハイフンのみ入力可能です。"
          },
          {
            "ColumnName": "ClassH",
            "LabelText": "代表者名",
            "MaxLength": 30.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassI",
            "LabelText": "期首月",
            "EditorReadOnly": true,
            "TextAlign": 20
          },
          {
            "ColumnName": "ClassJ",
            "LabelText": "締日",
            "EditorReadOnly": true,
            "TextAlign": 20
          },
          {
            "ColumnName": "ClassK",
            "LabelText": "登録番号",
            "MaxLength": 14.0,
            "ClientRegexValidation": "^[a-zA-Z0-9]*$",
            "RegexValidationMessage": "英数字のみ入力可能です。"
          },
          {
            "ColumnName": "DateA",
            "LabelText": "入力開始日",
            "EditorReadOnly": true,
            "TextAlign": 20
          },
          {
            "ColumnName": "ClassL",
            "LabelText": "コールセンター番号",
            "MaxLength": 15.0,
            "ClientRegexValidation": "^[0-9\\-]+$",
            "RegexValidationMessage": "半角数字またはハイフンのみ入力可能です。"
          },
          {
            "ColumnName": "ClassM",
            "LabelText": "会社ID",
            "DefaultInput": "01",
            "ImportKey": true,
            "Hide": true,
            "NoDuplication": true
          }
        ],
        "Processes": [
          {
            "Id": 1,
            "Name": "作成",
            "ScreenType": 10,
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassA',byte:30},         {item:'ClassB',byte:30},         {item:'ClassD',byte:40},         {item:'ClassE',byte:40},         {item:'ClassH',byte:30}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          },
          {
            "Id": 2,
            "Name": "更新",
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassA',byte:30},         {item:'ClassB',byte:30},         {item:'ClassD',byte:40},         {item:'ClassE',byte:40},         {item:'ClassH',byte:30}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "ClassM",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          },
          {
            "Title": "作成・更新ボタン非表示",
            "New": true,
            "Edit": true,
            "Body": "#CreateCommand{\n    display:none !important\n}\n#UpdateCommand{\n    display:none !important\n}",
            "Id": 2
          }
        ],
        "Scripts": [
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n",
            "Id": 1
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 2
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 3
          },
          {
            "Title": "バイト数チェック",
            "New": true,
            "Edit": true,
            "Body": "/**\n * sjisで使えない文字列を返す\n * @param {string} text エンコード文字列\n * @returns {Array} 文字化けした文字列配列\n */\nfunction detectUnsupportedChars(text) {\n    const utf16Array = Encoding.stringToCode(text); // 文字列をコードポイントの配列に変換\n    const sjisArray = Encoding.convert(utf16Array, 'SJIS', 'UNICODE'); // Shift JIS に変換\n    const restoredArray = Encoding.convert(sjisArray, 'UNICODE', 'SJIS'); // 再び UTF-16 に戻す\n    const restoredText = Encoding.codeToString(restoredArray); // 文字列に変換\n    \n    console.log(text);\n    console.log(restoredText);\n\n    text = Array.from(text);\n\n    let unsupportedChars = [];\n    for (let i = 0; i < text.length; i++) {\n        if (text[i] !== restoredText[i]) {\n            unsupportedChars.push(text[i]); // 変換後に変化した文字をリストアップ\n        }\n    }\n    \n    return unsupportedChars;\n}\n\n/**\n * 全角文字かチェックします。\n * @param str チェック対象の文字列\n * @returns 全角文字の場合 true\n */\nfunction isFullWidth(str) {\n    return /^[^\\x01-\\x7E\\uFF65-\\uFF9F]+$/.test(str);\n}\n\n/**\n * 入力文字のバリデーション\n * @param {string} label 対象項目名\n * @param {string} text 対象文字列\n * @param {number} byte バイト数\n */\nfunction byte_check(label,text,byte){\n    const unsuported_string = detectUnsupportedChars(text);\n    if(unsuported_string.length > 0){\n        alert(`下記文字列は使用できません。\\n${unsuported_string.toString()}`);\n        return false;\n    }\n\n    const byte_count = Array.from(text).reduce((a,b) => a += isFullWidth(b) ? 2 : 1,0);\n    if(byte_count > byte){\n        alert(`${label}の文字数が多すぎます。`);\n        return false;\n    }\n    return true;\n}\n\n// マスタ用\n/*[\n    {item:'ClassA',byte:15},\n    {item:'ClassB',byte:15},\n    {item:'ClassC',byte:15},\n]*/\nfunction maste_byte_check(e,option){\n    for(item of option){\n        const label = $p.getControl(item[\"item\"]).parent().parent().prev().text();\n        const text = $p.getControl(item[\"item\"]).val();\n        if(!byte_check(label,text,item[\"byte\"])){\n            return;\n        }\n    }\n    // 登録処理\n    const commandId = $p.action() == \"new\" ? \"CreateCommand\" : \"UpdateCommand\";\n    $(`#${commandId}`).click();\n}\n\n",
            "Id": 4
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          },
          {
            "Title": "encodingjs読み込み",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js\"></script>",
            "Id": 3
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841980,
      "Title": "科目マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841980,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB",
          "ClassC",
          "ClassD",
          "NumA",
          "ClassE",
          "ClassF"
        ],
        "FilterColumns": [
          "ClassA",
          "ClassB"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "_Section-1",
            "ClassB",
            "ClassC",
            "ClassD",
            "NumA",
            "ClassE",
            "ClassF",
            "Title"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "科目CD",
            "ImportKey": true,
            "ValidateRequired": true,
            "MaxLength": 4.0,
            "ClientRegexValidation": "^[0-9]*$",
            "RegexValidationMessage": "数値のみ入力可能です。"
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "科目名",
            "ValidateRequired": true,
            "MaxLength": 14.0
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "借方消費税区分",
            "MaxLength": 2.0,
            "ClientRegexValidation": "^[0-9]*$",
            "RegexValidationMessage": "数値のみ入力可能です。"
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "貸方消費税区分",
            "MaxLength": 2.0,
            "ClientRegexValidation": "^[0-9]*$",
            "RegexValidationMessage": "数値のみ入力可能です。"
          },
          {
            "ColumnName": "ClassF",
            "LabelText": "按分区分",
            "ChoicesText": "0\n1\n2\n3",
            "NoWrap": true,
            "MaxLength": 1.0,
            "ExtendedHtmlAfterControl": "<div style=\"padding-left: 100%; margin-top : 10px; white-space:nowrap;\">\n(0:人数按分,1:売上金額按分,2:個別按分,3:人数＋売上按分)\n</div>",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassE",
            "LabelText": "集計CD",
            "ChoicesText": "1\n2\n3",
            "ValidateRequired": true,
            "MaxLength": 1.0,
            "ExtendedHtmlAfterControl": "<div style=\"padding-left: 100%; margin-top : 10px; white-space:nowrap;\">\n(1:人件費,2:一般管理費,3:営業外)\n</div>",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "NumA",
            "LabelText": "順序",
            "Nullable": true,
            "Min": 0.0,
            "Max": 9999.0
          }
        ],
        "Processes": [
          {
            "Id": 1,
            "Name": "更新",
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassB',byte:16}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          },
          {
            "Id": 2,
            "Name": "作成",
            "ScreenType": 10,
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassB',byte:16}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "ClassA",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          },
          {
            "Title": "作成・更新ボタン非表示",
            "New": true,
            "Edit": true,
            "Body": "#CreateCommand{\n    display:none !important\n}\n#UpdateCommand{\n    display:none !important\n}",
            "Id": 2
          }
        ],
        "Scripts": [
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n    if($p.action() != 'edit'){\n        return;\n    }\n\n    $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n})",
            "Id": 1
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 2
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 3
          },
          {
            "Title": "バイト数チェック",
            "New": true,
            "Edit": true,
            "Body": "/**\n * sjisで使えない文字列を返す\n * @param {string} text エンコード文字列\n * @returns {Array} 文字化けした文字列配列\n */\nfunction detectUnsupportedChars(text) {\n    const utf16Array = Encoding.stringToCode(text); // 文字列をコードポイントの配列に変換\n    const sjisArray = Encoding.convert(utf16Array, 'SJIS', 'UNICODE'); // Shift JIS に変換\n    const restoredArray = Encoding.convert(sjisArray, 'UNICODE', 'SJIS'); // 再び UTF-16 に戻す\n    const restoredText = Encoding.codeToString(restoredArray); // 文字列に変換\n    \n    console.log(text);\n    console.log(restoredText);\n\n    text = Array.from(text);\n\n    let unsupportedChars = [];\n    for (let i = 0; i < text.length; i++) {\n        if (text[i] !== restoredText[i]) {\n            unsupportedChars.push(text[i]); // 変換後に変化した文字をリストアップ\n        }\n    }\n    \n    return unsupportedChars;\n}\n\n/**\n * 全角文字かチェックします。\n * @param str チェック対象の文字列\n * @returns 全角文字の場合 true\n */\nfunction isFullWidth(str) {\n    return /^[^\\x01-\\x7E\\uFF65-\\uFF9F]+$/.test(str);\n}\n\n/**\n * 入力文字のバリデーション\n * @param {string} label 対象項目名\n * @param {string} text 対象文字列\n * @param {number} byte バイト数\n */\nfunction byte_check(label,text,byte){\n    const unsuported_string = detectUnsupportedChars(text);\n    if(unsuported_string.length > 0){\n        alert(`下記文字列は使用できません。\\n${unsuported_string.toString()}`);\n        return false;\n    }\n\n    const byte_count = Array.from(text).reduce((a,b) => a += isFullWidth(b) ? 2 : 1,0);\n    if(byte_count > byte){\n        alert(`${label}の文字数が多すぎます。`);\n        return false;\n    }\n    return true;\n}\n\n// マスタ用\n/*[\n    {item:'ClassA',byte:15},\n    {item:'ClassB',byte:15},\n    {item:'ClassC',byte:15},\n]*/\nfunction maste_byte_check(e,option){\n    for(item of option){\n        const label = $p.getControl(item[\"item\"]).parent().parent().prev().text();\n        const text = $p.getControl(item[\"item\"]).val();\n        if(!byte_check(label,text,item[\"byte\"])){\n            return;\n        }\n    }\n    // 登録処理\n    const commandId = $p.action() == \"new\" ? \"CreateCommand\" : \"UpdateCommand\";\n    $(`#${commandId}`).click();\n}\n\n",
            "Id": 4
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          },
          {
            "Title": "encodingjs読み込み",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js\"></script>",
            "Id": 3
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841981,
      "Title": "税率マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841981,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "DateA",
          "NumA",
          "NumB"
        ],
        "FilterColumns": [],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "DateA",
            "_Section-1",
            "NumA",
            "NumB",
            "Title"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "NumA",
            "LabelText": "切替前税率",
            "Unit": "％",
            "Min": 0.0,
            "Max": 999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumB",
            "LabelText": "切替後税率",
            "Unit": "％",
            "Min": 0.0,
            "Max": 999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "DateA",
            "LabelText": "切替日付",
            "ValidateRequired": true
          },
          {
            "ColumnName": "Title",
            "Hide": true
          },
          {
            "ColumnName": "ResultId",
            "Hide": true
          },
          {
            "ColumnName": "ClassA",
            "LabelText": "税率ID",
            "DefaultInput": "ZR",
            "ImportKey": true,
            "Hide": true,
            "ValidateRequired": true,
            "NoDuplication": true,
            "CopyByDefault": true,
            "EditorReadOnly": true
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc",
              "DateA": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "ClassA",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          }
        ],
        "Scripts": [
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n",
            "Id": 1
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 2
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 3
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841982,
      "Title": "請求金額マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841982,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB",
          "DateA",
          "NumA",
          "NumB",
          "NumC",
          "NumD",
          "NumE",
          "NumF",
          "NumG",
          "NumH",
          "DateB",
          "DateC",
          "NumI"
        ],
        "FilterColumns": [
          "ClassA",
          "ClassB",
          "DateA",
          "DateB",
          "DateC"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "ClassB",
            "DateA",
            "_Section-1",
            "NumA",
            "NumB",
            "NumC",
            "NumD",
            "NumE",
            "NumF",
            "NumG",
            "NumH",
            "DateB",
            "DateC",
            "NumI",
            "_Links-1841987",
            "Title",
            "Class100"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "得意先CD",
            "ChoicesText": "[\n    {\n        \"SiteId\": 1841987,\n        \"SearchFormat\": \"[ClassA] __ [ClassB] __ [ClassC]\",\n        \"Value\": \"[ClassA]\",\n        \"NoAddButton\" : true,\n        \"Lookups\": [\n              {\n                \"From\": \"ClassB\",\n                \"To\": \"ClassB\"\n              },\n         ]\n    }\n]",
            "UseSearch": true,
            "ValidateRequired": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassB",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "得意先名",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "NumA",
            "LabelText": "前月残高",
            "Format": "C",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumB",
            "LabelText": "入金金額",
            "Format": "C",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumC",
            "LabelText": "調整金額",
            "Format": "C",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumD",
            "LabelText": "売上金額",
            "Format": "C",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumE",
            "LabelText": "返品金額",
            "Format": "C",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumF",
            "LabelText": "訂正金額",
            "Format": "C",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumG",
            "LabelText": "消費税額",
            "Format": "C",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumH",
            "LabelText": "当月残高",
            "Format": "C",
            "NoWrap": true,
            "ExtendedFieldCss": "sdt_disabled",
            "Min": 0.0,
            "Max": 99999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumI",
            "LabelText": "伝票枚数",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "DateA",
            "LabelText": "請求日付",
            "NoWrap": true,
            "ValidateRequired": true,
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "DateB",
            "LabelText": "請求開始日付",
            "ValidateRequired": true,
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "DateC",
            "LabelText": "請求終了日付",
            "ValidateRequired": true,
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "Title",
            "Hide": true,
            "ValidateRequired": false,
            "NoDuplication": true
          },
          {
            "ColumnName": "Class100",
            "LabelText": "主キー項目",
            "ImportKey": true,
            "Hide": true,
            "NoDuplication": true
          }
        ],
        "Links": [
          {
            "ColumnName": "ClassA",
            "SiteId": 1841987,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB] __ [ClassC]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassB"
              }
            ],
            "JsonFormat": true
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc",
              "ClassB": "asc",
              "DateA": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "CalendarTimePeriod": "Monthly",
            "CalendarFromTo": "DateA",
            "CrosstabGroupByX": "ClassA",
            "CrosstabGroupByY": "ClassA",
            "CrosstabAggregateType": "Total",
            "CrosstabValue": "NumA",
            "CrosstabTimePeriod": "Monthly",
            "KambanAggregateType": "Count",
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "Class100",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          }
        ],
        "Scripts": [
          {
            "Title": "主キー設定",
            "New": true,
            "Edit": true,
            "Body": "$(document).on('change', '#Results_ClassA, #Results_DateA', function () {\n    var A = $('#Results_ClassA').val();\n    var B = $('#Results_DateA').val();\n\n   $p.set($('#Results_Class100'), A + '__' + B);\n})",
            "Id": 1
          },
          {
            "Title": "当月残高計算",
            "New": true,
            "Edit": true,
            "Body": "let Zan  //当月残高\n\n$p.on('change', 'NumA', function () { //前月残高\n    A = $p.getControl('NumA').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumA'), EN(B)); \n    NUM();\n})\n\n\n$p.on('change', 'NumB', function () { //前月残高\n    A = $p.getControl('NumB').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumB'), EN(B));\n    NUM();\n})\n\n\n$p.on('change', 'NumC', function () { //前月残高\n    A = $p.getControl('NumC').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumC'), EN(B));\n    NUM();\n})\n\n$p.on('change', 'NumD', function () { //前月残高\n    A = $p.getControl('NumD').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumD'), EN(B));\n    NUM();\n})\n\n\n$p.on('change', 'NumE', function () { //前月残高\n    A = $p.getControl('NumE').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumE'), EN(B));\n    NUM();\n})\n\n\n$p.on('change', 'NumE', function () { //前月残高\n    A = $p.getControl('NumE').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumE'), EN(B));\n    NUM();\n})\n\n$p.on('change', 'NumF', function () { //前月残高\n    A = $p.getControl('NumF').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumF'), EN(B));\n    NUM();\n})\n\n$p.on('change', 'NumG', function () { //前月残高\n    A = $p.getControl('NumG').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumG'), EN(B));\n    NUM();\n})\n//取得した合計金額を数値に変換して計算する関数\nfunction NUM() {\n    A = $p.getControl('NumA').val();\n    B = $p.getControl('NumB').val();\n    C = $p.getControl('NumC').val();\n    D = $p.getControl('NumD').val();\n    E = $p.getControl('NumE').val();\n    F = $p.getControl('NumF').val();\n    G = $p.getControl('NumG').val();\n\n    A1 = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n    B1 = parseInt(String(B).replace(/[^0-9]/g, ''), 10);\n    C1 = parseInt(String(C).replace(/[^0-9]/g, ''), 10);\n    D1 = parseInt(String(D).replace(/[^0-9]/g, ''), 10);\n    E1 = parseInt(String(E).replace(/[^0-9]/g, ''), 10);\n    F1 = parseInt(String(F).replace(/[^0-9]/g, ''), 10);\n    G1 = parseInt(String(G).replace(/[^0-9]/g, ''), 10);\n\n    let H\n\n    //当月残高=前月残高-入金金額-調整金額+売上金額+返品金額+訂正金額+消費税額\n    H = A1 - B1 - C1 + D1 + E1 + F1 + G1;\n    $p.set($p.getControl('NumH'), EN(H)); //(A)小計\n}\n\n//\\マークと３桁区切りのカンマを追加する関数\nfunction EN(x) {\n    x = '\\xA5' + Math.round(x).toLocaleString();\n    return x;\n}",
            "Id": 2
          },
          {
            "Title": "sdt_disabled",
            "New": true,
            "Edit": true,
            "Body": "// =================================================\n// フィールドCSSに'sdt_disabled'クラスが設定されているフィールドを\n// disabledにします。\n// $p.set()は稼働しますが、手動での操作を制限します。\n// -------------------------------------------------\n// 引数：disabledにするかreadonlyにするか\n// =================================================\n\nfunction setDisabled(type){\n  //該当の入力エリアをdisabled / readonlyにする\n  $('.sdt_disabled input').prop(type, true); // 一般的なinput要素\n  $('.sdt_disabled input[type=\"number\"]').prop(type, true); // 数値用のinput要素\n  $('.sdt_disabled textarea').prop(type, true); // textarea要素\n  $('.sdt_disabled select').prop(type, true); // select要素\n\n  // selectはreadonlyが効かないのでoptionをdisabledにする\n  // $('.sdt_disabled option').prop('disabled', true);\n  // $('.sdt_disabled option:selected').prop('disabled', false);\n\n  //コントロールアイコンを削除する\n  $('.sdt_disabled div.field-control div.ui-icon').remove();\n}\n\n\nonEditorLoadFuncs.push(\n  function () {\n    setDisabled('disabled');\n  }\n)",
            "Id": 3
          },
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n    if($p.action() != 'edit'){\n        return;\n    }\n\n    $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_DateA').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_DateAField .ui-icon').css('display','none');\n})",
            "Id": 4
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 5
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 6
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//得意先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//得意先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n//得意先CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassA'])\n    oldData['ClassA'] = o_results1[0]['ClassA']\n} catch(e) {\n    oldData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//得意先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n//得意先CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassA'])\n    oldData['ClassA'] = o_results1[0]['ClassA']\n} catch(e) {\n    oldData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841983,
      "Title": "配送先マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841983,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB",
          "ClassC",
          "ClassD",
          "ClassE",
          "ClassF",
          "ClassG",
          "ClassH",
          "ClassI",
          "ClassJ",
          "ClassK",
          "ClassL"
        ],
        "FilterColumns": [
          "ClassA",
          "ClassB",
          "ClassE"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "_Section-1",
            "ClassB",
            "ClassC",
            "ClassD",
            "ClassE",
            "ClassF",
            "ClassG",
            "ClassH",
            "ClassI",
            "ClassJ",
            "ClassK",
            "ClassL",
            "Title"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "配送先CD",
            "ImportKey": true,
            "ValidateRequired": true,
            "MaxLength": 2.0,
            "ClientRegexValidation": "^[a-zA-Z0-9]*$",
            "RegexValidationMessage": "英数字のみ入力可能です。",
            "NoDuplication": true,
            "CopyByDefault": true
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "配送先名1",
            "NoWrap": true,
            "ValidateRequired": true,
            "MaxLength": 28.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "配送先名2",
            "NoWrap": true,
            "MaxLength": 28.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "略称",
            "NoWrap": true,
            "ValidateRequired": true,
            "MaxLength": 8.0
          },
          {
            "ColumnName": "ClassE",
            "LabelText": "フリガナ",
            "NoWrap": true,
            "ValidateRequired": true,
            "MaxLength": 5.0,
            "ClientRegexValidation": "^[a-zA-Z0-9ｦ-ﾟ]*$",
            "RegexValidationMessage": "英数字半角カナのみ入力可能です。"
          },
          {
            "ColumnName": "ClassF",
            "LabelText": "郵便番号",
            "NoWrap": true,
            "MaxLength": 8.0,
            "ClientRegexValidation": "^\\d{3}-\\d{4}$",
            "RegexValidationMessage": "999-9999形式で入力して下さい。"
          },
          {
            "ColumnName": "ClassG",
            "LabelText": "住所1",
            "NoWrap": true,
            "MaxLength": 32.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassH",
            "LabelText": "住所2",
            "NoWrap": true,
            "MaxLength": 32.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassI",
            "LabelText": "TEL",
            "NoWrap": true,
            "MaxLength": 15.0,
            "ClientRegexValidation": "^[0-9\\-]+$",
            "RegexValidationMessage": "半角数字またはハイフンのみ入力可能です。"
          },
          {
            "ColumnName": "ClassJ",
            "LabelText": "FAX",
            "NoWrap": true,
            "MaxLength": 15.0,
            "ClientRegexValidation": "^[0-9\\-]+$",
            "RegexValidationMessage": "半角数字またはハイフンのみ入力可能です。"
          },
          {
            "ColumnName": "ClassK",
            "LabelText": "配送先担当者名",
            "NoWrap": true,
            "MaxLength": 40.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassL",
            "LabelText": "メモ",
            "NoWrap": true,
            "MaxLength": 40.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "Title",
            "Hide": true
          }
        ],
        "Processes": [
          {
            "Id": 1,
            "Name": "作成",
            "ScreenType": 10,
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassB',byte:28},         {item:'ClassC',byte:28},         {item:'ClassD',byte:8},         {item:'ClassG',byte:32},         {item:'ClassH',byte:32},         {item:'ClassK',byte:40},         {item:'ClassL',byte:40}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          },
          {
            "Id": 2,
            "Name": "更新",
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassB',byte:28},         {item:'ClassC',byte:28},         {item:'ClassD',byte:8},         {item:'ClassG',byte:32},         {item:'ClassH',byte:32},         {item:'ClassK',byte:40},         {item:'ClassL',byte:40}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "ColumnSorterHash": {
              "ClassA": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "ClassA",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          },
          {
            "Title": "作成・更新ボタン非表示",
            "New": true,
            "Edit": true,
            "Body": "#CreateCommand{\n    display:none !important\n}\n#UpdateCommand{\n    display:none !important\n}",
            "Id": 2
          }
        ],
        "Scripts": [
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n  if($p.action() != 'edit'){\n      return;\n  }\n\n  $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n\n})",
            "Id": 1
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 2
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 3
          },
          {
            "Title": "バイト数チェック",
            "New": true,
            "Edit": true,
            "Body": "/**\n * sjisで使えない文字列を返す\n * @param {string} text エンコード文字列\n * @returns {Array} 文字化けした文字列配列\n */\nfunction detectUnsupportedChars(text) {\n    const utf16Array = Encoding.stringToCode(text); // 文字列をコードポイントの配列に変換\n    const sjisArray = Encoding.convert(utf16Array, 'SJIS', 'UNICODE'); // Shift JIS に変換\n    const restoredArray = Encoding.convert(sjisArray, 'UNICODE', 'SJIS'); // 再び UTF-16 に戻す\n    const restoredText = Encoding.codeToString(restoredArray); // 文字列に変換\n    \n    console.log(text);\n    console.log(restoredText);\n\n    text = Array.from(text);\n\n    let unsupportedChars = [];\n    for (let i = 0; i < text.length; i++) {\n        if (text[i] !== restoredText[i]) {\n            unsupportedChars.push(text[i]); // 変換後に変化した文字をリストアップ\n        }\n    }\n    \n    return unsupportedChars;\n}\n\n/**\n * 全角文字かチェックします。\n * @param str チェック対象の文字列\n * @returns 全角文字の場合 true\n */\nfunction isFullWidth(str) {\n    return /^[^\\x01-\\x7E\\uFF65-\\uFF9F]+$/.test(str);\n}\n\n/**\n * 入力文字のバリデーション\n * @param {string} label 対象項目名\n * @param {string} text 対象文字列\n * @param {number} byte バイト数\n */\nfunction byte_check(label,text,byte){\n    const unsuported_string = detectUnsupportedChars(text);\n    if(unsuported_string.length > 0){\n        alert(`下記文字列は使用できません。\\n${unsuported_string.toString()}`);\n        return false;\n    }\n\n    const byte_count = Array.from(text).reduce((a,b) => a += isFullWidth(b) ? 2 : 1,0);\n    if(byte_count > byte){\n        alert(`${label}の文字数が多すぎます。`);\n        return false;\n    }\n    return true;\n}\n\n// マスタ用\n/*[\n    {item:'ClassA',byte:15},\n    {item:'ClassB',byte:15},\n    {item:'ClassC',byte:15},\n]*/\nfunction maste_byte_check(e,option){\n    for(item of option){\n        const label = $p.getControl(item[\"item\"]).parent().parent().prev().text();\n        const text = $p.getControl(item[\"item\"]).val();\n        if(!byte_check(label,text,item[\"byte\"])){\n            return;\n        }\n    }\n    // 登録処理\n    const commandId = $p.action() == \"new\" ? \"CreateCommand\" : \"UpdateCommand\";\n    $(`#${commandId}`).click();\n}\n\n",
            "Id": 4
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          },
          {
            "Title": "encodingjs読み込み",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js\"></script>",
            "Id": 3
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841984,
      "Title": "ウエルシア物件内容マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841984,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB"
        ],
        "FilterColumns": [
          "ClassA",
          "ClassB"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "_Section-1",
            "ClassB",
            "Title"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "内容CD",
            "ImportKey": true,
            "ValidateRequired": true,
            "MaxLength": 3.0,
            "ClientRegexValidation": "^[0-9]*$",
            "RegexValidationMessage": "数値のみ入力可能です。",
            "NoDuplication": true
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "ウエルシア物件内容名",
            "ValidateRequired": true,
            "MaxLength": 40.0
          },
          {
            "ColumnName": "Title",
            "Hide": true,
            "ValidateRequired": false
          }
        ],
        "Processes": [
          {
            "Id": 1,
            "Name": "更新",
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[ {item:'ClassB',byte:60}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          },
          {
            "Id": 2,
            "Name": "作成",
            "ScreenType": 10,
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[ {item:'ClassB',byte:60}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "ClassA",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          },
          {
            "Title": "作成・更新ボタン非表示",
            "New": true,
            "Edit": true,
            "Body": "#CreateCommand{\n    display:none !important\n}\n#UpdateCommand{\n    display:none !important\n}",
            "Id": 2
          }
        ],
        "Scripts": [
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n    if($p.action() != 'edit'){\n        return;\n    }\n\n    $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n})",
            "Id": 1
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 2
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 3
          },
          {
            "Title": "バイト数チェック",
            "New": true,
            "Edit": true,
            "Body": "/**\n * sjisで使えない文字列を返す\n * @param {string} text エンコード文字列\n * @returns {Array} 文字化けした文字列配列\n */\nfunction detectUnsupportedChars(text) {\n    const utf16Array = Encoding.stringToCode(text); // 文字列をコードポイントの配列に変換\n    const sjisArray = Encoding.convert(utf16Array, 'SJIS', 'UNICODE'); // Shift JIS に変換\n    const restoredArray = Encoding.convert(sjisArray, 'UNICODE', 'SJIS'); // 再び UTF-16 に戻す\n    const restoredText = Encoding.codeToString(restoredArray); // 文字列に変換\n    \n    console.log(text);\n    console.log(restoredText);\n\n    text = Array.from(text);\n\n    let unsupportedChars = [];\n    for (let i = 0; i < text.length; i++) {\n        if (text[i] !== restoredText[i]) {\n            unsupportedChars.push(text[i]); // 変換後に変化した文字をリストアップ\n        }\n    }\n    \n    return unsupportedChars;\n}\n\n/**\n * 全角文字かチェックします。\n * @param str チェック対象の文字列\n * @returns 全角文字の場合 true\n */\nfunction isFullWidth(str) {\n    return /^[^\\x01-\\x7E\\uFF65-\\uFF9F]+$/.test(str);\n}\n\n/**\n * 入力文字のバリデーション\n * @param {string} label 対象項目名\n * @param {string} text 対象文字列\n * @param {number} byte バイト数\n */\nfunction byte_check(label,text,byte){\n    const unsuported_string = detectUnsupportedChars(text);\n    if(unsuported_string.length > 0){\n        alert(`下記文字列は使用できません。\\n${unsuported_string.toString()}`);\n        return false;\n    }\n\n    const byte_count = Array.from(text).reduce((a,b) => a += isFullWidth(b) ? 2 : 1,0);\n    if(byte_count > byte){\n        alert(`${label}の文字数が多すぎます。`);\n        return false;\n    }\n    return true;\n}\n\n// マスタ用\n/*[\n    {item:'ClassA',byte:15},\n    {item:'ClassB',byte:15},\n    {item:'ClassC',byte:15},\n]*/\nfunction maste_byte_check(e,option){\n    for(item of option){\n        const label = $p.getControl(item[\"item\"]).parent().parent().prev().text();\n        const text = $p.getControl(item[\"item\"]).val();\n        if(!byte_check(label,text,item[\"byte\"])){\n            return;\n        }\n    }\n    // 登録処理\n    const commandId = $p.action() == \"new\" ? \"CreateCommand\" : \"UpdateCommand\";\n    $(`#${commandId}`).click();\n}\n\n",
            "Id": 4
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          },
          {
            "Title": "encodingjs読み込み",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js\"></script>",
            "Id": 3
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "AfterCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        context.Log(model[key]);\n        context.Log(key);\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Log('リザルトID');\n    context.Log(model['ResultId']);\n    items.Delete(model['ResultId']);\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "__",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841985,
      "Title": "売上仕入単価マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841985,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB",
          "ClassC",
          "ClassD",
          "ClassE",
          "ClassJ",
          "ClassG",
          "ClassH",
          "NumI",
          "NumJ",
          "NumK",
          "NumL",
          "NumE",
          "NumF",
          "NumG",
          "NumA",
          "NumB",
          "NumC",
          "NumD",
          "DateA"
        ],
        "FilterColumns": [
          "ClassA",
          "ClassB",
          "ClassC",
          "ClassD",
          "ClassE",
          "ClassJ",
          "ClassG",
          "ClassH"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "ClassC",
            "ClassE",
            "ClassJ",
            "ClassG",
            "_Section-1",
            "ClassB",
            "ClassD",
            "ClassH",
            "NumI",
            "NumJ",
            "NumK",
            "NumL",
            "NumE",
            "NumF",
            "NumG",
            "NumB",
            "NumA",
            "NumD",
            "NumC",
            "_Links-1841977",
            "_Links-1841987",
            "Title",
            "Class100"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "得意先CD",
            "ChoicesText": "[\n    {\n        \"SiteId\": 1841987,\n        \"SearchFormat\": \"[ClassA] __ [ClassB] __ [ClassC]\",\n        \"Value\": \"[ClassA]\",\n        \"NoAddButton\" : true,\n        \"Lookups\": [\n              {\n                \"From\": \"ClassB\",\n                \"To\": \"ClassB\"\n              },\n         ]\n    }\n]",
            "UseSearch": true,
            "NoWrap": true,
            "ValidateRequired": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassB",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "得意先名",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "仕入先CD",
            "ChoicesText": "[\n    {\n        \"SiteId\": 1841977,\n        \"SearchFormat\": \"[ClassA] __ [ClassB] __ [ClassC]\",\n        \"Value\": \"[ClassA]\",\n        \"NoAddButton\" : true,\n        \"Lookups\": [\n             {\n                \"From\": \"ClassB\",\n                \"To\": \"ClassD\"\n              },\n         ]\n    }\n]",
            "UseSearch": true,
            "NoWrap": true,
            "ValidateRequired": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassD",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "仕入先名",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassE",
            "LabelText": "PC区分",
            "NoWrap": true,
            "MaxLength": 1.0,
            "ClientRegexValidation": "^[a-zA-Z0-9]*$",
            "RegexValidationMessage": "英数字または記号のみ入力可能です。"
          },
          {
            "ColumnName": "ClassG",
            "LabelText": "仕様No",
            "ExtendedFieldCss": "sdt_disabled",
            "MaxLength": 10.0
          },
          {
            "ColumnName": "ClassH",
            "LabelText": "名称",
            "ExtendedFieldCss": "sdt_disabled"
          },
          {
            "ColumnName": "NumA",
            "LabelText": "大口売上単価",
            "Format": "C",
            "Nullable": true,
            "Min": 0.0,
            "Max": 99999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumB",
            "LabelText": "大口仕入単価",
            "Format": "C",
            "NoWrap": true,
            "Nullable": true,
            "Min": 0.0,
            "Max": 99999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumC",
            "LabelText": "小口売上単価",
            "Format": "C",
            "Nullable": true,
            "Min": 0.0,
            "Max": 99999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumD",
            "LabelText": "小口仕入単価",
            "Format": "C",
            "Nullable": true,
            "Min": 0.0,
            "Max": 99999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "DateA",
            "LabelText": "初期登録日"
          },
          {
            "ColumnName": "Class100",
            "LabelText": "主キー項目",
            "ImportKey": true,
            "Hide": true,
            "NoDuplication": true
          },
          {
            "ColumnName": "NumI",
            "LabelText": "W",
            "NoWrap": true,
            "ExtendedFieldCss": "sdt_disabled"
          },
          {
            "ColumnName": "NumJ",
            "LabelText": "D",
            "NoWrap": true,
            "ExtendedFieldCss": "sdt_disabled"
          },
          {
            "ColumnName": "NumK",
            "LabelText": "H",
            "NoWrap": true,
            "ExtendedFieldCss": "sdt_disabled"
          },
          {
            "ColumnName": "NumL",
            "LabelText": "D1",
            "ExtendedFieldCss": "sdt_disabled"
          },
          {
            "ColumnName": "NumE",
            "LabelText": "D2",
            "ExtendedFieldCss": "sdt_disabled"
          },
          {
            "ColumnName": "NumF",
            "LabelText": "H1",
            "ExtendedFieldCss": "sdt_disabled"
          },
          {
            "ColumnName": "NumG",
            "LabelText": "H2",
            "ExtendedFieldCss": "sdt_disabled"
          },
          {
            "ColumnName": "ClassJ",
            "LabelText": "製品No",
            "ExtendedFieldCss": "sdt_disabled",
            "ValidateRequired": true,
            "ExtendedHtmlAfterControl": "<div class=\"ui-icon ui-icon-search \" id=\"productSearch\" tabindex=\"0\"></div>\n        <div class=\"ui-icon ui-icon-close textClear\" id=\"productDelete\" onclick=\"initialize()\" tabindex=\"0\"></div>"
          }
        ],
        "Links": [
          {
            "ColumnName": "ClassA",
            "SiteId": 1841987,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB] __ [ClassC]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassB"
              }
            ],
            "JsonFormat": true
          },
          {
            "ColumnName": "ClassC",
            "SiteId": 1841977,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB] __ [ClassC]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassD"
              }
            ],
            "JsonFormat": true
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc",
              "ClassC": "asc",
              "ClassE": "asc",
              "ClassJ": "asc",
              "ClassG": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "CalendarTimePeriod": "Monthly",
            "CalendarFromTo": "DateA",
            "CrosstabGroupByX": "ClassA",
            "CrosstabGroupByY": "ClassA",
            "CrosstabAggregateType": "Total",
            "CrosstabValue": "NumA",
            "CrosstabTimePeriod": "Monthly",
            "KambanAggregateType": "Count",
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "Class100",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          }
        ],
        "Scripts": [
          {
            "Title": "主キー設定",
            "New": true,
            "Edit": true,
            "Body": "//$(document).on('change', '#Results_ClassA', '#Results_ClassC','#Results_ClassE','#Results_ClassJ','#Results_ClassG', function () {\n$(document).on('change', '#Results_ClassA, #Results_ClassC, #Results_ClassE, #Results_ClassJ, #Results_ClassG', function() {\n    var A = $('#Results_ClassA').val();\n    var C = $('#Results_ClassC').val();\n    var E = $('#Results_ClassE').val();\n    var J = $('#Results_ClassJ').val();\n    var G = $('#Results_ClassG').val();\n\n   $p.set($('#Results_Class100'), A + '__' + C + '__' + E + '__' + J + '__' + G);\n});",
            "Id": 1
          },
          {
            "Title": "sdt_disabled",
            "New": true,
            "Edit": true,
            "Body": "// =================================================\n// フィールドCSSに'sdt_disabled'クラスが設定されているフィールドを\n// disabledにします。\n// $p.set()は稼働しますが、手動での操作を制限します。\n// -------------------------------------------------\n// 引数：disabledにするかreadonlyにするか\n// =================================================\n\nfunction setDisabled(type){\n  //該当の入力エリアをdisabled / readonlyにする\n  $('.sdt_disabled input').prop(type, true); // 一般的なinput要素\n  $('.sdt_disabled input[type=\"number\"]').prop(type, true); // 数値用のinput要素\n  $('.sdt_disabled textarea').prop(type, true); // textarea要素\n  $('.sdt_disabled select').prop(type, true); // select要素\n\n  // selectはreadonlyが効かないのでoptionをdisabledにする\n  // $('.sdt_disabled option').prop('disabled', true);\n  // $('.sdt_disabled option:selected').prop('disabled', false);\n\n  //コントロールアイコンを削除する\n  $('.sdt_disabled div.field-control div.ui-icon').remove();\n}\n\n//$p.events.on_editor_load = function () {\n//  setDisabled('disabled');\n//}",
            "Id": 2
          },
          {
            "Title": "00_共通.js",
            "New": true,
            "Edit": true,
            "Body": "// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝コード値系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\nconst SUCCESS_MESSAGE_CODE = {\n    // 成功メッセージ\n    'SUCCESS_CREATE_FILE': 'ファイルの作成に成功しました',\n    'SUCCESS_UPDATE': '更新に成功しました',\n    'SUCCESS_DELETE': '削除に成功しました',\n    'SUCCESS_UPLOAD': 'アップロードに成功しました',\n    'SUCCESS_DOWNLOAD': 'ダウンロードに成功しました',\n    'SUCCESS_SAVE': '保存に成功しました',\n    'SUCCESS_CHECK': 'チェックが完了しました',\n    'NOT_FOUND': '該当データ無し',\n}\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝判定系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n/**\n * Null判定する関数です。\n * @param {object} obj オブジェクト\n * @returns {boolean} 判定結果\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonIsNull(obj) {\n    if (Array.isArray(obj)) {\n        return obj.filter(v => String(v).trim() !== '').length == 0;\n    } else if (typeof obj === 'object') {\n        return !obj || Object.keys(obj).length === 0 && obj.constructor === Object;\n    } else {\n        return !obj && obj !== 0 || String(obj).trim() == '';\n    }\n}\n\n/**\n * ステータスをチェックする関数です。\n * @param {Array|string} applyStatuses 適用するステータス\n * @returns {boolean} チェック結果\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonCheckStatus(applyStatuses = \"all\") {\n    if ($p.action() !== \"edit\" && $p.action() !== \"new\") {\n        let message = \"編集画面で使用を想定\"\n        alert(message)\n        throw new Error(message)\n    }\n    let allFlg = false;\n    if (!Array.isArray(applyStatuses)) {\n        if (applyStatuses === \"all\") {\n            allFlg = true;\n        } else {\n            applyStatuses = [applyStatuses];\n        }\n    }\n    return allFlg || applyStatuses.map(v => +v).includes(+commonGetValue(\"Status\", false));\n}\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝値取得&値設定系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n/**\n * 日付を出力する関数です。\n *\n * yyyy引数なしで現在日付\n * 月末はddに0を入力\n *\n * @param {Number} yyyy   年(またはDateオブジェクト)\n * @param {Number} mm     月\n * @param {Number} dd     日\n * @param {String} format フォーマット\n *\n * @return {String} フォーマット加工された日付文字列\n *\n * 例1. yyyy = 2022, mm = 4, dd = 18, format = 'YYYY-MM-DD'\n *            ⇓\n *     '2022-04-18'\n * 例2. yyyy = 2021, mm = 13, dd = 10, format = 'YYYY-MM-DD'\n *            ⇓\n *     '2022-01-10'\n * 例3. yyyy = 2021, mm = 11, dd = 0, format = 'YYYY-MM-DD'\n *            ⇓\n *     '2022-10-31'\n * 例4. yyyy = 2020\n *            ⇓\n *     '2020-01-01T00:00:00'\n * 例5. 引数なし\n *            ⇓\n *     現在日付の'YYYY-MM-DD'\n * 例6. yyyy = \"\", mm = \"\", dd = \"\", format = 'YYYYMM'\n *            ⇓\n *     現在日付の'YYYYMM'\n */\nfunction commonGetDate(yyyy, mm = 1, dd = 1, format = 'YYYY-MM-DD') {\n    let date\n    if (typeof yyyy === 'undefined' || commonIsNull(yyyy)) {\n        date = new Date()\n    } else if (typeof yyyy === 'object') {\n        date = yyyy\n    } else {\n        date = new Date(yyyy, mm - 1, dd)\n    }\n    return format\n        .replace(/YYYY/, String(date.getFullYear()).padStart(4, \"0\"))\n        .replace(/MM/, String(date.getMonth() + 1).padStart(2, \"0\"))\n        .replace(/DD/, String(date.getDate()).padStart(2, \"0\"))\n        .replace(/hh/, String(date.getHours()).padStart(2, \"0\"))\n        .replace(/mm/, String(date.getMinutes()).padStart(2, \"0\"))\n        .replace(/ss/, String(date.getSeconds()).padStart(2, \"0\"))\n\n}\n\n\n/**\n * 入力されたラベルに一致する項目の選択した値を返却する。\n * @param {String} label ラベル\n * @param {Boolean} valueFlg true : value値 false : display値\n * @returns {*} 選択された値または表示テキスト\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonGetValue(label, valueFlg = true) {\n    if ($p.action() !== \"edit\" && $p.action() !== \"new\") {\n        let message = \"編集画面で使用を想定\"\n        alert(message)\n        throw new Error(message)\n    }\n    const control = $p.getControl($p.getColumnName(label));\n    const tagName = control.prop(\"tagName\");\n\n    let value;\n\n    switch (tagName) {\n        case \"SELECT\":\n            value = commonHandleSelect(control, valueFlg);\n            break;\n        case \"INPUT\":\n            value = commonHandleInput(control, label, valueFlg);\n            break;\n        case \"TEXTAREA\":\n            value = document.getElementById(commonGetId(label) + \".viewer\").innerText;\n            break;\n        default:\n            value = commonHandleDefault(control, valueFlg);\n    }\n\n    return commonParseIfJson(value);\n}\n\n/**\n * 入力されたラベルに一致する項目の選択した値を入力する。\n * @param {String} label ラベル\n * @param {object} value 値\n */\nfunction commonSetValue(label, value) {\n    if ($p.action() !== \"edit\" && $p.action() !== \"new\") {\n        let message = \"編集画面で使用を想定\"\n        alert(message)\n        throw new Error(message)\n    }\n\n    // 値が変更されている場合\n    if (commonGetValue(label, true) != value) {\n        if ($p.getColumnName(label).startsWith(\"Check\")) {\n            // changeイベントを動かす\n            $p.getControl(label).click()\n        } else {\n            value = (value == commonGetDateEmpty()) ? \"\" : value\n            $p.set($p.getControl(label), value)\n        }\n    }\n}\n\n/**\n * 入力されたラベルのIDを返却する。\n * @param {String} label ラベル\n * @param {Boolean} [prefix=true] プレフィックス（テーブル名）を付けるかどうか\n * @param {Boolean} [suffix=false] サフィックス（'Field'）を付けるかどうか\n * @returns {String} 生成されたID\n * @throws {Error} ラベルが不正な場合やその他のエラー\n */\nfunction commonGetId(label, prefix = true, suffix = false) {\n    if ($p.action() !== \"edit\" && $p.action() !== \"new\") {\n        let message = \"編集画面で使用を想定\"\n        alert(message)\n        throw new Error(message)\n    }\n\n    let id = $p.getColumnName(label);\n    if (commonIsNull(id)) {\n        let message = `commonGetId ：ラベル不正。${label}`\n        alert(message)\n        throw new Error(message)\n    }\n    id = prefix ? `${$p.tableName()}_${id}` : id;\n    id = suffix ? `${id}Field` : id;\n    return id;\n\n}\n\n/**\n * SELECT要素の値を処理する。\n * @param {jQuery} control jQuery対象のSELECT要素\n * @param {Boolean} valueFlg true : value値 false : display値\n * @returns {*} 選択された値または表示テキスト\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonHandleSelect(control, valueFlg) {\n    if (control.attr(\"multiple\")) {\n        return valueFlg ? control.val() : control.next().children().last().text();\n    }\n    const selectedOption = control.children(':selected');\n    return valueFlg ? selectedOption.val() : selectedOption.text();\n}\n\n/**\n * INPUT要素の値を処理する。\n * @param {jQuery} control jQuery対象のINPUT要素\n * @param {String} label ラベル\n * @param {Boolean} valueFlg true : value値 false : display値\n * @returns {*} 入力された値または表示テキスト\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonHandleInput(control, label, valueFlg) {\n    const inputId = commonGetId(label);\n    if (inputId.indexOf(\"Check\") > 0) {\n        const checked = document.getElementById(inputId).checked;\n        return valueFlg ? +checked : checked;\n    }\n    let value = valueFlg ? control.attr('data-value') : control[0].innerHTML;\n    return commonIsNull(value) ? control.val() : value;\n\n}\n\n/**\n * デフォルトの要素処理を行う。\n * @param {jQuery} control jQuery対象の要素\n * @param {Boolean} valueFlg true : value値 false : display値\n * @returns {*} 要素の値または表示テキスト\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonHandleDefault(control, valueFlg) {\n    let value = valueFlg ? (control.attr('data-value') ?? control[0].innerHTML) : control[0].innerHTML;\n    return commonIsNull(value) ? control.val() : value;\n}\n\n/**\n * 空日付を出力する関数です。\n *\n * @return {String} 空日付\n */\nfunction commonGetDateEmpty() {\n    return '1899-12-30T00:00:00'\n}\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝値変換系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n/**\n * 値がJSON文字列の場合はパースし、そうでない場合は元の値を返す。\n * @param {*} value パース対象の値\n * @returns {*} パースされた値または元の値\n */\nfunction commonParseIfJson(value) {\n    if (typeof value !== 'string') return value;\n    try {\n        return JSON.parse(value);\n    } catch (err) {\n        return value;\n    }\n}\n\n/**\n * file を Base64 文字列に変換する。\n * @param {ArrayBuffer} file 変換する file\n * @returns {string} Base64 エンコードされた文字列\n */\nasync function commonToBase64(file) {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = () => {\n            const base64String = reader.result.split(\",\")[1];\n            resolve(base64String);\n        };\n        reader.onerror = (err) => reject(err);\n        reader.readAsDataURL(file);\n    });\n}\n\n/**\n   * 引数の2次元配列をUTF-8のCSVに変換する関数です。\n   * @param {Array} array 2次元配列\n   *\n   * @return {String} csvData\n   * 例. [\n   *      ['数量', '単価', '合計'],\n   *      ['1', '2', '2'],\n   *      ['4', '5', '20'],\n   *      ['7', '8', '56'],\n   *     ]\n   *            ⇓\n   * 'data:text/csvcharset=utf-8,\"数量\",\"単価\",\"合計\"\\r\\n\"1\",\"2\",\"2\"\\r\\n\"4\",\"5\",\"20\"\\r\\n\"7\",\"8\",\"56\"\\r\\n'\n   */\nfunction commonConvert2DToCsv(d2array) {\n    // csvDataに出力方法を追加\n    let csvOutput = 'data:text/csvcharset=utf-8,'\n    let csvData = csvOutput\n    d2array.forEach(v => {\n        const row = '\"' + v.join('\",\"') + '\"'\n        csvData += row + '\\r\\n'\n    })\n    return csvData\n}\n\n/**\n   * 引数の2次元配列をUTF-8のCSVに変換する関数です。\n   * @param {String} csvData\n   *\n   * @return {Array} array 2次元配列\n   * 例. 'data:text/csvcharset=utf-8,\"数量\",\"単価\",\"合計\"\\r\\n\"1\",\"2\",\"2\"\\r\\n\"4\",\"5\",\"20\"\\r\\n\"7\",\"8\",\"56\"\\r\\n'\n   *            ⇓\n   *     [\n   *      ['数量', '単価', '合計'],\n   *      ['1', '2', '2'],\n   *      ['4', '5', '20'],\n   *      ['7', '8', '56'],\n   *     ]\n   */\nfunction commonConvertCsvTo2D(csvData) {\n    // 行の分割\n    let rows = csvData.split(/\\r?\\n/);\n\n    // 空行の除去\n    let filteredRows = rows.filter(row => row.trim() !== '');\n\n    // 各行を処理\n    let processedData = filteredRows.map(row => {\n        // カラムに分割\n        let columns = row.split(',');\n\n        // 各値ごとに型変換処理\n        return columns.map(value => {\n            let trimmed = value.trim();\n            let num = Number(trimmed);\n\n            if (!isNaN(num) && trimmed !== '') {\n                return num;\n            }\n            return trimmed;\n        });\n    });\n\n    return processedData;\n}\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝要素追加&要素編集系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n/**\n * 指定された文言と完全に一致する最初のリンクを検索し、href属性を'#'に変更して、クリック時にカスタム関数を実行する関数\n * @param {string} searchText - リンクを検索するための文言（完全一致）\n * @param {function} customClickHandler - クリック時に実行されるカスタム関数\n * @returns {boolean} - リンクが見つかって修正されたかどうか\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonModifyLink(searchText, customClickHandler) {\n    const link = Array.from(document.getElementsByTagName('a')).find(a =>\n        a.textContent.trim() === searchText.trim()\n    );\n\n    if (link) {\n        const dataValue = link.closest('[data-value]')?.getAttribute('data-value');\n        link.setAttribute('href', '#');\n        link.style.color = 'black';\n        link.style.textDecoration = 'none';\n        link.onclick = function (event) {\n            event.preventDefault();\n            customClickHandler(dataValue, link.textContent);\n            return false;\n        };\n        return true;\n    } else {\n        console.warn(`\"${searchText}\" と完全に一致するリンクが見つかりませんでした。`);\n        return false;\n    }\n}\n\n/**\n * メインコマンドエリアにボタンを追加する関数です。\n * @param {String} buttonId     ボタンID\n * @param {String} buttonLabel  ラベル\n * @param {Function} clickFunc  click時関数\n * @param {String} icon         アイコン（empty指定でアイコンなし）\n * @throws {Error}              処理中に発生したエラー\n */\nfunction commonAddButtonToMainCommands(buttonId, buttonLabel, clickFunc, icon = \"ui-icon-disk\") {\n    const target = document.getElementById(\"MainCommands\");\n    const elem = document.createElement('button');\n    elem.id = buttonId;\n    elem.className = 'button button-icon ui-button ui-corner-all ui-widget applied customized';\n    elem.onclick = clickFunc;\n    elem.innerText = buttonLabel;\n    if (icon !== \"empty\") {\n        const span = document.createElement('span');\n        span.className = `ui-button-icon ui-icon ${icon}`;\n        elem.appendChild(span);\n    }\n    const space = document.createElement('span');\n    space.className = \"ui-button-icon-space\";\n    elem.appendChild(space);\n\n    target.appendChild(elem);\n}\n\n/**\n * 指定項目横にボタンを追加する関数です。\n * @param {String} buttonId     ボタンID\n * @param {String} buttonLabel  ラベル\n * @param {Function} clickFunc  click時関数\n * @param {String} icon         アイコン（empty指定でアイコンなし）\n * @param {Array} applys        適用するステータス\n * @throws {Error}              処理中に発生したエラー\n */\nfunction commonAddButtonToNextField(ItemLabel, buttonId, buttonLabel, clickFunc, icon = \"ui-icon-disk\", applys = \"all\") {\n    if (!commonCheckStatus(applys)) return;\n\n    // 対象のフィールドを取得\n    const targetField = document.getElementById(commonGetId(ItemLabel));\n    if (!targetField) {\n        let message = `commonAddButtonToNextField :対象項目が見つかりません。${ItemLabel}`\n        alert(message)\n        throw new Error(message)\n    }\n\n    // container-normal クラスを持つ親要素を見つける\n    const containerElement = targetField.closest('.container-normal');\n    if (!containerElement) {\n        let message = `commonAddButtonToNextField :container-normalクラスを持つ親要素が見つかりません。`\n        alert(message)\n        throw new Error(message)\n    }\n\n    // 新しいボタン要素を作成\n    const elem = document.createElement('button');\n    elem.id = buttonId;\n    elem.className = 'button button-icon ui-button ui-corner-all ui-widget applied customized';\n    elem.onclick = clickFunc;\n\n    if (icon !== \"empty\") {\n        const span = document.createElement('span');\n        span.className = `ui-button-icon ui-icon ${icon}`;\n        elem.insertBefore(span, elem.firstChild);\n    }\n\n    const space = document.createElement('span');\n    space.className = \"ui-button-icon-space\";\n    elem.appendChild(space);\n\n    const textNode = document.createTextNode(buttonLabel);\n    elem.appendChild(textNode);\n\n    // ボタンをcontainer-normal要素内に挿入\n    containerElement.appendChild(elem);\n\n    // レイアウトとスタイルを調整\n    containerElement.style.display = 'flex';\n    containerElement.style.alignItems = 'center';\n    containerElement.style.flexWrap = 'nowrap';\n\n    targetField.style.flexGrow = '1';\n    targetField.style.flexShrink = '1';\n    targetField.style.flexBasis = 'auto';\n    targetField.style.minWidth = '0';\n\n    elem.style.flexGrow = '0';\n    elem.style.flexShrink = '0';\n    elem.style.flexBasis = 'auto';\n    elem.style.marginLeft = '10px';\n    elem.style.whiteSpace = 'nowrap';\n\n}\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝API系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet API_VERSION = \"1.0\"\n\n/**\n * 取得APIを呼び出す関数です。\n *\n * @param {Number}    id テーブルID\n * @param {Array}     columns 取得列\n * @param {Object}    filterHash フィルター条件\n * @param {Object}    sorterHash ソート条件\n * @param {Object}    filterSearchTypes 検索条件\n * @param {Boolean}   keyFlg true : 表示名 false : カラム名\n * @param {Boolean}   valueFlg true : value値 false : display値\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonGetData(id = $p.siteId(), columns = [\"ClassA\", \"NumA\"], filterHash = {}, sorterHash = { \"ResultId\": \"asc\" }, filterSearchTypes = {}, keyFlg = true, valueFlg = true, addFunc) {\n    let offset = 0\n    let data = []\n    let temp = {}\n    do {\n        temp = await commonGetInnner(id, columns, filterHash, sorterHash, filterSearchTypes, keyFlg, valueFlg, offset, addFunc)\n        data = [...data, ...temp.Response.Data]\n        offset += temp.Response.PageSize\n    } while (offset < temp.Response.TotalCount)\n    return data\n\n    /**\n     * 取得APIを呼び出す関数内関数です。(TotalCount 200)\n     *\n     * @param {Number}    id テーブルID\n     * @param {Array}     columns 取得列\n     * @param {Object}    filterHash フィルター条件\n     * @param {Object}    sorterHash ソート条件\n     * @param {Object}    filterSearchTypes 検索条件\n     * @param {Boolean}   keyFlg true : 表示名 false : カラム名\n     * @param {Boolean}   valueFlg true : value値 false : display値\n     * @param {Number}    offset オフセット条件\n     * @param {Function}  addFunc 最後に実行したい関数\n     */\n    async function commonGetInnner(id, columns, filterHash, sorterHash, filterSearchTypes, keyFlg, valueFlg, offset, addFunc) {\n        let payload = {\n            'id': id,\n            'data': {\n                'Offset': offset,\n                'View': {\n                    'ApiDataType': \"KeyValues\",\n                    'ApiColumnKeyDisplayType': keyFlg ? 'LabelText' : 'ColumnName',\n                    'ApiColumnValueDisplayType': valueFlg ? \"Value\" : \"DisplayValue\",\n                    \"ColumnFilterHash\": filterHash,\n                    \"ColumnSorterHash\": sorterHash,\n                    \"ColumnFilterSearchTypes\": filterSearchTypes,\n                }\n            },\n            'done': function (data) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n                return data.Response.Data\n            }\n        }\n\n        if (!Array.isArray(columns)) {\n            columns = [columns]\n        }\n        if (columns.length > 0) {\n            payload['data']['View']['GridColumns'] = columns\n        }\n\n\n\n        return await $p.apiGet(payload)\n    }\n}\n\n/**\n * エクスポートAPIを呼び出す関数です。\n *\n * @param {String}    tableId 取得テーブルID\n * @param {Array}     columns 取得列\n * @param {Object}    filterHash フィルター条件\n * @param {Object}    sorterHash ソート条件\n * @param {Object}    filterSearchTypes 検索条件\n * @param {Boolean}   jsonFlg trueならjson　falseならcsvで取得\n * @param {Boolean}   headerFlg trueならheaderも取得\n * @param {Boolean}   overFlg trueなら超過分のみ取得\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonExportData(tableId = $p.siteId(), columns = [\"ClassA\", \"NumA\"], filterHash = {}, sorterHash = { \"ResultId\": \"asc\" }, filterSearchTypes = {}, jsonFlg = true, headerFlg = true, overFlg = false, addFunc) {\n    if (!Array.isArray(columns)) {\n        columns = [columns]\n    }\n    columns.unshift(\"ResultId\")\n    let data = await commonExportInner(tableId, columns, filterHash, sorterHash, filterSearchTypes, jsonFlg, headerFlg, overFlg, addFunc)\n    if (jsonFlg) {\n        // json整形\n        data = JSON.parse(data.Response.Content)\n    } else {\n        // csv整形\n        data = commonConvertCsvTo2D(data.Response.Content)\n    }\n\n    return data\n    /**\n     * エクスポートAPIを呼び出す関数内関数です。\n     *\n     * @param {String}    tableId 取得テーブルID\n     * @param {Array}     columns 取得列\n     * @param {Object}    filterHash フィルター条件\n     * @param {Object}    sorterHash ソート条件\n     * @param {Object}    filterSearchTypes 検索条件\n     * @param {Boolean}   jsonFlg trueならjson　falseならcsvで取得\n     * @param {Boolean}   headerFlg trueならheaderも取得\n     * @param {Boolean}   overFlg trueなら超過分のみ取得\n     * @param {Function}  addFunc 最後に実行したい関数\n     */\n    async function commonExportInner(tableId, columns, filterHash, sorterHash, filterSearchTypes, jsonFlg, headerFlg, overFlg, addFunc) {\n\n        let col = []\n        columns.forEach(v => col.push({ \"ColumnName\": v }))\n        let data = JSON.stringify({\n            \"ApiVersion\": API_VERSION,\n            \"Export\": {\n                \"Columns\": col,\n                \"Header\": headerFlg,\n                \"Type\": jsonFlg ? \"json\" : \"csv\"\n            },\n            \"View\": {\n                \"Overdue\": overFlg,\n                \"ColumnFilterHash\": filterHash,\n                \"ColumnSorterHash\": sorterHash,\n                \"ColumnFilterSearchTypes\": filterSearchTypes,\n            }\n        })\n\n        return new Promise((resolve, reject) => {\n            $.ajax({\n                type: \"POST\",\n                url: `/api/items/${tableId}/export`,\n                contentType: 'application/json',\n                data: data\n            }).then(\n                function (result) {\n                    if (addFunc && typeof addFunc === 'function') {\n                        // 渡されたオブジェクトが関数なら実行する\n                        addFunc(data)\n                    }\n                    // 正常終了\n                    resolve(result)\n                },\n                function () {\n                    // エラー\n                    reject()\n                }\n            )\n        })\n    }\n}\n\n/**\n * 登録APIを呼び出す関数です。\n *\n * @param {String}    tableId 登録テーブルID\n * @param {Object}    Hash 更新項目\n * @param {String}    Status 登録ステータス\n * @param {String}    Comments 登録コメント\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonCreate(tableId, Hash = {}, Status, Comments, addFunc) {\n\n    // 登録項目\n    let ClassHash = {}\n    let NumHash = {}\n    let DateHash = {}\n    let DescriptionHash = {}\n    let CheckHash = {}\n    for (let key in Hash) {\n        if (key.includes(\"Class\")) ClassHash[key] = Hash[key]\n        else if (key.includes(\"Num\")) NumHash[key] = commonConvertCTo1(Hash[key])\n        else if (key.includes(\"Date\")) DateHash[key] = commonIsNull(Hash[key]) ? commonGetDateEmpty() : Hash[key]\n        else if (key.includes(\"Description\")) DescriptionHash[key] = Hash[key]\n        else if (key.includes(\"Check\")) CheckHash[key] = Hash[key]\n    }\n\n    let data = JSON.stringify({\n        \"ApiVersion\": API_VERSION,\n        Status,\n        Comments,\n        ClassHash,\n        NumHash,\n        DateHash,\n        DescriptionHash,\n        CheckHash\n    })\n    if (!commonIsNull(Status)) {\n        delete data[\"Status\"]\n    }\n    if (!commonIsNull(Comments)) {\n        delete data[\"Comments\"]\n    }\n\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            type: \"POST\",\n            url: `/api/items/${tableId}/create`,\n            contentType: 'application/json',\n            data: data\n        }).then(\n            function (result) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n                // 正常終了\n                resolve(result)\n            },\n            function () {\n                // エラー\n                reject()\n            }\n        )\n    })\n}\n\n/**\n * 更新APIを呼び出す関数です。\n *\n * @param {String}    recordId 更新レコードID\n * @param {Object}    Hash 更新項目\n * @param {String}    Status 更新ステータス\n * @param {String}    Comments 更新コメント\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonUpdate(recordId, Hash = {}, Status, Comments, addFunc) {\n\n    // 更新項目\n    let ClassHash = {}\n    let NumHash = {}\n    let DateHash = {}\n    let DescriptionHash = {}\n    let CheckHash = {}\n    for (let key in Hash) {\n        if (key.includes(\"Class\")) ClassHash[key] = Hash[key]\n        else if (key.includes(\"Num\")) NumHash[key] = commonConvertCTo1(Hash[key])\n        else if (key.includes(\"Date\")) DateHash[key] = commonIsNull(Hash[key]) ? commonGetDateEmpty() : Hash[key]\n        else if (key.includes(\"Description\")) DescriptionHash[key] = Hash[key]\n        else if (key.includes(\"Check\")) CheckHash[key] = Hash[key]\n    }\n    let data = JSON.stringify({\n        \"ApiVersion\": API_VERSION,\n        Status,\n        Comments,\n        ClassHash,\n        NumHash,\n        DateHash,\n        DescriptionHash,\n        CheckHash\n    })\n    if (!commonIsNull(Status)) {\n        delete data[\"Status\"]\n    }\n    if (!commonIsNull(Comments)) {\n        delete data[\"Comments\"]\n    }\n\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            type: \"POST\",\n            url: `/api/items/${recordId}/update`,\n            contentType: 'application/json',\n            data: data\n        }).then(\n            function (result) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n\n                // 正常終了\n                resolve(result)\n            },\n            function () {\n                // エラー\n                reject()\n            }\n        )\n    })\n}\n\n/**\n * ユーザー取得APIを呼び出す関数です。\n *\n * @param {Array}     userIds 取得UserId\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonExportUser(userIds, addFunc) {\n    let users = []\n    if (Array.isArray(userIds)) {\n        users = userIds\n    } else {\n        users = [userIds]\n    }\n    let data = JSON.stringify({\n        \"ApiVersion\": API_VERSION,\n        \"View\": {\n            \"ColumnFilterHash\": {\n                \"UserId\": JSON.stringify(users)\n            }\n        }\n    })\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            type: \"POST\",\n            url: \"/api/users/get\",\n            contentType: 'application/json',\n            data: data\n        }).then(\n            function (result) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n                // 正常終了\n                resolve(result)\n            },\n            function () {\n                // エラー\n                reject()\n            }\n        )\n    })\n}\n\n/**\n * グループ取得APIを呼び出す関数です。\n *\n * @param {Array}     groupIds 取得GroupId\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonExportGroup(groupIds, addFunc) {\n    let groups = []\n    if (Array.isArray(groupIds)) {\n        groups = groupIds\n    } else {\n        groups = [groupIds]\n    }\n    let data = JSON.stringify({\n        \"ApiVersion\": API_VERSION,\n        \"View\": {\n            \"ColumnFilterHash\": {\n                \"GroupId\": JSON.stringify(groups)\n            }\n        }\n    })\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            type: \"POST\",\n            url: \"/api/groups/get\",\n            contentType: 'application/json',\n            data: data\n        }).then(\n            function (result) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n                // 正常終了\n                resolve(result)\n            },\n            function () {\n                // エラー\n                reject()\n            }\n        )\n    })\n}\n\n/**\n * 添付項目にExcelを添付し更新する共通関数です。\n *\n * @param {string} targetID 更新対象のアイテムID\n * @param {string} className 添付ファイルのクラス名\n * @param {Object} excel Excelワークブックオブジェクト\n * @param {string} filename 添付ファイルの名前\n */\nasync function commonUpdateExcel(targetID, className, workbook, filename) {\n    const fileBuffer = await workbook.xlsx.writeBuffer()\n    const base64 = commonToBase64(fileBuffer)\n\n    let url = `/api/items/${targetID}/update`\n    let method_name = \"POST\"\n    let data = {\n        \"ApiVersion\": API_VERSION,\n        \"AttachmentsHash\": {\n            [className]: [\n                {\n                    \"ContentType\": \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\n                    \"Name\": filename,\n                    \"Base64\": base64\n                }\n            ]\n        }\n    }\n    await $.ajax({\n        type: method_name,\n        url: url,\n        data: JSON.stringify(data),\n        contentType: 'application/json',\n        dataType: 'json',\n        scriptCharset: 'utf-8',\n        success: function (data) {\n            // Success\n            console.log(\"success\")\n            console.log(JSON.stringify(data))\n        },\n        error: function (data) {\n            // Error\n            console.log(\"error\")\n            console.log(JSON.stringify(data))\n        }\n    })\n}\n\n",
            "Id": 10
          },
          {
            "Title": "20_ダイアログテンプレート.js",
            "New": true,
            "Edit": true,
            "Body": "// ダイアログを作成し、ページに追加する関数\nhtmls = {};\nfunction createAndAddDialog(dialogId, title, fields, btnFields = [], submitHandler) {\n    if (document.getElementById(dialogId)) {\n        let message = `ダイアログID \"${dialogId}\" は既に存在します。一意のIDを使用してください。`;\n        alert(message)\n        throw new Error(message);\n    }\n\n    // 何行になるかを計算し、配列に格納\n    let columnCountArr = [];\n    let rowCount = 0;\n    let newLineFlg = false;\n    for(let field of fields){\n        if(typeof(field.options) == 'object' && 'newLine' in field.options && field.options.newLine){\n            newLineFlg = true;\n            rowCount++;\n        }\n        else if(typeof(field.options) == 'object' && \"newLine\" in field.options && !field.options.newLine){\n            if(newLineFlg){\n                columnCountArr.push(rowCount);\n                rowCount = 0;\n            }\n            else{\n                newLineFlg = true;\n            }\n        }\n    }\n\n    let content = '';\n    newLineFlg = false;\n    let arrCount = 0;\n    for(let field of fields){\n        sqlArrayPush(field,dialogId);\n        if(typeof(field.options) == 'object' && 'newLine' in field.options && field.options.newLine){\n            if(newLineFlg){\n                content += \"</div>\";\n            }\n            let conteiner_width = Math.floor(100 / columnCountArr[arrCount]);\n            content += `<div style=\"display: inline-block;width: ${conteiner_width}%;vertical-align: top;\">`;\n            content += createField(dialogId, field.type, field.id, field.label, field.options);\n            newLineFlg = true;\n        }\n        else if(typeof(field.options) == 'object' && \"newLine\" in field.options && !field.options.newLine){\n            if(newLineFlg){\n                content += \"</div>\";\n                content += `<div style=\"display: block;\">`;\n                content += createField(dialogId, field.type, field.id, field.label, field.options);\n                newLineFlg = true;\n                arrCount++;\n            }\n        }\n        else{\n            content += createField(dialogId, field.type, field.id, field.label, field.options);\n        }\n\n    }\n    if(newLineFlg)content += \"</div>\";\n\n    let btnContent = '';\n    if(btnFields.length > 0){\n        btnContent = btnFields.map(e => createButton(e.label,e.options.onclick ? e.options.onclick : '',e.options.icon,dialogId,e.id,e.options.hidden ? true:false)).join('');\n    }\n    const dialogHTML = createDialogHTML(dialogId, title, content,btnContent);\n    $('#Application').append(dialogHTML);\n\n    \n    htmls[dialogId] = dialogHTML;\n\n    // バリデーションイベント登録\n    // for(let field of fields){\n    //     create_varidate_event(dialogId,field.id,field.type,field.options);\n    // }\n\n    createLookups(dialogId, title, fields);\n    // submitHandlerを設定\n    $(`#${dialogId}_submit`).on('click', function() {\n        submitDialog(dialogId, submitHandler);\n    });\n\n    // searchArr作成\n    let search_items = fields.filter(e => e.type == 'search-table');\n    if(search_items.length == 0)return;\n    for(item of search_items){\n        let tmp_searchObj = {dialogId:dialogId,tableId:item.id,searchTableId:item.options.searchTableId,multiple:item.options.multiple ? true:false};\n        // toColumns作成\n        tmp_searchObj.toColumns = item.options.t_heads.map(e =>{\n            tmp = {ColumnName:e.ColumnName};\n\n            if('specialTerms'in e)tmp[\"specialTerms\"] = e.specialTerms;\n            if('alignment' in e)tmp[\"alignment\"] = e.alignment;\n            if(e.hidden)tmp[\"hidden\"] = true;\n            if(e.type)tmp[\"type\"] = e.type;\n            return tmp;\n\n        });\n        // options作成\n        tmp_searchObj.options = [];\n        let tmpArr;\n        fields.forEach(e => {\n            if('forColumnName' in e){\n                tmpArr = {searchColumn:e.forColumnName,type:e.type,id:e.id};\n                if(\"digitsNum\" in e.options)tmpArr[\"digitsNum\"] = e.options.digitsNum;\n                if(\"alignment\" in e.options)tmpArr[\"alignment\"] = e.options.alignment;\n                tmp_searchObj.options.push(tmpArr);\n            }\n        });\n        searchArr.push(tmp_searchObj);\n\n    }\n    $(`#${dialogId}_searchButton`).on('click',function(e){\n        create_searchList($(this));\n    })\n\n\n\n}\n\n// ダイアログのベース構造を定義\nconst createDialogHTML = (dialogId, title, content, btnContent) => `\n    <div id=\"${dialogId}\" class=\"dialog\" title=\"${title}\">\n        ${content}\n        <div class=\"command-center\">\n            ${btnContent}\n            <button id=\"${dialogId}_close\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" type=\"button\" onclick=\"closeDialog('${dialogId}',true);\"style='position:relative;'>\n                <span class=\"ui-button-icon ui-icon ui-icon-cancel\"></span>\n                <span class=\"ui-button-icon-space\"> </span>終了\n            </button>\n        </div>\n    </div>\n`;\n\nfunction createButton(label,onclick,icon,dialogId,id,hiddenFlg){\n    return `\n        <button id=\"${dialogId}_${id}\" style=\"${hiddenFlg ? \"display:none\":''}\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" type=\"button\" onclick=\"${onclick == '' ? '':onclick}\">\n                    <span class=\"ui-button-icon ui-icon ui-icon-${icon}\"></span>\n                    <span class=\"ui-icon-${icon}\"> </span>${label}\n        </button>\n    `\n}\n\n// ダイアログを開く関数\nfunction openDialog(dialogId,width='550',unit = 'px',func = null) {\n\n    $(`#${dialogId}`).dialog({\n        modal:true,\n        width: `${width}${unit}`,\n        resizable: true,\n        closeOnEscape:false,\n    })\n    $(`#${dialogId}`).css('max-height',\"90vh\");\n    dialog_openTime = getJPISOTime()\n\n    if(typeof func == 'function'){\n        func();\n    }\n    \n}\n// ダイアログ固有の送信処理を格納するオブジェクト\nconst dialogSubmitHandlers = {};\n\n// ダイアログ内のフォームをSubmitする関数\nfunction submitDialog(dialogId, submitHandler) {\n    // バリデーションを実行\n    if (!validateDialog(dialogId)) {\n        return;\n    }\n\n    // 送信ハンドラを設定\n    if (typeof submitHandler === 'function') {\n        dialogSubmitHandlers[dialogId] = submitHandler;\n    }\n\n    // ダイアログ固有の送信処理を実行\n    if (dialogSubmitHandlers[dialogId]) {\n        dialogSubmitHandlers[dialogId](dialogId);\n    }\n    closeDialog(dialogId);\n}\n\n// ダイアログのバリデーションを行う関数\nfunction validateDialog(dialogId) {\n    let isValid = true;\n    $(`#${dialogId} [required]`).each(function() {\n        const field = $(this);\n        const errorElement = $(`#${field.attr('id').replace(/(From|To)$/, '')}-error`);\n        if (!field.val()) {\n            isValid = false;\n            field.addClass('error');\n            errorElement.text('この項目は必須です');\n        } else {\n            field.removeClass('error');\n            errorElement.text('');\n        }\n    });\n    return isValid;\n}\n\nfunction editMarkdown(dialogId, id) {\n\n    const fullId = `${dialogId}_${id}`;\n    $(`#${fullId}`).show().focus();\n    $(`#${fullId}_viewer`).hide();\n}\n\n// フィールドの有効/無効を切り替える関数\nfunction toggleFieldDisabled(fieldId, disabled) {\n    const field = $(`#${fieldId}`);\n    field.prop('disabled', disabled);\n\n    if (disabled) {\n        field.addClass('disabled');\n    } else {\n        field.removeClass('disabled');\n    }\n}\n\nfunction sqlArrayPush(field,dialogId){\n    if(field.type == 'search-table' && field.options.sql)useSqlDialogs.push(dialogId);\n    if(field.type == 'search-table' && field.options.individualSql)useIndividualSqlDialogs.push(dialogId);\n}\n\n/**\n * 現在の日本時間を ISO 8601 形式 (YYYY-MM-DDTHH:mm:ss) で取得する\n * @returns {string} 日本時間の ISO 8601 形式の文字列 (例: \"2024-12-11T01:41:33\")\n */\nfunction getJPISOTime() {\n    const now = new Date();\n    const jpISOTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000)\n        .toISOString()\n        .slice(0, 19);  // 秒まで切り取り\n    return jpISOTime;\n}\n\n/**\n * 前回出力履歴を取得する\n * @param {string} listName     帳票名\n * @param {number} number       番号（見積番号等）\n * @param {string} id           結果を入力するid\n *  */\nasync function get_history(listName,number,id){\n    try{\n        const sql = `\n            SELECT CreateDate, PCName\n            From TW見積出力履歴\n            WHERE ListName = '${listName}'\n            AND Number = ${number}\n        `;\n\n        let res = await fetchSql(sql);\n        res = res.results;\n\n        if(res.length == 0){\n            $(`#${id} .input-container span`).text('');\n            return;\n        }\n\n        // 入力\n        let tmp = formatDate_for_japanese(res[0].CreateDate) + \"　\" + formatTime_for_japanese(res[0].CreateDate) + \"　\" + res[0].PCName;\n\n        $(`#${id} .input-container span`).text(tmp);\n\n    }catch(err){\n        $(`#${id} .input-container span`).text('');\n        console.error('前回出力情報取得処理',err);\n        return;\n    }\n}",
            "Id": 12
          },
          {
            "Title": "21_検索ダイアログテンプレート.js",
            "New": true,
            "Edit": true,
            "Body": "/**\n * 検索ダイアログ\n * @param {string} dialogId 検索ダイアログID\n * @param {string} tableId 検索先テーブルID\n * @param {Array} fields 項目ごとのパラメータ\n * @param {Array} btnFields ダイアログ下部に表示するボタン\n * @param {string} width ダイアログのwidthを指定\n */\nlet useSqlDialogs = [];\nlet useIndividualSqlDialogs = [];\nasync function create_searchDialog(dialogId,tableId,fields,btnFields = [],width = '750px'){\n    if (document.getElementById(dialogId)) {\n        let message = `ダイアログID \"${dialogId}\" は既に存在します。一意のIDを使用してください。`;\n        alert(message)\n        throw new Error(message);\n    }\n\n    let multipleFlg = false;\n    for(i = 0; i < 2; i++){\n        if(multipleFlg)dialogId += \"_multiple\";\n        // 何行になるかを計算し、配列に格納\n        let columnCountArr = [];\n        let rowCount = 0;\n        let newLineFlg = false;\n        for(let field of fields){\n            if(typeof(field.options) == 'object' && 'newLine' in field.options && field.options.newLine){\n                newLineFlg = true;\n                rowCount++;\n            }\n            else if(typeof(field.options) == 'object' && \"newLine\" in field.options && !field.options.newLine){\n                if(newLineFlg){\n                    columnCountArr.push(rowCount);\n                    rowCount = 0;\n                }\n                else{\n                    newLineFlg = true;\n                }\n            }\n        }\n\n        let filterHTML = '';\n        newLineFlg = false;\n        let arrCount = 0;\n        for(let field of fields){\n            if(field.type == 'search-table' && field.options.sql)useSqlDialogs.push(dialogId);\n            if(field.type == 'search-table' && field.options.individualSql)useIndividualSqlDialogs.push(dialogId);\n            if(typeof(field.options) == 'object' && 'newLine' in field.options && field.options.newLine){\n                if(newLineFlg){\n                    filterHTML += \"</div>\";\n                }\n                let conteiner_width = Math.floor(100 / columnCountArr[arrCount]);\n                filterHTML += `<div style=\"display: inline-block;width: ${conteiner_width}%;vertical-align: top;\">`;\n                filterHTML += createField(dialogId, field.type, field.id, field.label, field.options,multipleFlg);\n                newLineFlg = true;\n            }\n            else if(typeof(field.options) == 'object' && \"newLine\" in field.options && !field.options.newLine){\n                if(newLineFlg){\n                    filterHTML += \"</div>\";\n                    filterHTML += `<div style=\"display: block;\">`;\n                    filterHTML += createField(dialogId, field.type, field.id, field.label, field.options,multipleFlg);\n                    newLineFlg = true;\n                    arrCount++;\n                }\n            }\n            else{\n                filterHTML += createField(dialogId, field.type, field.id, field.label, field.options,multipleFlg);\n            }\n        }\n        if(newLineFlg)filterHTML += \"</div>\";\n\n        const btnHTML = btnFields.map(field => createField(dialogId, field.type, field.id, field.label, field.options,multipleFlg)).join('');\n        const dialogHTML      = searchDialogTemplate(dialogId,filterHTML,multipleFlg,btnHTML);\n        $('#Application').append(dialogHTML);\n\n        // 検索用のイベント登録\n        $(`#${dialogId}_searchButton`).on('click',function(e){\n            create_searchList($(this));\n        })\n\n        // searchArr作成（検索に必要な情報を格納）\n        const searchTable_items = fields.filter(e => e.type == 'search-table');\n        for(item of searchTable_items){\n            let tmp_searchObj = {dialogId:dialogId,searchTableId:tableId,tableId:item.id,width:width};\n            // toColumns作成\n            tmp_searchObj.toColumns = item.options.t_heads.map(e =>{\n                tmp = {ColumnName:e.ColumnName};\n\n                if('specialTerms'in e)tmp[\"specialTerms\"] = e.specialTerms;\n                if('alignment' in e)tmp[\"alignment\"] = e.alignment;\n                if(e.hidden)tmp[\"hidden\"] = true;\n                if(e.type)tmp['type'] = e.type;\n                return tmp;\n\n            });\n            // options作成\n            tmp_searchObj.options = [];\n            let tmpArr;\n            fields.forEach(e => {\n                if('forColumnName' in e){\n                    tmpArr = {searchColumn:e.forColumnName,type:e.type,id:e.id};\n                    if(\"digitsNum\" in e.options)tmpArr[\"digitsNum\"] = e.options.digitsNum;\n                    if(\"alignment\" in e.options)tmpArr[\"alignment\"] = e.options.alignment;\n                    tmp_searchObj.options.push(tmpArr);\n                }\n            });\n            searchArr.push(tmp_searchObj);\n        }\n\n        // lookups作成\n        createLookups(dialogId,'',fields);\n\n        multipleFlg = true;\n    }\n}\n\n// ダイアログテンプレート\nfunction searchDialogTemplate(id,filterHTML,multipleFlg,btnHTML){\n\n    return `\n        <div id=\"${id}Dialog\" class=\"searchDialog\" style=\"display: none; margin-top: 10px;\">\n            ${filterHTML}\n            <div class=\"command-center\">\n                ${multipleFlg ? btnHTML : ''}\n                <button id=\"${id}_close\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" type=\"button\" onclick=\"closeDialog('${id}Dialog',false);\"style='position:relative;'>\n                    <span class=\"ui-button-icon ui-icon ui-icon-cancel\"></span>\n                    <span class=\"ui-button-icon-space\"> </span>終了\n                </button>\n            </div>\n        </div>\n    `;\n}\n\n// ③ダイアログを表示する\n$(document).on('click','.dialogSearch',function(){\n\n    // テーブルの検索機能は各ダイアログファイルに記載\n    if($(this).parent().prop('tagName') == 'TD')return;\n\n    let id = $(this).prev().attr('id');\n\n    const parentClass = $(this).parent().attr('class');\n    let type = '';\n    if(parentClass == 'text-set'){\n        id = id.slice(0,-2);\n        type = 'text-set';\n    }\n    else if(parentClass == 'range-text-container'){\n        id = id.slice(-2) == 'om' ? id.slice(0,-4) : id.slice(0,-2);\n        type = 'range-text';\n    }\n\n\n    let lookup = lookups.find(e => e.id == id);\n    let dialogId = lookup.searchDialog.id;\n    if(dialogId == \"recipientNoSearch\")return;  //納入先CD検索は個別処理\n    if(lookup.searchDialog.multiple)dialogId += \"_multiple\";\n    let title = lookup.searchDialog.title;\n    const width = searchArr.find(e => dialogId == e.dialogId).width;\n\n    if(parentClass == 'text-set'){\n        id += 'From';\n    }\n    else if(parentClass == 'range-text-container'){\n        id = $(this).prev().attr('id');\n    }\n\n    openDialog_for_searchDialog(dialogId,id,width,title)\n\n})\n\nfunction openDialog_for_searchDialog(dialogId,id,width,title){\n    searchOutputId.push({id:id,dialogId:dialogId});\n    $(`#${dialogId}Dialog td`).remove();\n    $(`#${dialogId}Dialog input`).val('');\n    $(`#${dialogId}Dialog`).dialog({\n        modal: true,\n        width: width,\n        resizable: true,\n        title:title,\n    });\n    $(`#${dialogId}Dialog`).css('max-height',\"90vh\");\n    $(`#${dialogId}Dialog`).focus();\n}\n\n\n// 検索ボタンが押されたら検索し、tableに表示\nasync function create_searchList(event){\n\n    showLoading()\n\n    let dialogId = '';\n    if(searchOutputId.length == 0){\n        dialogId = $(event).closest('div.dialog').attr('id');\n    }else{\n        dialogId = searchOutputId[searchOutputId.length -1].dialogId;\n    }\n\n    // アクティブな検索ダイアログの情報を取得\n    let searchDialogData = searchArr.find(e => e.dialogId == dialogId);\n\n    let arr = [];\n    // 簡単なSQL・joinなど複雑なSQL・Pleasanterのテーブルに取得できる処理で分け\n    if(useSqlDialogs.includes(dialogId)){\n        try{\n            arr = await requestSQL(searchDialogData);\n        }catch{\n            return;\n        }\n    }\n    else if(useIndividualSqlDialogs.includes(dialogId)){\n        arr = await requestIndividualSQL(searchDialogData);\n        if(arr == null)return;\n    }\n    else{\n    // それ以外の場合\n        // 検索対象テーブルID\n        let tableId = searchDialogData.searchTableId;\n\n        if(tableId == ''){\n            alert('検索先IDが指定されていません。');\n            return;\n        }\n\n        let columns = [];\n        let filter = {};\n        let filterSearchType = {};\n        // 複数回Getしなきゃいけないテーブルは処理を分ける\n        if(searchDialogData.dialogId == 'auxiliarySubjectSearch'){\n\n            let tmpData = await commonGetData(MASTER_TABLES[\"科目マスタ\"],['ResultId'],{ClassA:$(`#auxiliarySubjectSearch_subjectCD`).val()},{},{ClassA:'ExactMatch'},false,false);\n            if(tmpData.length != 1){\n                alert('科目CDを入力してください。');\n                return;\n            }\n            let KAMOKUCD_resultId = tmpData[0].ResultId;\n            columns = ['ClassC','ClassD'];\n            filter = {\n                ClassA:JSON.stringify([KAMOKUCD_resultId]),\n                ClassC:$('#auxiliarySubjectSearch_auxiliarySubjectCD').val(),\n                ClassD:$('#auxiliarySubjectSearch_teamName').val()\n            };\n            filterSearchType = {\n                ClassA:'ExactMatch',\n                ClassC:'ExactMatch',\n                ClassD:'PartialMatchMultiple',\n            }\n        }\n        else if(searchDialogData.dialogId == 'recipientNoSearch'){\n            let tmpData = await commonGetData(MASTER_TABLES[\"得意先マスタ\"],['ResultId'],{ClassA:$(`#recipientNoSearch_custmerFrom`).val()},{},{ClassA:'ExactMatch'},false,false);\n            if(tmpData.length != 1){\n                alert('得意先CDを入力してください。');\n                return;\n            }\n            columns = ['ClassD','ClassE','ClassF'];\n            const custmerResultId = tmpData[0].ResultId;\n            const receptNo = $('#recipientNoSearch_recipientCD').val();\n            const receptName = $('#recipientNoSearch_recipientName1').val();\n            const furigana = $('#recipientNoSearch_furigana').val();\n            filter = {\n                // ClassA:JSON.stringify(custmerResultId)\n                ClassA:\"223515\"\n            };\n            if(receptNo != \"\")filter[\"ClassD\"] = receptNo;\n            if(receptName != \"\")filter[\"ClassE\"] = receptName;\n            if(furigana != \"\")filter[\"ClassI\"] = furigana;\n\n            filterSearchType = {\n                ClassA:'ExactMatch',\n                ClassD:'PartialMatch',\n                ClassE:'PartialMatch',\n                ClassI:'PartialMatch',\n            }\n        }\n        else{\n            // gridColumns作成\n            columns = searchDialogData.toColumns.map(e => e.ColumnName);\n\n            // ColumnFilterHashとColumnFilterSearchTypes作成\n            searchDialogData.options.forEach(e => {\n                let res = create_filter(e,dialogId);\n                // res = {column:'ClassA',text:''}見本\n                if(Object.keys(res).length == 0){\n                    hideLoading();\n                    return;\n                }\n                filter[res.column] = res.text;\n                filterSearchType[res.column] = res.searchType;\n            });\n        }\n        tableData = await commonGetData(tableId,columns,filter,{},filterSearchType,false,false);\n        tableData.sort((a,b) => a.ClassA-b.ClassA)\n\n\n        if(tableData.length == 0){\n            alert('フィルター条件に合致するデータがありません。');\n            hideLoading();\n            return;\n        }\n        for(record of tableData){\n\n            // 日付はyyyy/mm/dd形式にして代入、Numでnullの場合は0に置換して代入\n            columns.forEach(e =>{\n                switch(e.substring(0,3)){\n                    case 'Num':\n                        record[e] = record[e] == null ? 0:record[e].toLocaleString();\n                        break;\n                    case 'Dat':\n                        // 1899-12-30だったら空文字を返し、それ以外なyyyy/mm/dd形式に置換\n                        if(record[e].substring(0,10) == ''){\n                            record[e] = '';\n                        }else{\n                            let dt = new Date(record[e]);\n                            record[e] = new Intl.DateTimeFormat('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit' }).format(dt);\n                        }\n                        break;\n                    default:\n                        record[e] = record[e];\n                }\n            });\n        }\n        arr = tableData;\n    }\n    let html = '';\n    for(item of arr){\n        if(searchDialogData.multiple  || searchDialogData.dialogId.includes('_multiple')){\n            html += '<tr tabindex=\"0\"><td class=\"searchTd bgc\"><input type=\"checkbox\" ></td>';\n        }else{\n            html += '<tr tabindex=\"0\">';\n        }\n        searchDialogData.toColumns.forEach((e,i) => {\n            if('alignment' in e && 'hidden' in e){\n                html += `<td class=\"searchTd bgc\" style='display:none; text-align:${e.alignment}' >${item[e.ColumnName]}</td>`\n            }\n            else if('alignment' in e){\n                html += `<td class=\"searchTd bgc\" style='text-align:${e.alignment}' >${item[e.ColumnName]}</td>`\n            }\n            else if('hidden' in e){\n                html += `<td class=\"searchTd bgc\" style='display:none;' >${item[e.ColumnName]}</td>`\n            }\n            else{\n                html += `<td class=\"searchTd bgc\">${item[e.ColumnName]}</td>`\n            }\n        });\n        html += \"</tr>\";\n    }\n\n    // 追加する\n    $(`#${dialogId}_${searchDialogData.tableId}_readTable tbody tr`).remove();\n    $(`#${dialogId}_${searchDialogData.tableId}_readTable tbody`).append(html);\n    $(`#${dialogId}_${searchDialogData.tableId}_readTable tbody`).children().eq(0).focus();\n\n    hideLoading();\n}\n\nconst fetchSql = async (query) => {\n    try {\n        showLoading()\n\n        const response = await fetch(SQL_URL, {\n            method: 'POST',\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n                query: query\n            })\n        });\n\n        if (!response.ok) {\n            // レスポンスがエラーの場合\n            throw new Error(`HTTP error! status: ${response.status}`);\n        }\n\n        const data = await response.json();\n        return data;\n    } catch (err) {\n        alert('SQLでエラーが発生しました。' + err);\n        console.error(\"SQLエラー:\", err);\n        return { err: \"Failed to execute SQL query.\" };\n    } finally {\n        hideLoading();\n    }\n\n};\nconst fetchStored = async (param) =>{\n    try {\n        showLoading()\n\n        let response =  await fetch(STORED_PROCEDURE_URL,{\n            method:\"POST\",\n            headers:{\n                \"content-type\":'application/json',\n            },\n            body:JSON.stringify(param)\n        })\n        if(!response.ok){\n            throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        response =  await response.json();\n        return response\n    } catch(err) {\n        alert('ストアドプロシージャでエラーが発生しました。' + err);\n        console.error(\"ストアドエラー:\", err);\n        return { err: \"Failed to execute stored query.\" };\n    } finally {\n        hideLoading();\n    }\n\n}\n\nconst fetchRenderForm = async (param) => {\n    try {\n        showLoading()\n        // クエリーパラメータに変換\n        const queryString = new URLSearchParams(param).toString();\n        const url = `${RENDER_FORM_URL}?${queryString}`;\n\n        // APIの状態チェック\n        const response = await fetch(url);\n        if (!response.ok) {\n            throw new Error(`API error: ${response.status}`);\n        }\n\n        // APIが正常な場合のみ新しいタブを開く\n        window.open(url, '_blank');\n\n    } catch (err) {\n        alert('入力画面生成でエラーが発生しました。' + err);\n        console.error(\"入力画面生成エラー:\", err);\n        return { err: \"Failed to execute input form.\" };\n    } finally {\n        hideLoading();\n    }\n}\n\nconst createWhere = obj =>{\n    let whereStr = 'WHERE 0=0 ';\n    Object.keys(obj).forEach(e =>{\n        if(obj[e] == '' || typeof(obj[e]) === \"undefined\"){\n            return '';\n        }\n        else if(typeof(obj[e]) == 'object'){\n            // fromよりtoのほうが大きい場合は入れ替え\n            let from = obj[e][\"from\"];\n            let to = obj[e][\"to\"];\n            if(from != '' && to != '' && from > to) [from,to] = [to,from];\n\n            // from,toに値がある場合はbetween,片方の場合は比較演算子\n            if(from != '' && to != ''){\n                whereStr += `AND ${e} BETWEEN '${from}' AND '${to}'`;\n            }else if(from != ''){\n                whereStr += `AND ${e} >= '${from}'`;\n            }else if(to != ''){\n                whereStr += `AND ${e} <= '${to}'`;\n            }\n        }\n        else{\n            whereStr += `AND ${e} LIKE '%${obj[e]}%'`;\n        }\n    })\n    return whereStr;\n}\n\nconst resMold = (res,dialogData) => {\n    for(record of res){\n        // 日付はyyyy/mm/dd形式にして代入、Numでnullの場合は0に置換して代入\n        dialogData.toColumns.forEach(e =>{\n            if(record[e.ColumnName] === null){\n                record[e.ColumnName] = '';\n            }\n            else if(typeof record[e.ColumnName] === \"undefined\"){\n                record[e.ColumnName] = '';\n            }\n            else if(e.type == 'time'){\n                record[e.ColumnName] = new Date(record[e.ColumnName]).toLocaleString('sv-SE').replaceAll('-','/');\n            }\n            else if(/^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:\\.\\d+)?$/.test(record[e.ColumnName])){\n                let tmpDt = new Date(record[e.ColumnName]);\n                record[e.ColumnName] = new Intl.DateTimeFormat('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit' }).format(tmpDt);\n            }\n            else if(\"alignment\" in e){\n                record[e.ColumnName] = record[e.ColumnName].toLocaleString();\n                // record[e.ColumnName] = Number(record[e.ColumnName]).toLocaleString();\n            }\n            else{\n                record[e.ColumnName] = record[e.ColumnName];\n            }\n        });\n    }\n    return res;\n}\n\n\nconst createWhereParam = (dialogData) =>{\n    let tmp     = {};\n    dialogData.options.forEach(e =>{\n        let fullId =  'fullId' in e ? e.fullId : dialogData.dialogId + \"_\" + e.id;\n        if(e.type == 'range-text' && \"alignment\" in e){\n            let fromVal = $(`#${fullId}From`).val().replaceAll(',','');\n            let toVal   = $(`#${fullId}To`).val().replaceAll(',','');\n            if((fromVal == '' && toVal == '') || !/^\\d*$/.test(fromVal) || !/^\\d*$/.test(toVal)){\n                tmp[e.searchColumn] = '';\n            }else{\n                tmp[e.searchColumn] = {from:Number(fromVal),to:Number(toVal)};\n            }\n        }\n        else if(e.type.slice(0,5) == 'range'){\n            let fromVal = $(`#${fullId}From`).val();\n            let toVal   = $(`#${fullId}To`).val();\n            if(fromVal == '' && toVal == ''){\n                tmp[e.searchColumn] = '';\n            }else{\n                tmp[e.searchColumn] = {from:fromVal,to:toVal};\n            }\n        }\n        else if(e.type == 'text-set'){\n            tmp[e.searchColumn] = $(`#${fullId}From`).val();\n        }\n        else{\n            tmp[e.searchColumn] = $(`#${fullId}`).val();\n        }\n    })\n    return tmp;\n}\n\n// 簡単なsql用の変数（汎用）\nasync function requestSQL(dialogData){\n\n    // sql文作成\n    // 足し算やcase句など特殊な処理はspecialTermsというパラメータがあるのでそちらを使用\n    let select  = 'selectStr' in dialogData ? dialogData.selectStr :dialogData.toColumns.map(e => {\n        if('specialTerms' in e){\n            return e.specialTerms;\n        }else{\n            return e.ColumnName;\n        }\n    }).join(',');\n    let from    = 'fromStr' in dialogData ? dialogData.fromStr : dialogData.searchTableId;\n\n    // where作成\n    let tmp     = createWhereParam(dialogData);\n    let where = createWhere(tmp);\n\n    if(dialogData.dialogId.includes('estimateNoSearch')){\n        where += \"ORDER BY 見積日付 DESC, 見積番号 DESC\";\n    }\n    let sql = `SELECT TOP 1000 ${select} FROM ${from} ${where}`;\n\n    let res;\n    try{\n        res = await fetchSql(sql);\n    }catch{\n        return;\n    }\n\n    res = res.results;\n\n    // 成形\n    return resMold(res,dialogData);\n\n}\n\n// 複雑なsql用の関数（個別作成）\nasync function requestIndividualSQL(dialogData){\n    // where作成\n    let tmp     = createWhereParam(dialogData);\n    let where = createWhere(tmp);\n    let sql;\n    // if('estimateNoSearch3'.includes(dialogData.dialogId)){\n    if(['estimateNoSearch3','estimateNoSearch3_multiple'].includes(dialogData.dialogId)){\n\n        let copy_dialogData = JSON.stringify(dialogData);\n        copy_dialogData = JSON.parse(copy_dialogData);\n        copy_dialogData.options = [\n            {searchColumn: 'MS.仕入先CD', type: 'range-text', id: 'supplierCD'}\n        ];\n        where2_param = createWhereParam(copy_dialogData);\n        let where2 = createWhere(where2_param);\n\n        sql = estimateNoSearch3_baseSQL(where,where2).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['estimateNoSearch4','estimateNoSearch4_multiple'].includes(dialogData.dialogId)){\n        sql = estimateNoSearch4_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['estimateNoSearch5','estimateNoSearch5_multiple'].includes(dialogData.dialogId)){\n        sql = estimateNoSearch5_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['mirrorSearch',\"mirrorSearch_multiple\"].includes(dialogData.dialogId)){\n        sql = mirrorSearch_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['urikakeKakuninSearch'].includes(dialogData.dialogId)){\n        sql = urikakeKakunin_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['productSearch1'].includes(dialogData.dialogId)){\n        sql = productSearch1_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['productSearch2'].includes(dialogData.dialogId)){\n        sql = productSearch2_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if('progressCheck'.includes(dialogData.dialogId)){\n        // 売上種別\n        let salesType = '';\n        switch($('#progressCheck_processingCategoryFrom').val()){\n            case '0':\n                salesType = ' AND (MHK.発注書発行日付 IS NULL AND MT.仕入日付 IS NULL)';\n                break;\n            case '1':\n                salesType = 'AND MHK.発注書発行日付 IS NOT NULL';\n                break;\n            case '2':\n                salesType = \"AND MT.売上日付 IS NOT NULL\";\n                break;\n        }\n\n        // 見積確定区分\n        let finalClassification = '';\n        switch($('#progressCheck_confirmationEstimateDatesFrom').val()){\n            case '0':\n                finalClassification = \"AND ISNULL(MHK.見積確定区分,0) = 0\";\n                break;\n            case '1':\n                finalClassification = \"AND ISNULL(MHK.見積確定区分,0) = 1\";\n        }\n        where += salesType + finalClassification;\n        sql = progressCheck_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    // 入金消込入力はストアドのため特殊処理\n    else if('ReceiptEntry'.includes(dialogData.dialogId)){\n\n        await receiptEntry_stored();\n        return null;\n    }\n    // 売上入力\n    else if('salesInput'.includes(dialogData.dialogId)){\n\n    }\n    // 売掛消費税調整入力\n    else if(['ReceivableSalesTaxAdjustmentEntrySearch'].includes(dialogData.dialogId)){\n        sql = ReceivableSalesTaxAdjustmentEntrySearch_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n\n    // 売掛消費税調整入力\n    else if(['ReceivableSalesTaxAdjustmentEntry'].includes(dialogData.dialogId)){\n        sql = ReceivableSalesTaxAdjustmentEntry_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    \n    // 経費入力\n    else if(['ExpenseEntrySearch'].includes(dialogData.dialogId)){\n\n        let personCD = '';\n        let personCDFrom = $('#ExpenseEntrySearch_personCDFrom').val();\n        let personCDTo = $('#ExpenseEntrySearch_personCDTo').val();\n        \n        // 担当者Fromのみ入力\n        if(!personCDFrom == '' && personCDTo == ''){\n            personCD = `AND KH.経費番号 IN (SELECT DISTINCT 経費番号 FROM TD経費明細 WHERE 担当者CD >= '${personCDFrom}')`;\n        }\n        // 担当者Toのみ入力\n        else if(personCDFrom == '' && !personCDTo == ''){\n            personCD = `AND KH.経費番号 IN (SELECT DISTINCT 経費番号 FROM TD経費明細 WHERE 担当者CD <= '${personCDTo}')`;\n        }\n        // 担当者FromTo\n        else if(!personCDFrom == '' && !personCDTo == ''){\n            personCD = `AND KH.経費番号 IN (SELECT DISTINCT 経費番号 FROM TD経費明細 WHERE 担当者CD BETWEEN '${personCDFrom}' AND '${personCDTo}')`;\n        }\n        \n        where += personCD\n\n        sql = ExpenseEntrySearch_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n\n\n    }\n\n    let res;\n    try{\n        res = await fetchSql(sql);\n    }catch{\n        return;\n    }\n\n    res = res.results;\n    return resMold(res,dialogData);\n}\n\n// apiget用のColumnFilterHashとColumnFilterSearchTypesを作成する関数\nfunction create_filter(e,dialogId){\n    let res = {};\n    switch(e.type){\n        case 'text':\n            let val = $(`#${dialogId}_${e.id}`).val();\n            // エラー処理\n            if(val == ''){\n                return {};\n            }\n            res =  {column:e.searchColumn,text:val,searchType:'PartialMatch'};\n            break;\n        case 'number':\n            num = $(`#${dialogId}_${e.id}`).val().replaceAll(',','');\n            // エラー処理\n            if(num == ''){\n                return {};\n            }\n            res =  {column:e.searchColumn,text:num,searchType:'ExactMatch'};\n            break;\n        case 'range-text':\n            let fromVal = $(`#${dialogId}_${e.id}From`).val();\n            let toVal = $(`#${dialogId}_${e.id}To`).val();\n\n            if(fromVal == '' && toVal == ''){\n                return {};\n            }\n\n            // 検索先項目がNumかどうかで処理を分ける\n            let arr = [];\n            if(e.searchColumn.substring(0,3) == 'Num'){\n                arr = JSON.stringify([`${fromVal},${toVal}`]);\n\n            }\n            else{\n                // 数値項目ではない場合。数値化して全パターン取得\n                fromVal = fromVal == '' ? \"0\".repeat(e.digitsNum) : fromVal;\n                toVal = toVal == '' ? \"9\".repeat(e.digitsNum):toVal;\n\n                for(i = Number(fromVal); i <= Number(toVal); i++){\n                    arr.push(String(i).padStart(e.digitsNum,'0').slice(`-${e.digitsNum}`));\n                }\n                arr = JSON.stringify(arr);\n            }\n            res = {column:e.searchColumn,text:arr,searchType:'ExactMatchMultiple'}\n            break;\n        case 'range-number':\n            let fromNum = $(`#${dialogId}_${e.id}From`).val();\n            let toNum = $(`#${dialogId}_${e.id}To`).val();\n\n            if(fromNum == '' && toNum == ''){\n                return {};\n            }\n            let numArr = JSON.stringify([`${fromNum},${toNum}`]);\n            res = {column:e.searchColumn,text:numArr,searchType:'ExactMatchMultiple'}\n\n\n            break;\n        case 'datepicker':\n\n            let dt = $(`#${dialogId}_${e.id}`).val();\n            if(dt == ''){\n                return {};\n            }\n            res = {column:e.searchColumn,text:JSON.stringify([dt.replace('-','/')]),searchType:'ExactMatch'}\n            break;\n        case 'range-date':\n            let dtFrom = $(`#${dialogId}_${e.id}From`).val();\n            let dtTo = $(`#${dialogId}_${e.id}To`).val();\n\n            if(dtFrom == '' && dtTo == ''){\n                return {};\n            }\n\n            let dates = JSON.stringify([`${dtFrom.replaceAll('-','/')},${dtTo.replaceAll('-','/')}`]);\n            res =  {column:e.searchColumn,text:dates,searchType:'ExactMatchMultiple'};\n            break;\n    }\n    return res;\n}\n\n// 選択されたときの処理\n$(document).on('click','tr:has(\".searchTd\")',function(e){\n\n\n    let item = $(this);\n\n    // ふくすう選択ダイアログなら処理終了\n    if(item.children().eq(0).children().eq(0).attr('type')){\n        // inputがクリックされていたら処理終了\n        if($(e.target).is('input')){\n            return;\n        }\n        item.find('input:first').prop('checked', function( index, prop ){\n            return !prop;\n        });\n        return;\n    }\n\n    if(searchOutputId.length == 0 || searchOutputId[searchOutputId.length -1].id == \"\")return;\n\n    if(searchOutputId[searchOutputId.length - 1].id == \"changeProductDialog_productNo\"){\n        $(`#changeProductDialog_productNo`).val(item.children().eq(0).text().replaceAll(' ',''));\n        $(`#changeProductDialog_methodNo`).val(item.children().eq(1).text().replaceAll(' ',''));\n        $(`#changeProductDialog_productName`).val(item.children().eq(2).text().replaceAll(' ',''));\n    }\n    else if(searchOutputId[searchOutputId.length - 1].id == \"changeProductDialog_AfterChangeNo\" ){\n        $(`#changeProductDialog_AfterChangeNo`).val(item.children().eq(0).text().replaceAll(' ',''));\n        $(`#changeProductDialog_AfterMethodNo`).val(item.children().eq(1).text().replaceAll(' ',''));\n        $(`#changeProductDialog_AfterProductName`).val(item.children().eq(2).text().replaceAll(' ',''));\n    }\n    else{\n        $(`#${searchOutputId[searchOutputId.length -1].id}`).val(item.children()[0].textContent).trigger('input');\n    }\n\n    $(`#${searchOutputId[searchOutputId.length -1].dialogId}Dialog tbody`).html('');\n    $(`#${searchOutputId[searchOutputId.length -1].dialogId}Dialog`).dialog('close');\n    searchOutputId.pop();\n})\n\n// マウスオーバー時のイベント\n$(document).on('mouseover','.bgc',function(){\n    $('.bgc').parent().css('background-color','');\n    $(this).parent().css('background-color','silver')\n})\n$(document).on('mouseout','.bgc',function(){\n    $('.bgc').parent().css('background-color','');\n})\n\n// ダイアログを閉じるボタンが押された時の処理\n$(document).on('click','.ui-dialog-titlebar-close',function(){\n    let elem = $(this).parent().parent().next();\n    var prevObjectElement = elem.prevObject[0];\n\n    // prevObjectElementの子要素の中に'searchDialog'クラスを持つ要素があるかをチェック\n    var hasSearchDialogClass = $(prevObjectElement).children().hasClass('searchDialog');\n    if(hasSearchDialogClass){\n        searchOutputId.pop();\n    }\n})\n\n// エスケープで閉じる機能を廃止のためコメントアウト\n// escapeが押されたらsearchOutputIdの末尾を削除\n// $(document).keydown(async function(e){\n//     const key = e.keyCode;\n//     if(key != 27){\n//         return;\n//     }\n//     // dialogでエスケープキーを閉じるときのバリデーション対策\n//     now_varidate_flg = true;\n//     await sleep(0);\n//     now_varidate_flg = false;\n//     searchOutputId.pop();\n\n//     // 閉じたdialogを削除\n// })\n\n// 複数選択ダイアログで、チェックマークが入っている項目をカンマ区切りで呼出元項目に入力する関数\nfunction resultInput(event){\n\n\n    let items = Array.from($(`#${searchOutputId[searchOutputId.length-1].dialogId}Dialog tbody input[type=\"checkbox\"]:checked`));\n\n    if(items.length == 0){\n        alert('選択されていません。');\n        return;\n    }\n\n    let resText = items.map(e => $(e).parent().parent().children().eq(1).text()).join(',');\n    $(`#${searchOutputId[searchOutputId.length -1].id}`).val(resText).trigger('input');\n    $(`#${searchOutputId[searchOutputId.length -1].dialogId}Dialog`).dialog('close');\n    searchOutputId.pop();\n}\n\n$(document).on('click','.ui-dialog-titlebar-close',function(){\n    let element = $(this).parent().parent();\n    element.find('table.searchTable tbody').html('');\n})\n\n$(document).on('keydown','tr:has(\".searchTd\")',function(e){\n    if(e.which == 13){\n        $(this).trigger('click');\n    }\n})",
            "Id": 13
          },
          {
            "Title": "22_ダイアログ共通.js",
            "New": true,
            "Edit": true,
            "Body": "//lookupするための情報と、どの検索ダイアログを開くかの情報を格納\nlet lookups = [];\n\n// 現在開いているダイアログの情報（古い順に入ってる）\nlet searchOutputId = [];\n\n// 各検索ダイアログの情報。ダイアログ作成時に作成\nlet searchArr = [\n    // {dialogId:'estimateNoSearch',searchTableId:'1273239',options:[\n    //         {type:\"range-text\",id:'estimateNo',searchColumn:'ClassA',digitsNum:6},\n    //         {type:\"range-date\",id:'billingDate',searchColumn:'DateB'},\n    //         {type:\"text\",id:'custmerCD',searchColumn:'ClassP'},\n    //         {type:\"range-number\",id:'AllMoney',searchColumn:'NumA'},\n    //         {type:\"range-date\",id:'estimateDate',searchColumn:'DateA'},\n    //         {type:\"text\",id:'estimateName',searchColumn:'ClassJ'},\n    //     ]\n    // }\n];\n\n// ダイアログが開かれた時間を格納\nlet dialog_openTime;\n\nconst styleElement = document.createElement('style');\nstyleElement.textContent = `\n    .loading-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.5);\n        z-index: 9999;\n        display: none;\n        justify-content: center;\n        align-items: center;\n    }\n\n    .loading-spinner {\n        width: 50px;\n        height: 50px;\n        border: 5px solid #f3f3f3;\n        border-top: 5px solid #3498db;\n        border-radius: 50%;\n        animation: spin 1s linear infinite;\n    }\n\n    @keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n    }\n\n    .searchDialog input:disabled,\n    .dialog input:disabled,\n    .dialog select:disabled,\n    .dialog textarea:disabled {\n        background-color: #f0f0f0;\n        color: #888;\n        cursor: not-allowed;\n    }\n    .dialog .error {\n        border: 1px solid red;\n    }\n    .dialog .error-message {\n        color: red;\n        font-size: 0.8em;\n        margin-top: 5px;\n    }\n    .field-wide {\n        width: 100%;\n        max-width:800px;\n    }\n    .field-normal {\n        width: 60%;\n        max-width:450px;\n    }\n    .both {\n        clear: both;\n        min-height:37px;\n        padding-bottom:5px;\n        height:37px;\n    }\n    .range-container {\n        display: flex;\n        align-items: center;\n    }\n    .range-input {\n        flex-grow: 1;\n        margin: 0 10px;\n        -webkit-appearance: none;\n        width: 100%;\n        height: 5px;\n        background: #d3d3d3;\n        outline: none;\n        opacity: 0.7;\n        transition: opacity .2s;\n    }\n    .range-input:hover {\n        opacity: 1;\n    }\n    .range-input::-webkit-slider-thumb {\n        -webkit-appearance: none;\n        appearance: none;\n        width: 15px;\n        height: 15px;\n        background: #4CAF50;\n        cursor: pointer;\n        border-radius: 50%;\n    }\n    .range-input::-moz-range-thumb {\n        width: 15px;\n        height: 15px;\n        background: #4CAF50;\n        cursor: pointer;\n        border-radius: 50%;\n    }\n    .range-label {\n        min-width: 30px;\n        text-align: center;\n    }\n    .range-text-container {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .oneItem{\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .text-set{\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .range-text-input {\n        width: 45%;\n    }\n    .range-text-separator {\n        margin: 0 10px;\n    }\n    .SdtRequired::after {\n        content: \"*\";\n        color: red;\n        margin-left: 3px;\n    }\n    .radioButton{\n        padding-top:7px;\n    }\n    .radioButton input[type=\"radio\"]{\n        vertical-align: sub;\n    }\n    .inputText{\n        width:20%;\n    }\n    .disableText{\n        width:80%;\n    }\n    .SdtTime{\n        /* position: absolute;\n        top:9px;\n        right:-17px;\n        z-index: 10; */\n        cursor:pointer;\n    }\n    .ui-icon-search{\n        position: absolute;\n        top:9px;\n        right:-17px;\n        z-index: 10;\n        cursor:pointer;\n    }\n    .ui-icon-close{\n        position: absolute;\n        top:9px;\n        right:-33px;\n        z-index: 10;\n        cursor: pointer;\n    }\n    .search{\n        position:static;\n    }\n    .button-small {\n        background: linear-gradient(145deg, #f8f8f8, #efefef);\n        border-radius: 5px;\n        color: #555;\n        text-align: center;\n        cursor: pointer;\n        transition: all 0.15s ease;\n    }\n    .button-small:hover {\n        background: linear-gradient(145deg, #f2f2f2, #e8e8e8);\n    }\n    .button-small:active {\n        background: linear-gradient(145deg, #e8e8e8, #f2f2f2);\n        transform: translateY(0.5px);\n    }\n    td > input:focus{\n        border:none;\n        background-color:white;\n    }\n    td > input:focus-visible {\n        outline:none;\n        box-shadow:none;\n    }\n    tr:focus{\n        border:none;\n        background-color: #d3d3d3;\n    }\n    tr:focus-visible{\n        outline: none;\n    }\n    .table {\n        border-collapse: separate;/*collapseから変更*/\n        border-spacing: 0;\n        border-radius: 5px 5px 0 0;\n        /* overflow: hidden; */\n    }\n\n    .table thead th,\n    .table tbody td {\n        border-bottom: 1px solid rgb(192, 192, 192);/*一括指定せず、border-bottomのみ*/\n        border-left: 1px solid rgb(192, 192, 192);\n    }\n    .table tr th:first-child,\n    .table tbody tr td:first-child {\n        border-left: none;\n    }\n    td{\n        width:auto;\n    }\n    .input_table input:disabled{\n        background-color:white;\n    }\n\n`;\n// スタイルを追加\ndocument.head.appendChild(styleElement);\n\n// フィールド作成の関数\nconst createField = (dialogId, type, id, label, options = {},multipleFlg = false) => {\n    const fullId = `${dialogId}_${id}`;\n    if (document.getElementById(fullId)) {\n        let message = `フィールドID \"${fullId}\" は既に存在します。一意のIDを使用してください。`;\n        alert(message)\n        throw new Error(message);\n    }\n\n    const hiddenAttr = options.hidden ? 'display:none':\"\";\n    const disabledAttr = options.disabled ? 'disabled' : '';\n    const requiredAttr = options.required ? 'required' : '';\n    const additionalAttrs = Object.entries(options.attributes || {})\n        .map(([key, value]) => `${key}=\"${value}\"`)\n        .join(' ');\n    const widthClass = options.width === 'wide' ? 'field-wide' : 'field-normal';\n    const requiredClass = requiredAttr == 'required' ? \"SdtRequired\" : '';\n    const maxLength = options.varidate && 'maxlength' in options.varidate ? options.varidate.maxlength : null;\n    const maxlengthForNumberClass = type == 'number' && options.varidate && 'maxlength' in options.varidate ? `maxlength_for_number` : \"\";\n    \n    // バリデーション\n    let varidateClass = \"\";\n    let numOnlyClass = \"\";\n    if(options.varidate && options.varidate.type == \"int\"){\n        varidateClass = 'varidate_int';\n        numOnlyClass = options.searchDialog || ('alignment' in options && options.alignment == 'end') ? \"numOnly\" : \"\";\n    }\n    else if(options.varidate && options.varidate.type == 'zeroPadding'){\n        varidateClass = 'varidate_zeroPadding';\n        numOnlyClass = options.searchDialog ? \"numOnly\" : \"\";\n    }\n    else if(options.varidate && options.varidate.type == 'str'){\n        varidateClass = 'varidate_str';\n    }\n\n    if(['text-set','select','radio'].includes(type) && !('values' in options) && !('searchDialog' in options)  && !(options.disabled)){\n        let message = `ダイアログ名:\"${dialogId}\"　項目ID:\"${id}\" の選択肢（values）を指定してください`;\n        alert(message)\n        throw new Error(message);\n    }\n\n    let t_head = '';\n    let fieldHTML = '';\n    switch(type) {\n        case 'text':\n        case 'number':\n        case 'email':\n\n            const initializeClass = options.value ? 'initialize_target':'';\n\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\" >\n                        <div class=\"container-normal\">\n                            <div class=\"oneItem\">\n                                <input id=\"${fullId}\" name=\"${fullId}\" class=\"control-textbox ${numOnlyClass} ${initializeClass} ${'alignment' in options && options.alignment == 'end' ? 'input-Number' :''} ${maxlengthForNumberClass} ${varidateClass}\" type=\"${type}\"\n                                    ${options.placeholder ? `placeholder=\"${options.placeholder}\"` : ''}\n                                    ${options.value ? `value=\"${options.value}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}\n                                    ${maxLength != null ? `maxlength='${maxLength}'` : ''}\n                                    style='${'alignment' in options ? `text-align:${options.alignment}` : ''}'\n                                >\n                                ${options.unit ?`<div style=\"font-size:12px; padding-left: 3px;\">${options.unit}</div>`: ''}\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-search dialogSearch ${varidateClass}\" style=\"position:static\" tabindex=\"0\"></div>`: ''}\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}')\"style=\"position:static\"></div>`: ''}\n                        </div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'select':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <select id=\"${fullId}\" name=\"${fullId}\" class=\"control-dropdown\"\n                                ${options.onchange ? `onchange=\"${options.onchange}('${dialogId}', '${id}')\"` : ''}\n                                ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                                <option value=\"\">&nbsp;</option>\n                                ${options.values ? options.values.map(opt => `<option value=\"${opt.value}\" ${opt.selected ? 'selected' : ''}>${opt.text}</option>`).join('') : ''}\n                            </select>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'datepicker':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"${fullId}\" name=\"${fullId}\" class=\"control-textbox ${varidateClass}\" type=${options.format ? options.format : \"date\"} max=\"${options.format && options.format == 'month' ? '9999-12':'9999-12-31'}\"\n                                ${options.placeholder ? `placeholder=\"${options.placeholder}\"` : ''}\n                                ${options.value ? `value=\"${options.value}\"` : ''}\n                                autocomplete=\"off\"\n                                ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                            <div class=\"ui-icon ui-icon-clock SdtTime\" style=\"position:static\"></div>\n                        </div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'textarea':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"field-wide both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <div id=\"${fullId}_viewer\" class=\"control-markup not-send\" ondblclick=\"editMarkdown('${dialogId}', '${id}');\">\n                                <pre>${options.value ? options.value : '<br>'}</pre>\n                            </div>\n                            <div id=\"${fullId}.editor\" class=\"ui-icon ui-icon-pencil button-edit-markdown\" onclick=\"editMarkdown('${dialogId}', '${id}');\">\n                            </div>\n                            <textarea id=\"${fullId}\" name=\"${fullId}\" class=\"control-markdown\" tabindex=\"-1\"\n                                ${options.placeholder ? `placeholder=\"${options.placeholder}\"` : ''}\n                                style=\"height: 100px; display: none;\"\n                                ${disabledAttr} ${requiredAttr} ${additionalAttrs}>${options.value ? options.value : ''}</textarea>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'checkbox':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <input id=\"${fullId}\" name=\"${fullId}\" type=\"checkbox\"\n                                ${options.checked ? 'checked' : ''}\n                                ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                            <label for=\"${fullId}\" class=\"${requiredClass}\">${label}</label>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'radio':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label ${requiredClass}\" >${label}</p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal radioButton\">\n                            ${options.values ? options.values.map(opt => `\n                                <input type=\"radio\" id=\"${fullId}_${opt.value}\" name=\"${fullId}\" value=\"${opt.value}\"\n                                    ${opt.checked ? 'checked' : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                                <label for=\"${fullId}_${opt.value}\">${opt.text}</label>\n                            `).join('') : ''}\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'range':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}\"  class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <div class=\"range-container\">\n                                <span class=\"range-label\">${options.min || 0}</span>\n                                <input id=\"${fullId}\" name=\"${fullId}\" class=\"range-input\" type=\"range\"\n                                    min=\"${options.min || 0}\" max=\"${options.max || 100}\"\n                                    value=\"${options.value || options.min || 0}\"\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}\n                                    oninput=\"document.getElementById('${fullId}Value').textContent = this.value\">\n                                <span class=\"range-label\">${options.max || 100}</span>\n                            </div>\n                            <div id=\"${fullId}Value\" style=\"text-align: center;\">${options.value || options.min || 0}</div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'range-text':\n        case 'range-number':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}From\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <div class=\"range-text-container\">\n                                <input id=\"${fullId}From\" name=\"${fullId}From\" class=\"control-textbox range-text-input ${numOnlyClass} ${'alignment' in options && options.alignment == 'end' ? 'input-Number' :''} ${maxlengthForNumberClass} ${varidateClass}\" type=\"${type=='range-text'?'text':'number'}\"\n                                    ${options.placeholderFrom ? `placeholder=\"${options.placeholderFrom}\"` : ''}\n                                    ${options.valueFrom ? `value=\"${options.valueFrom}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}\n                                    style='${'alignment' in options ? `text-align:${options.alignment}` : ''}'\n                                    ${maxLength != null ? `maxlength='${maxLength}'` : ''}\n                                >\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-search dialogSearch ${varidateClass}\" style=\"position:static\" tabindex=\"0\"></div>`: ''}\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}From')\"  style=\"position:static\"></div>`: ''}\n                                <span class=\"range-text-separator\">${options.betweenString ? options.betweenString : '～'}</span>\n                                <input id=\"${fullId}To\" name=\"${fullId}To\" class=\"control-textbox range-text-input ${numOnlyClass} ${'alignment' in options && options.alignment == 'end' ? 'input-Number' :''} ${maxlengthForNumberClass} ${varidateClass}\" type=\"${type=='range-text'?'text':'number'}\"\n                                    ${options.placeholderTo ? `placeholder=\"${options.placeholderTo}\"` : ''}\n                                    ${options.valueTo ? `value=\"${options.valueTo}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}\n                                    style='${'alignment' in options ? `text-align:${options.alignment}` : ''}'\n                                    ${maxLength != null ? `maxlength='${maxLength}'` : ''}\n                                >\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-search dialogSearch ${varidateClass}\" style=\"position:static\" tabindex=\"0\"></div>`: ''}\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}To')\"  style=\"position:static\"></div>`: ''}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'range-date':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}From\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <div class=\"range-text-container\">\n                                <input id=\"${fullId}From\" name=\"${fullId}From\" class=\"control-textbox ${varidateClass}\" type=${options.format ? options.format : \"date\"} max=\"${options.format && options.format == 'month' ? '9999-12':'9999-12-31'}\"\n                                    ${options.placeholderFrom ? `placeholder=\"${options.placeholderFrom}\"` : ''}\n                                    ${options.valueFrom ? `value=\"${options.valueFrom}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                                <span class=\"range-text-separator\">～</span>\n                                <input id=\"${fullId}To\" name=\"${fullId}To\" class=\"control-textbox ${varidateClass}\" type=${options.format ? options.format : \"date\"} max=\"${options.format && options.format == 'month' ? '9999-12':'9999-12-31'}\"\n                                    ${options.placeholderTo ? `placeholder=\"${options.placeholderTo}\"` : ''}\n                                    ${options.valueTo ? `value=\"${options.valueTo}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'text-set':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"field-wide both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}From\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <div class=\"text-set\">\n                                <input id=\"${fullId}From\" name=\"${fullId}From\" class=\"control-textbox inputText ${varidateClass}\" type=\"${'type' in options ? options.type : 'text'}\"\n                                    ${options.placeholderFrom ? `placeholder=\"${options.placeholderFrom}\"` : ''}\n                                    ${options.valueFrom ? `value=\"${options.valueFrom}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}\n                                    ${maxLength != null ? `maxlength='${maxLength}'` : ''}\n                                >\n                                <input id=\"${fullId}To\" name=\"${fullId}To\" value=\"${options.values ? options.values.map(e => e.value + \":\" + e.text).join(' '):''}\" class=\"control-textbox disableText\" type=\"text\" disabled>\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-search dialogSearch ${varidateClass}\" style=\"position: static;\" tabindex=\"0\"></div>`: ''}\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}From')\"style=\"position: static;\"></div>`: ''}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'button_block':\n            fieldHTML = `\n                <div style=\"width:80%; display: flex;justify-content: end; margin-bottom:10px;\">\n                    <button id=${fullId} class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" data-icon=\"ui-icon-disk\" type=\"button\" style=\"z-index: 9999;\" onclick=\"${options.onclick}\">\n                        <span class=\"ui-button-icon ui-icon ui-icon-disk \" style=\"position: static;\"></span>\n                        <span class=\"ui-button-icon-space\"> </span>${label}\n                    </button>\n                </div>\n            `\n            break;\n        case 'button_inline':\n            fieldHTML = `\n                <button id=${fullId} class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" data-icon=\"ui-icon-disk\" type=\"button\" style=\"z-index: 9999; ${hiddenAttr}\" onclick=\"${'onclick' in options ? options.onclick : ''}\">\n                    <span class=\"ui-button-icon ui-icon ui-icon-disk \" style=\"position: static;\"></span>\n                    <span class=\"ui-button-icon-space\"> </span>${label}\n                </button>\n            `\n            break;\n        case 'buttonTextSet':\n            fieldHTML = `\n                <div class=\"input-button-container\" style=\"clear: both; padding: 10px; border:1px solid #ccc; border-radius: 5px; width: 95%; margin: 0 auto; margin-bottom: 20px;\">\n                    <label for=\"my-input\" class=\"label\" style=\"top:-20px; left:10px; background-color: rgb(254,238,189); padding:0 10px;\">${label}</label>\n                    <span style=\"display: none;\">\n                        <input style=\"display: inline-block; left: 30px; position: absolute;border: 1px solid rgb(192,192,192); width: 75%; height: 24px; border-radius: 5px;\">\n                        <button class=\"button button-icon ui-button ui-corner-all ui-widget applied changePath customized\" type=\"button\" style=\"float: right; top:-4px;\" >\n                            <span class=\"ui-button-icon ui-icon ui-icon-disk\"></span>\n                            <span class=\"ui-icon-disk\"> </span>登録\n                        </button>\n                    </span>\n                    <span>\n                        <span style=\"display: inline-block; left: 30px; position: absolute;\"></span>\n                        <button class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" type=\"button\" style=\"float: right; top:-4px;\" onclick=\"${options.onclick ? options.onclick : ''}\">\n                            <span class=\"ui-button-icon ui-icon ui-icon-disk\"></span>\n                            <span class=\"ui-icon-disk\"> </span>${options.btnLabel}\n                        </button>\n                    </span>\n                </div>\n            `\n            break;\n        case 'ImportFile':\n            fieldHTML = `\n                <div class=\"input-button-container\" style=\"clear: both; padding: 10px; border:1px solid #ccc; border-radius: 5px; width: 95%; margin: 0 auto; margin-bottom: 20px;\">\n                    <label for=\"my-input\" class=\"label\" style=\"top:-20px; left:10px; background-color: rgb(254,238,189); padding:0 10px;\">${label}</label>\n                    <input type=\"file\" id=\"${id}\" accept=\"${options.fileType}\">\n                </div>\n            `\n            break;\n        case 'borderText':\n            fieldHTML = `\n                <div class=\"input-container\" style=\"clear: both; padding: 10px; border:1px solid #ccc; border-radius: 5px; width: 95%; margin: 0 auto;\">\n                    <label for=\"my-input\" class=\"label\" style=\"top:-20px; left:10px; background-color: rgb(254,238,189); padding:0 10px;\">${label}</label>\n                    <span style=\"display: inline-block; left: 30px; position: absolute;\"></span>\n                </div>\n            `\n            break;\n        case 'input-table':\n            // thead作成\n            t_head = '';\n            if(options.multiple || multipleFlg)t_head += `<th style=\"text-align: center;border-collapse: collapse;\" class='inversion'><input type=\"checkbox\" class=\"allCheck\"></th>`;\n            if(options.lineNumber)t_head += `<th>No</th>`\n            t_head += options.t_heads.map(e => `<th style=\"text-align: center;border-collapse: collapse; ${e.width ?'width:'+ e.width + \";\":''}\">${e.label}</th>`).join('');\n            // tbody作成\n            let t_body = '';\n            columnCou = options.t_heads.length;\n            for(i = 0;i < options.row;i++){\n                t_body += \"<tr style='background-color:white !important'>\";\n                t_body += options.multiple || multipleFlg ?  `<td class='inversion'><input type='checkbox'></td>` : ``;\n                t_body += options.lineNumber ? `<td style=\"text-align:center;\">${i + 1}</td>` : '';\n                options.t_heads.forEach((e,j) =>{\n                    let for_numItem = false;\n                    if('alignment' in e)for_numItem = true;\n\n                    const maxlength = e.varidate && 'maxLength' in e.varidate ? `maxlength=\"${e.varidate.maxLength}\" `: \"\";\n                    const maxlengthFrom = e.varidateFrom && 'maxLength' in e.varidateFrom ? `maxlength=\"${e.varidateFrom.maxLength}\" `: \"\";\n                    const maxlengthTo = e.varidateTo && 'maxLength' in e.varidateTo ? `maxlength=\"${e.varidateTo.maxLength}\" `: \"\";\n\n                    let varidateClass = \"\";\n                    if(e.varidate && e.varidate.type == \"int\"){\n                        varidateClass = 'varidate_int';\n                    }\n                    else if(e.varidate && e.varidate.type == 'zeroPadding'){\n                        varidateClass = 'varidate_zeroPadding';\n                    }\n                    else if(e.varidate && e.varidate.type == 'str'){\n                        varidateClass = 'varidate_str';\n                    }\n\n                    let varidateFromClass = \"\";\n                    if(e.varidateFrom && e.varidateFrom.type == \"int\"){\n                        varidateFromClass = 'varidate_int';\n                    }\n                    else if(e.varidateFrom && e.varidateFrom.type == 'zeroPadding'){\n                        varidateFromClass = 'varidate_zeroPadding';\n                    }\n                    else if(e.varidateFrom && e.varidateFrom.type == 'str'){\n                        varidateFromClass = 'varidate_str';\n                    }\n\n                    let varidateToClass = \"\";\n                    if(e.varidateTo && e.varidateTo.type == \"int\"){\n                        varidateToClass = 'varidate_int';\n                    }\n                    else if(e.varidateTo && e.varidateTo.type == 'zeroPadding'){\n                        varidateToClass = 'varidate_zeroPadding';\n                    }\n                    else if(e.varidateTo && e.varidateTo.type == 'str'){\n                        varidateToClass = 'varidate_str';\n                    }\n\n\n                    const table_requiredAttr_from = e.requiredFrom ? 'required':'';\n                    const table_requiredAttr_to = e.requiredTo ? 'required':'';\n                    const table_requiredAttr = e.required ? 'required':'';\n                    switch (e.type){\n                        case 'text-set':\n                            const disabled_from   = e.disabled ? 'disabled' : '';\n                            const disabled_to     = 'to_disabled' in e && !e.to_disabled ? '':'disabled';\n                            \n                            t_body += `\n                                <td id=\"${fullId}_${i}_${j}\">\n                                    <input id=\"${fullId}_${i}_${j}_From\" class=\"${`${fullId}_${j}`} ${varidateFromClass} ${for_numItem ? 'input-Number':''}\" type=\"text\" style='border:none; height:50%; \n                                        width:${e.search ? \"calc(100% - 39px)\":'100%'}; ${for_numItem ? `text-align:${e.alignment}`:''}' ${disabled_from} ${maxlengthFrom} ${table_requiredAttr_from}\n                                    >\n                                    ${e.search ? `<div class=\"ui-icon ui-icon-search tableInSearch ${varidateFromClass}\" style=\"position: static;\" tabindex=\"0\"></div>`: ''}\n                                    ${e.search ? `<div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}_${i}_${j}_From')\"style=\"position: static;\"></div>`:''}\n                                    <input type=\"text\" id=\"${fullId}_${i}_${j}_To\" class=\"${for_numItem ? 'input-Number':''} ${varidateToClass} ${`${fullId}_${j}_to`}\"\n                                        style='border: none; border-top:dashed rgb(192,192,192) 1px; height:50%; width:100%; background-color: white;${for_numItem ? `text-align:${e.alignment}`:''}' ${disabled_to}\n                                        ${table_requiredAttr_to}${maxlengthTo}\n                                    >\n                                </td>\n                            `;\n                            break;\n                        case 'date':\n                            t_body += `\n                                <td id=\"${fullId}_${i}_${j}\">\n                                    <input type=\"date\" style='border:none; height:100%; width:100%' ${e.disabled ? 'disabled':''} max=\"9999-12-31\" class=\"${varidateFromClass} ${`${fullId}_${j}`} \"${table_requiredAttr_from}>\n                                    <input type='text' class=\"${`${fullId}_${j}`} ${`${fullId}_${j}_to`} ${varidateToClass}\" style=\"border:none;border-top:dashed rgb(192,192,192) 1px;width:100%;\" ${e.disabled ? 'disabled':''} ${maxlengthTo} ${table_requiredAttr_to}>\n                                </td>`;\n                            break;\n                        case 'dateOnly':\n                            t_body += `\n                                <td id=\"${fullId}_${i}_${j}\">\n                                    <input type=\"date\" style='border:none; height:100%; width:100%'  ${e.disabled ? 'disabled':''} max=\"9999-12-31\" class=\"${`${fullId}_${j}`} ${varidateClass}\" ${table_requiredAttr}>\n                                </td>`;\n                            break;\n                        case 'button':\n                            t_body += `\n                                <td id=\"${fullId}_${i}_${j}\" class=\"button-small\">\n                                    <button\n                                        style=\"width:100%;\"\n                                        ${e.disabled ? 'disabled':''}\n                                    >\n                                        ${e.btn_label ? e.btn_label : 'ボタン'}\n                                    </button>\n                                </td>`;\n                            break;\n                        default:\n                            if(e.search) {\n                                t_body += `\n                                    <td id=\"${fullId}_${i}_${j}\" style=\"height:100%\">\n                                        <input id=\"${fullId}_${i}_${j}_From\" class=\"${`${fullId}_${j}`} ${varidateClass}\" type=\"text\" style='border:none;width:calc(100% - 39px); height:100%; ${for_numItem ? `text-align:${e.alignment}`:''}'  ${e.disabled ? 'disabled':''} ${maxlength} ${table_requiredAttr}>\n                                        <div class=\"ui-icon ui-icon-search tableInSearch ${varidateClass}\" style=\"position: static;\" tabindex=\"0\"></div>\n                                        <div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}_${i}_${j}')\"style=\"position: static;\"></div>\n                                    </td>`;\n                            } else {\n                                t_body += `\n                                    <td id=\"${fullId}_${i}_${j}\" style=\"height:100%\">\n                                        <input type=\"text\"  class=\"${`${fullId}_${j}`} ${varidateClass} ${for_numItem ? 'input-Number':''}\" style='border:none; height:100%; width:100%; background-color:white;${for_numItem ? `text-align:${e.alignment}`:''} ' ${e.disabled ? 'disabled': ''} ${maxlength} ${table_requiredAttr}>\n                                    </td>`;\n                            }\n                            break;\n                    }\n                })\n                t_body += \"</tr>\";\n            }\n            fieldHTML = `\n                <div id=\"${fullId}_inputTable\" class=\"input_table ui-dialog-content ui-widget-content\" style=\"display: inline-block; margin-top:20px; width: 98%;margin-left:1%;\">\n                    <div class=\"field-vertical \" style=\"width: 100%;\">\n                        <div class=\"field-control\">\n                            <div class=\"container-selectable\">\n                                <div class=\"wrapper h300\">\n                                    <table class=\"table inputTable\" style=\"height:100%;\">\n                                        <thead style=\"position: sticky; top:0; background-color: gold; z-index:9999\">\n                                            <tr>\n                                                ${t_head}\n                                            </tr>\n                                        <tbody>\n                                            ${t_body}\n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `;\n            break;\n        case 'search-table':\n            t_head = '';\n            if(options.multiple || multipleFlg)t_head += `<th style=\"text-align: center;border-collapse: collapse;\" class='inversion'><input type=\"checkbox\" class=\"allCheck\"></th>`;\n            t_head += options.t_heads.map(e => `<th style=\"text-align: center;border-collapse: collapse; ${e.hidden ? 'display:none;':''}\">${e.label}</th>`).join('');\n            fieldHTML = `\n                <div style=\"width:80%; display: flex;justify-content: end;\">\n                    <button id=\"${fullId}_searchButton\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" data-icon=\"ui-icon-search\" type=\"button\" style=\"z-index: 9999;\" onclick='create_searchList($(this));'>\n                        <span class=\"ui-button-icon ui-icon ui-icon-search search\" style=\"position: static;\"></span>\n                        <span class=\"ui-button-icon-space\"> </span>検索\n                    </button>\n                </div>\n                <div id=\"${fullId}_readTable\" class=\"ui-dialog-content ui-widget-content\" style=\"display: inline-block; margin-top:20px; width: 98%;margin-left:1%;\">\n                    <div class=\"field-vertical \" style=\"width: 100%;\">\n                        <div class=\"field-control\">\n                            <div class=\"container-selectable\">\n                                <div class=\"wrapper h300\">\n                                    <table class=\"table searchTable\">\n                                        <thead style=\"position: sticky; top:0; background-color: gold; z-index:9999\">\n                                            <tr>\n                                                ${t_head}\n                                            </tr>\n                                        </thead>\n                                        <tbody>\n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `;\n            break;\n        case 'free':\n            fieldHTML = options.str;\n            break;\n    }\n    return fieldHTML;\n};\n\n\n//時計マークがクリックされたら現在日付を入力\n$(document).on('click','.SdtTime',function(){\n\n    //フォーマットを取得\n    const format = $(this).prev().prop('type');\n    //現在日付を取得\n    let dt = new Date();\n    //typeがmonthの場合は「yyyy-mm」、dateの場合は「yyyy-mm-dd」形式に文字列成型\n    let formatDt = dt.toLocaleDateString('sv-SE');\n    if(format == \"month\"){\n        formatDt = formatDt.slice(0,7);\n    }\n    $(this).prev().val(formatDt);\n})\n\n// lookups作成\nfunction createLookups(dialogId, title, fields){\n\n    //キー項目を取得\n    let keyObjs = fields.filter(e => e.options && typeof(e.options) == \"object\" && ( e.options.lookupOrigin || e.options.searchDialog));\n\n    for(let keyObj of keyObjs){\n\n        // id作成\n        let key_fullId = dialogId + \"_\" + keyObj.id;\n        // 転記先項目を取得\n        let lookpupList = fields.filter(e => e.options.lookupFor  && e.options.lookupFor[0].id == keyObj.id);\n\n        let tmp_lookups = {};\n\n        // キー項目の値を代入\n        tmp_lookups.id              = key_fullId;\n        tmp_lookups.type            = keyObj.type;\n        tmp_lookups.tableId         = keyObj.options.lookupOrigin ? keyObj.options.lookupOrigin.tableId : '';\n        tmp_lookups.keyColumnName   = keyObj.options.lookupOrigin ? keyObj.options.lookupOrigin.keyColumnName : '';\n        tmp_lookups.digitsNum       = keyObj.options.digitsNum ? keyObj.options.digitsNum:'';\n        tmp_lookups.searchDialog    = {id:keyObj.options.searchDialog ? keyObj.options.searchDialog.id:'',title:keyObj.options.searchDialog ? keyObj.options.searchDialog.title:'',multiple:keyObj.options.searchDialog.multiple ? true : false};\n        if(keyObj.options.lookupOrigin && 'base_sql' in keyObj.options.lookupOrigin)tmp_lookups.base_sql = keyObj.options.lookupOrigin.base_sql;\n        // 転記先項目のパラメータ設定\n        if(keyObj.options.lookupOrigin && keyObj.type == 'text-set'){\n            let tmp = [{type:'text',id:key_fullId + 'To',columnName:keyObj.options.lookupOrigin.forColumnName}];\n            if(keyObj.options.lookupOrigin.specialTerms)tmp[0].specialTerms = keyObj.options.lookupOrigin.specialTerms;\n            tmp_lookups.toParam = tmp;\n        }\n        else if(keyObj.options.lookupOrigin){\n            tmp_lookups.toParam = lookpupList.map(e => {\n                let param = {};\n                param.type = e.type;\n                param.id = e.type == 'text-set' ? dialogId + \"_\" + e.id + 'From' :dialogId + \"_\" + e.id;\n                param.columnType = e.options.lookupFor[0].columnType;\n                param.columnName = e.options.lookupFor[0].columnName;\n                if('specialTerms' in e.options.lookupFor[0])param.specialTerms = e.options.lookupFor[0].specialTerms;\n                if('func' in e.options.lookupFor[0])param.func = e.options.lookupFor[0].func;\n                return param;\n            })\n        }\n\n        // 前回出力情報\n        if(\"get_lastTime_output\" in keyObj.options){\n            tmp_lookups.get_lastTime_output = {dialogId:dialogId,name:keyObj.options.get_lastTime_output};\n        }\n\n        lookups.push(tmp_lookups);\n\n        // イベント登録\n        if(keyObj.options.lookupOrigin){\n            if(keyObj.type == 'text-set')key_fullId += 'From';\n            $(document).on('input',`#${key_fullId}`,function(e){\n\n                if(now_IME)return;\n\n                // 数字以外を入力できないようにする\n                if(/[^\\uFF10-\\uFF19\\u0030-\\u0039]/.test($(this).val()) && $(this).val() != \"\"){\n                    let tmp = $(this).val().replace(/[^０-９0-9]/g, '');\n                    $(this).val(tmp);\n                    return;\n                }\n\n                let inputValue = $(this).val().length;\n                let id = $(this).attr('id');\n                let parentClass = $(this).parent().attr('class');\n                if(parentClass == 'text-set'){\n                    id = id.slice(0,-4);\n                }\n                let tmp = lookups.find(e => e.id == id);\n                if(inputValue != tmp.digitsNum) return;\n\n                dialogLookups($(this),parentClass);\n            })\n            // 桁以外でフォーカスが外れたらクリア処理\n            $(document).on('blur',`#${key_fullId}`,function(){\n\n                let inputValue = $(this).val().length;\n                let parentClass = $(this).parent().attr('class');\n                let id = $(this).attr('id');\n                if(parentClass == 'text-set')id = id.slice(0,-4);\n                let tmp = lookups.find(e => e.id == id);\n                if(inputValue == tmp.digitsNum) return;\n                // クリア処理\n                $(this).val('');\n                let lookup = lookups.filter(e => e.id == id)[0];\n                let prm = lookup.toParam ? lookup.toParam : [];\n\n                prm.forEach(e => {\n                    $(`#${e.id}`).val('').trigger('blur');\n                });\n\n                // 前回出力情報削除\n                if('get_lastTime_output' in tmp){\n                    $(`#${tmp.get_lastTime_output.dialogId} .input-container span`).text('');\n                }\n            })\n        }\n    }\n}\n\n// 全角数字を半角数字に変換する関数\nconst convertFullWidthToHalfWidth = (str) => {\n    return str.replace(/[ー－]/g,'-').replace(/[０-９]/g, function(char) {\n        // '０' (全角) の文字コードは 65296、'0' (半角) の文字コードは 48\n        // 差分 (65296 - 48) を引いて半角に変換\n        return String.fromCharCode(char.charCodeAt(0) - 65248);\n    });\n}\n\n\n// ルックアップする\n// tableなど特殊なものは各ダイアログファイルに記載\nasync function dialogLookups(t,parentClass = ''){\n    try {\n        showLoading();\n\n        t.val(convertFullWidthToHalfWidth(t.val()));\n\n        let item_label = t.closest('.field-control').prev().children('label').text();\n\n        let keyId = t.attr('id');\n        if(parentClass == 'text-set') keyId = keyId.slice(0,-4);\n\n        let lookup = lookups.filter(e => e.id == keyId)[0];\n        let prm = lookup.toParam;\n        let columns = lookup.toParam.map(e => {\n            if('specialTerms' in e){\n                return e.specialTerms;\n            }else{\n                return e.columnName;\n            }\n        });\n\n        // SQLが必要かで処理を分ける\n        let tableData;\n        if(!/^[0-9]+$/.test(lookup.tableId)){\n\n            // 売上入力の場合は処理を分ける\n            if(\"salesInput_estimateNo\" == lookup.id){\n                where = `WHERE MH.見積番号 = ${$('#salesInput_estimateNo').val()}`;\n                let sql = salesInput_baseSQL(where);\n                tableData = await fetchSql(sql);\n                salesInput_lookup(tableData);\n                return;\n            }\n            else if('base_sql' in lookup){\n                const sql = lookup.base_sql + $('#'+ t.attr('id')).val();\n                tableData = await fetchSql(sql);\n                tableData = tableData.results;\n            }\n            else{\n                let sql = `SELECT ${columns} FROM ${lookup.tableId} WHERE ${lookup.keyColumnName} = ${$('#'+ t.attr('id')).val()}`;\n                tableData = await fetchSql(sql);\n                tableData = tableData.results;\n            }\n        }\n        else{\n            await $p.apiGet({\n                id: lookup.tableId,\n                data: {\n                    View: {\n                        'ApiDataType': \"KeyValues\",\n                        'ApiColumnKeyDisplayType':'ColumnName',\n                        'ApiColumnValueDisplayType':\"Value\",\n                        'GridColumns': columns,\n                        \"ColumnFilterHash\":{\n                            [lookup['keyColumnName']]:$(`#${t.attr('id')}`).val()\n                        },\n                        \"ColumnFilterSearchTypes\": {\n                            [lookup['keyColumnName']]: \"ExactMatch\"\n                        }\n                    },\n                },\n                done: function (data) {\n                    tableData = data.Response.Data;\n                }\n            });\n        }\n        if(tableData.length != 1) {\n            alert(`指定の${item_label}は存在しません`);\n            t.val('').trigger('blur');\n            t.focus();\n            return;\n        }\n\n        prm.forEach(e => {\n            let tmp = tableData[0][e.columnName];\n            let item = \"\";\n            if('func' in e){\n                tmp = e.func(tableData[0]);\n            }\n            if(e.type == \"datepicker\"){\n                $(`#${e.id}`).val(\n                    tableData[0][e.columnName] == \"\" ? \"\":\n                    new Date(tmp).toLocaleDateString('sv-SE')\n                ).trigger('input');\n            }else{\n                $(`#${e.id}`).val(tmp).trigger('input');\n            }\n        });\n\n        // 前回出力情報\n        if('get_lastTime_output' in lookup){\n            get_history(lookup.get_lastTime_output.name,$(`#${t.attr('id')}`).val(),lookup.get_lastTime_output.dialogId)\n        }\n\n    } catch(error) {\n        console.error('ルックアップエラー：', error);\n        alert('予期せぬエラーが発生しました。');\n    } finally {\n        hideLoading();\n    }\n}\n\n$(document).on('blur','textarea',function(){\n    $(this).hide();\n    $(this).prev().prev().text($(this).val());\n    $(this).prev().prev().show();\n})\n\n$(document).on('mousedown','button:has(.ui-icon-closethick)',function(){\n    const element = $(this).closest('div').next();\n    const id = element.attr('id');\n    if(element.hasClass('searchDialog'))return;\n    closeDialog(id,true);\n})\n\n// ダイアログを閉じる関数\nfunction closeDialog(dialogId,deleteFlg) {\n    $(`#${dialogId}`).dialog('close');\n    $(`#${dialogId} table.searchTable tbody`).html('');\n    searchOutputId.pop();\n\n    if(!deleteFlg)return;\n\n    \n    $(`#${dialogId}`).dialog(\"destroy\").remove();\n    $('#Application').append(htmls[dialogId]);\n\n}\n\n// ダイアログをモーダルにするための関数\nwindow.addEventListener(\"load\", async (event) => {\n    await sleep(1000);\n    $(document).off(\"click\", \".ui-widget-overlay\")\n\n    // ローディングオーバーレイ要素を作成\n    const loadingOverlay = document.createElement('div');\n    loadingOverlay.className = 'loading-overlay';\n    loadingOverlay.innerHTML = '<div class=\"loading-spinner\"></div>';\n    document.body.appendChild(loadingOverlay);\n\n\n});\n\n// 全件チェック\n$(document).on('change','.allCheck',function(){\n    const allCheckFlg = $(this).prop('checked');\n\n    let targetElements = $(this).closest('table').find('tbody').find('input[type=\"checkbox\"]');\n\n    targetElements.prop('checked',allCheckFlg);\n\n})\n\n// inputtableの複数選択画面で、tdデフラグを反転\n$(document).on('click','.inversion',function(){\n    let targetElement = $(this).find('input[type=\"checkbox\"]');\n    targetElement.prop('checked',!targetElement.prop('checked')).trigger('change');\n})\n$(document).on('click','.inversion > input',function(event){\n    event.stopPropagation();\n})\n\n// 検索ダイアログの横にある×ボタンが押されたときに実行\n// keyになるinput要素を削除\n// blurイベントを着火させてlookup対象項目も削除\nfunction textClear(id){\n    $(`#${id}`).val('').trigger('blur');\n}\n\n\n$(document).on('keydown','.ui-icon-search',function(e){\n    if(e.which == 13){\n        $(this).trigger('click');\n    }\n})\n$(document).on('keydown','.ui-icon-close',function(e){\n    if(e.which == 13){\n        $(this).trigger('click');\n    }\n})\n\n\n$(document).on('keydown', 'tr', function(e) {\n    let tbodyElement = $(this);\n    let idx = $(this).index();\n\n    // フォーカス移動\n    if (e.which == 38 && idx != 0) {\n        let prevElement = tbodyElement.prev();\n        prevElement.focus();\n        ensureElementVisible(prevElement);\n        e.preventDefault();\n    } else if (e.which == 40 && idx != (tbodyElement.siblings().length)) {\n        let nextElement = tbodyElement.next();\n        nextElement.focus();\n        ensureElementVisible(nextElement);\n        e.preventDefault();\n    }\n});\n\n// 表示領域内にフォーカスが収まっているか確認し、必要ならスクロール\nfunction ensureElementVisible(element) {\n    let elementTop = element.offset().top;\n    let elementBottom = elementTop + element.outerHeight();\n\n    let viewportTop = $(window).scrollTop();\n    let viewportBottom = viewportTop + $(window).height();\n\n    // 要素がビューの上に隠れている場合\n    if (elementTop < viewportTop) {\n        $('html, body').scrollTop(elementTop - 20); // 少し余裕をもたせてスクロール\n    }\n    // 要素がビューの下に隠れている場合\n    else if (elementBottom > viewportBottom) {\n        $('html, body').scrollTop(elementBottom - $(window).height() + 20); // 少し余裕をもたせてスクロール\n    }\n}\n\n//click出力先が変更された時の処理\n// 変更処理がないためコメントアウト\n// $(document).on('click','.input-button-container button',function(){\n//     // どちらのボタンが押されたかで処理を分ける\n//     if($(this).hasClass('changePath')){\n//         inputValue = $(this).prev().val();\n//         $(this).parent().next().children('span').text(inputValue);\n//         $(this).parent().css('display','none');\n//         $(this).parent().next().css('display','contents');\n//     }\n//     else{\n//         $(this).parent().css('display','none');\n//         $(this).parent().prev().css('display','contents');\n//     }\n// })\n\n// 数値入力用項目がフォーカスから外れたら3桁区切りにする\n$(document).on('blur','.input-Number',async function(){\n    await sleep(1);\n    let val = Number(convertFullWidthToHalfWidth($(this).val().replaceAll(',','').replace(/[ー－]/g,'-').replace(/[^-\\d０-９,]/g, '')));\n    if(/^-?[0-9]+$/.test(val)){\n        $(this).val(val.toLocaleString());\n    }\n})\n\n// 3桁区切り解除\n$(document).on('focus','.input-Number',async function(){\n    let val = Number($(this).val().replaceAll(',',''));\n    if(val == 0){\n        $(this).val('');\n    }\n    else if(/^-?[0-9]+$/.test(val)){\n        $(this).val(val);\n    }\n})\n\n$(document).on('input','.varidate_int',function(){\n    input_numberOnly($(this))\n})\n$(document).on('input','.varidate_zeroPadding',function(){\n    input_numberOnly($(this))\n})\n\n// マイナス符号、数字（半角・全角）のみ許可する\nfunction input_numberOnly(e){\n    if(now_IME)return;\n    const target_element = varidate_input_select(e);\n    const target_value = target_element.val();\n    \n    after_value = target_value.replace(/[^-ー－\\d０-９]/g, \"\");\n    target_element.val(after_value);\n}\n\n\n// バリデーション\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nnow_varidate_flg = false;\n\n// 固定長数字で0埋め（得意先CDなど）\n$(document).on('blur','.varidate_zeroPadding',function(){\n    varidate_zeroPadding($(this));\n})\nasync function varidate_zeroPadding(e){\n    if(now_varidate_flg)return;\n    now_varidate_flg = true;\n\n\n    // 検索ボタンのあるinput要素は処理終了（input_numberOnlyのみ動作させたいため。）\n    if(e.prop('tagName') == 'INPUT' && e.next().hasClass('ui-icon-search')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    const element = varidate_input_select(e);\n\n    const dialog_element = element.closest('.dialog');\n\n\n    await sleep(0);\n\n    // if(activeItem_check(e) || element.is(':focus') || !dialog_element.is(':visible')){\n    if(activeItem_check(e) || element.is(':focus') || dialog_element.is(':focus')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    const maxLength = element.prop('maxlength');\n    const required_flg = element.prop('required');\n\n    if(!required_flg && element.val() == ''){\n        now_varidate_flg = false;\n        return;\n    }\n    // 0-9 or ０-９の値以外が入力されていたらクリア処理とアラート\n    if((required_flg && element.val() == '') || /[^０-９\\d]/.test(element.val())){\n        element.focus();\n        element.val('');\n        alert(`${maxLength}桁の数字を入力してください`);\n\n        // alertで新しくイベント着火しちゃうから、新しく着火したイベントを先に進めて終了させる（now_varidate_flg）\n        await sleep(0);\n        now_varidate_flg = false;\n        return;\n    }\n\n    // 全角数字を半角数字に変換\n    let val = convertFullWidthToHalfWidth(element.val());\n    val = ('0000000' + val).slice(-(maxLength));\n    element.val(val);\n\n    now_varidate_flg = false;\n}\n\n$(document).on('blur','.varidate_int',function(){\n    varidate_number($(this));\n})\n// 半角数字のバリデーション（合計金額など）\nasync function varidate_number(e){\n\n    if(now_varidate_flg)return;\n    now_varidate_flg = true;\n    const element = varidate_input_select(e);\n    const dialog_element = element.closest('.dialog');\n\n    if(e.prop('tagName') == 'INPUT' && e.next().hasClass('ui-icon-search')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    await sleep(0);\n\n\n    // ブラウザからアクティブが外れた場合、検索ダイアログを開くときは処理終了\n    if(activeItem_check(e) || element.is(':focus') || dialog_element.is(':focus')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    const required_flg = element.prop('required');\n\n    //  0-9 or ０-９の値以外が入力されていたらクリア処理とアラート\n    // if((!required_flg)){\n    //     return;\n    // }\n    if(!/(^-?ー?－?[０-９\\d]+$|^$)/.test(element.val()) || (required_flg && element.val() == \"\")){\n    // if(!/^[\\d\\uFF10-\\uFF19]+(,\\d{3})*$/.test(element.val())){\n        element.focus();\n        element.val('');\n        alert(\"未入力項目があります。\");\n\n        // alertで新しくイベント着火しちゃうから、新しく着火したイベントを先に進めて終了させる（now_varidate_flg）\n        await sleep(0);\n        now_varidate_flg = false;\n        return;\n    }\n\n    // 全角数字を半角数字に変換\n    let val = convertFullWidthToHalfWidth(element.val());\n    element.val(val);\n    now_varidate_flg = false;\n\n}\n\n// 必須項目チェック\n$(document).on('blur','.varidate_str',function(){\n    varidate_fixedLength_str($(this));\n})\nasync function varidate_fixedLength_str(e){\n\n    if(now_varidate_flg)return;\n    now_varidate_flg = true;\n\n    const element = varidate_input_select(e);\n\n    const dialog_element = element.closest('.dialog');\n\n    if(e.prop('tagName') == 'INPUT' && e.next().hasClass('ui-icon-search')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    await sleep(0);\n\n    // フォーカスがinput or 検索ダイアログ or ブラウザ以外に移った時は処理終了\n    if(activeItem_check(e) || element.is(':focus') || dialog_element.is(':focus')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    const required_flg = element.prop('required');\n\n    // 必須チェック\n    if(element.val() == '' && required_flg){\n        alert('必須項目です。');\n        element.val('');\n        element.focus();\n        await sleep(0);\n        now_varidate_flg = false;\n        return;\n    }\n    now_varidate_flg = false;\n}\n\n// text-setのバリデーション\n$(document).on('input','.text-set input',async function(){\n    try{\n        if(now_IME)return;\n\n        // lookup項目は除外\n        if($(this).attr('id').slice(-2) == 'To')return;\n\n        let id = $(this).attr('id').slice(0,-4);\n        let tmp = lookups.filter(e => e.id == id);\n\n        if(tmp.length != 0)return;\n\n        let choices = $(this).next().val().split(' ').map(e => e.split(':')[0]);\n        choices.push(\"\");\n\n        if($(this).val().length > 1){\n            $(this).val($(this).val().slice(0,1));\n            return;\n        }\n\n        if(!choices.includes($(this).val())){\n            $(this).val('').focus();\n        }\n    }\n    catch(err){\n        return;\n    }\n})\n\n// input type=number はmaxlengthが働かないので指定桁以上を入力できないようにする\n$(document).on('input','.maxlength_for_number',function(){\n    let maxlength = $(this).attr('maxlength');\n    if(maxlength == \"\"){\n        return;\n    }\n    else{\n        maxlength = Number(maxlength);\n    }\n    let val = $(this).val();\n    if(val.length > maxlength){\n        $(this).val(val.slice(0,maxlength));\n    }\n\n})\n\n// divかinputかわからないため、input要素を返す\nfunction varidate_input_select(e){\n    if(e.parent().hasClass('text-set') && e.prop('tagName') == 'DIV'){\n        return e.prevAll().eq(1);\n    }\n    else if(e.prop('tagName') == 'DIV'){\n        return e.prev();\n    }else{\n        return e;\n    }\n}\n\n// ブラウザ自体からfocusが外れた、検索ダイアログを開いた場合、input,button要素以外がfocusになったらはtrueを返す\nfunction activeItem_check(e){\n    const after_focus_element = $(':focus');\n    const dialog_element = $(e).closest('.dialog');\n    const after_focus_dialog_element = after_focus_element.closest('.dialog');\n\n    if(after_focus_dialog_element.length == 0){\n        return true;\n    }\n    if(dialog_element.attr('id') != after_focus_dialog_element.attr('id')){\n        return true;\n    }\n\n    if(!isWindowActive || searchOutputId.length > 0 || !['INPUT'].includes(after_focus_element.prop('tagName'))){\n        return true;\n    }\n    return false;\n}\n\n// ブラウザのアクティブ状態を監視\nlet isWindowActive = true;\nwindow.addEventListener('blur', () => {\n    isWindowActive = false;\n});\n\nwindow.addEventListener('focus', () => {\n    isWindowActive = true;\n});\n\n// 指定したミリ秒待機する\nasync function sleep(s){\n    await new Promise((resolve,reject) => {\n        setTimeout(() => {\n            resolve();\n        }, s);\n    })\n}\n\n// ローディング制御関数\nfunction showLoading() {\n    //     document.querySelector('.loading-overlay').style.display = 'flex';\n    const element = document.querySelector('.loading-overlay');\n    if(element == null)return;\n    element.style.display = 'flex';\n}\n\nfunction hideLoading() {\n    //     document.querySelector('.loading-overlay').style.display = 'none';\n    const element = document.querySelector('.loading-overlay');\n    if(element == null)return;\n    element.style.display = 'none';\n}\n\n// 帳票をダウンロードする処理\nasync function download_report(param, fileName = \"\", accept=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\"){\n    try {\n        showLoading();\n        let res = await fetch(SERVICE_URL, {\n            method: \"POST\",\n            headers: {\n                \"content-type\": \"application/json\",\n                \"Accept\": accept,\n            },\n            body: JSON.stringify(param)\n        });\n\n        if (!res.ok) {\n            const errorData = await res.json();\n            console.error(errorData);\n            alert(errorData.message);\n            return;\n        }\n\n        // 成功メッセージをヘッダーから取得して表示\n        const messageCode = res.headers.get('Success-Message-Code');\n        if (messageCode) {\n            if (SUCCESS_MESSAGE_CODE[messageCode]) {\n                alert(SUCCESS_MESSAGE_CODE[messageCode]);\n            } else {\n                alert(`登録されていないメッセージコードです: ${messageCode}`);\n            }\n        }\n\n\n        // ファイルのダウンロードをするかどうか\n        const skip = res.headers.get('Download-Skip');\n        if (skip) {\n            console.log(\"ファイルのダウンロードをスキップします\")\n        } else {\n            // ダウンロードファイル名をクライアント側で上書きする場合\n            let downloadFileName = \"\"\n            if (fileName) {\n                downloadFileName = fileName;\n            // ダウンロードファイル名をサーバー側で指定する場合\n            } else {\n                let tmpText = res.headers.get('Content-Disposition').split('filename=')[1].replace(/\"/g, '')\n                downloadFileName = decodeString(tmpText)\n            }\n\n            const blob = await res.blob();\n            const url = window.URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = downloadFileName;\n            document.body.appendChild(a);\n            a.click();\n\n            // リンクを削除\n            document.body.removeChild(a);\n            window.URL.revokeObjectURL(url);\n            console.log(\"ファイルをダウンロードしました\")\n\n        }\n\n    } catch(error) {\n        console.error('予期せぬエラー：', error.message);\n        alert(`Error: 予期せぬエラーが発生しました。`);\n    } finally {\n        hideLoading();\n    }\n}\n\n/**\n * 指定された日付を特定のフォーマットで返す関数\n * @param {number} day          日付（1-31の数値、または99で月末日）\n * @param {string} type         出力形式（'month'で年月のみ、その他で年月日）\n * @returns {string}            YYYY-MM-DD または YYYY-MM 形式の日付文字列\n * @example\n * // 月の15日の完全な日付を取得\n * monthDateGein(15)    // => '2024-11-15'\n * // 月末日を取得\n * monthDateGein(99)    // => '2024-11-30'\n * // 年月のみを取得\n * monthDateGein(15, 'month')   // => '2024-11'\n */\nfunction monthDateGein(day,type){\n    let dt = new Date();\n    let resDate;\n    if(day == 99){\n        resDate = new Date(dt.getFullYear(),dt.getMonth()+1,0).toLocaleDateString('sv-SE');\n    }\n    else{\n        resDate = new Date(dt.getFullYear(),dt.getMonth(),day).toLocaleDateString('sv-SE');\n    }\n    resDate = type == 'month' ? resDate.slice(0,7) : resDate;\n    console.log(resDate);\n    return resDate;\n}\n\n/**\n * 文字列を変換する関数\n * @param {string} str          チェックしたい文字列\n * @param {string} replaceStr   変換したい文字列　規定値はnull\n */\nfunction SpcToNull(str,replaceStr = null){\n    if(str == ''){\n        return replaceStr;\n    }else{\n        return str.trim();\n    }\n}\n\n/**\n * 文字列を変換する関数\n * @param {string} encodedText   変換したい文字列\n */\nfunction decodeString(encodedText){\n    // Base64文字列をデコードしてUint8Arrayを取得\n    const binaryData = Uint8Array.from(atob(encodedText), c => c.charCodeAt(0));\n\n    // Uint8ArrayをUTF-8文字列にデコード\n    const decoder = new TextDecoder('utf-8');\n    return decoder.decode(binaryData);\n\n}\n\n// 日付をYYYY-MM-DD形式の文字列に変換するための関数\nfunction formatDate(date) {\n    date = new Date(date);\n    if(!date instanceof Date)return null;\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0'); // 月は0ベースのため+1\n    const day = String(date.getDate()).padStart(2, '0');\n    return `${year}-${month}-${day}`;\n}\n\n// 日付をYYYY年MM月DD日に変換する関数\nfunction formatDate_for_japanese(date){\n    date = new Date(date);\n    if(isNaN(date)){\n        throw new Error;\n    }\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    return `${year}年${month}月${day}日`;\n}\n\n// 時間をhh時mm分形式で返す\nfunction formatTime_for_japanese(date){\n    date = new Date(date);\n    if(!date instanceof Date){\n        return '';\n    }\n    return date.getHours() + \"時\" + date.getMinutes() + \"分\";\n}\n\n// dateオーバーフローさせない\nfunction not_date_overflow(old_date,new_date){\n    if(isNaN(new_date.getTime())){\n        return new_date;\n    }\n    else if(old_date.getMonth() == new_date.getMonth()){\n        return new_date;\n    }\n    else{\n        return new Date(new_date.setMonth(new_date.getMonth(),0));\n    }\n}\n\nfunction getFirstDateOfScope(wdate, wshime, defaultVal = \"\") {\n\n    wshime = Number(wshime);\n\n    // wdateが日付型かチェックし、日付型でなければ変換\n    const date = (wdate instanceof Date) ? wdate : new Date(wdate);\n\n    // 変換が失敗した場合、defaultValを返す\n    if (isNaN(date.getTime())) return defaultVal;\n\n    switch (wshime) {\n        case 0:\n            return formatDate(date);  // そのままの日付を返す\n        case 99:\n            return formatDate(new Date(date.getFullYear(), date.getMonth(), 1));  // 月初日を返す\n        default:\n            // 日付が締め日を超える場合とそれ以下の場合で分岐\n            let bufDate = new Date(`${date.getFullYear()}-${date.getMonth()+1}-${wshime}`);\n            if(isNaN(bufDate.getTime()) || new Date(date.getFullYear(),date.getMonth(),wshime).getMonth() != date.getMonth()){\n                return defaultVal;\n            }\n            if (date.getDate() > wshime) {\n                let after_date = new Date(bufDate.getFullYear(), bufDate.getMonth(), wshime + 1);\n                return formatDate(after_date);\n            }\n            else {\n                let tmp_date1 = new Date(bufDate);\n                let tmp_date2 = new Date(bufDate);\n\n                // 締日が月末だったら月初を返す\n                if(bufDate.getMonth() != new Date(tmp_date1.setDate(tmp_date1.getDate()+1)).getMonth()){\n                    return formatDate(new Date(bufDate.setDate(1)));\n                }\n                // 請求日付と締日から1か月前、1日を足した値が月をまたいでいないか\n                else if(bufDate.getMonth() == new Date(tmp_date2.getFullYear(),tmp_date2.getMonth()-1,tmp_date2.getDate()+1).getMonth()){\n                    return formatDate(new Date(bufDate.getFullYear(),bufDate.getMonth(),0));\n                }\n                else{\n                    return formatDate(new Date(bufDate.getFullYear(),bufDate.getMonth()-1,bufDate.getDate()+1));\n                }\n            }\n    }\n}\n\nfunction getLastDateOfScope(wdate, wshime, Default = '') {\n\n    wshime = Number(wshime);\n    let bufDate;\n\n    // wdateをDateオブジェクトとして変換\n    const date = new Date(wdate);\n    if (isNaN(date)) {\n        return Default;\n    }\n\n    switch (wshime) {\n        case 0:\n            // Case 0: そのまま日付を返す\n            return formatDate(date); // \"YYYY-MM-DD\" 形式\n\n        case 99:\n            // Case 99: 次月の初日から1日減らして末日を取得\n            const nextMonth = new Date(date.getFullYear(), date.getMonth() + 1, 1);\n            nextMonth.setDate(nextMonth.getDate() - 1);\n            return formatDate(nextMonth);\n        default:\n            // それ以外のケース\n            if(new Date(date.getFullYear(),date.getMonth(),wshime).getMonth() != date.getMonth()){\n                return Default;\n            }\n            if (date.getDate() > wshime) {\n                // 指定日の翌月にシメ日を設定\n                let tmp = new Date(`${date.getFullYear()}-${date.getMonth()+2}-1`);\n                bufDate = new Date(`${date.getFullYear()}-${date.getMonth()+2}-${wshime}`);\n                if (isNaN(bufDate.getTime())) {\n                    return Default;\n                }\n                else if(tmp.getMonth() != bufDate.getMonth()){\n                    return formatDate(new Date(bufDate.getFullYear(),bufDate.getMonth(),0));\n                }\n                else {\n                    return formatDate(bufDate);\n                }\n            } else {\n                // 指定日の月にシメ日を設定\n                let tmp = `${date.getFullYear()}-${date.getMonth()+1}-${wshime}`;\n                bufDate = new Date(tmp);\n                if (!isNaN(bufDate.getTime())) {\n                    return formatDate(bufDate);\n                } else {\n                    return Default;\n                }\n            }\n    }\n}\n\n\n// 日付の月間を計算する関数\nfunction DateDiff(date1, date2) {\n    const year1 = date1.getFullYear();\n    const month1 = date1.getMonth();  // 0-11の範囲\n    const year2 = date2.getFullYear();\n    const month2 = date2.getMonth();\n\n    // 年の差を12倍し、月の差を足し合わせる\n    const monthDifference = (year2 - year1) * 12 + (month2 - month1);\n    return monthDifference;\n}\n\nlet now_IME = false;\n// IME入力中か判断する関数（ルックアップで使用）\n$(document).on('compositionstart',function(){\n    now_IME = true;\n})\n$(document).on('compositionend',function(){\n    now_IME = false;\n    $(':focus').trigger('input');\n})\n\n\nclass cMitumoriH{\n    constructor(estimateNo){\n        this.estimateNo = estimateNo;\n        this.m_isDsp_estimate_category = 0; //見積区分\n        this.m_isDsp_inCompony_communication = 0; //社内伝\n    }\n    async isU_category(u_category){\n        let res_flg = false;\n        const sql = `\n            SELECT COUNT(U区分) AS 区分カウント\n            FROM TD見積シートM\n            WHERE 見積番号 = ${this.estimateNo}\n            AND U区分 = '${u_category}'\n            AND 見積数量 <> 0\n        `;\n        const res = await fetchSql(sql);\n        if(res.results.length == 0){\n            return false;\n        }\n        else{\n            if(res.results.区分カウント == 0){\n                return false;\n            }\n            else{\n                return true;\n            }\n        }\n    }\n    async GetById(){\n        const sql = `select * from TD見積 where 見積番号 = ${this.estimateNo}`;\n        const res = await fetchSql(sql);\n        if(res.results.length == 0){\n            return false;\n        }\n        res = res.results[0];\n        switch(this.m_isDsp_estimate_category){\n            case 0:\n                if(res.見積区分 == 1){\n                    alert('指定の見積番号は本見積ではありません。');\n                    return false;\n                }\n                break;\n            case 1:\n                if(res.見積区分 == 0){\n                    alert('指定の見積番号は仮見積もりではありません。');\n                    return false;\n                }\n        }\n        switch(this.m_isDsp_inCompony_communication){\n            case 1:\n                if(res.得意先CD == \"9999\"){\n                    alert('社内在庫分です。');\n                    return false;\n                }\n            case 2:\n                if(res.得意先CD == \"9999\"){\n                    alert('社内在庫意外です。');\n                    return false;\n                }\n        }\n\n        return true;\n    }\n}\n/*\n`m_isDsp_estimate_category\n仮見積 = 0\n本見積 = 1\n全て = 2\n`\n`m_isDsp_inCompony_communication\n全て = 0\n社内伝以外 = 1\n社内伝のみ = 2\n`*/\n\n\nclass clsDates{\n    constructor(dateID){\n        this.dateID = dateID;\n    }\n\n    async GetbyID(){\n        let dates = await fetchSql(`SELECT * FROM TMDates WHERE DateID = '${this.dateID}'`);\n        if(dates.results.length != 0){\n            this.updateDate = new Date(dates.results[0].更新日付);\n        }\n    }\n\n}\n\nfunction null_to_zero(value,defaultvalue = 0){\n    if(value == null || value == \"\"){\n        return defaultvalue;\n    }else{\n        return value;\n    }\n}\n\n\n",
            "Id": 14
          },
          {
            "Title": "62_製品検索マスタダイアログ.js",
            "New": true,
            "Edit": true,
            "Body": "// 製品検索ダイアログ作成\n{\n    const dialogId = 'productSearch1';\n    create_searchDialog(dialogId,'TM製品',[\n        {type:'text',id:'productNo',label:'製品No',forColumnName:'製品NO',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'methodNo',label:'仕様No',forColumnName:'仕様NO',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'KANJIName',label:'漢字名称',forColumnName:'漢字名称',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'mainSupplier',label:'主仕入先',forColumnName:'主仕入先CD',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'W',label:'W',forColumnName:'W',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'D',label:'D',forColumnName:'D',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H',label:'H',forColumnName:'H',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'D1',label:'D1',forColumnName:'D1',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'D2',label:'D2',forColumnName:'D2',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H1',label:'H1',forColumnName:'H1',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H2',label:'H2',forColumnName:'H2',options:{\n            width:'wide',\n        }},\n\n        { type: 'search-table', id: 'searchTable', label: '', options: {\n            newLine:false,\n            individualSql:true,\n            t_heads:[\n                {label:\"製品No\",type:'',ColumnName:'製品NO'},\n                {label:\"仕様No\",type:'',ColumnName:'仕様NO'},\n                {label:\"漢字名称\",type:'',ColumnName:'漢字名称'},\n                {label:\"主仕入先\",type:'',ColumnName:'主仕入先CD'},\n                {label:\"W\",type:'',ColumnName:'W'},\n                {label:\"D\",type:'',ColumnName:'D'},\n                {label:\"H\",type:'',ColumnName:'H'},\n                {label:\"D1\",type:'',ColumnName:'D1'},\n                {label:\"D2\",type:'',ColumnName:'D2'},\n                {label:\"H1\",type:'',ColumnName:'H1'},\n                {label:\"H2\",type:'',ColumnName:'H2'},\n                {label:\"仕入先名\",type:'',ColumnName:'仕入先名1'},\n            ]\n        }},\n    ],\n    [\n        { type: 'button_inline', id: 'create', label: 'OK', options: {\n            onclick:`resultInput('${dialogId}')`,\n            icon:'disk'\n        }},\n    ],\n    '1300px')\n}\n\nconst productSearch1_baseSQL = (e) => {\n    return `\n        SELECT TOP 1000 SE.製品NO,SE.仕様NO,SE.漢字名称,SE.主仕入先CD,SE.W,SE.D,SE.H,SE.D1,SE.D2,SE.H1,SE.H2,SI.仕入先名1\n        FROM TM製品 AS SE\n        INNER JOIN\n            TM仕入先 AS SI\n        ON\n            SE.主仕入先CD = SI.仕入先CD\n        ${e} and 廃盤FLG = 0\n        ORDER BY\n        SE.製品NO ASC , SE.仕様NO ASC\n    `\n}\n\n\n// 製品検索ダイアログ作成\n{\n    const dialogId = 'productSearch2';\n    create_searchDialog(dialogId,'TM製品',[\n        {type:'text',id:'productNo',label:'製品No',forColumnName:'製品NO',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'methodNo',label:'仕様No',forColumnName:'仕様NO',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'KANJIName',label:'漢字名称',forColumnName:'漢字名称',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'mainSupplier',label:'主仕入先',forColumnName:'主仕入先CD',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'W',label:'W',forColumnName:'W',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'D',label:'D',forColumnName:'D',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H',label:'H',forColumnName:'H',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'D1',label:'D1',forColumnName:'D1',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'D2',label:'D2',forColumnName:'D2',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H1',label:'H1',forColumnName:'H1',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H2',label:'H2',forColumnName:'H2',options:{\n            width:'wide',\n        }},\n\n        { type: 'search-table', id: 'searchTable', label: '', options: {\n            newLine:false,\n            individualSql:true,\n            t_heads:[\n                {label:\"\",ColumnName:'タイトル',hidden:true},\n                {label:\"製品No\",type:'',ColumnName:'製品NO'},\n                {label:\"仕様No\",type:'',ColumnName:'仕様NO'},\n                {label:\"漢字名称\",type:'',ColumnName:'漢字名称'},\n                {label:\"主仕入先\",type:'',ColumnName:'主仕入先CD'},\n                {label:\"W\",type:'',ColumnName:'W'},\n                {label:\"D\",type:'',ColumnName:'D'},\n                {label:\"H\",type:'',ColumnName:'H'},\n                {label:\"D1\",type:'',ColumnName:'D1'},\n                {label:\"D2\",type:'',ColumnName:'D2'},\n                {label:\"H1\",type:'',ColumnName:'H1'},\n                {label:\"H2\",type:'',ColumnName:'H2'},\n                {label:\"仕入先名\",type:'',ColumnName:'仕入先名1'},\n            ]\n        }},\n    ],\n    [\n        { type: 'button_inline', id: 'create', label: 'OK', options: {\n            onclick:`resultInput('${dialogId}')`,\n            icon:'disk'\n        }},\n    ],\n    '1300px')\n}\n\nconst productSearch2_baseSQL = (e) => {\n    return `\n        SELECT TOP 1000 \n            SE.製品NO + '___' + SE.仕様NO AS タイトル, \n            SE.製品NO,SE.仕様NO,SE.漢字名称,SE.主仕入先CD,SE.W,SE.D,SE.H,SE.D1,SE.D2,SE.H1,SE.H2,SI.仕入先名1\n        FROM TM製品 AS SE\n        INNER JOIN\n            TM仕入先 AS SI\n        ON\n            SE.主仕入先CD = SI.仕入先CD\n        ${e} and 廃盤FLG = 0\n        ORDER BY\n        SE.製品NO ASC , SE.仕様NO ASC\n    `\n}\n",
            "Id": 15
          },
          {
            "Title": "売上仕入単価マスタ.js",
            "New": true,
            "Edit": true,
            "Body": "const styleElement2 = document.createElement('style');\nstyleElement2.textContent = `\n    .field-normal{\n        width:340px ;\n        max-width:340px ;\n        height:45px ;\n        padding:0 20px 10px 0 ;\n    }\n    .field-wide{\n        width:100%;\n        min-height:45px;\n        float:left;\n        padding:0 10px 10px 0;\n        clear both;\n            max-width:100%\n    }\n    .sdt_disabled input,\n    .sdt_disabled select,\n    .sdt_disabled textarea{\n        background:#f5f5f5;\n    }\n    #productSearch{\n        display:block;\n        position:static;\n        margin-left:320px;\n        margin-top:6px;\n        overflow:visible;\n    }\n    #productDelete{\n        position:sticky;\n        margin-left:335px;\n        overflow:visible;\n        margin-top:-50px;\n    }\n`;\ndocument.head.appendChild(styleElement2);\n\nlookups.push({\n    id:\"Results_ClassJ\",\n    searchDialog:{id:\"productSearch2\",title:'製品No検索',multiple:false}\n})\n\n$(document).on('input','#Results_ClassJ',async function(){\n    try{\n        const productNo = $('#Results_ClassJ');\n        const siyouNo = $('#Results_ClassG');\n        if(productNo.val() == \"\"){\n            return;\n        }\n        const arr = productNo.val().split('___');\n        $p.set($p.getControl('ClassJ'),arr[0]);\n        $p.set($p.getControl('ClassG'),arr[1]);\n        const data = await commonGetData(MASTER_TABLES[\"製品マスタ\"],['ClassC','NumA','NumB','NumC','NumD','NumE','NumF','NumG'],{ClassA:productNo.val().replaceAll(' ',''),ClassB:siyouNo.val().replaceAll(' ','')},{},{ClassA:'ExactMatch',ClassB:'ExactMatch'},false,false);\n\n        if(data.length ==0 ){\n            alert('指定の製品Noは存在しません。');\n            return;\n        }\n\n        \n        $p.set($p.getControl('ClassH'),data[0].ClassC);\n        $p.set($p.getControl('NumI'),null_to_zero(data[0].NumA,0));\n        $p.set($p.getControl('NumJ'),null_to_zero(data[0].NumD,0));\n        $p.set($p.getControl('NumK'),null_to_zero(data[0].NumG,0));\n        $p.set($p.getControl('NumL'),null_to_zero(data[0].NumB,0));\n        $p.set($p.getControl('NumE'),null_to_zero(data[0].NumE,0));\n        $p.set($p.getControl('NumF'),null_to_zero(data[0].NumC,0));\n        $p.set($p.getControl('NumG'),null_to_zero(data[0].NumF,0));\n\n\n    }catch(e){\n        alert('予期せぬエラーが発生しました。');\n        console.error(e);\n        return;\n    }\n})\nfunction initialize(){\n    $p.set($p.getControl('ClassJ'),\"\");\n    $p.set($p.getControl('ClassG'),\"\");\n    $p.set($p.getControl('ClassH'),\"\");\n    $p.set($p.getControl('NumI'),\"\");\n    $p.set($p.getControl('NumJ'),\"\");\n    $p.set($p.getControl('NumK'),\"\");\n    $p.set($p.getControl('NumL'),\"\");\n    $p.set($p.getControl('NumE'),\"\");\n    $p.set($p.getControl('NumF'),\"\");\n    $p.set($p.getControl('NumG'),\"\");\n}\n\n// $p.events.on_editor_load = function () {\n//     setDisabled('disabled');\n\n//     $('.dialogSearch').off('click');\n\n//     if($('#productSearch2Dialog').length == 0){\n//         $('#Application').append(productSearch_html);\n//     }\n\n//     $('#productSearch').on('click',function(){\n//         openDialog_for_searchDialog('productSearch2','Results_ClassJ','1300px','製品検索ダイアログ');\n//     })\n// }\nonEditorLoadFuncs.push(\n    function () {\n        setDisabled('disabled');\n    \n        $('.dialogSearch').off('click');\n    \n        if($('#productSearch2Dialog').length == 0){\n            $('#Application').append(productSearch_html);\n        }\n    \n        $('#productSearch').on('click',function(){\n            openDialog_for_searchDialog('productSearch2','Results_ClassJ','1300px','製品検索ダイアログ');\n        })\n      }\n)\n\n\nconst productSearch_html = `\n\n<div id=\"productSearch2Dialog\" class=\"searchDialog ui-dialog-content ui-widget-content\" style=\"display:none; margin-top: 10px; width: auto; min-height: 89.25px; max-height: 90vh; height: auto;\">\n        <div style=\"display: inline-block;width: 33%;vertical-align: top;\">\n            <div id=\"productSearch2_productNoField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_productNo\" class=\"\">製品No</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_productNo\" name=\"productSearch2_productNo\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_productNo-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_methodNoField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_methodNo\" class=\"\">仕様No</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_methodNo\" name=\"productSearch2_methodNo\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_methodNo-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_KANJINameField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_KANJIName\" class=\"\">漢字名称</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_KANJIName\" name=\"productSearch2_KANJIName\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_KANJIName-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_mainSupplierField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_mainSupplier\" class=\"\">主仕入先</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_mainSupplier\" name=\"productSearch2_mainSupplier\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_mainSupplier-error\"></div>\n            </div>\n        </div><div style=\"display: inline-block;width: 33%;vertical-align: top;\">\n            <div id=\"productSearch2_WField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_W\" class=\"\">W</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_W\" name=\"productSearch2_W\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_W-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_DField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_D\" class=\"\">D</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_D\" name=\"productSearch2_D\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_D-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_HField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_H\" class=\"\">H</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_H\" name=\"productSearch2_H\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_H-error\"></div>\n            </div>\n        </div><div style=\"display: inline-block;width: 33%;vertical-align: top;\">\n            <div id=\"productSearch2_D1Field\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_D1\" class=\"\">D1</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_D1\" name=\"productSearch2_D1\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_D1-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_D2Field\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_D2\" class=\"\">D2</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_D2\" name=\"productSearch2_D2\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_D2-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_H1Field\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_H1\" class=\"\">H1</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_H1\" name=\"productSearch2_H1\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_H1-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_H2Field\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_H2\" class=\"\">H2</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_H2\" name=\"productSearch2_H2\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_H2-error\"></div>\n            </div>\n        \n            \n        </div><div style=\"display: block;\">\n            <div style=\"width:80%; display: flex;justify-content: end;\">\n                <button id=\"productSearch2_searchTable_searchButton\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" data-icon=\"ui-icon-search\" type=\"button\" style=\"z-index: 9999;\" onclick=\"create_searchList($(this));\">\n                    <span class=\"ui-button-icon ui-icon ui-icon-search search\" style=\"position: static;\"></span>\n                    <span class=\"ui-button-icon-space\"> </span>検索\n                </button>\n            </div>\n            <div id=\"productSearch2_searchTable_readTable\" class=\"ui-dialog-content ui-widget-content\" style=\"display: inline-block; margin-top:20px; width: 98%;margin-left:1%;\">\n                <div class=\"field-vertical \" style=\"width: 100%;\">\n                    <div class=\"field-control\">\n                        <div class=\"container-selectable\">\n                            <div class=\"wrapper h300\">\n                                <table class=\"table searchTable\">\n                                    <thead style=\"position: sticky; top:0; background-color: gold; z-index:9999\">\n                                        <tr>\n                                            <th style=\"text-align: center;border-collapse: collapse; display:none;\"></th><th style=\"text-align: center;border-collapse: collapse; \">製品No</th><th style=\"text-align: center;border-collapse: collapse; \">仕様No</th><th style=\"text-align: center;border-collapse: collapse; \">漢字名称</th><th style=\"text-align: center;border-collapse: collapse; \">主仕入先</th><th style=\"text-align: center;border-collapse: collapse; \">W</th><th style=\"text-align: center;border-collapse: collapse; \">D</th><th style=\"text-align: center;border-collapse: collapse; \">H</th><th style=\"text-align: center;border-collapse: collapse; \">D1</th><th style=\"text-align: center;border-collapse: collapse; \">D2</th><th style=\"text-align: center;border-collapse: collapse; \">H1</th><th style=\"text-align: center;border-collapse: collapse; \">H2</th><th style=\"text-align: center;border-collapse: collapse; \">仕入先名</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"command-center\">\n            \n            <button id=\"productSearch2_close\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" type=\"button\" onclick=\"closeDialog('productSearch2Dialog',false);\" style=\"position:relative;\">\n                <span class=\"ui-button-icon ui-icon ui-icon-cancel\"></span>\n                <span class=\"ui-button-icon-space\"> </span>終了\n            </button>\n        </div>\n    </div>\n`\n",
            "Id": 16
          },
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n    if($p.action() != 'edit'){\n        return;\n    }\n\n    $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_ClassE').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_ClassC').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_ClassJ').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_ClassG').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_ClassJField .ui-icon').css('display','none');\n})",
            "Id": 17
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 18
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 19
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n//得意先CD、仕入先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\ntry {\n    let n_results2 = items.Get(model['ClassC'])\n    newData['ClassC'] = n_results2[0]['ClassA']\n} catch(e) {\n    newData['ClassC'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n//得意先CD、仕入先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\ntry {\n    let n_results2 = items.Get(model['ClassC'])\n    newData['ClassC'] = n_results2[0]['ClassA']\n} catch(e) {\n    newData['ClassC'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n}\n\n//得意先CD、仕入先CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassA'])\n    oldData['ClassA'] = o_results1[0]['ClassA']\n} catch(e) {\n    oldData['ClassA'] = '';\n}\ntry {\n    let o_results2 = items.Get(results[0]['ClassC'])\n    oldData['ClassC'] = o_results2[0]['ClassA']\n} catch(e) {\n    oldData['ClassC'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n//得意先CD、仕入先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\ntry {\n    let n_results2 = items.Get(model['ClassC'])\n    newData['ClassC'] = n_results2[0]['ClassA']\n} catch(e) {\n    newData['ClassC'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n}\n\n//得意先CD、仕入先CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassA'])\n    oldData['ClassA'] = o_results1[0]['ClassA']\n} catch(e) {\n    oldData['ClassA'] = '';\n}\ntry {\n    let o_results2 = items.Get(results[0]['ClassC'])\n    oldData['ClassC'] = o_results2[0]['ClassA']\n} catch(e) {\n    oldData['ClassC'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841986,
      "Title": "売掛金額マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841986,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB",
          "DateC",
          "NumA",
          "NumB",
          "NumC",
          "NumD",
          "NumE",
          "NumF",
          "NumG",
          "NumH",
          "DateA",
          "DateB",
          "NumI"
        ],
        "FilterColumns": [
          "ClassA",
          "ClassB",
          "DateC",
          "DateA",
          "DateB"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "ClassB",
            "DateC",
            "_Section-1",
            "NumA",
            "NumB",
            "NumC",
            "NumD",
            "NumE",
            "NumF",
            "NumG",
            "NumH",
            "NumJ",
            "DateA",
            "DateB",
            "NumI",
            "_Links-1841987",
            "Title",
            "Class100"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "得意先CD",
            "ChoicesText": "[\n    {\n        \"SiteId\": 1841987,\n        \"SearchFormat\": \"[ClassA] __ [ClassB] __ [ClassC]\",\n        \"Value\": \"[ClassA]\",\n        \"NoAddButton\" : true,\n        \"Lookups\": [\n              {\n                \"From\": \"ClassB\",\n                \"To\": \"ClassB\"\n              },\n         ]\n    }\n]",
            "UseSearch": true,
            "ValidateRequired": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassB",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "得意先名",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "NumA",
            "LabelText": "前月残高",
            "Format": "C",
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumB",
            "LabelText": "入金金額",
            "Format": "C",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumC",
            "LabelText": "調整金額",
            "Format": "C",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumD",
            "LabelText": "売上金額",
            "Format": "C",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumE",
            "LabelText": "返品金額",
            "Format": "C",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumF",
            "LabelText": "訂正金額",
            "Format": "C",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumG",
            "LabelText": "消費税額",
            "Format": "C",
            "NoWrap": true,
            "ExtendedHtmlAfterControl": "<div style=\"padding-left: 100%; margin-top : 10px; white-space:nowrap;\">\n(売掛調整金額含む)\n</div>",
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumH",
            "LabelText": "当月残高",
            "Format": "C",
            "NoWrap": true,
            "ExtendedFieldCss": "sdt_disabled",
            "Min": 0.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumI",
            "LabelText": "伝票枚数",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "DateA",
            "LabelText": "売掛開始日付",
            "NoWrap": true,
            "ValidateRequired": true,
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "DateB",
            "LabelText": "売掛終了日付",
            "ValidateRequired": true,
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "NumJ",
            "LabelText": "非課税金額",
            "Format": "C",
            "NoWrap": true,
            "ExtendedHtmlAfterControl": "<div style=\"padding-left: 100%; margin-top : 10px; white-space:nowrap;\">\n(金額に含まれる)\n</div>",
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "Class100",
            "LabelText": "主キー項目",
            "ImportKey": true,
            "Hide": true,
            "NoDuplication": true
          },
          {
            "ColumnName": "Title",
            "Hide": true,
            "ValidateRequired": false
          },
          {
            "ColumnName": "DateC",
            "LabelText": "売掛日付",
            "NoWrap": true,
            "ValidateRequired": true,
            "DateFilterSetMode": 2
          }
        ],
        "Links": [
          {
            "ColumnName": "ClassA",
            "SiteId": 1841987,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB] __ [ClassC]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassB"
              }
            ],
            "JsonFormat": true
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc",
              "ClassB": "asc",
              "DateC": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "Class100",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          }
        ],
        "Scripts": [
          {
            "Title": "主キー設定",
            "New": true,
            "Edit": true,
            "Body": "$(document).on('change', '#Results_ClassA, #Results_ClassD', function () {\n    var A = $('#Results_ClassA').val();\n    var B = $('#Results_DateC').val();\n\n   $p.set($('#Results_Class100'), A + '__' + B);\n})",
            "Id": 1
          },
          {
            "Title": "当月残高計算",
            "New": true,
            "Edit": true,
            "Body": "let Zan  //当月残高\n\n$p.on('change', 'NumA', function () { //前月残高\n    A = $p.getControl('NumA').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumA'), EN(B)); \n    NUM();\n})\n\n\n$p.on('change', 'NumB', function () { //前月残高\n    A = $p.getControl('NumB').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumB'), EN(B));\n    NUM();\n})\n\n\n$p.on('change', 'NumC', function () { //前月残高\n    A = $p.getControl('NumC').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumC'), EN(B));\n    NUM();\n})\n\n$p.on('change', 'NumD', function () { //前月残高\n    A = $p.getControl('NumD').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumD'), EN(B));\n    NUM();\n})\n\n\n$p.on('change', 'NumE', function () { //前月残高\n    A = $p.getControl('NumE').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumE'), EN(B));\n    NUM();\n})\n\n\n$p.on('change', 'NumE', function () { //前月残高\n    A = $p.getControl('NumE').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumE'), EN(B));\n    NUM();\n})\n\n$p.on('change', 'NumF', function () { //前月残高\n    A = $p.getControl('NumF').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumF'), EN(B));\n    NUM();\n})\n\n$p.on('change', 'NumG', function () { //前月残高\n    A = $p.getControl('NumG').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumG'), EN(B));\n    NUM();\n})\n//取得した合計金額を数値に変換して計算する関数\nfunction NUM() {\n    A = $p.getControl('NumA').val();\n    B = $p.getControl('NumB').val();\n    C = $p.getControl('NumC').val();\n    D = $p.getControl('NumD').val();\n    E = $p.getControl('NumE').val();\n    F = $p.getControl('NumF').val();\n    G = $p.getControl('NumG').val();\n\n    A1 = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n    B1 = parseInt(String(B).replace(/[^0-9]/g, ''), 10);\n    C1 = parseInt(String(C).replace(/[^0-9]/g, ''), 10);\n    D1 = parseInt(String(D).replace(/[^0-9]/g, ''), 10);\n    E1 = parseInt(String(E).replace(/[^0-9]/g, ''), 10);\n    F1 = parseInt(String(F).replace(/[^0-9]/g, ''), 10);\n    G1 = parseInt(String(G).replace(/[^0-9]/g, ''), 10);\n\n    let H\n\n    //当月残高=前月残高-入金金額-調整金額+売上金額+返品金額+訂正金額+消費税額\n    H = A1 - B1 - C1 + D1 + E1 + F1 + G1;\n    $p.set($p.getControl('NumH'), EN(H)); //(A)小計\n}\n\n//\\マークと３桁区切りのカンマを追加する関数\nfunction EN(x) {\n    x = '\\xA5' + Math.round(x).toLocaleString();\n    return x;\n}",
            "Id": 2
          },
          {
            "Title": "sdt_disabled",
            "New": true,
            "Edit": true,
            "Body": "// =================================================\n// フィールドCSSに'sdt_disabled'クラスが設定されているフィールドを\n// disabledにします。\n// $p.set()は稼働しますが、手動での操作を制限します。\n// -------------------------------------------------\n// 引数：disabledにするかreadonlyにするか\n// =================================================\n\nfunction setDisabled(type){\n    //該当の入力エリアをdisabled / readonlyにする\n    $('.sdt_disabled input').prop(type, true); // 一般的なinput要素\n    $('.sdt_disabled input[type=\"number\"]').prop(type, true); // 数値用のinput要素\n    $('.sdt_disabled textarea').prop(type, true); // textarea要素\n    $('.sdt_disabled select').prop(type, true); // select要素\n  \n    // selectはreadonlyが効かないのでoptionをdisabledにする\n    // $('.sdt_disabled option').prop('disabled', true);\n    // $('.sdt_disabled option:selected').prop('disabled', false);\n  \n    //コントロールアイコンを削除する\n    $('.sdt_disabled div.field-control div.ui-icon').remove();\n  }\n  \n  \n  onEditorLoadFuncs.push(\n    function () {\n      setDisabled('disabled');\n    }\n  )",
            "Id": 3
          },
          {
            "Title": "日付変更",
            "New": true,
            "Edit": true,
            "Body": "$p.on('change', 'DateC', function () { //売掛日付\n    AA()\n})\n\n//日付を1日に変更する関数\nfunction AA(){\n\n    let Date=$p.getControl(\"DateC\").val()\n    let parts = Date.split(\"/\");\n    parts[2] = \"01\";\n    let newDate = parts.join(\"/\");\n    $p.set($p.getControl('DateC'), newDate)\n\n}",
            "Id": 4
          },
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n    if($p.action() != 'edit'){\n        return;\n    }\n\n    $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_DateC').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_DateCField .ui-icon').css('display','none');\n})",
            "Id": 5
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 6
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 7
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//得意先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//得意先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n//得意先CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassA'])\n    oldData['ClassA'] = o_results1[0]['ClassA']\n} catch(e) {\n    oldData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//得意先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n//得意先CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassA'])\n    oldData['ClassA'] = o_results1[0]['ClassA']\n} catch(e) {\n    oldData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841987,
      "Title": "得意先マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841987,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB",
          "ClassC",
          "ClassD",
          "ClassE",
          "ClassF",
          "ClassG",
          "ClassH",
          "ClassI",
          "ClassJ",
          "ClassK",
          "ClassL",
          "DateA",
          "ClassM",
          "ClassN",
          "ClassQ",
          "ClassR",
          "ClassS",
          "ClassT",
          "ClassU",
          "ClassV",
          "ClassW",
          "ClassX",
          "ClassY",
          "ClassZ",
          "NumA",
          "Class010",
          "NumB",
          "Class001",
          "Class002",
          "Class003",
          "Class004",
          "Class005",
          "Class006",
          "Class007",
          "Class008",
          "Class009"
        ],
        "FilterColumns": [
          "ClassA",
          "ClassB",
          "ClassC"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "_Section-4",
            "ClassB",
            "ClassC",
            "ClassD",
            "ClassE",
            "ClassF",
            "ClassG",
            "ClassH",
            "ClassI",
            "ClassJ",
            "ClassK",
            "ClassL",
            "DateA",
            "ClassM",
            "ClassN",
            "ClassQ",
            "ClassR",
            "_Section-2",
            "ClassS",
            "ClassV",
            "ClassY",
            "ClassZ",
            "Class010",
            "Class001",
            "Class002",
            "Class003",
            "ClassT",
            "ClassU",
            "ClassW",
            "ClassX",
            "NumA",
            "NumB",
            "_Section-3",
            "Class004",
            "Class005",
            "Class006",
            "Class007",
            "Class008",
            "Class009",
            "Title"
          ]
        },
        "SectionLatestId": 4,
        "Sections": [
          {
            "Id": 4,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 2,
            "LabelText": "請求先情報",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 3,
            "LabelText": "区分情報",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "得意先CD",
            "ImportKey": true,
            "ValidateRequired": true,
            "MaxLength": 4.0,
            "ClientRegexValidation": "^[a-zA-Z0-9]*$",
            "RegexValidationMessage": "英数字のみ入力可能です。",
            "NoDuplication": true
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "得意先名1",
            "NoWrap": true,
            "ValidateRequired": true,
            "MaxLength": 28.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "得意先名2",
            "NoWrap": true,
            "MaxLength": 28.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "略称",
            "NoWrap": true,
            "ValidateRequired": true,
            "MaxLength": 8.0
          },
          {
            "ColumnName": "ClassE",
            "LabelText": "フリガナ",
            "NoWrap": true,
            "ValidateRequired": true,
            "MaxLength": 5.0,
            "ClientRegexValidation": "^[a-zA-Z0-9ｦ-ﾟ]*$",
            "RegexValidationMessage": "英数字半角カナのみ入力可能です。"
          },
          {
            "ColumnName": "ClassF",
            "LabelText": "郵便番号",
            "NoWrap": true,
            "MaxLength": 8.0,
            "ClientRegexValidation": "^\\d{3}-\\d{4}$",
            "RegexValidationMessage": "999-9999形式で入力して下さい。"
          },
          {
            "ColumnName": "ClassG",
            "LabelText": "住所1",
            "NoWrap": true,
            "MaxLength": 32.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassH",
            "LabelText": "住所2",
            "NoWrap": true,
            "MaxLength": 32.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassI",
            "LabelText": "電話番号",
            "NoWrap": true,
            "MaxLength": 15.0,
            "ClientRegexValidation": "^[0-9\\-]+$",
            "RegexValidationMessage": "半角数字またはハイフンのみ入力可能です。"
          },
          {
            "ColumnName": "ClassJ",
            "LabelText": "FAX番号",
            "MaxLength": 15.0,
            "ClientRegexValidation": "^[0-9\\-]+$",
            "RegexValidationMessage": "半角数字またはハイフンのみ入力可能です。"
          },
          {
            "ColumnName": "ClassK",
            "LabelText": "得意先担当者名",
            "NoWrap": true,
            "MaxLength": 40.0
          },
          {
            "ColumnName": "ClassL",
            "LabelText": "メモ",
            "NoWrap": true,
            "MaxLength": 40.0
          },
          {
            "ColumnName": "ClassM",
            "LabelText": "集計CD",
            "ChoicesText": "[\n    {\n        \"SiteId\": 1841987,\n        \"SearchFormat\": \"[ClassA] __ [ClassB] __ [ClassC]\",\n        \"Value\": \"[ClassA]\",\n        \"NoAddButton\": true,\n        \"Lookups\": [\n              {\n                \"From\": \"ClassB\",\n                \"To\": \"ClassN\"\n              },\n         ]\n    }\n]",
            "UseSearch": true,
            "NoWrap": true,
            "ValidateRequired": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassN",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassN",
            "LabelText": "集計",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassQ",
            "LabelText": "担当者CD",
            "ChoicesText": "[\n    {\n        \"SiteId\": 3064531,\n        \"SearchFormat\": \"[ClassA] __ [ClassB]\",\n        \"Value\": \"[ClassA]\",\n        \"NoAddButton\": true,\n        \"Lookups\": [\n            {\n                \"From\": \"ClassB\",\n                \"To\": \"ClassR\",\n                \"Type\": 0\n            },\n         ]\n    }\n]",
            "UseSearch": true,
            "NoWrap": true,
            "ValidateRequired": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassR",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassR",
            "LabelText": "担当者名",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassS",
            "LabelText": "締日",
            "NoWrap": true,
            "MaxLength": 2.0,
            "ClientRegexValidation": "^[0-9]*$",
            "RegexValidationMessage": "数値のみ入力可能です。",
            "ExtendedHtmlAfterControl": "<div style=\"padding-left: 100%; margin-top : 10px; white-space:nowrap;\">\n(月末=99　都度請求＝00)\n</div>"
          },
          {
            "ColumnName": "ClassT",
            "LabelText": "回収方法CD",
            "ChoicesText": "0\n1\n2\n3",
            "DefaultInput": "0",
            "ValidateRequired": true,
            "MaxLength": 1.0,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassU",
            "LabelText": "回収方法",
            "DefaultInput": "0:振込　1:集金　2:郵送　3:その他",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassV",
            "LabelText": "決算月",
            "NoWrap": true,
            "MaxLength": 2.0,
            "ClientRegexValidation": "^(1[0-2]|[0-9])$",
            "RegexValidationMessage": "数値が不正です。"
          },
          {
            "ColumnName": "ClassW",
            "LabelText": "請求様式CD",
            "ChoicesText": "0\n1\n2\n3\n4",
            "DefaultInput": "0",
            "ValidateRequired": true,
            "MaxLength": 1.0,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassX",
            "LabelText": "請求様式",
            "DefaultInput": "0:当社請求書　1:検収請求書　2:EDP手書　3:手書明細式　4:手書一覧式",
            "ExtendedControlCss": "width400",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassY",
            "LabelText": "入金サイクルCD",
            "NoWrap": true,
            "MaxLength": 2.0,
            "ClientRegexValidation": "^[0-9]*$",
            "RegexValidationMessage": "数値のみ入力可能です。"
          },
          {
            "ColumnName": "ClassZ",
            "LabelText": "入金サイクル",
            "DefaultInput": "0:当月",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "NumA",
            "LabelText": "導入請求金額",
            "Format": "C",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumB",
            "LabelText": "導入売掛金額",
            "Format": "C",
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "DateA",
            "LabelText": "最終使用日",
            "NoWrap": true
          },
          {
            "ColumnName": "Class001",
            "LabelText": "入金区分CD",
            "ChoicesText": "[\n    {\n        \"SiteId\": 2190740,\n        \"SearchFormat\": \"[ClassA] __ [ClassB] __ [ClassC]\",\n        \"Value\": \"[ClassA]\",\n        \"NoAddButton\" : true,\n        \"Lookups\": [\n              {\n                \"From\": \"ClassB\",\n                \"To\": \"Class002\"\n              },\n              {\n                \"From\": \"ClassC\",\n                \"To\": \"Class003\"\n              },\n         ]\n    }\n]",
            "UseSearch": true,
            "NoWrap": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "Class002,Class003",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "Class010",
            "LabelText": "入金予定日",
            "MaxLength": 2.0,
            "ClientRegexValidation": "^(0{2}|99|[1-9]|[12][0-9]|3[01])$",
            "RegexValidationMessage": "数値が不正です。",
            "ExtendedHtmlAfterControl": "<div style=\"padding-left: 100%; margin-top : 10px; white-space:nowrap;\">\n(月末=99　都度請求＝00)\n</div>"
          },
          {
            "ColumnName": "Class002",
            "LabelText": "入金区分１",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "Class003",
            "LabelText": "入金区分２",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "Class004",
            "LabelText": "税集計区分CD",
            "ChoicesText": "0\n1\n3",
            "DefaultInput": "0",
            "ValidateRequired": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "Class005",
            "LabelText": "税集計区分",
            "DefaultInput": "0:伝票単位　1:請求単位　3:税対象外",
            "ExtendedControlCss": "width250",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "Class006",
            "LabelText": "売上端数CD",
            "ChoicesText": "0\n1\n2",
            "DefaultInput": "0",
            "NoWrap": true,
            "ValidateRequired": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "Class007",
            "LabelText": "売上端数",
            "DefaultInput": "0:四捨五入　1:切り上げ　2:切り捨て",
            "ExtendedControlCss": "width250",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "Class008",
            "LabelText": "消費税端数CD",
            "ChoicesText": "0\n1\n2",
            "DefaultInput": "0",
            "NoWrap": true,
            "ValidateRequired": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "Class009",
            "LabelText": "消費税端数",
            "DefaultInput": "0:四捨五入　1:切り上げ　2:切り捨て",
            "ExtendedControlCss": "width250",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "Title",
            "Hide": true,
            "NoDuplication": true
          },
          {
            "ColumnName": "Owner",
            "DefaultInput": ""
          }
        ],
        "Links": [
          {
            "ColumnName": "Class001",
            "SiteId": 2190740,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB] __ [ClassC]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "Class002"
              },
              {
                "From": "ClassC",
                "To": "Class003"
              }
            ],
            "JsonFormat": true
          },
          {
            "ColumnName": "ClassM",
            "SiteId": 1841987,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB] __ [ClassC]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassN"
              }
            ],
            "JsonFormat": true
          },
          {
            "ColumnName": "ClassQ",
            "SiteId": 3064531,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassR"
              }
            ],
            "JsonFormat": true
          }
        ],
        "Processes": [
          {
            "Id": 1,
            "Name": "作成",
            "ScreenType": 10,
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassB',byte:28},         {item:'ClassC',byte:28},         {item:'ClassD',byte:8},         {item:'ClassG',byte:32},          {item:'ClassH',byte:32},          {item:'ClassK',byte:40},          {item:'ClassL',byte:40},  ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          },
          {
            "Id": 2,
            "Name": "更新",
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassB',byte:28},         {item:'ClassC',byte:28},         {item:'ClassD',byte:8},         {item:'ClassG',byte:32},          {item:'ClassH',byte:32},          {item:'ClassK',byte:40},          {item:'ClassL',byte:40},  ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "CalendarTimePeriod": "Monthly",
            "CalendarFromTo": "DateA",
            "CrosstabGroupByX": "ClassM",
            "CrosstabGroupByY": "ClassM",
            "CrosstabAggregateType": "Total",
            "CrosstabValue": "NumA",
            "CrosstabTimePeriod": "Monthly",
            "KambanAggregateType": "Count",
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "ClassA",
        "Styles": [
          {
            "Title": "width",
            "New": true,
            "Edit": true,
            "Body": ".width400{\n    width:400px;\n}\n.width250{\n    width:250px;\n}",
            "Id": 1
          },
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 2
          },
          {
            "Title": "作成・更新ボタン非表示",
            "New": true,
            "Edit": true,
            "Body": "#CreateCommand{\n    display:none !important\n}\n#UpdateCommand{\n    display:none !important\n}",
            "Id": 3
          }
        ],
        "Scripts": [
          {
            "Title": "カナ変換テスト",
            "New": true,
            "Edit": true,
            "Body": "(function ($) {\n    $.fn.autoKana = function (element1, element2, passedOptions) {\n\n        var options = $.extend(\n            {\n                'katakana': false\n            }, passedOptions);\n\n        var kana_extraction_pattern = new RegExp('[^ 　ぁあ-んーa-zA-Zｱ-ﾝ0-9]', 'g');\n        var kana_compacting_pattern = new RegExp('[ぁぃぅぇぉっゃゅょ]', 'g');\n        var elName,\n            elKana,\n            active = false,\n            timer = null,\n            flagConvert = true,\n            input,\n            values,\n            ignoreString,\n            baseKana;\n\n        elName = $(element1);\n        elKana = $(element2);\n        active = true;\n        _stateClear();\n\n        elName.blur(_eventBlur);\n        elName.focus(_eventFocus);\n        elName.keydown(_eventKeyDown);\n\n        function _checkConvert(new_values) {\n            if (!flagConvert) {\n                if (Math.abs(values.length - new_values.length) > 1) {\n                    var tmp_values = new_values.join('').replace(kana_compacting_pattern, '').split('');\n                    if (Math.abs(values.length - tmp_values.length) > 1) {\n                        _stateConvert();\n                    }\n                } else {\n                    if (values.length == input.length && values.join('') != input) {\n                        if (input.match(kana_extraction_pattern)) {\n                            _stateConvert();\n                        }\n                    }\n                }\n            }\n        }\n\n        function _checkValue() {\n            var new_input, new_values;\n            new_input = elName.val()    //姓の値\n            // 姓とセイが空だったら\n            if (new_input == '' && elKana.val() != '') {\n                _stateClear();\n                _setKana();\n            // 違ったら\n            } else {\n                new_input = _removeString(new_input);\n                if (input == new_input) {\n                    return;\n                } else {\n                    input = new_input;\n                    if (!flagConvert) {\n                        new_values = new_input.replace(kana_extraction_pattern, '').split('');\n                        _checkConvert(new_values);\n                        _setKana(new_values);\n                    }\n                }\n            }\n        };\n\n        function _clearInterval() {\n            clearInterval(timer);\n        };\n\n        function _eventBlur(event) {\n            _clearInterval();\n        };\n        function _eventFocus(event) {\n            _stateInput();\n            _setInterval();\n        };\n        function _eventKeyDown(event) {\n            if (flagConvert) {\n                _stateInput();\n            }\n        };\n        function _isHiragana(chara) {\n            return ((chara >= 12353 && chara <= 12435) || chara == 12445 || chara == 12446);\n        };\n        // new_inputは姓の値\n        function _removeString(new_input) {\n            if (new_input.indexOf(ignoreString) !== -1) {\n                return new_input.replace(ignoreString, '');\n            } else {\n                var i, ignoreArray, inputArray;\n                ignoreArray = ignoreString.split('');\n                inputArray = new_input.split('');\n                for (i = 0; i < ignoreArray.length; i++) {\n                    if (ignoreArray[i] == inputArray[i]) {\n                        inputArray[i] = '';\n                    }\n                }\n                return inputArray.join('');\n            }\n        }\n        function _setInterval() {\n            var self = this;\n            timer = setInterval(_checkValue, 10);\n        };\n        function _setKana(new_values) {\n            if (!flagConvert) {\n                if (new_values) {\n                    values = new_values;\n                }\n                if (active) {\n                    var _val = _toKatakana(baseKana + values.join(''));\n\n                    elKana.val(_val).change();\n                }\n            }\n        };\n        function _stateClear() {\n            baseKana = '';\n            flagConvert = false;\n            ignoreString = '';\n            input = '';\n            values = [];\n        };\n        function _stateInput() {\n            baseKana = elKana.val();\n            flagConvert = false;\n            ignoreString = elName.val();\n        };\n        function _stateConvert() {\n            baseKana = baseKana + values.join('');\n            flagConvert = true;\n            values = [];\n        };\n        function _toKatakana(src) {\n            const fullWidthToHalfWidth = {\n                'ァ': 'ｧ', 'ィ': 'ｨ', 'ゥ': 'ｩ', 'ェ': 'ｪ', 'ォ': 'ｫ',\n                'ャ': 'ｬ', 'ュ': 'ｭ', 'ョ': 'ｮ', 'ッ': 'ｯ',\n                'ア': 'ｱ', 'イ': 'ｲ', 'ウ': 'ｳ', 'エ': 'ｴ', 'オ': 'ｵ',\n                'カ': 'ｶ', 'キ': 'ｷ', 'ク': 'ｸ', 'ケ': 'ｹ', 'コ': 'ｺ',\n                'サ': 'ｻ', 'シ': 'ｼ', 'ス': 'ｽ', 'セ': 'ｾ', 'ソ': 'ｿ',\n                'タ': 'ﾀ', 'チ': 'ﾁ', 'ツ': 'ﾂ', 'テ': 'ﾃ', 'ト': 'ﾄ',\n                'ナ': 'ﾅ', 'ニ': 'ﾆ', 'ヌ': 'ﾇ', 'ネ': 'ﾈ', 'ノ': 'ﾉ',\n                'ハ': 'ﾊ', 'ヒ': 'ﾋ', 'フ': 'ﾌ', 'ヘ': 'ﾍ', 'ホ': 'ﾎ',\n                'マ': 'ﾏ', 'ミ': 'ﾐ', 'ム': 'ﾑ', 'メ': 'ﾒ', 'モ': 'ﾓ',\n                'ヤ': 'ﾔ', 'ユ': 'ﾕ', 'ヨ': 'ﾖ',\n                'ラ': 'ﾗ', 'リ': 'ﾘ', 'ル': 'ﾙ', 'レ': 'ﾚ', 'ロ': 'ﾛ',\n                'ワ': 'ﾜ', 'ヲ': 'ｦ', 'ン': 'ﾝ',\n                'ガ': 'ｶﾞ', 'ギ': 'ｷﾞ', 'グ': 'ｸﾞ', 'ゲ': 'ｹﾞ', 'ゴ': 'ｺﾞ',\n                'ザ': 'ｻﾞ', 'ジ': 'ｼﾞ', 'ズ': 'ｽﾞ', 'ゼ': 'ｾﾞ', 'ゾ': 'ｿﾞ',\n                'ダ': 'ﾀﾞ', 'ヂ': 'ﾁﾞ', 'ヅ': 'ﾂﾞ', 'デ': 'ﾃﾞ', 'ド': 'ﾄﾞ',\n                'バ': 'ﾊﾞ', 'ビ': 'ﾋﾞ', 'ブ': 'ﾌﾞ', 'ベ': 'ﾍﾞ', 'ボ': 'ﾎﾞ',\n                'パ': 'ﾊﾟ', 'ピ': 'ﾋﾟ', 'プ': 'ﾌﾟ', 'ペ': 'ﾍﾟ', 'ポ': 'ﾎﾟ'\n            };\n            if (options.katakana) {\n                var c, i, str;\n                str = new String;\n                for (i = 0; i < src.length; i++) {\n                    c = src.charCodeAt(i);\n                    if (_isHiragana(c)) {\n                        str += String.fromCharCode(c + 96);\n                    } else {\n                        str += src.charAt(i);\n                    }\n                }\n                return str.replace(/[\\u30A1-\\u30F6]/g, match => fullWidthToHalfWidth[match] || match);\n            } else {\n                return src;\n            }\n        }\n    };\n})(jQuery);\n$.fn.autoKana('#Results_ClassB', '#Results_ClassE', {katakana:true});",
            "Id": 1
          },
          {
            "Title": "略称",
            "New": true,
            "Edit": true,
            "Body": "$('#Results_ClassB').on('input',function(){\n\n    $('#Results_ClassD').val($('#Results_ClassB').val().slice(0,4));\n\n})",
            "Id": 2
          },
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝閲覧権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        replaceBulkDeleteButton()\n        loadPermittion(masterTableFlag)\n    } else {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n\n\n/**\n * オリジナル一括削除ボタンを作成する関数です。\n */\nfunction replaceBulkDeleteButton() {\n    // テーブルの一覧画面以外は何もしない\n    if(!(($p.tableName() == \"Result\" || $p.tableName() == \"Issue\") && $p.action() == \"index\")) {\n        return\n    }\n    // 既にボタンがあったら何もしない\n    let bulkDelId = \"BulkDeleteCommand\"\n    let originBulkDelId = \"OriginBulkDeleteCommand\"\n    if (document.getElementById(originBulkDelId)) {\n        return\n    }\n    document.getElementById(bulkDelId)?.remove()\n\n    addButtonToMainCommands(originBulkDelId, \"一括削除\", async () => {\n        if ($p.selectedIds().length === 0) {\n            alert(\"削除するデータを選択してください\")\n            return\n        }\n        if (!confirm(\"選択されたデータを削除しますか？\")) {\n            return\n        }\n\n        $p.selectedIds().forEach(id => console.log($p.apiDelete({id})))\n\n        alert(\"選択データの一括削除が完了しました。\");\n        // 表示が変わるため画面をリロード\n        location.reload();\n\n\n    }, \"ui-icon-trash\")\n}\n\n\n\n/**\n * メインコマンドエリアにボタンを追加する関数です。\n * @param {String} buttonId     ボタンID\n * @param {String} buttonLabel  ラベル\n * @param {Function} clickFunc  click時関数\n * @param {String} icon         アイコン（empty指定でアイコンなし）\n * @throws {Error}              処理中に発生したエラー\n */\nfunction addButtonToMainCommands(buttonId, buttonLabel, clickFunc, icon = \"ui-icon-disk\") {\n    if (!document.getElementById(\"MainCommands\")) {\n        return\n    }\n    const target = document.getElementById(\"MainCommands\");\n    const elem = document.createElement('button');\n    elem.id = buttonId;\n    elem.className = 'button button-icon ui-button ui-corner-all ui-widget applied customized';\n    elem.onclick = clickFunc;\n    elem.innerText = buttonLabel;\n    if (icon !== \"empty\") {\n        const span = document.createElement('span');\n        span.className = `ui-button-icon ui-icon ${icon}`;\n        elem.appendChild(span);\n    }\n    const space = document.createElement('span');\n    space.className = \"ui-button-icon-space\";\n    elem.appendChild(space);\n\n    target.appendChild(elem);\n}\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n  if($p.action() != 'edit'){\n      return;\n  }\n\n  $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n\n})",
            "Id": 3
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 4
          },
          {
            "Title": "一括削除ボタン追加",
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 5
          },
          {
            "Title": "バイト数チェック",
            "New": true,
            "Edit": true,
            "Body": "/**\n * sjisで使えない文字列を返す\n * @param {string} text エンコード文字列\n * @returns {Array} 文字化けした文字列配列\n */\nfunction detectUnsupportedChars(text) {\n    const utf16Array = Encoding.stringToCode(text); // 文字列をコードポイントの配列に変換\n    const sjisArray = Encoding.convert(utf16Array, 'SJIS', 'UNICODE'); // Shift JIS に変換\n    const restoredArray = Encoding.convert(sjisArray, 'UNICODE', 'SJIS'); // 再び UTF-16 に戻す\n    const restoredText = Encoding.codeToString(restoredArray); // 文字列に変換\n    \n    console.log(text);\n    console.log(restoredText);\n\n    text = Array.from(text);\n\n    let unsupportedChars = [];\n    for (let i = 0; i < text.length; i++) {\n        if (text[i] !== restoredText[i]) {\n            unsupportedChars.push(text[i]); // 変換後に変化した文字をリストアップ\n        }\n    }\n    \n    return unsupportedChars;\n}\n\n/**\n * 全角文字かチェックします。\n * @param str チェック対象の文字列\n * @returns 全角文字の場合 true\n */\nfunction isFullWidth(str) {\n    return /^[^\\x01-\\x7E\\uFF65-\\uFF9F]+$/.test(str);\n}\n\n/**\n * 入力文字のバリデーション\n * @param {string} label 対象項目名\n * @param {string} text 対象文字列\n * @param {number} byte バイト数\n */\nfunction byte_check(label,text,byte){\n    const unsuported_string = detectUnsupportedChars(text);\n    if(unsuported_string.length > 0){\n        alert(`下記文字列は使用できません。\\n${unsuported_string.toString()}`);\n        return false;\n    }\n\n    const byte_count = Array.from(text).reduce((a,b) => a += isFullWidth(b) ? 2 : 1,0);\n    if(byte_count > byte){\n        alert(`${label}の文字数が多すぎます。`);\n        return false;\n    }\n    return true;\n}\n\n// マスタ用\n/*[\n    {item:'ClassA',byte:15},\n    {item:'ClassB',byte:15},\n    {item:'ClassC',byte:15},\n]*/\nfunction maste_byte_check(e,option){\n    for(item of option){\n        const label = $p.getControl(item[\"item\"]).parent().parent().prev().text();\n        const text = $p.getControl(item[\"item\"]).val();\n        if(!byte_check(label,text,item[\"byte\"])){\n            return;\n        }\n    }\n    // 登録処理\n    const commandId = $p.action() == \"new\" ? \"CreateCommand\" : \"UpdateCommand\";\n    $(`#${commandId}`).click();\n}\n\n",
            "Id": 6
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          },
          {
            "Title": "encodingjs読み込み",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js\"></script>",
            "Id": 3
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//集計CD、担当者CD、入金区分CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassM']);\n    newData['ClassM'] = n_results1[0]['ClassA'];\n} catch(e) {\n    newData['ClassM'] = '';\n}\ntry {\n    let n_results2 = items.Get(model['ClassQ']);\n    newData['ClassQ'] = n_results2[0]['ClassA'];\n} catch(e) {\n    newData['ClassQ'] = '';\n}\ntry {\n    let n_results3 = items.Get(model['Class001']);\n    newData['Class001'] = n_results3[0]['ClassA'];\n} catch(e) {\n    newData['Class001'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\ncontext.Log('処理開始');\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//集計CD、担当者CD、入金区分CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassM']);\n    newData['ClassM'] = n_results1[0]['ClassA'];\n} catch(e) {\n    newData['ClassM'] = '';\n}\ntry {\n    let n_results2 = items.Get(model['ClassQ']);\n    newData['ClassQ'] = n_results2[0]['ClassA'];\n} catch(e) {\n    newData['ClassQ'] = '';\n}\ntry {\n    let n_results3 = items.Get(model['Class001']);\n    newData['Class001'] = n_results3[0]['ClassA'];\n} catch(e) {\n    newData['Class001'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n//集計CD、担当者CD、入金区分CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassM']);\n    oldData['ClassM'] = o_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassM'] = '';\n}\ntry {\n    let o_results2 = items.Get(results[0]['ClassQ'])\n    oldData['ClassQ'] = o_results2[0]['ClassA'];\n} catch(e) {\n    newData['ClassQ'] = '';\n}\ntry {\n    let o_results3 = items.Get(results[0]['Class001'])\n    oldData['Class001'] = o_results3[0]['ClassA']\n} catch(e) {\n    newData['Class001'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n//集計CD、担当者CD、入金区分CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassM']);\n    newData['ClassM'] = n_results1[0]['ClassA'];\n} catch(e) {\n    newData['ClassM'] = '';\n}\ntry {\n    let n_results2 = items.Get(model['ClassQ']);\n    newData['ClassQ'] = n_results2[0]['ClassA'];\n} catch(e) {\n    newData['ClassQ'] = '';\n}\ntry {\n    let n_results3 = items.Get(model['Class001']);\n    newData['Class001'] = n_results3[0]['ClassA'];\n} catch(e) {\n    newData['Class001'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n//集計CD、担当者CD、入金区分CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassM']);\n    oldData['ClassM'] = o_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassM'] = '';\n}\ntry {\n    let o_results2 = items.Get(results[0]['ClassQ'])\n    oldData['ClassQ'] = o_results2[0]['ClassA'];\n} catch(e) {\n    newData['ClassQ'] = '';\n}\ntry {\n    let o_results3 = items.Get(results[0]['Class001'])\n    oldData['Class001'] = o_results3[0]['ClassA']\n} catch(e) {\n    newData['Class001'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841988,
      "Title": "支払金額マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841988,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB",
          "DateA",
          "NumA",
          "NumB",
          "NumC",
          "NumD",
          "NumE",
          "NumF",
          "NumG",
          "NumH",
          "DateB",
          "DateC",
          "NumI"
        ],
        "FilterColumns": [
          "ClassA",
          "ClassB",
          "DateA",
          "DateB",
          "DateC"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "ClassB",
            "DateA",
            "_Section-1",
            "NumA",
            "NumB",
            "NumC",
            "NumD",
            "NumE",
            "NumF",
            "NumG",
            "NumH",
            "DateB",
            "DateC",
            "NumI",
            "_Links-1841977",
            "Title",
            "Class100"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "仕入先CD",
            "ChoicesText": "[\n    {\n        \"SiteId\": 1841977,\n        \"SearchFormat\": \"[ClassA] __ [ClassB] __ [ClassC]\",\n        \"Value\": \"[ClassA]\",\n        \"NoAddButton\" : true,\n        \"Lookups\": [\n              {\n                \"From\": \"ClassB\",\n                \"To\": \"ClassB\"\n              },\n         ]\n    }\n]",
            "UseSearch": true,
            "ValidateRequired": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassB",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "仕入先名",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "NumA",
            "LabelText": "前月残高",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumB",
            "LabelText": "支払金額",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumC",
            "LabelText": "調整金額",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumD",
            "LabelText": "仕入金額",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumE",
            "LabelText": "返品金額",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumF",
            "LabelText": "訂正金額",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumG",
            "LabelText": "消費税額",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumH",
            "LabelText": "当月残高",
            "NoWrap": true,
            "ExtendedFieldCss": "sdt_disabled",
            "Min": 0.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumI",
            "LabelText": "伝票枚数",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "DateA",
            "LabelText": "支払日付",
            "NoWrap": true,
            "ValidateRequired": true,
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "DateB",
            "LabelText": "支払開始日付",
            "ValidateRequired": true,
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "DateC",
            "LabelText": "支払終了日付",
            "ValidateRequired": true,
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "Title",
            "Hide": true,
            "ValidateRequired": false,
            "NoDuplication": true
          },
          {
            "ColumnName": "Class100",
            "LabelText": "主キー項目",
            "ImportKey": true,
            "Hide": true,
            "NoDuplication": true
          }
        ],
        "Links": [
          {
            "ColumnName": "ClassA",
            "SiteId": 1841977,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB] __ [ClassC]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassB"
              }
            ],
            "JsonFormat": true
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc",
              "ClassB": "asc",
              "DateA": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "Class100",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          }
        ],
        "Scripts": [
          {
            "Title": "主キー設定",
            "New": true,
            "Edit": true,
            "Body": "$(document).on('change', '#Results_ClassA, #Results_DateA', function () {\n    var A = $('#Results_ClassA').val();\n    var B = $('#Results_DateA').val();\n\n   $p.set($('#Results_Class100'), A + '__' + B);\n})",
            "Id": 1
          },
          {
            "Title": "当月残高計算",
            "New": true,
            "Edit": true,
            "Body": "let Zan  //当月残高\n\n$p.on('change', 'NumA', function () { //前月残高\n    A = $p.getControl('NumA').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumA'), EN(B)); \n    NUM();\n})\n\n\n$p.on('change', 'NumB', function () { //前月残高\n    A = $p.getControl('NumB').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumB'), EN(B));\n    NUM();\n})\n\n\n$p.on('change', 'NumC', function () { //前月残高\n    A = $p.getControl('NumC').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumC'), EN(B));\n    NUM();\n})\n\n$p.on('change', 'NumD', function () { //前月残高\n    A = $p.getControl('NumD').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumD'), EN(B));\n    NUM();\n})\n\n\n$p.on('change', 'NumE', function () { //前月残高\n    A = $p.getControl('NumE').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumE'), EN(B));\n    NUM();\n})\n\n\n$p.on('change', 'NumE', function () { //前月残高\n    A = $p.getControl('NumE').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumE'), EN(B));\n    NUM();\n})\n\n$p.on('change', 'NumF', function () { //前月残高\n    A = $p.getControl('NumF').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumF'), EN(B));\n    NUM();\n})\n\n$p.on('change', 'NumG', function () { //前月残高\n    A = $p.getControl('NumG').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumG'), EN(B));\n    NUM();\n})\n//取得した合計金額を数値に変換して計算する関数\nfunction NUM() {\n    A = $p.getControl('NumA').val();\n    B = $p.getControl('NumB').val();\n    C = $p.getControl('NumC').val();\n    D = $p.getControl('NumD').val();\n    E = $p.getControl('NumE').val();\n    F = $p.getControl('NumF').val();\n    G = $p.getControl('NumG').val();\n\n    A1 = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n    B1 = parseInt(String(B).replace(/[^0-9]/g, ''), 10);\n    C1 = parseInt(String(C).replace(/[^0-9]/g, ''), 10);\n    D1 = parseInt(String(D).replace(/[^0-9]/g, ''), 10);\n    E1 = parseInt(String(E).replace(/[^0-9]/g, ''), 10);\n    F1 = parseInt(String(F).replace(/[^0-9]/g, ''), 10);\n    G1 = parseInt(String(G).replace(/[^0-9]/g, ''), 10);\n\n    let H\n\n    //当月残高=前月残高-入金金額-調整金額+売上金額+返品金額+訂正金額+消費税額\n    H = A1 - B1 - C1 + D1 + E1 + F1 + G1;\n    $p.set($p.getControl('NumH'), EN(H)); //(A)小計\n}\n\n//\\マークと３桁区切りのカンマを追加する関数\nfunction EN(x) {\n    x = '\\xA5' + Math.round(x).toLocaleString();\n    return x;\n}",
            "Id": 2
          },
          {
            "Title": "sdt_disabled",
            "New": true,
            "Edit": true,
            "Body": "// =================================================\n// フィールドCSSに'sdt_disabled'クラスが設定されているフィールドを\n// disabledにします。\n// $p.set()は稼働しますが、手動での操作を制限します。\n// -------------------------------------------------\n// 引数：disabledにするかreadonlyにするか\n// =================================================\n\nfunction setDisabled(type){\n    //該当の入力エリアをdisabled / readonlyにする\n    $('.sdt_disabled input').prop(type, true); // 一般的なinput要素\n    $('.sdt_disabled input[type=\"number\"]').prop(type, true); // 数値用のinput要素\n    $('.sdt_disabled textarea').prop(type, true); // textarea要素\n    $('.sdt_disabled select').prop(type, true); // select要素\n  \n    // selectはreadonlyが効かないのでoptionをdisabledにする\n    // $('.sdt_disabled option').prop('disabled', true);\n    // $('.sdt_disabled option:selected').prop('disabled', false);\n  \n    //コントロールアイコンを削除する\n    $('.sdt_disabled div.field-control div.ui-icon').remove();\n  }\n  \n  \n  onEditorLoadFuncs.push(\n    function () {\n      setDisabled('disabled');\n    }\n  )",
            "Id": 3
          },
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n    if($p.action() != 'edit'){\n        return;\n    }\n\n    $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_DateA').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_DateAField .ui-icon').css('display','none');\n})\n",
            "Id": 4
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 5
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 6
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//仕入先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//仕入先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n//仕入先CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassA'])\n    oldData['ClassA'] = o_results1[0]['ClassA']\n} catch(e) {\n    oldData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//仕入先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n//仕入先CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassA'])\n    oldData['ClassA'] = o_results1[0]['ClassA']\n} catch(e) {\n    oldData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841989,
      "Title": "棚番マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841989,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassF",
          "ClassG",
          "ClassB",
          "ClassC",
          "NumA",
          "NumB",
          "NumC",
          "NumD",
          "NumE",
          "NumF",
          "NumG"
        ],
        "FilterColumns": [
          "ClassF",
          "ClassG",
          "ClassB",
          "ClassC",
          "NumA",
          "NumB",
          "NumC",
          "NumD",
          "NumE",
          "NumF",
          "NumG"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassF",
            "_Section-1",
            "ClassG",
            "ClassB",
            "ClassC",
            "NumA",
            "NumB",
            "NumC",
            "NumD",
            "NumE",
            "NumF",
            "NumG",
            "Title"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassF"
        ],
        "LinkColumns": [
          "ClassG",
          "ClassB",
          "ClassE",
          "ClassF"
        ],
        "Columns": [
          {
            "ColumnName": "ClassB",
            "LabelText": "仕様No",
            "NoWrap": true,
            "ExtendedFieldCss": "sdt_disabled",
            "MaxLength": 7.0
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "漢字名称",
            "ExtendedFieldCss": "sdt_disabled"
          },
          {
            "ColumnName": "ClassF",
            "LabelText": "棚番名",
            "DefaultInput": "AA-00-00-00-00",
            "ImportKey": true,
            "ValidateRequired": true,
            "MaxLength": 40.0,
            "ClientRegexValidation": "^[A-Z]{2}-\\d{2}-\\d{2}-\\d{2}-\\d{2}$",
            "RegexValidationMessage": "書式が固定されています。"
          },
          {
            "ColumnName": "Title",
            "Hide": true
          },
          {
            "ColumnName": "NumA",
            "LabelText": "W",
            "NoWrap": true,
            "ExtendedFieldCss": "sdt_disabled",
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "NumB",
            "LabelText": "D",
            "NoWrap": true,
            "ExtendedFieldCss": "sdt_disabled",
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "NumC",
            "LabelText": "H",
            "NoWrap": true,
            "ExtendedFieldCss": "sdt_disabled",
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "NumD",
            "LabelText": "D1",
            "ExtendedFieldCss": "sdt_disabled",
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "NumE",
            "LabelText": "D2",
            "ExtendedFieldCss": "sdt_disabled",
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "NumF",
            "LabelText": "H1",
            "ExtendedFieldCss": "sdt_disabled",
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "NumG",
            "LabelText": "H2",
            "ExtendedFieldCss": "sdt_disabled",
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "ClassG",
            "LabelText": "製品No",
            "ExtendedFieldCss": "sdt_disabled",
            "ValidateRequired": true,
            "ExtendedHtmlAfterControl": "<div class=\"ui-icon ui-icon-search \" id=\"productSearch\" tabindex=\"0\"></div>\n<div class=\"ui-icon ui-icon-close textClear\" id=\"productDelete\" onclick=\"initialize()\" tabindex=\"0\"></div>"
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassF": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "CalendarTimePeriod": "Monthly",
            "CalendarFromTo": "DateA",
            "CrosstabGroupByX": "CreatedTime",
            "CrosstabGroupByY": "Columns",
            "CrosstabAggregateType": "Total",
            "CrosstabValue": "NumA",
            "CrosstabTimePeriod": "Monthly",
            "KambanAggregateType": "Count",
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "ClassF",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          }
        ],
        "Scripts": [
          {
            "Title": "sdt_disabled",
            "New": true,
            "Edit": true,
            "Body": "// =================================================\n// フィールドCSSに'sdt_disabled'クラスが設定されているフィールドを\n// disabledにします。\n// $p.set()は稼働しますが、手動での操作を制限します。\n// -------------------------------------------------\n// 引数：disabledにするかreadonlyにするか\n// =================================================\n\nfunction setDisabled(type){\n  //該当の入力エリアをdisabled / readonlyにする\n  $('.sdt_disabled input').prop(type, true); // 一般的なinput要素\n  $('.sdt_disabled input[type=\"number\"]').prop(type, true); // 数値用のinput要素\n  $('.sdt_disabled textarea').prop(type, true); // textarea要素\n  $('.sdt_disabled select').prop(type, true); // select要素\n\n  // selectはreadonlyが効かないのでoptionをdisabledにする\n  // $('.sdt_disabled option').prop('disabled', true);\n  // $('.sdt_disabled option:selected').prop('disabled', false);\n\n  //コントロールアイコンを削除する\n  $('.sdt_disabled div.field-control div.ui-icon').remove();\n}\n\n// $p.events.on_editor_load = function () {\n//   setDisabled('disabled');\n// }\n\nonEditorLoadFuncs.push(\n  function () {\n    setDisabled('disabled');\n  }\n)",
            "Id": 3
          },
          {
            "Title": "00_共通.js",
            "New": true,
            "Edit": true,
            "Body": "// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝コード値系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\nconst SUCCESS_MESSAGE_CODE = {\n    // 成功メッセージ\n    'SUCCESS_CREATE_FILE': 'ファイルの作成に成功しました',\n    'SUCCESS_UPDATE': '更新に成功しました',\n    'SUCCESS_DELETE': '削除に成功しました',\n    'SUCCESS_UPLOAD': 'アップロードに成功しました',\n    'SUCCESS_DOWNLOAD': 'ダウンロードに成功しました',\n    'SUCCESS_SAVE': '保存に成功しました',\n    'SUCCESS_CHECK': 'チェックが完了しました',\n    'NOT_FOUND': '該当データ無し',\n}\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝判定系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n/**\n * Null判定する関数です。\n * @param {object} obj オブジェクト\n * @returns {boolean} 判定結果\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonIsNull(obj) {\n    if (Array.isArray(obj)) {\n        return obj.filter(v => String(v).trim() !== '').length == 0;\n    } else if (typeof obj === 'object') {\n        return !obj || Object.keys(obj).length === 0 && obj.constructor === Object;\n    } else {\n        return !obj && obj !== 0 || String(obj).trim() == '';\n    }\n}\n\n/**\n * ステータスをチェックする関数です。\n * @param {Array|string} applyStatuses 適用するステータス\n * @returns {boolean} チェック結果\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonCheckStatus(applyStatuses = \"all\") {\n    if ($p.action() !== \"edit\" && $p.action() !== \"new\") {\n        let message = \"編集画面で使用を想定\"\n        alert(message)\n        throw new Error(message)\n    }\n    let allFlg = false;\n    if (!Array.isArray(applyStatuses)) {\n        if (applyStatuses === \"all\") {\n            allFlg = true;\n        } else {\n            applyStatuses = [applyStatuses];\n        }\n    }\n    return allFlg || applyStatuses.map(v => +v).includes(+commonGetValue(\"Status\", false));\n}\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝値取得&値設定系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n/**\n * 日付を出力する関数です。\n *\n * yyyy引数なしで現在日付\n * 月末はddに0を入力\n *\n * @param {Number} yyyy   年(またはDateオブジェクト)\n * @param {Number} mm     月\n * @param {Number} dd     日\n * @param {String} format フォーマット\n *\n * @return {String} フォーマット加工された日付文字列\n *\n * 例1. yyyy = 2022, mm = 4, dd = 18, format = 'YYYY-MM-DD'\n *            ⇓\n *     '2022-04-18'\n * 例2. yyyy = 2021, mm = 13, dd = 10, format = 'YYYY-MM-DD'\n *            ⇓\n *     '2022-01-10'\n * 例3. yyyy = 2021, mm = 11, dd = 0, format = 'YYYY-MM-DD'\n *            ⇓\n *     '2022-10-31'\n * 例4. yyyy = 2020\n *            ⇓\n *     '2020-01-01T00:00:00'\n * 例5. 引数なし\n *            ⇓\n *     現在日付の'YYYY-MM-DD'\n * 例6. yyyy = \"\", mm = \"\", dd = \"\", format = 'YYYYMM'\n *            ⇓\n *     現在日付の'YYYYMM'\n */\nfunction commonGetDate(yyyy, mm = 1, dd = 1, format = 'YYYY-MM-DD') {\n    let date\n    if (typeof yyyy === 'undefined' || commonIsNull(yyyy)) {\n        date = new Date()\n    } else if (typeof yyyy === 'object') {\n        date = yyyy\n    } else {\n        date = new Date(yyyy, mm - 1, dd)\n    }\n    return format\n        .replace(/YYYY/, String(date.getFullYear()).padStart(4, \"0\"))\n        .replace(/MM/, String(date.getMonth() + 1).padStart(2, \"0\"))\n        .replace(/DD/, String(date.getDate()).padStart(2, \"0\"))\n        .replace(/hh/, String(date.getHours()).padStart(2, \"0\"))\n        .replace(/mm/, String(date.getMinutes()).padStart(2, \"0\"))\n        .replace(/ss/, String(date.getSeconds()).padStart(2, \"0\"))\n\n}\n\n\n/**\n * 入力されたラベルに一致する項目の選択した値を返却する。\n * @param {String} label ラベル\n * @param {Boolean} valueFlg true : value値 false : display値\n * @returns {*} 選択された値または表示テキスト\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonGetValue(label, valueFlg = true) {\n    if ($p.action() !== \"edit\" && $p.action() !== \"new\") {\n        let message = \"編集画面で使用を想定\"\n        alert(message)\n        throw new Error(message)\n    }\n    const control = $p.getControl($p.getColumnName(label));\n    const tagName = control.prop(\"tagName\");\n\n    let value;\n\n    switch (tagName) {\n        case \"SELECT\":\n            value = commonHandleSelect(control, valueFlg);\n            break;\n        case \"INPUT\":\n            value = commonHandleInput(control, label, valueFlg);\n            break;\n        case \"TEXTAREA\":\n            value = document.getElementById(commonGetId(label) + \".viewer\").innerText;\n            break;\n        default:\n            value = commonHandleDefault(control, valueFlg);\n    }\n\n    return commonParseIfJson(value);\n}\n\n/**\n * 入力されたラベルに一致する項目の選択した値を入力する。\n * @param {String} label ラベル\n * @param {object} value 値\n */\nfunction commonSetValue(label, value) {\n    if ($p.action() !== \"edit\" && $p.action() !== \"new\") {\n        let message = \"編集画面で使用を想定\"\n        alert(message)\n        throw new Error(message)\n    }\n\n    // 値が変更されている場合\n    if (commonGetValue(label, true) != value) {\n        if ($p.getColumnName(label).startsWith(\"Check\")) {\n            // changeイベントを動かす\n            $p.getControl(label).click()\n        } else {\n            value = (value == commonGetDateEmpty()) ? \"\" : value\n            $p.set($p.getControl(label), value)\n        }\n    }\n}\n\n/**\n * 入力されたラベルのIDを返却する。\n * @param {String} label ラベル\n * @param {Boolean} [prefix=true] プレフィックス（テーブル名）を付けるかどうか\n * @param {Boolean} [suffix=false] サフィックス（'Field'）を付けるかどうか\n * @returns {String} 生成されたID\n * @throws {Error} ラベルが不正な場合やその他のエラー\n */\nfunction commonGetId(label, prefix = true, suffix = false) {\n    if ($p.action() !== \"edit\" && $p.action() !== \"new\") {\n        let message = \"編集画面で使用を想定\"\n        alert(message)\n        throw new Error(message)\n    }\n\n    let id = $p.getColumnName(label);\n    if (commonIsNull(id)) {\n        let message = `commonGetId ：ラベル不正。${label}`\n        alert(message)\n        throw new Error(message)\n    }\n    id = prefix ? `${$p.tableName()}_${id}` : id;\n    id = suffix ? `${id}Field` : id;\n    return id;\n\n}\n\n/**\n * SELECT要素の値を処理する。\n * @param {jQuery} control jQuery対象のSELECT要素\n * @param {Boolean} valueFlg true : value値 false : display値\n * @returns {*} 選択された値または表示テキスト\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonHandleSelect(control, valueFlg) {\n    if (control.attr(\"multiple\")) {\n        return valueFlg ? control.val() : control.next().children().last().text();\n    }\n    const selectedOption = control.children(':selected');\n    return valueFlg ? selectedOption.val() : selectedOption.text();\n}\n\n/**\n * INPUT要素の値を処理する。\n * @param {jQuery} control jQuery対象のINPUT要素\n * @param {String} label ラベル\n * @param {Boolean} valueFlg true : value値 false : display値\n * @returns {*} 入力された値または表示テキスト\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonHandleInput(control, label, valueFlg) {\n    const inputId = commonGetId(label);\n    if (inputId.indexOf(\"Check\") > 0) {\n        const checked = document.getElementById(inputId).checked;\n        return valueFlg ? +checked : checked;\n    }\n    let value = valueFlg ? control.attr('data-value') : control[0].innerHTML;\n    return commonIsNull(value) ? control.val() : value;\n\n}\n\n/**\n * デフォルトの要素処理を行う。\n * @param {jQuery} control jQuery対象の要素\n * @param {Boolean} valueFlg true : value値 false : display値\n * @returns {*} 要素の値または表示テキスト\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonHandleDefault(control, valueFlg) {\n    let value = valueFlg ? (control.attr('data-value') ?? control[0].innerHTML) : control[0].innerHTML;\n    return commonIsNull(value) ? control.val() : value;\n}\n\n/**\n * 空日付を出力する関数です。\n *\n * @return {String} 空日付\n */\nfunction commonGetDateEmpty() {\n    return '1899-12-30T00:00:00'\n}\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝値変換系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n/**\n * 値がJSON文字列の場合はパースし、そうでない場合は元の値を返す。\n * @param {*} value パース対象の値\n * @returns {*} パースされた値または元の値\n */\nfunction commonParseIfJson(value) {\n    if (typeof value !== 'string') return value;\n    try {\n        return JSON.parse(value);\n    } catch (err) {\n        return value;\n    }\n}\n\n/**\n * file を Base64 文字列に変換する。\n * @param {ArrayBuffer} file 変換する file\n * @returns {string} Base64 エンコードされた文字列\n */\nasync function commonToBase64(file) {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = () => {\n            const base64String = reader.result.split(\",\")[1];\n            resolve(base64String);\n        };\n        reader.onerror = (err) => reject(err);\n        reader.readAsDataURL(file);\n    });\n}\n\n/**\n   * 引数の2次元配列をUTF-8のCSVに変換する関数です。\n   * @param {Array} array 2次元配列\n   *\n   * @return {String} csvData\n   * 例. [\n   *      ['数量', '単価', '合計'],\n   *      ['1', '2', '2'],\n   *      ['4', '5', '20'],\n   *      ['7', '8', '56'],\n   *     ]\n   *            ⇓\n   * 'data:text/csvcharset=utf-8,\"数量\",\"単価\",\"合計\"\\r\\n\"1\",\"2\",\"2\"\\r\\n\"4\",\"5\",\"20\"\\r\\n\"7\",\"8\",\"56\"\\r\\n'\n   */\nfunction commonConvert2DToCsv(d2array) {\n    // csvDataに出力方法を追加\n    let csvOutput = 'data:text/csvcharset=utf-8,'\n    let csvData = csvOutput\n    d2array.forEach(v => {\n        const row = '\"' + v.join('\",\"') + '\"'\n        csvData += row + '\\r\\n'\n    })\n    return csvData\n}\n\n/**\n   * 引数の2次元配列をUTF-8のCSVに変換する関数です。\n   * @param {String} csvData\n   *\n   * @return {Array} array 2次元配列\n   * 例. 'data:text/csvcharset=utf-8,\"数量\",\"単価\",\"合計\"\\r\\n\"1\",\"2\",\"2\"\\r\\n\"4\",\"5\",\"20\"\\r\\n\"7\",\"8\",\"56\"\\r\\n'\n   *            ⇓\n   *     [\n   *      ['数量', '単価', '合計'],\n   *      ['1', '2', '2'],\n   *      ['4', '5', '20'],\n   *      ['7', '8', '56'],\n   *     ]\n   */\nfunction commonConvertCsvTo2D(csvData) {\n    // 行の分割\n    let rows = csvData.split(/\\r?\\n/);\n\n    // 空行の除去\n    let filteredRows = rows.filter(row => row.trim() !== '');\n\n    // 各行を処理\n    let processedData = filteredRows.map(row => {\n        // カラムに分割\n        let columns = row.split(',');\n\n        // 各値ごとに型変換処理\n        return columns.map(value => {\n            let trimmed = value.trim();\n            let num = Number(trimmed);\n\n            if (!isNaN(num) && trimmed !== '') {\n                return num;\n            }\n            return trimmed;\n        });\n    });\n\n    return processedData;\n}\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝要素追加&要素編集系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n/**\n * 指定された文言と完全に一致する最初のリンクを検索し、href属性を'#'に変更して、クリック時にカスタム関数を実行する関数\n * @param {string} searchText - リンクを検索するための文言（完全一致）\n * @param {function} customClickHandler - クリック時に実行されるカスタム関数\n * @returns {boolean} - リンクが見つかって修正されたかどうか\n * @throws {Error} 処理中に発生したエラー\n */\nfunction commonModifyLink(searchText, customClickHandler) {\n    const link = Array.from(document.getElementsByTagName('a')).find(a =>\n        a.textContent.trim() === searchText.trim()\n    );\n\n    if (link) {\n        const dataValue = link.closest('[data-value]')?.getAttribute('data-value');\n        link.setAttribute('href', '#');\n        link.style.color = 'black';\n        link.style.textDecoration = 'none';\n        link.onclick = function (event) {\n            event.preventDefault();\n            customClickHandler(dataValue, link.textContent);\n            return false;\n        };\n        return true;\n    } else {\n        console.warn(`\"${searchText}\" と完全に一致するリンクが見つかりませんでした。`);\n        return false;\n    }\n}\n\n/**\n * メインコマンドエリアにボタンを追加する関数です。\n * @param {String} buttonId     ボタンID\n * @param {String} buttonLabel  ラベル\n * @param {Function} clickFunc  click時関数\n * @param {String} icon         アイコン（empty指定でアイコンなし）\n * @throws {Error}              処理中に発生したエラー\n */\nfunction commonAddButtonToMainCommands(buttonId, buttonLabel, clickFunc, icon = \"ui-icon-disk\") {\n    const target = document.getElementById(\"MainCommands\");\n    const elem = document.createElement('button');\n    elem.id = buttonId;\n    elem.className = 'button button-icon ui-button ui-corner-all ui-widget applied customized';\n    elem.onclick = clickFunc;\n    elem.innerText = buttonLabel;\n    if (icon !== \"empty\") {\n        const span = document.createElement('span');\n        span.className = `ui-button-icon ui-icon ${icon}`;\n        elem.appendChild(span);\n    }\n    const space = document.createElement('span');\n    space.className = \"ui-button-icon-space\";\n    elem.appendChild(space);\n\n    target.appendChild(elem);\n}\n\n/**\n * 指定項目横にボタンを追加する関数です。\n * @param {String} buttonId     ボタンID\n * @param {String} buttonLabel  ラベル\n * @param {Function} clickFunc  click時関数\n * @param {String} icon         アイコン（empty指定でアイコンなし）\n * @param {Array} applys        適用するステータス\n * @throws {Error}              処理中に発生したエラー\n */\nfunction commonAddButtonToNextField(ItemLabel, buttonId, buttonLabel, clickFunc, icon = \"ui-icon-disk\", applys = \"all\") {\n    if (!commonCheckStatus(applys)) return;\n\n    // 対象のフィールドを取得\n    const targetField = document.getElementById(commonGetId(ItemLabel));\n    if (!targetField) {\n        let message = `commonAddButtonToNextField :対象項目が見つかりません。${ItemLabel}`\n        alert(message)\n        throw new Error(message)\n    }\n\n    // container-normal クラスを持つ親要素を見つける\n    const containerElement = targetField.closest('.container-normal');\n    if (!containerElement) {\n        let message = `commonAddButtonToNextField :container-normalクラスを持つ親要素が見つかりません。`\n        alert(message)\n        throw new Error(message)\n    }\n\n    // 新しいボタン要素を作成\n    const elem = document.createElement('button');\n    elem.id = buttonId;\n    elem.className = 'button button-icon ui-button ui-corner-all ui-widget applied customized';\n    elem.onclick = clickFunc;\n\n    if (icon !== \"empty\") {\n        const span = document.createElement('span');\n        span.className = `ui-button-icon ui-icon ${icon}`;\n        elem.insertBefore(span, elem.firstChild);\n    }\n\n    const space = document.createElement('span');\n    space.className = \"ui-button-icon-space\";\n    elem.appendChild(space);\n\n    const textNode = document.createTextNode(buttonLabel);\n    elem.appendChild(textNode);\n\n    // ボタンをcontainer-normal要素内に挿入\n    containerElement.appendChild(elem);\n\n    // レイアウトとスタイルを調整\n    containerElement.style.display = 'flex';\n    containerElement.style.alignItems = 'center';\n    containerElement.style.flexWrap = 'nowrap';\n\n    targetField.style.flexGrow = '1';\n    targetField.style.flexShrink = '1';\n    targetField.style.flexBasis = 'auto';\n    targetField.style.minWidth = '0';\n\n    elem.style.flexGrow = '0';\n    elem.style.flexShrink = '0';\n    elem.style.flexBasis = 'auto';\n    elem.style.marginLeft = '10px';\n    elem.style.whiteSpace = 'nowrap';\n\n}\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝API系＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet API_VERSION = \"1.0\"\n\n/**\n * 取得APIを呼び出す関数です。\n *\n * @param {Number}    id テーブルID\n * @param {Array}     columns 取得列\n * @param {Object}    filterHash フィルター条件\n * @param {Object}    sorterHash ソート条件\n * @param {Object}    filterSearchTypes 検索条件\n * @param {Boolean}   keyFlg true : 表示名 false : カラム名\n * @param {Boolean}   valueFlg true : value値 false : display値\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonGetData(id = $p.siteId(), columns = [\"ClassA\", \"NumA\"], filterHash = {}, sorterHash = { \"ResultId\": \"asc\" }, filterSearchTypes = {}, keyFlg = true, valueFlg = true, addFunc) {\n    let offset = 0\n    let data = []\n    let temp = {}\n    do {\n        temp = await commonGetInnner(id, columns, filterHash, sorterHash, filterSearchTypes, keyFlg, valueFlg, offset, addFunc)\n        data = [...data, ...temp.Response.Data]\n        offset += temp.Response.PageSize\n    } while (offset < temp.Response.TotalCount)\n    return data\n\n    /**\n     * 取得APIを呼び出す関数内関数です。(TotalCount 200)\n     *\n     * @param {Number}    id テーブルID\n     * @param {Array}     columns 取得列\n     * @param {Object}    filterHash フィルター条件\n     * @param {Object}    sorterHash ソート条件\n     * @param {Object}    filterSearchTypes 検索条件\n     * @param {Boolean}   keyFlg true : 表示名 false : カラム名\n     * @param {Boolean}   valueFlg true : value値 false : display値\n     * @param {Number}    offset オフセット条件\n     * @param {Function}  addFunc 最後に実行したい関数\n     */\n    async function commonGetInnner(id, columns, filterHash, sorterHash, filterSearchTypes, keyFlg, valueFlg, offset, addFunc) {\n        let payload = {\n            'id': id,\n            'data': {\n                'Offset': offset,\n                'View': {\n                    'ApiDataType': \"KeyValues\",\n                    'ApiColumnKeyDisplayType': keyFlg ? 'LabelText' : 'ColumnName',\n                    'ApiColumnValueDisplayType': valueFlg ? \"Value\" : \"DisplayValue\",\n                    \"ColumnFilterHash\": filterHash,\n                    \"ColumnSorterHash\": sorterHash,\n                    \"ColumnFilterSearchTypes\": filterSearchTypes,\n                }\n            },\n            'done': function (data) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n                return data.Response.Data\n            }\n        }\n\n        if (!Array.isArray(columns)) {\n            columns = [columns]\n        }\n        if (columns.length > 0) {\n            payload['data']['View']['GridColumns'] = columns\n        }\n\n\n\n        return await $p.apiGet(payload)\n    }\n}\n\n/**\n * エクスポートAPIを呼び出す関数です。\n *\n * @param {String}    tableId 取得テーブルID\n * @param {Array}     columns 取得列\n * @param {Object}    filterHash フィルター条件\n * @param {Object}    sorterHash ソート条件\n * @param {Object}    filterSearchTypes 検索条件\n * @param {Boolean}   jsonFlg trueならjson　falseならcsvで取得\n * @param {Boolean}   headerFlg trueならheaderも取得\n * @param {Boolean}   overFlg trueなら超過分のみ取得\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonExportData(tableId = $p.siteId(), columns = [\"ClassA\", \"NumA\"], filterHash = {}, sorterHash = { \"ResultId\": \"asc\" }, filterSearchTypes = {}, jsonFlg = true, headerFlg = true, overFlg = false, addFunc) {\n    if (!Array.isArray(columns)) {\n        columns = [columns]\n    }\n    columns.unshift(\"ResultId\")\n    let data = await commonExportInner(tableId, columns, filterHash, sorterHash, filterSearchTypes, jsonFlg, headerFlg, overFlg, addFunc)\n    if (jsonFlg) {\n        // json整形\n        data = JSON.parse(data.Response.Content)\n    } else {\n        // csv整形\n        data = commonConvertCsvTo2D(data.Response.Content)\n    }\n\n    return data\n    /**\n     * エクスポートAPIを呼び出す関数内関数です。\n     *\n     * @param {String}    tableId 取得テーブルID\n     * @param {Array}     columns 取得列\n     * @param {Object}    filterHash フィルター条件\n     * @param {Object}    sorterHash ソート条件\n     * @param {Object}    filterSearchTypes 検索条件\n     * @param {Boolean}   jsonFlg trueならjson　falseならcsvで取得\n     * @param {Boolean}   headerFlg trueならheaderも取得\n     * @param {Boolean}   overFlg trueなら超過分のみ取得\n     * @param {Function}  addFunc 最後に実行したい関数\n     */\n    async function commonExportInner(tableId, columns, filterHash, sorterHash, filterSearchTypes, jsonFlg, headerFlg, overFlg, addFunc) {\n\n        let col = []\n        columns.forEach(v => col.push({ \"ColumnName\": v }))\n        let data = JSON.stringify({\n            \"ApiVersion\": API_VERSION,\n            \"Export\": {\n                \"Columns\": col,\n                \"Header\": headerFlg,\n                \"Type\": jsonFlg ? \"json\" : \"csv\"\n            },\n            \"View\": {\n                \"Overdue\": overFlg,\n                \"ColumnFilterHash\": filterHash,\n                \"ColumnSorterHash\": sorterHash,\n                \"ColumnFilterSearchTypes\": filterSearchTypes,\n            }\n        })\n\n        return new Promise((resolve, reject) => {\n            $.ajax({\n                type: \"POST\",\n                url: `/api/items/${tableId}/export`,\n                contentType: 'application/json',\n                data: data\n            }).then(\n                function (result) {\n                    if (addFunc && typeof addFunc === 'function') {\n                        // 渡されたオブジェクトが関数なら実行する\n                        addFunc(data)\n                    }\n                    // 正常終了\n                    resolve(result)\n                },\n                function () {\n                    // エラー\n                    reject()\n                }\n            )\n        })\n    }\n}\n\n/**\n * 登録APIを呼び出す関数です。\n *\n * @param {String}    tableId 登録テーブルID\n * @param {Object}    Hash 更新項目\n * @param {String}    Status 登録ステータス\n * @param {String}    Comments 登録コメント\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonCreate(tableId, Hash = {}, Status, Comments, addFunc) {\n\n    // 登録項目\n    let ClassHash = {}\n    let NumHash = {}\n    let DateHash = {}\n    let DescriptionHash = {}\n    let CheckHash = {}\n    for (let key in Hash) {\n        if (key.includes(\"Class\")) ClassHash[key] = Hash[key]\n        else if (key.includes(\"Num\")) NumHash[key] = commonConvertCTo1(Hash[key])\n        else if (key.includes(\"Date\")) DateHash[key] = commonIsNull(Hash[key]) ? commonGetDateEmpty() : Hash[key]\n        else if (key.includes(\"Description\")) DescriptionHash[key] = Hash[key]\n        else if (key.includes(\"Check\")) CheckHash[key] = Hash[key]\n    }\n\n    let data = JSON.stringify({\n        \"ApiVersion\": API_VERSION,\n        Status,\n        Comments,\n        ClassHash,\n        NumHash,\n        DateHash,\n        DescriptionHash,\n        CheckHash\n    })\n    if (!commonIsNull(Status)) {\n        delete data[\"Status\"]\n    }\n    if (!commonIsNull(Comments)) {\n        delete data[\"Comments\"]\n    }\n\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            type: \"POST\",\n            url: `/api/items/${tableId}/create`,\n            contentType: 'application/json',\n            data: data\n        }).then(\n            function (result) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n                // 正常終了\n                resolve(result)\n            },\n            function () {\n                // エラー\n                reject()\n            }\n        )\n    })\n}\n\n/**\n * 更新APIを呼び出す関数です。\n *\n * @param {String}    recordId 更新レコードID\n * @param {Object}    Hash 更新項目\n * @param {String}    Status 更新ステータス\n * @param {String}    Comments 更新コメント\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonUpdate(recordId, Hash = {}, Status, Comments, addFunc) {\n\n    // 更新項目\n    let ClassHash = {}\n    let NumHash = {}\n    let DateHash = {}\n    let DescriptionHash = {}\n    let CheckHash = {}\n    for (let key in Hash) {\n        if (key.includes(\"Class\")) ClassHash[key] = Hash[key]\n        else if (key.includes(\"Num\")) NumHash[key] = commonConvertCTo1(Hash[key])\n        else if (key.includes(\"Date\")) DateHash[key] = commonIsNull(Hash[key]) ? commonGetDateEmpty() : Hash[key]\n        else if (key.includes(\"Description\")) DescriptionHash[key] = Hash[key]\n        else if (key.includes(\"Check\")) CheckHash[key] = Hash[key]\n    }\n    let data = JSON.stringify({\n        \"ApiVersion\": API_VERSION,\n        Status,\n        Comments,\n        ClassHash,\n        NumHash,\n        DateHash,\n        DescriptionHash,\n        CheckHash\n    })\n    if (!commonIsNull(Status)) {\n        delete data[\"Status\"]\n    }\n    if (!commonIsNull(Comments)) {\n        delete data[\"Comments\"]\n    }\n\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            type: \"POST\",\n            url: `/api/items/${recordId}/update`,\n            contentType: 'application/json',\n            data: data\n        }).then(\n            function (result) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n\n                // 正常終了\n                resolve(result)\n            },\n            function () {\n                // エラー\n                reject()\n            }\n        )\n    })\n}\n\n/**\n * ユーザー取得APIを呼び出す関数です。\n *\n * @param {Array}     userIds 取得UserId\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonExportUser(userIds, addFunc) {\n    let users = []\n    if (Array.isArray(userIds)) {\n        users = userIds\n    } else {\n        users = [userIds]\n    }\n    let data = JSON.stringify({\n        \"ApiVersion\": API_VERSION,\n        \"View\": {\n            \"ColumnFilterHash\": {\n                \"UserId\": JSON.stringify(users)\n            }\n        }\n    })\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            type: \"POST\",\n            url: \"/api/users/get\",\n            contentType: 'application/json',\n            data: data\n        }).then(\n            function (result) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n                // 正常終了\n                resolve(result)\n            },\n            function () {\n                // エラー\n                reject()\n            }\n        )\n    })\n}\n\n/**\n * グループ取得APIを呼び出す関数です。\n *\n * @param {Array}     groupIds 取得GroupId\n * @param {Function}  addFunc 最後に実行したい関数\n */\nasync function commonExportGroup(groupIds, addFunc) {\n    let groups = []\n    if (Array.isArray(groupIds)) {\n        groups = groupIds\n    } else {\n        groups = [groupIds]\n    }\n    let data = JSON.stringify({\n        \"ApiVersion\": API_VERSION,\n        \"View\": {\n            \"ColumnFilterHash\": {\n                \"GroupId\": JSON.stringify(groups)\n            }\n        }\n    })\n    return new Promise((resolve, reject) => {\n        $.ajax({\n            type: \"POST\",\n            url: \"/api/groups/get\",\n            contentType: 'application/json',\n            data: data\n        }).then(\n            function (result) {\n                if (addFunc && typeof addFunc === 'function') {\n                    // 渡されたオブジェクトが関数なら実行する\n                    addFunc(data)\n                }\n                // 正常終了\n                resolve(result)\n            },\n            function () {\n                // エラー\n                reject()\n            }\n        )\n    })\n}\n\n/**\n * 添付項目にExcelを添付し更新する共通関数です。\n *\n * @param {string} targetID 更新対象のアイテムID\n * @param {string} className 添付ファイルのクラス名\n * @param {Object} excel Excelワークブックオブジェクト\n * @param {string} filename 添付ファイルの名前\n */\nasync function commonUpdateExcel(targetID, className, workbook, filename) {\n    const fileBuffer = await workbook.xlsx.writeBuffer()\n    const base64 = commonToBase64(fileBuffer)\n\n    let url = `/api/items/${targetID}/update`\n    let method_name = \"POST\"\n    let data = {\n        \"ApiVersion\": API_VERSION,\n        \"AttachmentsHash\": {\n            [className]: [\n                {\n                    \"ContentType\": \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\n                    \"Name\": filename,\n                    \"Base64\": base64\n                }\n            ]\n        }\n    }\n    await $.ajax({\n        type: method_name,\n        url: url,\n        data: JSON.stringify(data),\n        contentType: 'application/json',\n        dataType: 'json',\n        scriptCharset: 'utf-8',\n        success: function (data) {\n            // Success\n            console.log(\"success\")\n            console.log(JSON.stringify(data))\n        },\n        error: function (data) {\n            // Error\n            console.log(\"error\")\n            console.log(JSON.stringify(data))\n        }\n    })\n}\n\n",
            "Id": 10
          },
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝閲覧権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\nonEditorLoadFuncs.push(function(){\n    if($p.action() != 'edit'){\n        return;\n    }\n\n    $('#Results_ClassF').attr('disabled',true).css('background-color','#f5f5f5');\n\n})",
            "Id": 18
          },
          {
            "Title": "20_ダイアログテンプレート.js",
            "New": true,
            "Edit": true,
            "Body": "// ダイアログを作成し、ページに追加する関数\nhtmls = {};\nfunction createAndAddDialog(dialogId, title, fields, btnFields = [], submitHandler) {\n    if (document.getElementById(dialogId)) {\n        let message = `ダイアログID \"${dialogId}\" は既に存在します。一意のIDを使用してください。`;\n        alert(message)\n        throw new Error(message);\n    }\n\n    // 何行になるかを計算し、配列に格納\n    let columnCountArr = [];\n    let rowCount = 0;\n    let newLineFlg = false;\n    for(let field of fields){\n        if(typeof(field.options) == 'object' && 'newLine' in field.options && field.options.newLine){\n            newLineFlg = true;\n            rowCount++;\n        }\n        else if(typeof(field.options) == 'object' && \"newLine\" in field.options && !field.options.newLine){\n            if(newLineFlg){\n                columnCountArr.push(rowCount);\n                rowCount = 0;\n            }\n            else{\n                newLineFlg = true;\n            }\n        }\n    }\n\n    let content = '';\n    newLineFlg = false;\n    let arrCount = 0;\n    for(let field of fields){\n        sqlArrayPush(field,dialogId);\n        if(typeof(field.options) == 'object' && 'newLine' in field.options && field.options.newLine){\n            if(newLineFlg){\n                content += \"</div>\";\n            }\n            let conteiner_width = Math.floor(100 / columnCountArr[arrCount]);\n            content += `<div style=\"display: inline-block;width: ${conteiner_width}%;vertical-align: top;\">`;\n            content += createField(dialogId, field.type, field.id, field.label, field.options);\n            newLineFlg = true;\n        }\n        else if(typeof(field.options) == 'object' && \"newLine\" in field.options && !field.options.newLine){\n            if(newLineFlg){\n                content += \"</div>\";\n                content += `<div style=\"display: block;\">`;\n                content += createField(dialogId, field.type, field.id, field.label, field.options);\n                newLineFlg = true;\n                arrCount++;\n            }\n        }\n        else{\n            content += createField(dialogId, field.type, field.id, field.label, field.options);\n        }\n\n    }\n    if(newLineFlg)content += \"</div>\";\n\n    let btnContent = '';\n    if(btnFields.length > 0){\n        btnContent = btnFields.map(e => createButton(e.label,e.options.onclick ? e.options.onclick : '',e.options.icon,dialogId,e.id,e.options.hidden ? true:false)).join('');\n    }\n    const dialogHTML = createDialogHTML(dialogId, title, content,btnContent);\n    $('#Application').append(dialogHTML);\n\n    \n    htmls[dialogId] = dialogHTML;\n\n    // バリデーションイベント登録\n    // for(let field of fields){\n    //     create_varidate_event(dialogId,field.id,field.type,field.options);\n    // }\n\n    createLookups(dialogId, title, fields);\n    // submitHandlerを設定\n    $(`#${dialogId}_submit`).on('click', function() {\n        submitDialog(dialogId, submitHandler);\n    });\n\n    // searchArr作成\n    let search_items = fields.filter(e => e.type == 'search-table');\n    if(search_items.length == 0)return;\n    for(item of search_items){\n        let tmp_searchObj = {dialogId:dialogId,tableId:item.id,searchTableId:item.options.searchTableId,multiple:item.options.multiple ? true:false};\n        // toColumns作成\n        tmp_searchObj.toColumns = item.options.t_heads.map(e =>{\n            tmp = {ColumnName:e.ColumnName};\n\n            if('specialTerms'in e)tmp[\"specialTerms\"] = e.specialTerms;\n            if('alignment' in e)tmp[\"alignment\"] = e.alignment;\n            if(e.hidden)tmp[\"hidden\"] = true;\n            if(e.type)tmp[\"type\"] = e.type;\n            return tmp;\n\n        });\n        // options作成\n        tmp_searchObj.options = [];\n        let tmpArr;\n        fields.forEach(e => {\n            if('forColumnName' in e){\n                tmpArr = {searchColumn:e.forColumnName,type:e.type,id:e.id};\n                if(\"digitsNum\" in e.options)tmpArr[\"digitsNum\"] = e.options.digitsNum;\n                if(\"alignment\" in e.options)tmpArr[\"alignment\"] = e.options.alignment;\n                tmp_searchObj.options.push(tmpArr);\n            }\n        });\n        searchArr.push(tmp_searchObj);\n\n    }\n    $(`#${dialogId}_searchButton`).on('click',function(e){\n        create_searchList($(this));\n    })\n\n\n\n}\n\n// ダイアログのベース構造を定義\nconst createDialogHTML = (dialogId, title, content, btnContent) => `\n    <div id=\"${dialogId}\" class=\"dialog\" title=\"${title}\">\n        ${content}\n        <div class=\"command-center\">\n            ${btnContent}\n            <button id=\"${dialogId}_close\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" type=\"button\" onclick=\"closeDialog('${dialogId}',true);\"style='position:relative;'>\n                <span class=\"ui-button-icon ui-icon ui-icon-cancel\"></span>\n                <span class=\"ui-button-icon-space\"> </span>終了\n            </button>\n        </div>\n    </div>\n`;\n\nfunction createButton(label,onclick,icon,dialogId,id,hiddenFlg){\n    return `\n        <button id=\"${dialogId}_${id}\" style=\"${hiddenFlg ? \"display:none\":''}\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" type=\"button\" onclick=\"${onclick == '' ? '':onclick}\">\n                    <span class=\"ui-button-icon ui-icon ui-icon-${icon}\"></span>\n                    <span class=\"ui-icon-${icon}\"> </span>${label}\n        </button>\n    `\n}\n\n// ダイアログを開く関数\nfunction openDialog(dialogId,width='550',unit = 'px',func = null) {\n\n    $(`#${dialogId}`).dialog({\n        modal:true,\n        width: `${width}${unit}`,\n        resizable: true,\n        closeOnEscape:false,\n    })\n    $(`#${dialogId}`).css('max-height',\"90vh\");\n    dialog_openTime = getJPISOTime()\n\n    if(typeof func == 'function'){\n        func();\n    }\n    \n}\n// ダイアログ固有の送信処理を格納するオブジェクト\nconst dialogSubmitHandlers = {};\n\n// ダイアログ内のフォームをSubmitする関数\nfunction submitDialog(dialogId, submitHandler) {\n    // バリデーションを実行\n    if (!validateDialog(dialogId)) {\n        return;\n    }\n\n    // 送信ハンドラを設定\n    if (typeof submitHandler === 'function') {\n        dialogSubmitHandlers[dialogId] = submitHandler;\n    }\n\n    // ダイアログ固有の送信処理を実行\n    if (dialogSubmitHandlers[dialogId]) {\n        dialogSubmitHandlers[dialogId](dialogId);\n    }\n    closeDialog(dialogId);\n}\n\n// ダイアログのバリデーションを行う関数\nfunction validateDialog(dialogId) {\n    let isValid = true;\n    $(`#${dialogId} [required]`).each(function() {\n        const field = $(this);\n        const errorElement = $(`#${field.attr('id').replace(/(From|To)$/, '')}-error`);\n        if (!field.val()) {\n            isValid = false;\n            field.addClass('error');\n            errorElement.text('この項目は必須です');\n        } else {\n            field.removeClass('error');\n            errorElement.text('');\n        }\n    });\n    return isValid;\n}\n\nfunction editMarkdown(dialogId, id) {\n\n    const fullId = `${dialogId}_${id}`;\n    $(`#${fullId}`).show().focus();\n    $(`#${fullId}_viewer`).hide();\n}\n\n// フィールドの有効/無効を切り替える関数\nfunction toggleFieldDisabled(fieldId, disabled) {\n    const field = $(`#${fieldId}`);\n    field.prop('disabled', disabled);\n\n    if (disabled) {\n        field.addClass('disabled');\n    } else {\n        field.removeClass('disabled');\n    }\n}\n\nfunction sqlArrayPush(field,dialogId){\n    if(field.type == 'search-table' && field.options.sql)useSqlDialogs.push(dialogId);\n    if(field.type == 'search-table' && field.options.individualSql)useIndividualSqlDialogs.push(dialogId);\n}\n\n/**\n * 現在の日本時間を ISO 8601 形式 (YYYY-MM-DDTHH:mm:ss) で取得する\n * @returns {string} 日本時間の ISO 8601 形式の文字列 (例: \"2024-12-11T01:41:33\")\n */\nfunction getJPISOTime() {\n    const now = new Date();\n    const jpISOTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000)\n        .toISOString()\n        .slice(0, 19);  // 秒まで切り取り\n    return jpISOTime;\n}\n\n/**\n * 前回出力履歴を取得する\n * @param {string} listName     帳票名\n * @param {number} number       番号（見積番号等）\n * @param {string} id           結果を入力するid\n *  */\nasync function get_history(listName,number,id){\n    try{\n        const sql = `\n            SELECT CreateDate, PCName\n            From TW見積出力履歴\n            WHERE ListName = '${listName}'\n            AND Number = ${number}\n        `;\n\n        let res = await fetchSql(sql);\n        res = res.results;\n\n        if(res.length == 0){\n            $(`#${id} .input-container span`).text('');\n            return;\n        }\n\n        // 入力\n        let tmp = formatDate_for_japanese(res[0].CreateDate) + \"　\" + formatTime_for_japanese(res[0].CreateDate) + \"　\" + res[0].PCName;\n\n        $(`#${id} .input-container span`).text(tmp);\n\n    }catch(err){\n        $(`#${id} .input-container span`).text('');\n        console.error('前回出力情報取得処理',err);\n        return;\n    }\n}",
            "Id": 12
          },
          {
            "Title": "21_検索ダイアログテンプレート.js",
            "New": true,
            "Edit": true,
            "Body": "/**\n * 検索ダイアログ\n * @param {string} dialogId 検索ダイアログID\n * @param {string} tableId 検索先テーブルID\n * @param {Array} fields 項目ごとのパラメータ\n * @param {Array} btnFields ダイアログ下部に表示するボタン\n * @param {string} width ダイアログのwidthを指定\n */\nlet useSqlDialogs = [];\nlet useIndividualSqlDialogs = [];\nasync function create_searchDialog(dialogId,tableId,fields,btnFields = [],width = '750px'){\n    if (document.getElementById(dialogId)) {\n        let message = `ダイアログID \"${dialogId}\" は既に存在します。一意のIDを使用してください。`;\n        alert(message)\n        throw new Error(message);\n    }\n\n    let multipleFlg = false;\n    for(i = 0; i < 2; i++){\n        if(multipleFlg)dialogId += \"_multiple\";\n        // 何行になるかを計算し、配列に格納\n        let columnCountArr = [];\n        let rowCount = 0;\n        let newLineFlg = false;\n        for(let field of fields){\n            if(typeof(field.options) == 'object' && 'newLine' in field.options && field.options.newLine){\n                newLineFlg = true;\n                rowCount++;\n            }\n            else if(typeof(field.options) == 'object' && \"newLine\" in field.options && !field.options.newLine){\n                if(newLineFlg){\n                    columnCountArr.push(rowCount);\n                    rowCount = 0;\n                }\n                else{\n                    newLineFlg = true;\n                }\n            }\n        }\n\n        let filterHTML = '';\n        newLineFlg = false;\n        let arrCount = 0;\n        for(let field of fields){\n            if(field.type == 'search-table' && field.options.sql)useSqlDialogs.push(dialogId);\n            if(field.type == 'search-table' && field.options.individualSql)useIndividualSqlDialogs.push(dialogId);\n            if(typeof(field.options) == 'object' && 'newLine' in field.options && field.options.newLine){\n                if(newLineFlg){\n                    filterHTML += \"</div>\";\n                }\n                let conteiner_width = Math.floor(100 / columnCountArr[arrCount]);\n                filterHTML += `<div style=\"display: inline-block;width: ${conteiner_width}%;vertical-align: top;\">`;\n                filterHTML += createField(dialogId, field.type, field.id, field.label, field.options,multipleFlg);\n                newLineFlg = true;\n            }\n            else if(typeof(field.options) == 'object' && \"newLine\" in field.options && !field.options.newLine){\n                if(newLineFlg){\n                    filterHTML += \"</div>\";\n                    filterHTML += `<div style=\"display: block;\">`;\n                    filterHTML += createField(dialogId, field.type, field.id, field.label, field.options,multipleFlg);\n                    newLineFlg = true;\n                    arrCount++;\n                }\n            }\n            else{\n                filterHTML += createField(dialogId, field.type, field.id, field.label, field.options,multipleFlg);\n            }\n        }\n        if(newLineFlg)filterHTML += \"</div>\";\n\n        const btnHTML = btnFields.map(field => createField(dialogId, field.type, field.id, field.label, field.options,multipleFlg)).join('');\n        const dialogHTML      = searchDialogTemplate(dialogId,filterHTML,multipleFlg,btnHTML);\n        $('#Application').append(dialogHTML);\n\n        // 検索用のイベント登録\n        $(`#${dialogId}_searchButton`).on('click',function(e){\n            create_searchList($(this));\n        })\n\n        // searchArr作成（検索に必要な情報を格納）\n        const searchTable_items = fields.filter(e => e.type == 'search-table');\n        for(item of searchTable_items){\n            let tmp_searchObj = {dialogId:dialogId,searchTableId:tableId,tableId:item.id,width:width};\n            // toColumns作成\n            tmp_searchObj.toColumns = item.options.t_heads.map(e =>{\n                tmp = {ColumnName:e.ColumnName};\n\n                if('specialTerms'in e)tmp[\"specialTerms\"] = e.specialTerms;\n                if('alignment' in e)tmp[\"alignment\"] = e.alignment;\n                if(e.hidden)tmp[\"hidden\"] = true;\n                if(e.type)tmp['type'] = e.type;\n                return tmp;\n\n            });\n            // options作成\n            tmp_searchObj.options = [];\n            let tmpArr;\n            fields.forEach(e => {\n                if('forColumnName' in e){\n                    tmpArr = {searchColumn:e.forColumnName,type:e.type,id:e.id};\n                    if(\"digitsNum\" in e.options)tmpArr[\"digitsNum\"] = e.options.digitsNum;\n                    if(\"alignment\" in e.options)tmpArr[\"alignment\"] = e.options.alignment;\n                    tmp_searchObj.options.push(tmpArr);\n                }\n            });\n            searchArr.push(tmp_searchObj);\n        }\n\n        // lookups作成\n        createLookups(dialogId,'',fields);\n\n        multipleFlg = true;\n    }\n}\n\n// ダイアログテンプレート\nfunction searchDialogTemplate(id,filterHTML,multipleFlg,btnHTML){\n\n    return `\n        <div id=\"${id}Dialog\" class=\"searchDialog\" style=\"display: none; margin-top: 10px;\">\n            ${filterHTML}\n            <div class=\"command-center\">\n                ${multipleFlg ? btnHTML : ''}\n                <button id=\"${id}_close\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" type=\"button\" onclick=\"closeDialog('${id}Dialog',false);\"style='position:relative;'>\n                    <span class=\"ui-button-icon ui-icon ui-icon-cancel\"></span>\n                    <span class=\"ui-button-icon-space\"> </span>終了\n                </button>\n            </div>\n        </div>\n    `;\n}\n\n// ③ダイアログを表示する\n$(document).on('click','.dialogSearch',function(){\n\n    // テーブルの検索機能は各ダイアログファイルに記載\n    if($(this).parent().prop('tagName') == 'TD')return;\n\n    let id = $(this).prev().attr('id');\n\n    const parentClass = $(this).parent().attr('class');\n    let type = '';\n    if(parentClass == 'text-set'){\n        id = id.slice(0,-2);\n        type = 'text-set';\n    }\n    else if(parentClass == 'range-text-container'){\n        id = id.slice(-2) == 'om' ? id.slice(0,-4) : id.slice(0,-2);\n        type = 'range-text';\n    }\n\n\n    let lookup = lookups.find(e => e.id == id);\n    let dialogId = lookup.searchDialog.id;\n    if(dialogId == \"recipientNoSearch\")return;  //納入先CD検索は個別処理\n    if(lookup.searchDialog.multiple)dialogId += \"_multiple\";\n    let title = lookup.searchDialog.title;\n    const width = searchArr.find(e => dialogId == e.dialogId).width;\n\n    if(parentClass == 'text-set'){\n        id += 'From';\n    }\n    else if(parentClass == 'range-text-container'){\n        id = $(this).prev().attr('id');\n    }\n\n    openDialog_for_searchDialog(dialogId,id,width,title)\n\n})\n\nfunction openDialog_for_searchDialog(dialogId,id,width,title){\n    searchOutputId.push({id:id,dialogId:dialogId});\n    $(`#${dialogId}Dialog td`).remove();\n    $(`#${dialogId}Dialog input`).val('');\n    $(`#${dialogId}Dialog`).dialog({\n        modal: true,\n        width: width,\n        resizable: true,\n        title:title,\n    });\n    $(`#${dialogId}Dialog`).css('max-height',\"90vh\");\n    $(`#${dialogId}Dialog`).focus();\n}\n\n\n// 検索ボタンが押されたら検索し、tableに表示\nasync function create_searchList(event){\n\n    showLoading()\n\n    let dialogId = '';\n    if(searchOutputId.length == 0){\n        dialogId = $(event).closest('div.dialog').attr('id');\n    }else{\n        dialogId = searchOutputId[searchOutputId.length -1].dialogId;\n    }\n\n    // アクティブな検索ダイアログの情報を取得\n    let searchDialogData = searchArr.find(e => e.dialogId == dialogId);\n\n    let arr = [];\n    // 簡単なSQL・joinなど複雑なSQL・Pleasanterのテーブルに取得できる処理で分け\n    if(useSqlDialogs.includes(dialogId)){\n        try{\n            arr = await requestSQL(searchDialogData);\n        }catch{\n            return;\n        }\n    }\n    else if(useIndividualSqlDialogs.includes(dialogId)){\n        arr = await requestIndividualSQL(searchDialogData);\n        if(arr == null)return;\n    }\n    else{\n    // それ以外の場合\n        // 検索対象テーブルID\n        let tableId = searchDialogData.searchTableId;\n\n        if(tableId == ''){\n            alert('検索先IDが指定されていません。');\n            return;\n        }\n\n        let columns = [];\n        let filter = {};\n        let filterSearchType = {};\n        // 複数回Getしなきゃいけないテーブルは処理を分ける\n        if(searchDialogData.dialogId == 'auxiliarySubjectSearch'){\n\n            let tmpData = await commonGetData(MASTER_TABLES[\"科目マスタ\"],['ResultId'],{ClassA:$(`#auxiliarySubjectSearch_subjectCD`).val()},{},{ClassA:'ExactMatch'},false,false);\n            if(tmpData.length != 1){\n                alert('科目CDを入力してください。');\n                return;\n            }\n            let KAMOKUCD_resultId = tmpData[0].ResultId;\n            columns = ['ClassC','ClassD'];\n            filter = {\n                ClassA:JSON.stringify([KAMOKUCD_resultId]),\n                ClassC:$('#auxiliarySubjectSearch_auxiliarySubjectCD').val(),\n                ClassD:$('#auxiliarySubjectSearch_teamName').val()\n            };\n            filterSearchType = {\n                ClassA:'ExactMatch',\n                ClassC:'ExactMatch',\n                ClassD:'PartialMatchMultiple',\n            }\n        }\n        else if(searchDialogData.dialogId == 'recipientNoSearch'){\n            let tmpData = await commonGetData(MASTER_TABLES[\"得意先マスタ\"],['ResultId'],{ClassA:$(`#recipientNoSearch_custmerFrom`).val()},{},{ClassA:'ExactMatch'},false,false);\n            if(tmpData.length != 1){\n                alert('得意先CDを入力してください。');\n                return;\n            }\n            columns = ['ClassD','ClassE','ClassF'];\n            const custmerResultId = tmpData[0].ResultId;\n            const receptNo = $('#recipientNoSearch_recipientCD').val();\n            const receptName = $('#recipientNoSearch_recipientName1').val();\n            const furigana = $('#recipientNoSearch_furigana').val();\n            filter = {\n                // ClassA:JSON.stringify(custmerResultId)\n                ClassA:\"223515\"\n            };\n            if(receptNo != \"\")filter[\"ClassD\"] = receptNo;\n            if(receptName != \"\")filter[\"ClassE\"] = receptName;\n            if(furigana != \"\")filter[\"ClassI\"] = furigana;\n\n            filterSearchType = {\n                ClassA:'ExactMatch',\n                ClassD:'PartialMatch',\n                ClassE:'PartialMatch',\n                ClassI:'PartialMatch',\n            }\n        }\n        else{\n            // gridColumns作成\n            columns = searchDialogData.toColumns.map(e => e.ColumnName);\n\n            // ColumnFilterHashとColumnFilterSearchTypes作成\n            searchDialogData.options.forEach(e => {\n                let res = create_filter(e,dialogId);\n                // res = {column:'ClassA',text:''}見本\n                if(Object.keys(res).length == 0){\n                    hideLoading();\n                    return;\n                }\n                filter[res.column] = res.text;\n                filterSearchType[res.column] = res.searchType;\n            });\n        }\n        tableData = await commonGetData(tableId,columns,filter,{},filterSearchType,false,false);\n        tableData.sort((a,b) => a.ClassA-b.ClassA)\n\n\n        if(tableData.length == 0){\n            alert('フィルター条件に合致するデータがありません。');\n            hideLoading();\n            return;\n        }\n        for(record of tableData){\n\n            // 日付はyyyy/mm/dd形式にして代入、Numでnullの場合は0に置換して代入\n            columns.forEach(e =>{\n                switch(e.substring(0,3)){\n                    case 'Num':\n                        record[e] = record[e] == null ? 0:record[e].toLocaleString();\n                        break;\n                    case 'Dat':\n                        // 1899-12-30だったら空文字を返し、それ以外なyyyy/mm/dd形式に置換\n                        if(record[e].substring(0,10) == ''){\n                            record[e] = '';\n                        }else{\n                            let dt = new Date(record[e]);\n                            record[e] = new Intl.DateTimeFormat('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit' }).format(dt);\n                        }\n                        break;\n                    default:\n                        record[e] = record[e];\n                }\n            });\n        }\n        arr = tableData;\n    }\n    let html = '';\n    for(item of arr){\n        if(searchDialogData.multiple  || searchDialogData.dialogId.includes('_multiple')){\n            html += '<tr tabindex=\"0\"><td class=\"searchTd bgc\"><input type=\"checkbox\" ></td>';\n        }else{\n            html += '<tr tabindex=\"0\">';\n        }\n        searchDialogData.toColumns.forEach((e,i) => {\n            if('alignment' in e && 'hidden' in e){\n                html += `<td class=\"searchTd bgc\" style='display:none; text-align:${e.alignment}' >${item[e.ColumnName]}</td>`\n            }\n            else if('alignment' in e){\n                html += `<td class=\"searchTd bgc\" style='text-align:${e.alignment}' >${item[e.ColumnName]}</td>`\n            }\n            else if('hidden' in e){\n                html += `<td class=\"searchTd bgc\" style='display:none;' >${item[e.ColumnName]}</td>`\n            }\n            else{\n                html += `<td class=\"searchTd bgc\">${item[e.ColumnName]}</td>`\n            }\n        });\n        html += \"</tr>\";\n    }\n\n    // 追加する\n    $(`#${dialogId}_${searchDialogData.tableId}_readTable tbody tr`).remove();\n    $(`#${dialogId}_${searchDialogData.tableId}_readTable tbody`).append(html);\n    $(`#${dialogId}_${searchDialogData.tableId}_readTable tbody`).children().eq(0).focus();\n\n    hideLoading();\n}\n\nconst fetchSql = async (query) => {\n    try {\n        showLoading()\n\n        const response = await fetch(SQL_URL, {\n            method: 'POST',\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n                query: query\n            })\n        });\n\n        if (!response.ok) {\n            // レスポンスがエラーの場合\n            throw new Error(`HTTP error! status: ${response.status}`);\n        }\n\n        const data = await response.json();\n        return data;\n    } catch (err) {\n        alert('SQLでエラーが発生しました。' + err);\n        console.error(\"SQLエラー:\", err);\n        return { err: \"Failed to execute SQL query.\" };\n    } finally {\n        hideLoading();\n    }\n\n};\nconst fetchStored = async (param) =>{\n    try {\n        showLoading()\n\n        let response =  await fetch(STORED_PROCEDURE_URL,{\n            method:\"POST\",\n            headers:{\n                \"content-type\":'application/json',\n            },\n            body:JSON.stringify(param)\n        })\n        if(!response.ok){\n            throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        response =  await response.json();\n        return response\n    } catch(err) {\n        alert('ストアドプロシージャでエラーが発生しました。' + err);\n        console.error(\"ストアドエラー:\", err);\n        return { err: \"Failed to execute stored query.\" };\n    } finally {\n        hideLoading();\n    }\n\n}\n\nconst fetchRenderForm = async (param) => {\n    try {\n        showLoading()\n        // クエリーパラメータに変換\n        const queryString = new URLSearchParams(param).toString();\n        const url = `${RENDER_FORM_URL}?${queryString}`;\n\n        // APIの状態チェック\n        const response = await fetch(url);\n        if (!response.ok) {\n            throw new Error(`API error: ${response.status}`);\n        }\n\n        // APIが正常な場合のみ新しいタブを開く\n        window.open(url, '_blank');\n\n    } catch (err) {\n        alert('入力画面生成でエラーが発生しました。' + err);\n        console.error(\"入力画面生成エラー:\", err);\n        return { err: \"Failed to execute input form.\" };\n    } finally {\n        hideLoading();\n    }\n}\n\nconst createWhere = obj =>{\n    let whereStr = 'WHERE 0=0 ';\n    Object.keys(obj).forEach(e =>{\n        if(obj[e] == '' || typeof(obj[e]) === \"undefined\"){\n            return '';\n        }\n        else if(typeof(obj[e]) == 'object'){\n            // fromよりtoのほうが大きい場合は入れ替え\n            let from = obj[e][\"from\"];\n            let to = obj[e][\"to\"];\n            if(from != '' && to != '' && from > to) [from,to] = [to,from];\n\n            // from,toに値がある場合はbetween,片方の場合は比較演算子\n            if(from != '' && to != ''){\n                whereStr += `AND ${e} BETWEEN '${from}' AND '${to}'`;\n            }else if(from != ''){\n                whereStr += `AND ${e} >= '${from}'`;\n            }else if(to != ''){\n                whereStr += `AND ${e} <= '${to}'`;\n            }\n        }\n        else{\n            whereStr += `AND ${e} LIKE '%${obj[e]}%'`;\n        }\n    })\n    return whereStr;\n}\n\nconst resMold = (res,dialogData) => {\n    for(record of res){\n        // 日付はyyyy/mm/dd形式にして代入、Numでnullの場合は0に置換して代入\n        dialogData.toColumns.forEach(e =>{\n            if(record[e.ColumnName] === null){\n                record[e.ColumnName] = '';\n            }\n            else if(typeof record[e.ColumnName] === \"undefined\"){\n                record[e.ColumnName] = '';\n            }\n            else if(e.type == 'time'){\n                record[e.ColumnName] = new Date(record[e.ColumnName]).toLocaleString('sv-SE').replaceAll('-','/');\n            }\n            else if(/^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:\\.\\d+)?$/.test(record[e.ColumnName])){\n                let tmpDt = new Date(record[e.ColumnName]);\n                record[e.ColumnName] = new Intl.DateTimeFormat('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit' }).format(tmpDt);\n            }\n            else if(\"alignment\" in e){\n                record[e.ColumnName] = record[e.ColumnName].toLocaleString();\n                // record[e.ColumnName] = Number(record[e.ColumnName]).toLocaleString();\n            }\n            else{\n                record[e.ColumnName] = record[e.ColumnName];\n            }\n        });\n    }\n    return res;\n}\n\n\nconst createWhereParam = (dialogData) =>{\n    let tmp     = {};\n    dialogData.options.forEach(e =>{\n        let fullId =  'fullId' in e ? e.fullId : dialogData.dialogId + \"_\" + e.id;\n        if(e.type == 'range-text' && \"alignment\" in e){\n            let fromVal = $(`#${fullId}From`).val().replaceAll(',','');\n            let toVal   = $(`#${fullId}To`).val().replaceAll(',','');\n            if((fromVal == '' && toVal == '') || !/^\\d*$/.test(fromVal) || !/^\\d*$/.test(toVal)){\n                tmp[e.searchColumn] = '';\n            }else{\n                tmp[e.searchColumn] = {from:Number(fromVal),to:Number(toVal)};\n            }\n        }\n        else if(e.type.slice(0,5) == 'range'){\n            let fromVal = $(`#${fullId}From`).val();\n            let toVal   = $(`#${fullId}To`).val();\n            if(fromVal == '' && toVal == ''){\n                tmp[e.searchColumn] = '';\n            }else{\n                tmp[e.searchColumn] = {from:fromVal,to:toVal};\n            }\n        }\n        else if(e.type == 'text-set'){\n            tmp[e.searchColumn] = $(`#${fullId}From`).val();\n        }\n        else{\n            tmp[e.searchColumn] = $(`#${fullId}`).val();\n        }\n    })\n    return tmp;\n}\n\n// 簡単なsql用の変数（汎用）\nasync function requestSQL(dialogData){\n\n    // sql文作成\n    // 足し算やcase句など特殊な処理はspecialTermsというパラメータがあるのでそちらを使用\n    let select  = 'selectStr' in dialogData ? dialogData.selectStr :dialogData.toColumns.map(e => {\n        if('specialTerms' in e){\n            return e.specialTerms;\n        }else{\n            return e.ColumnName;\n        }\n    }).join(',');\n    let from    = 'fromStr' in dialogData ? dialogData.fromStr : dialogData.searchTableId;\n\n    // where作成\n    let tmp     = createWhereParam(dialogData);\n    let where = createWhere(tmp);\n\n    if(dialogData.dialogId.includes('estimateNoSearch')){\n        where += \"ORDER BY 見積日付 DESC, 見積番号 DESC\";\n    }\n    let sql = `SELECT TOP 1000 ${select} FROM ${from} ${where}`;\n\n    let res;\n    try{\n        res = await fetchSql(sql);\n    }catch{\n        return;\n    }\n\n    res = res.results;\n\n    // 成形\n    return resMold(res,dialogData);\n\n}\n\n// 複雑なsql用の関数（個別作成）\nasync function requestIndividualSQL(dialogData){\n    // where作成\n    let tmp     = createWhereParam(dialogData);\n    let where = createWhere(tmp);\n    let sql;\n    // if('estimateNoSearch3'.includes(dialogData.dialogId)){\n    if(['estimateNoSearch3','estimateNoSearch3_multiple'].includes(dialogData.dialogId)){\n\n        let copy_dialogData = JSON.stringify(dialogData);\n        copy_dialogData = JSON.parse(copy_dialogData);\n        copy_dialogData.options = [\n            {searchColumn: 'MS.仕入先CD', type: 'range-text', id: 'supplierCD'}\n        ];\n        where2_param = createWhereParam(copy_dialogData);\n        let where2 = createWhere(where2_param);\n\n        sql = estimateNoSearch3_baseSQL(where,where2).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['estimateNoSearch4','estimateNoSearch4_multiple'].includes(dialogData.dialogId)){\n        sql = estimateNoSearch4_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['estimateNoSearch5','estimateNoSearch5_multiple'].includes(dialogData.dialogId)){\n        sql = estimateNoSearch5_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['mirrorSearch',\"mirrorSearch_multiple\"].includes(dialogData.dialogId)){\n        sql = mirrorSearch_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['urikakeKakuninSearch'].includes(dialogData.dialogId)){\n        sql = urikakeKakunin_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['productSearch1'].includes(dialogData.dialogId)){\n        sql = productSearch1_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if(['productSearch2'].includes(dialogData.dialogId)){\n        sql = productSearch2_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    else if('progressCheck'.includes(dialogData.dialogId)){\n        // 売上種別\n        let salesType = '';\n        switch($('#progressCheck_processingCategoryFrom').val()){\n            case '0':\n                salesType = ' AND (MHK.発注書発行日付 IS NULL AND MT.仕入日付 IS NULL)';\n                break;\n            case '1':\n                salesType = 'AND MHK.発注書発行日付 IS NOT NULL';\n                break;\n            case '2':\n                salesType = \"AND MT.売上日付 IS NOT NULL\";\n                break;\n        }\n\n        // 見積確定区分\n        let finalClassification = '';\n        switch($('#progressCheck_confirmationEstimateDatesFrom').val()){\n            case '0':\n                finalClassification = \"AND ISNULL(MHK.見積確定区分,0) = 0\";\n                break;\n            case '1':\n                finalClassification = \"AND ISNULL(MHK.見積確定区分,0) = 1\";\n        }\n        where += salesType + finalClassification;\n        sql = progressCheck_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    // 入金消込入力はストアドのため特殊処理\n    else if('ReceiptEntry'.includes(dialogData.dialogId)){\n\n        await receiptEntry_stored();\n        return null;\n    }\n    // 売上入力\n    else if('salesInput'.includes(dialogData.dialogId)){\n\n    }\n    // 売掛消費税調整入力\n    else if(['ReceivableSalesTaxAdjustmentEntrySearch'].includes(dialogData.dialogId)){\n        sql = ReceivableSalesTaxAdjustmentEntrySearch_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n\n    // 売掛消費税調整入力\n    else if(['ReceivableSalesTaxAdjustmentEntry'].includes(dialogData.dialogId)){\n        sql = ReceivableSalesTaxAdjustmentEntry_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n    }\n    \n    // 経費入力\n    else if(['ExpenseEntrySearch'].includes(dialogData.dialogId)){\n\n        let personCD = '';\n        let personCDFrom = $('#ExpenseEntrySearch_personCDFrom').val();\n        let personCDTo = $('#ExpenseEntrySearch_personCDTo').val();\n        \n        // 担当者Fromのみ入力\n        if(!personCDFrom == '' && personCDTo == ''){\n            personCD = `AND KH.経費番号 IN (SELECT DISTINCT 経費番号 FROM TD経費明細 WHERE 担当者CD >= '${personCDFrom}')`;\n        }\n        // 担当者Toのみ入力\n        else if(personCDFrom == '' && !personCDTo == ''){\n            personCD = `AND KH.経費番号 IN (SELECT DISTINCT 経費番号 FROM TD経費明細 WHERE 担当者CD <= '${personCDTo}')`;\n        }\n        // 担当者FromTo\n        else if(!personCDFrom == '' && !personCDTo == ''){\n            personCD = `AND KH.経費番号 IN (SELECT DISTINCT 経費番号 FROM TD経費明細 WHERE 担当者CD BETWEEN '${personCDFrom}' AND '${personCDTo}')`;\n        }\n        \n        where += personCD\n\n        sql = ExpenseEntrySearch_baseSQL(where).replaceAll('\\n',' ').replaceAll(/\\s{2,}/g, ' ');\n\n\n    }\n\n    let res;\n    try{\n        res = await fetchSql(sql);\n    }catch{\n        return;\n    }\n\n    res = res.results;\n    return resMold(res,dialogData);\n}\n\n// apiget用のColumnFilterHashとColumnFilterSearchTypesを作成する関数\nfunction create_filter(e,dialogId){\n    let res = {};\n    switch(e.type){\n        case 'text':\n            let val = $(`#${dialogId}_${e.id}`).val();\n            // エラー処理\n            if(val == ''){\n                return {};\n            }\n            res =  {column:e.searchColumn,text:val,searchType:'PartialMatch'};\n            break;\n        case 'number':\n            num = $(`#${dialogId}_${e.id}`).val().replaceAll(',','');\n            // エラー処理\n            if(num == ''){\n                return {};\n            }\n            res =  {column:e.searchColumn,text:num,searchType:'ExactMatch'};\n            break;\n        case 'range-text':\n            let fromVal = $(`#${dialogId}_${e.id}From`).val();\n            let toVal = $(`#${dialogId}_${e.id}To`).val();\n\n            if(fromVal == '' && toVal == ''){\n                return {};\n            }\n\n            // 検索先項目がNumかどうかで処理を分ける\n            let arr = [];\n            if(e.searchColumn.substring(0,3) == 'Num'){\n                arr = JSON.stringify([`${fromVal},${toVal}`]);\n\n            }\n            else{\n                // 数値項目ではない場合。数値化して全パターン取得\n                fromVal = fromVal == '' ? \"0\".repeat(e.digitsNum) : fromVal;\n                toVal = toVal == '' ? \"9\".repeat(e.digitsNum):toVal;\n\n                for(i = Number(fromVal); i <= Number(toVal); i++){\n                    arr.push(String(i).padStart(e.digitsNum,'0').slice(`-${e.digitsNum}`));\n                }\n                arr = JSON.stringify(arr);\n            }\n            res = {column:e.searchColumn,text:arr,searchType:'ExactMatchMultiple'}\n            break;\n        case 'range-number':\n            let fromNum = $(`#${dialogId}_${e.id}From`).val();\n            let toNum = $(`#${dialogId}_${e.id}To`).val();\n\n            if(fromNum == '' && toNum == ''){\n                return {};\n            }\n            let numArr = JSON.stringify([`${fromNum},${toNum}`]);\n            res = {column:e.searchColumn,text:numArr,searchType:'ExactMatchMultiple'}\n\n\n            break;\n        case 'datepicker':\n\n            let dt = $(`#${dialogId}_${e.id}`).val();\n            if(dt == ''){\n                return {};\n            }\n            res = {column:e.searchColumn,text:JSON.stringify([dt.replace('-','/')]),searchType:'ExactMatch'}\n            break;\n        case 'range-date':\n            let dtFrom = $(`#${dialogId}_${e.id}From`).val();\n            let dtTo = $(`#${dialogId}_${e.id}To`).val();\n\n            if(dtFrom == '' && dtTo == ''){\n                return {};\n            }\n\n            let dates = JSON.stringify([`${dtFrom.replaceAll('-','/')},${dtTo.replaceAll('-','/')}`]);\n            res =  {column:e.searchColumn,text:dates,searchType:'ExactMatchMultiple'};\n            break;\n    }\n    return res;\n}\n\n// 選択されたときの処理\n$(document).on('click','tr:has(\".searchTd\")',function(e){\n\n\n    let item = $(this);\n\n    // ふくすう選択ダイアログなら処理終了\n    if(item.children().eq(0).children().eq(0).attr('type')){\n        // inputがクリックされていたら処理終了\n        if($(e.target).is('input')){\n            return;\n        }\n        item.find('input:first').prop('checked', function( index, prop ){\n            return !prop;\n        });\n        return;\n    }\n\n    if(searchOutputId.length == 0 || searchOutputId[searchOutputId.length -1].id == \"\")return;\n\n    if(searchOutputId[searchOutputId.length - 1].id == \"changeProductDialog_productNo\"){\n        $(`#changeProductDialog_productNo`).val(item.children().eq(0).text().replaceAll(' ',''));\n        $(`#changeProductDialog_methodNo`).val(item.children().eq(1).text().replaceAll(' ',''));\n        $(`#changeProductDialog_productName`).val(item.children().eq(2).text().replaceAll(' ',''));\n    }\n    else if(searchOutputId[searchOutputId.length - 1].id == \"changeProductDialog_AfterChangeNo\" ){\n        $(`#changeProductDialog_AfterChangeNo`).val(item.children().eq(0).text().replaceAll(' ',''));\n        $(`#changeProductDialog_AfterMethodNo`).val(item.children().eq(1).text().replaceAll(' ',''));\n        $(`#changeProductDialog_AfterProductName`).val(item.children().eq(2).text().replaceAll(' ',''));\n    }\n    else{\n        $(`#${searchOutputId[searchOutputId.length -1].id}`).val(item.children()[0].textContent).trigger('input');\n    }\n\n    $(`#${searchOutputId[searchOutputId.length -1].dialogId}Dialog tbody`).html('');\n    $(`#${searchOutputId[searchOutputId.length -1].dialogId}Dialog`).dialog('close');\n    searchOutputId.pop();\n})\n\n// マウスオーバー時のイベント\n$(document).on('mouseover','.bgc',function(){\n    $('.bgc').parent().css('background-color','');\n    $(this).parent().css('background-color','silver')\n})\n$(document).on('mouseout','.bgc',function(){\n    $('.bgc').parent().css('background-color','');\n})\n\n// ダイアログを閉じるボタンが押された時の処理\n$(document).on('click','.ui-dialog-titlebar-close',function(){\n    let elem = $(this).parent().parent().next();\n    var prevObjectElement = elem.prevObject[0];\n\n    // prevObjectElementの子要素の中に'searchDialog'クラスを持つ要素があるかをチェック\n    var hasSearchDialogClass = $(prevObjectElement).children().hasClass('searchDialog');\n    if(hasSearchDialogClass){\n        searchOutputId.pop();\n    }\n})\n\n// エスケープで閉じる機能を廃止のためコメントアウト\n// escapeが押されたらsearchOutputIdの末尾を削除\n// $(document).keydown(async function(e){\n//     const key = e.keyCode;\n//     if(key != 27){\n//         return;\n//     }\n//     // dialogでエスケープキーを閉じるときのバリデーション対策\n//     now_varidate_flg = true;\n//     await sleep(0);\n//     now_varidate_flg = false;\n//     searchOutputId.pop();\n\n//     // 閉じたdialogを削除\n// })\n\n// 複数選択ダイアログで、チェックマークが入っている項目をカンマ区切りで呼出元項目に入力する関数\nfunction resultInput(event){\n\n\n    let items = Array.from($(`#${searchOutputId[searchOutputId.length-1].dialogId}Dialog tbody input[type=\"checkbox\"]:checked`));\n\n    if(items.length == 0){\n        alert('選択されていません。');\n        return;\n    }\n\n    let resText = items.map(e => $(e).parent().parent().children().eq(1).text()).join(',');\n    $(`#${searchOutputId[searchOutputId.length -1].id}`).val(resText).trigger('input');\n    $(`#${searchOutputId[searchOutputId.length -1].dialogId}Dialog`).dialog('close');\n    searchOutputId.pop();\n}\n\n$(document).on('click','.ui-dialog-titlebar-close',function(){\n    let element = $(this).parent().parent();\n    element.find('table.searchTable tbody').html('');\n})\n\n$(document).on('keydown','tr:has(\".searchTd\")',function(e){\n    if(e.which == 13){\n        $(this).trigger('click');\n    }\n})",
            "Id": 13
          },
          {
            "Title": "22_ダイアログ共通.js",
            "New": true,
            "Edit": true,
            "Body": "//lookupするための情報と、どの検索ダイアログを開くかの情報を格納\nlet lookups = [];\n\n// 現在開いているダイアログの情報（古い順に入ってる）\nlet searchOutputId = [];\n\n// 各検索ダイアログの情報。ダイアログ作成時に作成\nlet searchArr = [\n    // {dialogId:'estimateNoSearch',searchTableId:'1273239',options:[\n    //         {type:\"range-text\",id:'estimateNo',searchColumn:'ClassA',digitsNum:6},\n    //         {type:\"range-date\",id:'billingDate',searchColumn:'DateB'},\n    //         {type:\"text\",id:'custmerCD',searchColumn:'ClassP'},\n    //         {type:\"range-number\",id:'AllMoney',searchColumn:'NumA'},\n    //         {type:\"range-date\",id:'estimateDate',searchColumn:'DateA'},\n    //         {type:\"text\",id:'estimateName',searchColumn:'ClassJ'},\n    //     ]\n    // }\n];\n\n// ダイアログが開かれた時間を格納\nlet dialog_openTime;\n\nconst styleElement = document.createElement('style');\nstyleElement.textContent = `\n    .loading-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.5);\n        z-index: 9999;\n        display: none;\n        justify-content: center;\n        align-items: center;\n    }\n\n    .loading-spinner {\n        width: 50px;\n        height: 50px;\n        border: 5px solid #f3f3f3;\n        border-top: 5px solid #3498db;\n        border-radius: 50%;\n        animation: spin 1s linear infinite;\n    }\n\n    @keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n    }\n\n    .searchDialog input:disabled,\n    .dialog input:disabled,\n    .dialog select:disabled,\n    .dialog textarea:disabled {\n        background-color: #f0f0f0;\n        color: #888;\n        cursor: not-allowed;\n    }\n    .dialog .error {\n        border: 1px solid red;\n    }\n    .dialog .error-message {\n        color: red;\n        font-size: 0.8em;\n        margin-top: 5px;\n    }\n    .field-wide {\n        width: 100%;\n        max-width:800px;\n    }\n    .field-normal {\n        width: 60%;\n        max-width:450px;\n    }\n    .both {\n        clear: both;\n        min-height:37px;\n        padding-bottom:5px;\n        height:37px;\n    }\n    .range-container {\n        display: flex;\n        align-items: center;\n    }\n    .range-input {\n        flex-grow: 1;\n        margin: 0 10px;\n        -webkit-appearance: none;\n        width: 100%;\n        height: 5px;\n        background: #d3d3d3;\n        outline: none;\n        opacity: 0.7;\n        transition: opacity .2s;\n    }\n    .range-input:hover {\n        opacity: 1;\n    }\n    .range-input::-webkit-slider-thumb {\n        -webkit-appearance: none;\n        appearance: none;\n        width: 15px;\n        height: 15px;\n        background: #4CAF50;\n        cursor: pointer;\n        border-radius: 50%;\n    }\n    .range-input::-moz-range-thumb {\n        width: 15px;\n        height: 15px;\n        background: #4CAF50;\n        cursor: pointer;\n        border-radius: 50%;\n    }\n    .range-label {\n        min-width: 30px;\n        text-align: center;\n    }\n    .range-text-container {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .oneItem{\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .text-set{\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .range-text-input {\n        width: 45%;\n    }\n    .range-text-separator {\n        margin: 0 10px;\n    }\n    .SdtRequired::after {\n        content: \"*\";\n        color: red;\n        margin-left: 3px;\n    }\n    .radioButton{\n        padding-top:7px;\n    }\n    .radioButton input[type=\"radio\"]{\n        vertical-align: sub;\n    }\n    .inputText{\n        width:20%;\n    }\n    .disableText{\n        width:80%;\n    }\n    .SdtTime{\n        /* position: absolute;\n        top:9px;\n        right:-17px;\n        z-index: 10; */\n        cursor:pointer;\n    }\n    .ui-icon-search{\n        position: absolute;\n        top:9px;\n        right:-17px;\n        z-index: 10;\n        cursor:pointer;\n    }\n    .ui-icon-close{\n        position: absolute;\n        top:9px;\n        right:-33px;\n        z-index: 10;\n        cursor: pointer;\n    }\n    .search{\n        position:static;\n    }\n    .button-small {\n        background: linear-gradient(145deg, #f8f8f8, #efefef);\n        border-radius: 5px;\n        color: #555;\n        text-align: center;\n        cursor: pointer;\n        transition: all 0.15s ease;\n    }\n    .button-small:hover {\n        background: linear-gradient(145deg, #f2f2f2, #e8e8e8);\n    }\n    .button-small:active {\n        background: linear-gradient(145deg, #e8e8e8, #f2f2f2);\n        transform: translateY(0.5px);\n    }\n    td > input:focus{\n        border:none;\n        background-color:white;\n    }\n    td > input:focus-visible {\n        outline:none;\n        box-shadow:none;\n    }\n    tr:focus{\n        border:none;\n        background-color: #d3d3d3;\n    }\n    tr:focus-visible{\n        outline: none;\n    }\n    .table {\n        border-collapse: separate;/*collapseから変更*/\n        border-spacing: 0;\n        border-radius: 5px 5px 0 0;\n        /* overflow: hidden; */\n    }\n\n    .table thead th,\n    .table tbody td {\n        border-bottom: 1px solid rgb(192, 192, 192);/*一括指定せず、border-bottomのみ*/\n        border-left: 1px solid rgb(192, 192, 192);\n    }\n    .table tr th:first-child,\n    .table tbody tr td:first-child {\n        border-left: none;\n    }\n    td{\n        width:auto;\n    }\n    .input_table input:disabled{\n        background-color:white;\n    }\n\n`;\n// スタイルを追加\ndocument.head.appendChild(styleElement);\n\n// フィールド作成の関数\nconst createField = (dialogId, type, id, label, options = {},multipleFlg = false) => {\n    const fullId = `${dialogId}_${id}`;\n    if (document.getElementById(fullId)) {\n        let message = `フィールドID \"${fullId}\" は既に存在します。一意のIDを使用してください。`;\n        alert(message)\n        throw new Error(message);\n    }\n\n    const hiddenAttr = options.hidden ? 'display:none':\"\";\n    const disabledAttr = options.disabled ? 'disabled' : '';\n    const requiredAttr = options.required ? 'required' : '';\n    const additionalAttrs = Object.entries(options.attributes || {})\n        .map(([key, value]) => `${key}=\"${value}\"`)\n        .join(' ');\n    const widthClass = options.width === 'wide' ? 'field-wide' : 'field-normal';\n    const requiredClass = requiredAttr == 'required' ? \"SdtRequired\" : '';\n    const maxLength = options.varidate && 'maxlength' in options.varidate ? options.varidate.maxlength : null;\n    const maxlengthForNumberClass = type == 'number' && options.varidate && 'maxlength' in options.varidate ? `maxlength_for_number` : \"\";\n    \n    // バリデーション\n    let varidateClass = \"\";\n    let numOnlyClass = \"\";\n    if(options.varidate && options.varidate.type == \"int\"){\n        varidateClass = 'varidate_int';\n        numOnlyClass = options.searchDialog || ('alignment' in options && options.alignment == 'end') ? \"numOnly\" : \"\";\n    }\n    else if(options.varidate && options.varidate.type == 'zeroPadding'){\n        varidateClass = 'varidate_zeroPadding';\n        numOnlyClass = options.searchDialog ? \"numOnly\" : \"\";\n    }\n    else if(options.varidate && options.varidate.type == 'str'){\n        varidateClass = 'varidate_str';\n    }\n\n    if(['text-set','select','radio'].includes(type) && !('values' in options) && !('searchDialog' in options)  && !(options.disabled)){\n        let message = `ダイアログ名:\"${dialogId}\"　項目ID:\"${id}\" の選択肢（values）を指定してください`;\n        alert(message)\n        throw new Error(message);\n    }\n\n    let t_head = '';\n    let fieldHTML = '';\n    switch(type) {\n        case 'text':\n        case 'number':\n        case 'email':\n\n            const initializeClass = options.value ? 'initialize_target':'';\n\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\" >\n                        <div class=\"container-normal\">\n                            <div class=\"oneItem\">\n                                <input id=\"${fullId}\" name=\"${fullId}\" class=\"control-textbox ${numOnlyClass} ${initializeClass} ${'alignment' in options && options.alignment == 'end' ? 'input-Number' :''} ${maxlengthForNumberClass} ${varidateClass}\" type=\"${type}\"\n                                    ${options.placeholder ? `placeholder=\"${options.placeholder}\"` : ''}\n                                    ${options.value ? `value=\"${options.value}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}\n                                    ${maxLength != null ? `maxlength='${maxLength}'` : ''}\n                                    style='${'alignment' in options ? `text-align:${options.alignment}` : ''}'\n                                >\n                                ${options.unit ?`<div style=\"font-size:12px; padding-left: 3px;\">${options.unit}</div>`: ''}\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-search dialogSearch ${varidateClass}\" style=\"position:static\" tabindex=\"0\"></div>`: ''}\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}')\"style=\"position:static\"></div>`: ''}\n                        </div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'select':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <select id=\"${fullId}\" name=\"${fullId}\" class=\"control-dropdown\"\n                                ${options.onchange ? `onchange=\"${options.onchange}('${dialogId}', '${id}')\"` : ''}\n                                ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                                <option value=\"\">&nbsp;</option>\n                                ${options.values ? options.values.map(opt => `<option value=\"${opt.value}\" ${opt.selected ? 'selected' : ''}>${opt.text}</option>`).join('') : ''}\n                            </select>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'datepicker':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"${fullId}\" name=\"${fullId}\" class=\"control-textbox ${varidateClass}\" type=${options.format ? options.format : \"date\"} max=\"${options.format && options.format == 'month' ? '9999-12':'9999-12-31'}\"\n                                ${options.placeholder ? `placeholder=\"${options.placeholder}\"` : ''}\n                                ${options.value ? `value=\"${options.value}\"` : ''}\n                                autocomplete=\"off\"\n                                ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                            <div class=\"ui-icon ui-icon-clock SdtTime\" style=\"position:static\"></div>\n                        </div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'textarea':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"field-wide both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <div id=\"${fullId}_viewer\" class=\"control-markup not-send\" ondblclick=\"editMarkdown('${dialogId}', '${id}');\">\n                                <pre>${options.value ? options.value : '<br>'}</pre>\n                            </div>\n                            <div id=\"${fullId}.editor\" class=\"ui-icon ui-icon-pencil button-edit-markdown\" onclick=\"editMarkdown('${dialogId}', '${id}');\">\n                            </div>\n                            <textarea id=\"${fullId}\" name=\"${fullId}\" class=\"control-markdown\" tabindex=\"-1\"\n                                ${options.placeholder ? `placeholder=\"${options.placeholder}\"` : ''}\n                                style=\"height: 100px; display: none;\"\n                                ${disabledAttr} ${requiredAttr} ${additionalAttrs}>${options.value ? options.value : ''}</textarea>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'checkbox':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <input id=\"${fullId}\" name=\"${fullId}\" type=\"checkbox\"\n                                ${options.checked ? 'checked' : ''}\n                                ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                            <label for=\"${fullId}\" class=\"${requiredClass}\">${label}</label>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'radio':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label ${requiredClass}\" >${label}</p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal radioButton\">\n                            ${options.values ? options.values.map(opt => `\n                                <input type=\"radio\" id=\"${fullId}_${opt.value}\" name=\"${fullId}\" value=\"${opt.value}\"\n                                    ${opt.checked ? 'checked' : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                                <label for=\"${fullId}_${opt.value}\">${opt.text}</label>\n                            `).join('') : ''}\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'range':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}\"  class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <div class=\"range-container\">\n                                <span class=\"range-label\">${options.min || 0}</span>\n                                <input id=\"${fullId}\" name=\"${fullId}\" class=\"range-input\" type=\"range\"\n                                    min=\"${options.min || 0}\" max=\"${options.max || 100}\"\n                                    value=\"${options.value || options.min || 0}\"\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}\n                                    oninput=\"document.getElementById('${fullId}Value').textContent = this.value\">\n                                <span class=\"range-label\">${options.max || 100}</span>\n                            </div>\n                            <div id=\"${fullId}Value\" style=\"text-align: center;\">${options.value || options.min || 0}</div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'range-text':\n        case 'range-number':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}From\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <div class=\"range-text-container\">\n                                <input id=\"${fullId}From\" name=\"${fullId}From\" class=\"control-textbox range-text-input ${numOnlyClass} ${'alignment' in options && options.alignment == 'end' ? 'input-Number' :''} ${maxlengthForNumberClass} ${varidateClass}\" type=\"${type=='range-text'?'text':'number'}\"\n                                    ${options.placeholderFrom ? `placeholder=\"${options.placeholderFrom}\"` : ''}\n                                    ${options.valueFrom ? `value=\"${options.valueFrom}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}\n                                    style='${'alignment' in options ? `text-align:${options.alignment}` : ''}'\n                                    ${maxLength != null ? `maxlength='${maxLength}'` : ''}\n                                >\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-search dialogSearch ${varidateClass}\" style=\"position:static\" tabindex=\"0\"></div>`: ''}\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}From')\"  style=\"position:static\"></div>`: ''}\n                                <span class=\"range-text-separator\">${options.betweenString ? options.betweenString : '～'}</span>\n                                <input id=\"${fullId}To\" name=\"${fullId}To\" class=\"control-textbox range-text-input ${numOnlyClass} ${'alignment' in options && options.alignment == 'end' ? 'input-Number' :''} ${maxlengthForNumberClass} ${varidateClass}\" type=\"${type=='range-text'?'text':'number'}\"\n                                    ${options.placeholderTo ? `placeholder=\"${options.placeholderTo}\"` : ''}\n                                    ${options.valueTo ? `value=\"${options.valueTo}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}\n                                    style='${'alignment' in options ? `text-align:${options.alignment}` : ''}'\n                                    ${maxLength != null ? `maxlength='${maxLength}'` : ''}\n                                >\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-search dialogSearch ${varidateClass}\" style=\"position:static\" tabindex=\"0\"></div>`: ''}\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}To')\"  style=\"position:static\"></div>`: ''}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'range-date':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"${widthClass} both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}From\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <div class=\"range-text-container\">\n                                <input id=\"${fullId}From\" name=\"${fullId}From\" class=\"control-textbox ${varidateClass}\" type=${options.format ? options.format : \"date\"} max=\"${options.format && options.format == 'month' ? '9999-12':'9999-12-31'}\"\n                                    ${options.placeholderFrom ? `placeholder=\"${options.placeholderFrom}\"` : ''}\n                                    ${options.valueFrom ? `value=\"${options.valueFrom}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                                <span class=\"range-text-separator\">～</span>\n                                <input id=\"${fullId}To\" name=\"${fullId}To\" class=\"control-textbox ${varidateClass}\" type=${options.format ? options.format : \"date\"} max=\"${options.format && options.format == 'month' ? '9999-12':'9999-12-31'}\"\n                                    ${options.placeholderTo ? `placeholder=\"${options.placeholderTo}\"` : ''}\n                                    ${options.valueTo ? `value=\"${options.valueTo}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'text-set':\n            fieldHTML = `\n                <div id=\"${fullId}Field\" class=\"field-wide both\" style=\"${hiddenAttr}\">\n                    <p class=\"field-label\"><label for=\"${fullId}From\" class=\"${requiredClass}\">${label}</label></p>\n                    <div class=\"field-control\">\n                        <div class=\"container-normal\">\n                            <div class=\"text-set\">\n                                <input id=\"${fullId}From\" name=\"${fullId}From\" class=\"control-textbox inputText ${varidateClass}\" type=\"${'type' in options ? options.type : 'text'}\"\n                                    ${options.placeholderFrom ? `placeholder=\"${options.placeholderFrom}\"` : ''}\n                                    ${options.valueFrom ? `value=\"${options.valueFrom}\"` : ''}\n                                    ${disabledAttr} ${requiredAttr} ${additionalAttrs}\n                                    ${maxLength != null ? `maxlength='${maxLength}'` : ''}\n                                >\n                                <input id=\"${fullId}To\" name=\"${fullId}To\" value=\"${options.values ? options.values.map(e => e.value + \":\" + e.text).join(' '):''}\" class=\"control-textbox disableText\" type=\"text\" disabled>\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-search dialogSearch ${varidateClass}\" style=\"position: static;\" tabindex=\"0\"></div>`: ''}\n                                ${options.searchDialog ?`<div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}From')\"style=\"position: static;\"></div>`: ''}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"error-message\" id=\"${fullId}-error\"></div>\n                </div>\n            `;\n            break;\n        case 'button_block':\n            fieldHTML = `\n                <div style=\"width:80%; display: flex;justify-content: end; margin-bottom:10px;\">\n                    <button id=${fullId} class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" data-icon=\"ui-icon-disk\" type=\"button\" style=\"z-index: 9999;\" onclick=\"${options.onclick}\">\n                        <span class=\"ui-button-icon ui-icon ui-icon-disk \" style=\"position: static;\"></span>\n                        <span class=\"ui-button-icon-space\"> </span>${label}\n                    </button>\n                </div>\n            `\n            break;\n        case 'button_inline':\n            fieldHTML = `\n                <button id=${fullId} class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" data-icon=\"ui-icon-disk\" type=\"button\" style=\"z-index: 9999; ${hiddenAttr}\" onclick=\"${'onclick' in options ? options.onclick : ''}\">\n                    <span class=\"ui-button-icon ui-icon ui-icon-disk \" style=\"position: static;\"></span>\n                    <span class=\"ui-button-icon-space\"> </span>${label}\n                </button>\n            `\n            break;\n        case 'buttonTextSet':\n            fieldHTML = `\n                <div class=\"input-button-container\" style=\"clear: both; padding: 10px; border:1px solid #ccc; border-radius: 5px; width: 95%; margin: 0 auto; margin-bottom: 20px;\">\n                    <label for=\"my-input\" class=\"label\" style=\"top:-20px; left:10px; background-color: rgb(254,238,189); padding:0 10px;\">${label}</label>\n                    <span style=\"display: none;\">\n                        <input style=\"display: inline-block; left: 30px; position: absolute;border: 1px solid rgb(192,192,192); width: 75%; height: 24px; border-radius: 5px;\">\n                        <button class=\"button button-icon ui-button ui-corner-all ui-widget applied changePath customized\" type=\"button\" style=\"float: right; top:-4px;\" >\n                            <span class=\"ui-button-icon ui-icon ui-icon-disk\"></span>\n                            <span class=\"ui-icon-disk\"> </span>登録\n                        </button>\n                    </span>\n                    <span>\n                        <span style=\"display: inline-block; left: 30px; position: absolute;\"></span>\n                        <button class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" type=\"button\" style=\"float: right; top:-4px;\" onclick=\"${options.onclick ? options.onclick : ''}\">\n                            <span class=\"ui-button-icon ui-icon ui-icon-disk\"></span>\n                            <span class=\"ui-icon-disk\"> </span>${options.btnLabel}\n                        </button>\n                    </span>\n                </div>\n            `\n            break;\n        case 'ImportFile':\n            fieldHTML = `\n                <div class=\"input-button-container\" style=\"clear: both; padding: 10px; border:1px solid #ccc; border-radius: 5px; width: 95%; margin: 0 auto; margin-bottom: 20px;\">\n                    <label for=\"my-input\" class=\"label\" style=\"top:-20px; left:10px; background-color: rgb(254,238,189); padding:0 10px;\">${label}</label>\n                    <input type=\"file\" id=\"${id}\" accept=\"${options.fileType}\">\n                </div>\n            `\n            break;\n        case 'borderText':\n            fieldHTML = `\n                <div class=\"input-container\" style=\"clear: both; padding: 10px; border:1px solid #ccc; border-radius: 5px; width: 95%; margin: 0 auto;\">\n                    <label for=\"my-input\" class=\"label\" style=\"top:-20px; left:10px; background-color: rgb(254,238,189); padding:0 10px;\">${label}</label>\n                    <span style=\"display: inline-block; left: 30px; position: absolute;\"></span>\n                </div>\n            `\n            break;\n        case 'input-table':\n            // thead作成\n            t_head = '';\n            if(options.multiple || multipleFlg)t_head += `<th style=\"text-align: center;border-collapse: collapse;\" class='inversion'><input type=\"checkbox\" class=\"allCheck\"></th>`;\n            if(options.lineNumber)t_head += `<th>No</th>`\n            t_head += options.t_heads.map(e => `<th style=\"text-align: center;border-collapse: collapse; ${e.width ?'width:'+ e.width + \";\":''}\">${e.label}</th>`).join('');\n            // tbody作成\n            let t_body = '';\n            columnCou = options.t_heads.length;\n            for(i = 0;i < options.row;i++){\n                t_body += \"<tr style='background-color:white !important'>\";\n                t_body += options.multiple || multipleFlg ?  `<td class='inversion'><input type='checkbox'></td>` : ``;\n                t_body += options.lineNumber ? `<td style=\"text-align:center;\">${i + 1}</td>` : '';\n                options.t_heads.forEach((e,j) =>{\n                    let for_numItem = false;\n                    if('alignment' in e)for_numItem = true;\n\n                    const maxlength = e.varidate && 'maxLength' in e.varidate ? `maxlength=\"${e.varidate.maxLength}\" `: \"\";\n                    const maxlengthFrom = e.varidateFrom && 'maxLength' in e.varidateFrom ? `maxlength=\"${e.varidateFrom.maxLength}\" `: \"\";\n                    const maxlengthTo = e.varidateTo && 'maxLength' in e.varidateTo ? `maxlength=\"${e.varidateTo.maxLength}\" `: \"\";\n\n                    let varidateClass = \"\";\n                    if(e.varidate && e.varidate.type == \"int\"){\n                        varidateClass = 'varidate_int';\n                    }\n                    else if(e.varidate && e.varidate.type == 'zeroPadding'){\n                        varidateClass = 'varidate_zeroPadding';\n                    }\n                    else if(e.varidate && e.varidate.type == 'str'){\n                        varidateClass = 'varidate_str';\n                    }\n\n                    let varidateFromClass = \"\";\n                    if(e.varidateFrom && e.varidateFrom.type == \"int\"){\n                        varidateFromClass = 'varidate_int';\n                    }\n                    else if(e.varidateFrom && e.varidateFrom.type == 'zeroPadding'){\n                        varidateFromClass = 'varidate_zeroPadding';\n                    }\n                    else if(e.varidateFrom && e.varidateFrom.type == 'str'){\n                        varidateFromClass = 'varidate_str';\n                    }\n\n                    let varidateToClass = \"\";\n                    if(e.varidateTo && e.varidateTo.type == \"int\"){\n                        varidateToClass = 'varidate_int';\n                    }\n                    else if(e.varidateTo && e.varidateTo.type == 'zeroPadding'){\n                        varidateToClass = 'varidate_zeroPadding';\n                    }\n                    else if(e.varidateTo && e.varidateTo.type == 'str'){\n                        varidateToClass = 'varidate_str';\n                    }\n\n\n                    const table_requiredAttr_from = e.requiredFrom ? 'required':'';\n                    const table_requiredAttr_to = e.requiredTo ? 'required':'';\n                    const table_requiredAttr = e.required ? 'required':'';\n                    switch (e.type){\n                        case 'text-set':\n                            const disabled_from   = e.disabled ? 'disabled' : '';\n                            const disabled_to     = 'to_disabled' in e && !e.to_disabled ? '':'disabled';\n                            \n                            t_body += `\n                                <td id=\"${fullId}_${i}_${j}\">\n                                    <input id=\"${fullId}_${i}_${j}_From\" class=\"${`${fullId}_${j}`} ${varidateFromClass} ${for_numItem ? 'input-Number':''}\" type=\"text\" style='border:none; height:50%; \n                                        width:${e.search ? \"calc(100% - 39px)\":'100%'}; ${for_numItem ? `text-align:${e.alignment}`:''}' ${disabled_from} ${maxlengthFrom} ${table_requiredAttr_from}\n                                    >\n                                    ${e.search ? `<div class=\"ui-icon ui-icon-search tableInSearch ${varidateFromClass}\" style=\"position: static;\" tabindex=\"0\"></div>`: ''}\n                                    ${e.search ? `<div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}_${i}_${j}_From')\"style=\"position: static;\"></div>`:''}\n                                    <input type=\"text\" id=\"${fullId}_${i}_${j}_To\" class=\"${for_numItem ? 'input-Number':''} ${varidateToClass} ${`${fullId}_${j}_to`}\"\n                                        style='border: none; border-top:dashed rgb(192,192,192) 1px; height:50%; width:100%; background-color: white;${for_numItem ? `text-align:${e.alignment}`:''}' ${disabled_to}\n                                        ${table_requiredAttr_to}${maxlengthTo}\n                                    >\n                                </td>\n                            `;\n                            break;\n                        case 'date':\n                            t_body += `\n                                <td id=\"${fullId}_${i}_${j}\">\n                                    <input type=\"date\" style='border:none; height:100%; width:100%' ${e.disabled ? 'disabled':''} max=\"9999-12-31\" class=\"${varidateFromClass} ${`${fullId}_${j}`} \"${table_requiredAttr_from}>\n                                    <input type='text' class=\"${`${fullId}_${j}`} ${`${fullId}_${j}_to`} ${varidateToClass}\" style=\"border:none;border-top:dashed rgb(192,192,192) 1px;width:100%;\" ${e.disabled ? 'disabled':''} ${maxlengthTo} ${table_requiredAttr_to}>\n                                </td>`;\n                            break;\n                        case 'dateOnly':\n                            t_body += `\n                                <td id=\"${fullId}_${i}_${j}\">\n                                    <input type=\"date\" style='border:none; height:100%; width:100%'  ${e.disabled ? 'disabled':''} max=\"9999-12-31\" class=\"${`${fullId}_${j}`} ${varidateClass}\" ${table_requiredAttr}>\n                                </td>`;\n                            break;\n                        case 'button':\n                            t_body += `\n                                <td id=\"${fullId}_${i}_${j}\" class=\"button-small\">\n                                    <button\n                                        style=\"width:100%;\"\n                                        ${e.disabled ? 'disabled':''}\n                                    >\n                                        ${e.btn_label ? e.btn_label : 'ボタン'}\n                                    </button>\n                                </td>`;\n                            break;\n                        default:\n                            if(e.search) {\n                                t_body += `\n                                    <td id=\"${fullId}_${i}_${j}\" style=\"height:100%\">\n                                        <input id=\"${fullId}_${i}_${j}_From\" class=\"${`${fullId}_${j}`} ${varidateClass}\" type=\"text\" style='border:none;width:calc(100% - 39px); height:100%; ${for_numItem ? `text-align:${e.alignment}`:''}'  ${e.disabled ? 'disabled':''} ${maxlength} ${table_requiredAttr}>\n                                        <div class=\"ui-icon ui-icon-search tableInSearch ${varidateClass}\" style=\"position: static;\" tabindex=\"0\"></div>\n                                        <div class=\"ui-icon ui-icon-close textClear\" onclick=\"textClear('${fullId}_${i}_${j}')\"style=\"position: static;\"></div>\n                                    </td>`;\n                            } else {\n                                t_body += `\n                                    <td id=\"${fullId}_${i}_${j}\" style=\"height:100%\">\n                                        <input type=\"text\"  class=\"${`${fullId}_${j}`} ${varidateClass} ${for_numItem ? 'input-Number':''}\" style='border:none; height:100%; width:100%; background-color:white;${for_numItem ? `text-align:${e.alignment}`:''} ' ${e.disabled ? 'disabled': ''} ${maxlength} ${table_requiredAttr}>\n                                    </td>`;\n                            }\n                            break;\n                    }\n                })\n                t_body += \"</tr>\";\n            }\n            fieldHTML = `\n                <div id=\"${fullId}_inputTable\" class=\"input_table ui-dialog-content ui-widget-content\" style=\"display: inline-block; margin-top:20px; width: 98%;margin-left:1%;\">\n                    <div class=\"field-vertical \" style=\"width: 100%;\">\n                        <div class=\"field-control\">\n                            <div class=\"container-selectable\">\n                                <div class=\"wrapper h300\">\n                                    <table class=\"table inputTable\" style=\"height:100%;\">\n                                        <thead style=\"position: sticky; top:0; background-color: gold; z-index:9999\">\n                                            <tr>\n                                                ${t_head}\n                                            </tr>\n                                        <tbody>\n                                            ${t_body}\n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `;\n            break;\n        case 'search-table':\n            t_head = '';\n            if(options.multiple || multipleFlg)t_head += `<th style=\"text-align: center;border-collapse: collapse;\" class='inversion'><input type=\"checkbox\" class=\"allCheck\"></th>`;\n            t_head += options.t_heads.map(e => `<th style=\"text-align: center;border-collapse: collapse; ${e.hidden ? 'display:none;':''}\">${e.label}</th>`).join('');\n            fieldHTML = `\n                <div style=\"width:80%; display: flex;justify-content: end;\">\n                    <button id=\"${fullId}_searchButton\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" data-icon=\"ui-icon-search\" type=\"button\" style=\"z-index: 9999;\" onclick='create_searchList($(this));'>\n                        <span class=\"ui-button-icon ui-icon ui-icon-search search\" style=\"position: static;\"></span>\n                        <span class=\"ui-button-icon-space\"> </span>検索\n                    </button>\n                </div>\n                <div id=\"${fullId}_readTable\" class=\"ui-dialog-content ui-widget-content\" style=\"display: inline-block; margin-top:20px; width: 98%;margin-left:1%;\">\n                    <div class=\"field-vertical \" style=\"width: 100%;\">\n                        <div class=\"field-control\">\n                            <div class=\"container-selectable\">\n                                <div class=\"wrapper h300\">\n                                    <table class=\"table searchTable\">\n                                        <thead style=\"position: sticky; top:0; background-color: gold; z-index:9999\">\n                                            <tr>\n                                                ${t_head}\n                                            </tr>\n                                        </thead>\n                                        <tbody>\n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `;\n            break;\n        case 'free':\n            fieldHTML = options.str;\n            break;\n    }\n    return fieldHTML;\n};\n\n\n//時計マークがクリックされたら現在日付を入力\n$(document).on('click','.SdtTime',function(){\n\n    //フォーマットを取得\n    const format = $(this).prev().prop('type');\n    //現在日付を取得\n    let dt = new Date();\n    //typeがmonthの場合は「yyyy-mm」、dateの場合は「yyyy-mm-dd」形式に文字列成型\n    let formatDt = dt.toLocaleDateString('sv-SE');\n    if(format == \"month\"){\n        formatDt = formatDt.slice(0,7);\n    }\n    $(this).prev().val(formatDt);\n})\n\n// lookups作成\nfunction createLookups(dialogId, title, fields){\n\n    //キー項目を取得\n    let keyObjs = fields.filter(e => e.options && typeof(e.options) == \"object\" && ( e.options.lookupOrigin || e.options.searchDialog));\n\n    for(let keyObj of keyObjs){\n\n        // id作成\n        let key_fullId = dialogId + \"_\" + keyObj.id;\n        // 転記先項目を取得\n        let lookpupList = fields.filter(e => e.options.lookupFor  && e.options.lookupFor[0].id == keyObj.id);\n\n        let tmp_lookups = {};\n\n        // キー項目の値を代入\n        tmp_lookups.id              = key_fullId;\n        tmp_lookups.type            = keyObj.type;\n        tmp_lookups.tableId         = keyObj.options.lookupOrigin ? keyObj.options.lookupOrigin.tableId : '';\n        tmp_lookups.keyColumnName   = keyObj.options.lookupOrigin ? keyObj.options.lookupOrigin.keyColumnName : '';\n        tmp_lookups.digitsNum       = keyObj.options.digitsNum ? keyObj.options.digitsNum:'';\n        tmp_lookups.searchDialog    = {id:keyObj.options.searchDialog ? keyObj.options.searchDialog.id:'',title:keyObj.options.searchDialog ? keyObj.options.searchDialog.title:'',multiple:keyObj.options.searchDialog.multiple ? true : false};\n        if(keyObj.options.lookupOrigin && 'base_sql' in keyObj.options.lookupOrigin)tmp_lookups.base_sql = keyObj.options.lookupOrigin.base_sql;\n        // 転記先項目のパラメータ設定\n        if(keyObj.options.lookupOrigin && keyObj.type == 'text-set'){\n            let tmp = [{type:'text',id:key_fullId + 'To',columnName:keyObj.options.lookupOrigin.forColumnName}];\n            if(keyObj.options.lookupOrigin.specialTerms)tmp[0].specialTerms = keyObj.options.lookupOrigin.specialTerms;\n            tmp_lookups.toParam = tmp;\n        }\n        else if(keyObj.options.lookupOrigin){\n            tmp_lookups.toParam = lookpupList.map(e => {\n                let param = {};\n                param.type = e.type;\n                param.id = e.type == 'text-set' ? dialogId + \"_\" + e.id + 'From' :dialogId + \"_\" + e.id;\n                param.columnType = e.options.lookupFor[0].columnType;\n                param.columnName = e.options.lookupFor[0].columnName;\n                if('specialTerms' in e.options.lookupFor[0])param.specialTerms = e.options.lookupFor[0].specialTerms;\n                if('func' in e.options.lookupFor[0])param.func = e.options.lookupFor[0].func;\n                return param;\n            })\n        }\n\n        // 前回出力情報\n        if(\"get_lastTime_output\" in keyObj.options){\n            tmp_lookups.get_lastTime_output = {dialogId:dialogId,name:keyObj.options.get_lastTime_output};\n        }\n\n        lookups.push(tmp_lookups);\n\n        // イベント登録\n        if(keyObj.options.lookupOrigin){\n            if(keyObj.type == 'text-set')key_fullId += 'From';\n            $(document).on('input',`#${key_fullId}`,function(e){\n\n                if(now_IME)return;\n\n                // 数字以外を入力できないようにする\n                if(/[^\\uFF10-\\uFF19\\u0030-\\u0039]/.test($(this).val()) && $(this).val() != \"\"){\n                    let tmp = $(this).val().replace(/[^０-９0-9]/g, '');\n                    $(this).val(tmp);\n                    return;\n                }\n\n                let inputValue = $(this).val().length;\n                let id = $(this).attr('id');\n                let parentClass = $(this).parent().attr('class');\n                if(parentClass == 'text-set'){\n                    id = id.slice(0,-4);\n                }\n                let tmp = lookups.find(e => e.id == id);\n                if(inputValue != tmp.digitsNum) return;\n\n                dialogLookups($(this),parentClass);\n            })\n            // 桁以外でフォーカスが外れたらクリア処理\n            $(document).on('blur',`#${key_fullId}`,function(){\n\n                let inputValue = $(this).val().length;\n                let parentClass = $(this).parent().attr('class');\n                let id = $(this).attr('id');\n                if(parentClass == 'text-set')id = id.slice(0,-4);\n                let tmp = lookups.find(e => e.id == id);\n                if(inputValue == tmp.digitsNum) return;\n                // クリア処理\n                $(this).val('');\n                let lookup = lookups.filter(e => e.id == id)[0];\n                let prm = lookup.toParam ? lookup.toParam : [];\n\n                prm.forEach(e => {\n                    $(`#${e.id}`).val('').trigger('blur');\n                });\n\n                // 前回出力情報削除\n                if('get_lastTime_output' in tmp){\n                    $(`#${tmp.get_lastTime_output.dialogId} .input-container span`).text('');\n                }\n            })\n        }\n    }\n}\n\n// 全角数字を半角数字に変換する関数\nconst convertFullWidthToHalfWidth = (str) => {\n    return str.replace(/[ー－]/g,'-').replace(/[０-９]/g, function(char) {\n        // '０' (全角) の文字コードは 65296、'0' (半角) の文字コードは 48\n        // 差分 (65296 - 48) を引いて半角に変換\n        return String.fromCharCode(char.charCodeAt(0) - 65248);\n    });\n}\n\n\n// ルックアップする\n// tableなど特殊なものは各ダイアログファイルに記載\nasync function dialogLookups(t,parentClass = ''){\n    try {\n        showLoading();\n\n        t.val(convertFullWidthToHalfWidth(t.val()));\n\n        let item_label = t.closest('.field-control').prev().children('label').text();\n\n        let keyId = t.attr('id');\n        if(parentClass == 'text-set') keyId = keyId.slice(0,-4);\n\n        let lookup = lookups.filter(e => e.id == keyId)[0];\n        let prm = lookup.toParam;\n        let columns = lookup.toParam.map(e => {\n            if('specialTerms' in e){\n                return e.specialTerms;\n            }else{\n                return e.columnName;\n            }\n        });\n\n        // SQLが必要かで処理を分ける\n        let tableData;\n        if(!/^[0-9]+$/.test(lookup.tableId)){\n\n            // 売上入力の場合は処理を分ける\n            if(\"salesInput_estimateNo\" == lookup.id){\n                where = `WHERE MH.見積番号 = ${$('#salesInput_estimateNo').val()}`;\n                let sql = salesInput_baseSQL(where);\n                tableData = await fetchSql(sql);\n                salesInput_lookup(tableData);\n                return;\n            }\n            else if('base_sql' in lookup){\n                const sql = lookup.base_sql + $('#'+ t.attr('id')).val();\n                tableData = await fetchSql(sql);\n                tableData = tableData.results;\n            }\n            else{\n                let sql = `SELECT ${columns} FROM ${lookup.tableId} WHERE ${lookup.keyColumnName} = ${$('#'+ t.attr('id')).val()}`;\n                tableData = await fetchSql(sql);\n                tableData = tableData.results;\n            }\n        }\n        else{\n            await $p.apiGet({\n                id: lookup.tableId,\n                data: {\n                    View: {\n                        'ApiDataType': \"KeyValues\",\n                        'ApiColumnKeyDisplayType':'ColumnName',\n                        'ApiColumnValueDisplayType':\"Value\",\n                        'GridColumns': columns,\n                        \"ColumnFilterHash\":{\n                            [lookup['keyColumnName']]:$(`#${t.attr('id')}`).val()\n                        },\n                        \"ColumnFilterSearchTypes\": {\n                            [lookup['keyColumnName']]: \"ExactMatch\"\n                        }\n                    },\n                },\n                done: function (data) {\n                    tableData = data.Response.Data;\n                }\n            });\n        }\n        if(tableData.length != 1) {\n            alert(`指定の${item_label}は存在しません`);\n            t.val('').trigger('blur');\n            t.focus();\n            return;\n        }\n\n        prm.forEach(e => {\n            let tmp = tableData[0][e.columnName];\n            let item = \"\";\n            if('func' in e){\n                tmp = e.func(tableData[0]);\n            }\n            if(e.type == \"datepicker\"){\n                $(`#${e.id}`).val(\n                    tableData[0][e.columnName] == \"\" ? \"\":\n                    new Date(tmp).toLocaleDateString('sv-SE')\n                ).trigger('input');\n            }else{\n                $(`#${e.id}`).val(tmp).trigger('input');\n            }\n        });\n\n        // 前回出力情報\n        if('get_lastTime_output' in lookup){\n            get_history(lookup.get_lastTime_output.name,$(`#${t.attr('id')}`).val(),lookup.get_lastTime_output.dialogId)\n        }\n\n    } catch(error) {\n        console.error('ルックアップエラー：', error);\n        alert('予期せぬエラーが発生しました。');\n    } finally {\n        hideLoading();\n    }\n}\n\n$(document).on('blur','textarea',function(){\n    $(this).hide();\n    $(this).prev().prev().text($(this).val());\n    $(this).prev().prev().show();\n})\n\n$(document).on('mousedown','button:has(.ui-icon-closethick)',function(){\n    const element = $(this).closest('div').next();\n    const id = element.attr('id');\n    if(element.hasClass('searchDialog'))return;\n    closeDialog(id,true);\n})\n\n// ダイアログを閉じる関数\nfunction closeDialog(dialogId,deleteFlg) {\n    $(`#${dialogId}`).dialog('close');\n    $(`#${dialogId} table.searchTable tbody`).html('');\n    searchOutputId.pop();\n\n    if(!deleteFlg)return;\n\n    \n    $(`#${dialogId}`).dialog(\"destroy\").remove();\n    $('#Application').append(htmls[dialogId]);\n\n}\n\n// ダイアログをモーダルにするための関数\nwindow.addEventListener(\"load\", async (event) => {\n    await sleep(1000);\n    $(document).off(\"click\", \".ui-widget-overlay\")\n\n    // ローディングオーバーレイ要素を作成\n    const loadingOverlay = document.createElement('div');\n    loadingOverlay.className = 'loading-overlay';\n    loadingOverlay.innerHTML = '<div class=\"loading-spinner\"></div>';\n    document.body.appendChild(loadingOverlay);\n\n\n});\n\n// 全件チェック\n$(document).on('change','.allCheck',function(){\n    const allCheckFlg = $(this).prop('checked');\n\n    let targetElements = $(this).closest('table').find('tbody').find('input[type=\"checkbox\"]');\n\n    targetElements.prop('checked',allCheckFlg);\n\n})\n\n// inputtableの複数選択画面で、tdデフラグを反転\n$(document).on('click','.inversion',function(){\n    let targetElement = $(this).find('input[type=\"checkbox\"]');\n    targetElement.prop('checked',!targetElement.prop('checked')).trigger('change');\n})\n$(document).on('click','.inversion > input',function(event){\n    event.stopPropagation();\n})\n\n// 検索ダイアログの横にある×ボタンが押されたときに実行\n// keyになるinput要素を削除\n// blurイベントを着火させてlookup対象項目も削除\nfunction textClear(id){\n    $(`#${id}`).val('').trigger('blur');\n}\n\n\n$(document).on('keydown','.ui-icon-search',function(e){\n    if(e.which == 13){\n        $(this).trigger('click');\n    }\n})\n$(document).on('keydown','.ui-icon-close',function(e){\n    if(e.which == 13){\n        $(this).trigger('click');\n    }\n})\n\n\n$(document).on('keydown', 'tr', function(e) {\n    let tbodyElement = $(this);\n    let idx = $(this).index();\n\n    // フォーカス移動\n    if (e.which == 38 && idx != 0) {\n        let prevElement = tbodyElement.prev();\n        prevElement.focus();\n        ensureElementVisible(prevElement);\n        e.preventDefault();\n    } else if (e.which == 40 && idx != (tbodyElement.siblings().length)) {\n        let nextElement = tbodyElement.next();\n        nextElement.focus();\n        ensureElementVisible(nextElement);\n        e.preventDefault();\n    }\n});\n\n// 表示領域内にフォーカスが収まっているか確認し、必要ならスクロール\nfunction ensureElementVisible(element) {\n    let elementTop = element.offset().top;\n    let elementBottom = elementTop + element.outerHeight();\n\n    let viewportTop = $(window).scrollTop();\n    let viewportBottom = viewportTop + $(window).height();\n\n    // 要素がビューの上に隠れている場合\n    if (elementTop < viewportTop) {\n        $('html, body').scrollTop(elementTop - 20); // 少し余裕をもたせてスクロール\n    }\n    // 要素がビューの下に隠れている場合\n    else if (elementBottom > viewportBottom) {\n        $('html, body').scrollTop(elementBottom - $(window).height() + 20); // 少し余裕をもたせてスクロール\n    }\n}\n\n//click出力先が変更された時の処理\n// 変更処理がないためコメントアウト\n// $(document).on('click','.input-button-container button',function(){\n//     // どちらのボタンが押されたかで処理を分ける\n//     if($(this).hasClass('changePath')){\n//         inputValue = $(this).prev().val();\n//         $(this).parent().next().children('span').text(inputValue);\n//         $(this).parent().css('display','none');\n//         $(this).parent().next().css('display','contents');\n//     }\n//     else{\n//         $(this).parent().css('display','none');\n//         $(this).parent().prev().css('display','contents');\n//     }\n// })\n\n// 数値入力用項目がフォーカスから外れたら3桁区切りにする\n$(document).on('blur','.input-Number',async function(){\n    await sleep(1);\n    let val = Number(convertFullWidthToHalfWidth($(this).val().replaceAll(',','').replace(/[ー－]/g,'-').replace(/[^-\\d０-９,]/g, '')));\n    if(/^-?[0-9]+$/.test(val)){\n        $(this).val(val.toLocaleString());\n    }\n})\n\n// 3桁区切り解除\n$(document).on('focus','.input-Number',async function(){\n    let val = Number($(this).val().replaceAll(',',''));\n    if(val == 0){\n        $(this).val('');\n    }\n    else if(/^-?[0-9]+$/.test(val)){\n        $(this).val(val);\n    }\n})\n\n$(document).on('input','.varidate_int',function(){\n    input_numberOnly($(this))\n})\n$(document).on('input','.varidate_zeroPadding',function(){\n    input_numberOnly($(this))\n})\n\n// マイナス符号、数字（半角・全角）のみ許可する\nfunction input_numberOnly(e){\n    if(now_IME)return;\n    const target_element = varidate_input_select(e);\n    const target_value = target_element.val();\n    \n    after_value = target_value.replace(/[^-ー－\\d０-９]/g, \"\");\n    target_element.val(after_value);\n}\n\n\n// バリデーション\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nnow_varidate_flg = false;\n\n// 固定長数字で0埋め（得意先CDなど）\n$(document).on('blur','.varidate_zeroPadding',function(){\n    varidate_zeroPadding($(this));\n})\nasync function varidate_zeroPadding(e){\n    if(now_varidate_flg)return;\n    now_varidate_flg = true;\n\n\n    // 検索ボタンのあるinput要素は処理終了（input_numberOnlyのみ動作させたいため。）\n    if(e.prop('tagName') == 'INPUT' && e.next().hasClass('ui-icon-search')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    const element = varidate_input_select(e);\n\n    const dialog_element = element.closest('.dialog');\n\n\n    await sleep(0);\n\n    // if(activeItem_check(e) || element.is(':focus') || !dialog_element.is(':visible')){\n    if(activeItem_check(e) || element.is(':focus') || dialog_element.is(':focus')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    const maxLength = element.prop('maxlength');\n    const required_flg = element.prop('required');\n\n    if(!required_flg && element.val() == ''){\n        now_varidate_flg = false;\n        return;\n    }\n    // 0-9 or ０-９の値以外が入力されていたらクリア処理とアラート\n    if((required_flg && element.val() == '') || /[^０-９\\d]/.test(element.val())){\n        element.focus();\n        element.val('');\n        alert(`${maxLength}桁の数字を入力してください`);\n\n        // alertで新しくイベント着火しちゃうから、新しく着火したイベントを先に進めて終了させる（now_varidate_flg）\n        await sleep(0);\n        now_varidate_flg = false;\n        return;\n    }\n\n    // 全角数字を半角数字に変換\n    let val = convertFullWidthToHalfWidth(element.val());\n    val = ('0000000' + val).slice(-(maxLength));\n    element.val(val);\n\n    now_varidate_flg = false;\n}\n\n$(document).on('blur','.varidate_int',function(){\n    varidate_number($(this));\n})\n// 半角数字のバリデーション（合計金額など）\nasync function varidate_number(e){\n\n    if(now_varidate_flg)return;\n    now_varidate_flg = true;\n    const element = varidate_input_select(e);\n    const dialog_element = element.closest('.dialog');\n\n    if(e.prop('tagName') == 'INPUT' && e.next().hasClass('ui-icon-search')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    await sleep(0);\n\n\n    // ブラウザからアクティブが外れた場合、検索ダイアログを開くときは処理終了\n    if(activeItem_check(e) || element.is(':focus') || dialog_element.is(':focus')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    const required_flg = element.prop('required');\n\n    //  0-9 or ０-９の値以外が入力されていたらクリア処理とアラート\n    // if((!required_flg)){\n    //     return;\n    // }\n    if(!/(^-?ー?－?[０-９\\d]+$|^$)/.test(element.val()) || (required_flg && element.val() == \"\")){\n    // if(!/^[\\d\\uFF10-\\uFF19]+(,\\d{3})*$/.test(element.val())){\n        element.focus();\n        element.val('');\n        alert(\"未入力項目があります。\");\n\n        // alertで新しくイベント着火しちゃうから、新しく着火したイベントを先に進めて終了させる（now_varidate_flg）\n        await sleep(0);\n        now_varidate_flg = false;\n        return;\n    }\n\n    // 全角数字を半角数字に変換\n    let val = convertFullWidthToHalfWidth(element.val());\n    element.val(val);\n    now_varidate_flg = false;\n\n}\n\n// 必須項目チェック\n$(document).on('blur','.varidate_str',function(){\n    varidate_fixedLength_str($(this));\n})\nasync function varidate_fixedLength_str(e){\n\n    if(now_varidate_flg)return;\n    now_varidate_flg = true;\n\n    const element = varidate_input_select(e);\n\n    const dialog_element = element.closest('.dialog');\n\n    if(e.prop('tagName') == 'INPUT' && e.next().hasClass('ui-icon-search')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    await sleep(0);\n\n    // フォーカスがinput or 検索ダイアログ or ブラウザ以外に移った時は処理終了\n    if(activeItem_check(e) || element.is(':focus') || dialog_element.is(':focus')){\n        now_varidate_flg = false;\n        return;\n    }\n\n    const required_flg = element.prop('required');\n\n    // 必須チェック\n    if(element.val() == '' && required_flg){\n        alert('必須項目です。');\n        element.val('');\n        element.focus();\n        await sleep(0);\n        now_varidate_flg = false;\n        return;\n    }\n    now_varidate_flg = false;\n}\n\n// text-setのバリデーション\n$(document).on('input','.text-set input',async function(){\n    try{\n        if(now_IME)return;\n\n        // lookup項目は除外\n        if($(this).attr('id').slice(-2) == 'To')return;\n\n        let id = $(this).attr('id').slice(0,-4);\n        let tmp = lookups.filter(e => e.id == id);\n\n        if(tmp.length != 0)return;\n\n        let choices = $(this).next().val().split(' ').map(e => e.split(':')[0]);\n        choices.push(\"\");\n\n        if($(this).val().length > 1){\n            $(this).val($(this).val().slice(0,1));\n            return;\n        }\n\n        if(!choices.includes($(this).val())){\n            $(this).val('').focus();\n        }\n    }\n    catch(err){\n        return;\n    }\n})\n\n// input type=number はmaxlengthが働かないので指定桁以上を入力できないようにする\n$(document).on('input','.maxlength_for_number',function(){\n    let maxlength = $(this).attr('maxlength');\n    if(maxlength == \"\"){\n        return;\n    }\n    else{\n        maxlength = Number(maxlength);\n    }\n    let val = $(this).val();\n    if(val.length > maxlength){\n        $(this).val(val.slice(0,maxlength));\n    }\n\n})\n\n// divかinputかわからないため、input要素を返す\nfunction varidate_input_select(e){\n    if(e.parent().hasClass('text-set') && e.prop('tagName') == 'DIV'){\n        return e.prevAll().eq(1);\n    }\n    else if(e.prop('tagName') == 'DIV'){\n        return e.prev();\n    }else{\n        return e;\n    }\n}\n\n// ブラウザ自体からfocusが外れた、検索ダイアログを開いた場合、input,button要素以外がfocusになったらはtrueを返す\nfunction activeItem_check(e){\n    const after_focus_element = $(':focus');\n    const dialog_element = $(e).closest('.dialog');\n    const after_focus_dialog_element = after_focus_element.closest('.dialog');\n\n    if(after_focus_dialog_element.length == 0){\n        return true;\n    }\n    if(dialog_element.attr('id') != after_focus_dialog_element.attr('id')){\n        return true;\n    }\n\n    if(!isWindowActive || searchOutputId.length > 0 || !['INPUT'].includes(after_focus_element.prop('tagName'))){\n        return true;\n    }\n    return false;\n}\n\n// ブラウザのアクティブ状態を監視\nlet isWindowActive = true;\nwindow.addEventListener('blur', () => {\n    isWindowActive = false;\n});\n\nwindow.addEventListener('focus', () => {\n    isWindowActive = true;\n});\n\n// 指定したミリ秒待機する\nasync function sleep(s){\n    await new Promise((resolve,reject) => {\n        setTimeout(() => {\n            resolve();\n        }, s);\n    })\n}\n\n// ローディング制御関数\nfunction showLoading() {\n    //     document.querySelector('.loading-overlay').style.display = 'flex';\n    const element = document.querySelector('.loading-overlay');\n    if(element == null)return;\n    element.style.display = 'flex';\n}\n\nfunction hideLoading() {\n    //     document.querySelector('.loading-overlay').style.display = 'none';\n    const element = document.querySelector('.loading-overlay');\n    if(element == null)return;\n    element.style.display = 'none';\n}\n\n// 帳票をダウンロードする処理\nasync function download_report(param, fileName = \"\", accept=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\"){\n    try {\n        showLoading();\n        let res = await fetch(SERVICE_URL, {\n            method: \"POST\",\n            headers: {\n                \"content-type\": \"application/json\",\n                \"Accept\": accept,\n            },\n            body: JSON.stringify(param)\n        });\n\n        if (!res.ok) {\n            const errorData = await res.json();\n            console.error(errorData);\n            alert(errorData.message);\n            return;\n        }\n\n        // 成功メッセージをヘッダーから取得して表示\n        const messageCode = res.headers.get('Success-Message-Code');\n        if (messageCode) {\n            if (SUCCESS_MESSAGE_CODE[messageCode]) {\n                alert(SUCCESS_MESSAGE_CODE[messageCode]);\n            } else {\n                alert(`登録されていないメッセージコードです: ${messageCode}`);\n            }\n        }\n\n\n        // ファイルのダウンロードをするかどうか\n        const skip = res.headers.get('Download-Skip');\n        if (skip) {\n            console.log(\"ファイルのダウンロードをスキップします\")\n        } else {\n            // ダウンロードファイル名をクライアント側で上書きする場合\n            let downloadFileName = \"\"\n            if (fileName) {\n                downloadFileName = fileName;\n            // ダウンロードファイル名をサーバー側で指定する場合\n            } else {\n                let tmpText = res.headers.get('Content-Disposition').split('filename=')[1].replace(/\"/g, '')\n                downloadFileName = decodeString(tmpText)\n            }\n\n            const blob = await res.blob();\n            const url = window.URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = downloadFileName;\n            document.body.appendChild(a);\n            a.click();\n\n            // リンクを削除\n            document.body.removeChild(a);\n            window.URL.revokeObjectURL(url);\n            console.log(\"ファイルをダウンロードしました\")\n\n        }\n\n    } catch(error) {\n        console.error('予期せぬエラー：', error.message);\n        alert(`Error: 予期せぬエラーが発生しました。`);\n    } finally {\n        hideLoading();\n    }\n}\n\n/**\n * 指定された日付を特定のフォーマットで返す関数\n * @param {number} day          日付（1-31の数値、または99で月末日）\n * @param {string} type         出力形式（'month'で年月のみ、その他で年月日）\n * @returns {string}            YYYY-MM-DD または YYYY-MM 形式の日付文字列\n * @example\n * // 月の15日の完全な日付を取得\n * monthDateGein(15)    // => '2024-11-15'\n * // 月末日を取得\n * monthDateGein(99)    // => '2024-11-30'\n * // 年月のみを取得\n * monthDateGein(15, 'month')   // => '2024-11'\n */\nfunction monthDateGein(day,type){\n    let dt = new Date();\n    let resDate;\n    if(day == 99){\n        resDate = new Date(dt.getFullYear(),dt.getMonth()+1,0).toLocaleDateString('sv-SE');\n    }\n    else{\n        resDate = new Date(dt.getFullYear(),dt.getMonth(),day).toLocaleDateString('sv-SE');\n    }\n    resDate = type == 'month' ? resDate.slice(0,7) : resDate;\n    console.log(resDate);\n    return resDate;\n}\n\n/**\n * 文字列を変換する関数\n * @param {string} str          チェックしたい文字列\n * @param {string} replaceStr   変換したい文字列　規定値はnull\n */\nfunction SpcToNull(str,replaceStr = null){\n    if(str == ''){\n        return replaceStr;\n    }else{\n        return str.trim();\n    }\n}\n\n/**\n * 文字列を変換する関数\n * @param {string} encodedText   変換したい文字列\n */\nfunction decodeString(encodedText){\n    // Base64文字列をデコードしてUint8Arrayを取得\n    const binaryData = Uint8Array.from(atob(encodedText), c => c.charCodeAt(0));\n\n    // Uint8ArrayをUTF-8文字列にデコード\n    const decoder = new TextDecoder('utf-8');\n    return decoder.decode(binaryData);\n\n}\n\n// 日付をYYYY-MM-DD形式の文字列に変換するための関数\nfunction formatDate(date) {\n    date = new Date(date);\n    if(!date instanceof Date)return null;\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0'); // 月は0ベースのため+1\n    const day = String(date.getDate()).padStart(2, '0');\n    return `${year}-${month}-${day}`;\n}\n\n// 日付をYYYY年MM月DD日に変換する関数\nfunction formatDate_for_japanese(date){\n    date = new Date(date);\n    if(isNaN(date)){\n        throw new Error;\n    }\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    return `${year}年${month}月${day}日`;\n}\n\n// 時間をhh時mm分形式で返す\nfunction formatTime_for_japanese(date){\n    date = new Date(date);\n    if(!date instanceof Date){\n        return '';\n    }\n    return date.getHours() + \"時\" + date.getMinutes() + \"分\";\n}\n\n// dateオーバーフローさせない\nfunction not_date_overflow(old_date,new_date){\n    if(isNaN(new_date.getTime())){\n        return new_date;\n    }\n    else if(old_date.getMonth() == new_date.getMonth()){\n        return new_date;\n    }\n    else{\n        return new Date(new_date.setMonth(new_date.getMonth(),0));\n    }\n}\n\nfunction getFirstDateOfScope(wdate, wshime, defaultVal = \"\") {\n\n    wshime = Number(wshime);\n\n    // wdateが日付型かチェックし、日付型でなければ変換\n    const date = (wdate instanceof Date) ? wdate : new Date(wdate);\n\n    // 変換が失敗した場合、defaultValを返す\n    if (isNaN(date.getTime())) return defaultVal;\n\n    switch (wshime) {\n        case 0:\n            return formatDate(date);  // そのままの日付を返す\n        case 99:\n            return formatDate(new Date(date.getFullYear(), date.getMonth(), 1));  // 月初日を返す\n        default:\n            // 日付が締め日を超える場合とそれ以下の場合で分岐\n            let bufDate = new Date(`${date.getFullYear()}-${date.getMonth()+1}-${wshime}`);\n            if(isNaN(bufDate.getTime()) || new Date(date.getFullYear(),date.getMonth(),wshime).getMonth() != date.getMonth()){\n                return defaultVal;\n            }\n            if (date.getDate() > wshime) {\n                let after_date = new Date(bufDate.getFullYear(), bufDate.getMonth(), wshime + 1);\n                return formatDate(after_date);\n            }\n            else {\n                let tmp_date1 = new Date(bufDate);\n                let tmp_date2 = new Date(bufDate);\n\n                // 締日が月末だったら月初を返す\n                if(bufDate.getMonth() != new Date(tmp_date1.setDate(tmp_date1.getDate()+1)).getMonth()){\n                    return formatDate(new Date(bufDate.setDate(1)));\n                }\n                // 請求日付と締日から1か月前、1日を足した値が月をまたいでいないか\n                else if(bufDate.getMonth() == new Date(tmp_date2.getFullYear(),tmp_date2.getMonth()-1,tmp_date2.getDate()+1).getMonth()){\n                    return formatDate(new Date(bufDate.getFullYear(),bufDate.getMonth(),0));\n                }\n                else{\n                    return formatDate(new Date(bufDate.getFullYear(),bufDate.getMonth()-1,bufDate.getDate()+1));\n                }\n            }\n    }\n}\n\nfunction getLastDateOfScope(wdate, wshime, Default = '') {\n\n    wshime = Number(wshime);\n    let bufDate;\n\n    // wdateをDateオブジェクトとして変換\n    const date = new Date(wdate);\n    if (isNaN(date)) {\n        return Default;\n    }\n\n    switch (wshime) {\n        case 0:\n            // Case 0: そのまま日付を返す\n            return formatDate(date); // \"YYYY-MM-DD\" 形式\n\n        case 99:\n            // Case 99: 次月の初日から1日減らして末日を取得\n            const nextMonth = new Date(date.getFullYear(), date.getMonth() + 1, 1);\n            nextMonth.setDate(nextMonth.getDate() - 1);\n            return formatDate(nextMonth);\n        default:\n            // それ以外のケース\n            if(new Date(date.getFullYear(),date.getMonth(),wshime).getMonth() != date.getMonth()){\n                return Default;\n            }\n            if (date.getDate() > wshime) {\n                // 指定日の翌月にシメ日を設定\n                let tmp = new Date(`${date.getFullYear()}-${date.getMonth()+2}-1`);\n                bufDate = new Date(`${date.getFullYear()}-${date.getMonth()+2}-${wshime}`);\n                if (isNaN(bufDate.getTime())) {\n                    return Default;\n                }\n                else if(tmp.getMonth() != bufDate.getMonth()){\n                    return formatDate(new Date(bufDate.getFullYear(),bufDate.getMonth(),0));\n                }\n                else {\n                    return formatDate(bufDate);\n                }\n            } else {\n                // 指定日の月にシメ日を設定\n                let tmp = `${date.getFullYear()}-${date.getMonth()+1}-${wshime}`;\n                bufDate = new Date(tmp);\n                if (!isNaN(bufDate.getTime())) {\n                    return formatDate(bufDate);\n                } else {\n                    return Default;\n                }\n            }\n    }\n}\n\n\n// 日付の月間を計算する関数\nfunction DateDiff(date1, date2) {\n    const year1 = date1.getFullYear();\n    const month1 = date1.getMonth();  // 0-11の範囲\n    const year2 = date2.getFullYear();\n    const month2 = date2.getMonth();\n\n    // 年の差を12倍し、月の差を足し合わせる\n    const monthDifference = (year2 - year1) * 12 + (month2 - month1);\n    return monthDifference;\n}\n\nlet now_IME = false;\n// IME入力中か判断する関数（ルックアップで使用）\n$(document).on('compositionstart',function(){\n    now_IME = true;\n})\n$(document).on('compositionend',function(){\n    now_IME = false;\n    $(':focus').trigger('input');\n})\n\n\nclass cMitumoriH{\n    constructor(estimateNo){\n        this.estimateNo = estimateNo;\n        this.m_isDsp_estimate_category = 0; //見積区分\n        this.m_isDsp_inCompony_communication = 0; //社内伝\n    }\n    async isU_category(u_category){\n        let res_flg = false;\n        const sql = `\n            SELECT COUNT(U区分) AS 区分カウント\n            FROM TD見積シートM\n            WHERE 見積番号 = ${this.estimateNo}\n            AND U区分 = '${u_category}'\n            AND 見積数量 <> 0\n        `;\n        const res = await fetchSql(sql);\n        if(res.results.length == 0){\n            return false;\n        }\n        else{\n            if(res.results.区分カウント == 0){\n                return false;\n            }\n            else{\n                return true;\n            }\n        }\n    }\n    async GetById(){\n        const sql = `select * from TD見積 where 見積番号 = ${this.estimateNo}`;\n        const res = await fetchSql(sql);\n        if(res.results.length == 0){\n            return false;\n        }\n        res = res.results[0];\n        switch(this.m_isDsp_estimate_category){\n            case 0:\n                if(res.見積区分 == 1){\n                    alert('指定の見積番号は本見積ではありません。');\n                    return false;\n                }\n                break;\n            case 1:\n                if(res.見積区分 == 0){\n                    alert('指定の見積番号は仮見積もりではありません。');\n                    return false;\n                }\n        }\n        switch(this.m_isDsp_inCompony_communication){\n            case 1:\n                if(res.得意先CD == \"9999\"){\n                    alert('社内在庫分です。');\n                    return false;\n                }\n            case 2:\n                if(res.得意先CD == \"9999\"){\n                    alert('社内在庫意外です。');\n                    return false;\n                }\n        }\n\n        return true;\n    }\n}\n/*\n`m_isDsp_estimate_category\n仮見積 = 0\n本見積 = 1\n全て = 2\n`\n`m_isDsp_inCompony_communication\n全て = 0\n社内伝以外 = 1\n社内伝のみ = 2\n`*/\n\n\nclass clsDates{\n    constructor(dateID){\n        this.dateID = dateID;\n    }\n\n    async GetbyID(){\n        let dates = await fetchSql(`SELECT * FROM TMDates WHERE DateID = '${this.dateID}'`);\n        if(dates.results.length != 0){\n            this.updateDate = new Date(dates.results[0].更新日付);\n        }\n    }\n\n}\n\nfunction null_to_zero(value,defaultvalue = 0){\n    if(value == null || value == \"\"){\n        return defaultvalue;\n    }else{\n        return value;\n    }\n}\n\n\n",
            "Id": 14
          },
          {
            "Title": "62_製品検索マスタダイアログ.js",
            "New": true,
            "Edit": true,
            "Body": "// 製品検索ダイアログ作成\n{\n    const dialogId = 'productSearch1';\n    create_searchDialog(dialogId,'TM製品',[\n        {type:'text',id:'productNo',label:'製品No',forColumnName:'製品NO',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'methodNo',label:'仕様No',forColumnName:'仕様NO',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'KANJIName',label:'漢字名称',forColumnName:'漢字名称',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'mainSupplier',label:'主仕入先',forColumnName:'主仕入先CD',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'W',label:'W',forColumnName:'W',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'D',label:'D',forColumnName:'D',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H',label:'H',forColumnName:'H',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'D1',label:'D1',forColumnName:'D1',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'D2',label:'D2',forColumnName:'D2',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H1',label:'H1',forColumnName:'H1',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H2',label:'H2',forColumnName:'H2',options:{\n            width:'wide',\n        }},\n\n        { type: 'search-table', id: 'searchTable', label: '', options: {\n            newLine:false,\n            individualSql:true,\n            t_heads:[\n                {label:\"製品No\",type:'',ColumnName:'製品NO'},\n                {label:\"仕様No\",type:'',ColumnName:'仕様NO'},\n                {label:\"漢字名称\",type:'',ColumnName:'漢字名称'},\n                {label:\"主仕入先\",type:'',ColumnName:'主仕入先CD'},\n                {label:\"W\",type:'',ColumnName:'W'},\n                {label:\"D\",type:'',ColumnName:'D'},\n                {label:\"H\",type:'',ColumnName:'H'},\n                {label:\"D1\",type:'',ColumnName:'D1'},\n                {label:\"D2\",type:'',ColumnName:'D2'},\n                {label:\"H1\",type:'',ColumnName:'H1'},\n                {label:\"H2\",type:'',ColumnName:'H2'},\n                {label:\"仕入先名\",type:'',ColumnName:'仕入先名1'},\n            ]\n        }},\n    ],\n    [\n        { type: 'button_inline', id: 'create', label: 'OK', options: {\n            onclick:`resultInput('${dialogId}')`,\n            icon:'disk'\n        }},\n    ],\n    '1300px')\n}\n\nconst productSearch1_baseSQL = (e) => {\n    return `\n        SELECT TOP 1000 SE.製品NO,SE.仕様NO,SE.漢字名称,SE.主仕入先CD,SE.W,SE.D,SE.H,SE.D1,SE.D2,SE.H1,SE.H2,SI.仕入先名1\n        FROM TM製品 AS SE\n        INNER JOIN\n            TM仕入先 AS SI\n        ON\n            SE.主仕入先CD = SI.仕入先CD\n        ${e} and 廃盤FLG = 0\n        ORDER BY\n        SE.製品NO ASC , SE.仕様NO ASC\n    `\n}\n\n\n// 製品検索ダイアログ作成\n{\n    const dialogId = 'productSearch2';\n    create_searchDialog(dialogId,'TM製品',[\n        {type:'text',id:'productNo',label:'製品No',forColumnName:'製品NO',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'methodNo',label:'仕様No',forColumnName:'仕様NO',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'KANJIName',label:'漢字名称',forColumnName:'漢字名称',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'mainSupplier',label:'主仕入先',forColumnName:'主仕入先CD',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'W',label:'W',forColumnName:'W',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'D',label:'D',forColumnName:'D',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H',label:'H',forColumnName:'H',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'D1',label:'D1',forColumnName:'D1',options:{\n            width:'wide',\n            newLine:true,\n        }},\n        {type:'text',id:'D2',label:'D2',forColumnName:'D2',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H1',label:'H1',forColumnName:'H1',options:{\n            width:'wide',\n        }},\n        {type:'text',id:'H2',label:'H2',forColumnName:'H2',options:{\n            width:'wide',\n        }},\n\n        { type: 'search-table', id: 'searchTable', label: '', options: {\n            newLine:false,\n            individualSql:true,\n            t_heads:[\n                {label:\"\",ColumnName:'タイトル',hidden:true},\n                {label:\"製品No\",type:'',ColumnName:'製品NO'},\n                {label:\"仕様No\",type:'',ColumnName:'仕様NO'},\n                {label:\"漢字名称\",type:'',ColumnName:'漢字名称'},\n                {label:\"主仕入先\",type:'',ColumnName:'主仕入先CD'},\n                {label:\"W\",type:'',ColumnName:'W'},\n                {label:\"D\",type:'',ColumnName:'D'},\n                {label:\"H\",type:'',ColumnName:'H'},\n                {label:\"D1\",type:'',ColumnName:'D1'},\n                {label:\"D2\",type:'',ColumnName:'D2'},\n                {label:\"H1\",type:'',ColumnName:'H1'},\n                {label:\"H2\",type:'',ColumnName:'H2'},\n                {label:\"仕入先名\",type:'',ColumnName:'仕入先名1'},\n            ]\n        }},\n    ],\n    [\n        { type: 'button_inline', id: 'create', label: 'OK', options: {\n            onclick:`resultInput('${dialogId}')`,\n            icon:'disk'\n        }},\n    ],\n    '1300px')\n}\n\nconst productSearch2_baseSQL = (e) => {\n    return `\n        SELECT TOP 1000 \n            SE.製品NO + '___' + SE.仕様NO AS タイトル, \n            SE.製品NO,SE.仕様NO,SE.漢字名称,SE.主仕入先CD,SE.W,SE.D,SE.H,SE.D1,SE.D2,SE.H1,SE.H2,SI.仕入先名1\n        FROM TM製品 AS SE\n        INNER JOIN\n            TM仕入先 AS SI\n        ON\n            SE.主仕入先CD = SI.仕入先CD\n        ${e} and 廃盤FLG = 0\n        ORDER BY\n        SE.製品NO ASC , SE.仕様NO ASC\n    `\n}\n",
            "Id": 15
          },
          {
            "Title": "棚番マスタ.js",
            "New": true,
            "Edit": true,
            "Body": "const styleElement2 = document.createElement('style');\nstyleElement2.textContent = `\n    .field-normal{\n        width:340px ;\n        max-width:340px ;\n        height:45px ;\n        padding:0 20px 10px 0 ;\n    }\n    .field-wide{\n        width:100%;\n        min-height:45px;\n        float:left;\n        padding:0 10px 10px 0;\n        clear both;\n            max-width:100%\n    }\n    .sdt_disabled input,\n    .sdt_disabled select,\n    .sdt_disabled textarea{\n        background:#f5f5f5;\n    }\n    #productSearch{\n        display:block;\n        position:static;\n        margin-left:320px;\n        margin-top:6px;\n        overflow:visible;\n    }\n    #productDelete{\n        position:sticky;\n        margin-left:335px;\n        overflow:visible;\n        margin-top:-50px;\n    }\n`;\ndocument.head.appendChild(styleElement2);\n\nlookups.push({\n    id:\"Results_ClassG\",\n    searchDialog:{id:\"productSearch2\",title:'製品No検索',multiple:false}\n})\n\n$(document).on('input','#Results_ClassG',async function(){\n    try{\n        const productNo = $('#Results_ClassG');\n        const siyouNo = $('#Results_ClassB');\n        if(productNo.val() == \"\"){\n            return;\n        }\n        const arr = productNo.val().split('___');\n        $p.set($p.getControl('ClassG'),arr[0]);\n        $p.set($p.getControl('ClassB'),arr[1]);\n        \n        const data = await commonGetData(MASTER_TABLES[\"製品マスタ\"],['ClassC','NumA','NumB','NumC','NumD','NumE','NumF','NumG'],{ClassA:productNo.val().replaceAll(' ',''),ClassB:siyouNo.val().replaceAll(' ','')},{},{ClassA:'ExactMatch',ClassB:'ExactMatch'},false,false);\n\n        if(data.length ==0 ){\n            alert('指定の製品Noは存在しません。');\n            return;\n        }\n\n        $p.set($p.getControl('ClassC'),data[0].ClassC);\n        $p.set($p.getControl('NumA'),null_to_zero(data[0].NumA,0));\n        $p.set($p.getControl('NumB'),null_to_zero(data[0].NumD,0));\n        $p.set($p.getControl('NumC'),null_to_zero(data[0].NumG,0));\n        $p.set($p.getControl('NumD'),null_to_zero(data[0].NumB,0));\n        $p.set($p.getControl('NumE'),null_to_zero(data[0].NumE,0));\n        $p.set($p.getControl('NumF'),null_to_zero(data[0].NumC,0));\n        $p.set($p.getControl('NumG'),null_to_zero(data[0].NumF,0));\n\n    }catch(e){\n        alert('予期せぬエラーが発生しました。');\n        console.error(e);\n        return;\n    }\n})\n\n\nfunction initialize(){\n    $p.set($p.getControl('ClassG'),'');\n    $p.set($p.getControl('ClassB'),'');\n    $p.set($p.getControl('ClassC'),'');\n    $p.set($p.getControl('NumA'),'');\n    $p.set($p.getControl('NumB'),'');\n    $p.set($p.getControl('NumC'),'');\n    $p.set($p.getControl('NumD'),'');\n    $p.set($p.getControl('NumE'),'');\n    $p.set($p.getControl('NumF'),'');\n    $p.set($p.getControl('NumG'),'');\n}\n\n// $p.events.on_editor_load = function () {\n//     setDisabled('disabled');\n\n//     $('.dialogSearch').off('click');\n\n//     if($('#productSearch2Dialog').length == 0){\n//         $('#Application').append(productSearch_html);\n//     }\n\n//     $('#productSearch').on('click',function(){\n//         openDialog_for_searchDialog('productSearch2','Results_ClassG','1300px','製品検索ダイアログ');\n//     })\n// }\n\nonEditorLoadFuncs.push(\n  function () {\n    setDisabled('disabled');\n\n    $('.dialogSearch').off('click');\n\n    if($('#productSearch2Dialog').length == 0){\n        $('#Application').append(productSearch_html);\n    }\n\n    $('#productSearch').on('click',function(){\n        openDialog_for_searchDialog('productSearch2','Results_ClassG','1300px','製品検索ダイアログ');\n    })\n}\n)\n\n\nconst productSearch_html = `\n\n<div id=\"productSearch2Dialog\" class=\"searchDialog ui-dialog-content ui-widget-content\" style=\"display:none; margin-top: 10px; width: auto; min-height: 89.25px; max-height: 90vh; height: auto;\">\n        <div style=\"display: inline-block;width: 33%;vertical-align: top;\">\n            <div id=\"productSearch2_productNoField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_productNo\" class=\"\">製品No</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_productNo\" name=\"productSearch2_productNo\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_productNo-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_methodNoField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_methodNo\" class=\"\">仕様No</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_methodNo\" name=\"productSearch2_methodNo\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_methodNo-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_KANJINameField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_KANJIName\" class=\"\">漢字名称</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_KANJIName\" name=\"productSearch2_KANJIName\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_KANJIName-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_mainSupplierField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_mainSupplier\" class=\"\">主仕入先</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_mainSupplier\" name=\"productSearch2_mainSupplier\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_mainSupplier-error\"></div>\n            </div>\n        </div><div style=\"display: inline-block;width: 33%;vertical-align: top;\">\n            <div id=\"productSearch2_WField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_W\" class=\"\">W</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_W\" name=\"productSearch2_W\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_W-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_DField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_D\" class=\"\">D</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_D\" name=\"productSearch2_D\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_D-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_HField\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_H\" class=\"\">H</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_H\" name=\"productSearch2_H\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_H-error\"></div>\n            </div>\n        </div><div style=\"display: inline-block;width: 33%;vertical-align: top;\">\n            <div id=\"productSearch2_D1Field\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_D1\" class=\"\">D1</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_D1\" name=\"productSearch2_D1\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_D1-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_D2Field\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_D2\" class=\"\">D2</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_D2\" name=\"productSearch2_D2\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_D2-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_H1Field\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_H1\" class=\"\">H1</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_H1\" name=\"productSearch2_H1\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_H1-error\"></div>\n            </div>\n        \n            <div id=\"productSearch2_H2Field\" class=\"field-wide both\" style=\"\">\n                <p class=\"field-label\"><label for=\"productSearch2_H2\" class=\"\">H2</label></p>\n                <div class=\"field-control\">\n                    <div class=\"container-normal\">\n                        <div class=\"oneItem\">\n                            <input id=\"productSearch2_H2\" name=\"productSearch2_H2\" class=\"control-textbox     \" type=\"text\" style=\"\">\n                            \n                            \n                            \n                    </div>\n                    </div>\n                </div>\n                <div class=\"error-message\" id=\"productSearch2_H2-error\"></div>\n            </div>\n        \n            \n        </div><div style=\"display: block;\">\n            <div style=\"width:80%; display: flex;justify-content: end;\">\n                <button id=\"productSearch2_searchTable_searchButton\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" data-icon=\"ui-icon-search\" type=\"button\" style=\"z-index: 9999;\" onclick=\"create_searchList($(this));\">\n                    <span class=\"ui-button-icon ui-icon ui-icon-search search\" style=\"position: static;\"></span>\n                    <span class=\"ui-button-icon-space\"> </span>検索\n                </button>\n            </div>\n            <div id=\"productSearch2_searchTable_readTable\" class=\"ui-dialog-content ui-widget-content\" style=\"display: inline-block; margin-top:20px; width: 98%;margin-left:1%;\">\n                <div class=\"field-vertical \" style=\"width: 100%;\">\n                    <div class=\"field-control\">\n                        <div class=\"container-selectable\">\n                            <div class=\"wrapper h300\">\n                                <table class=\"table searchTable\">\n                                    <thead style=\"position: sticky; top:0; background-color: gold; z-index:9999\">\n                                        <tr>\n                                            <th style=\"text-align: center;border-collapse: collapse; display:none;\"></th><th style=\"text-align: center;border-collapse: collapse; \">製品No</th><th style=\"text-align: center;border-collapse: collapse; \">仕様No</th><th style=\"text-align: center;border-collapse: collapse; \">漢字名称</th><th style=\"text-align: center;border-collapse: collapse; \">主仕入先</th><th style=\"text-align: center;border-collapse: collapse; \">W</th><th style=\"text-align: center;border-collapse: collapse; \">D</th><th style=\"text-align: center;border-collapse: collapse; \">H</th><th style=\"text-align: center;border-collapse: collapse; \">D1</th><th style=\"text-align: center;border-collapse: collapse; \">D2</th><th style=\"text-align: center;border-collapse: collapse; \">H1</th><th style=\"text-align: center;border-collapse: collapse; \">H2</th><th style=\"text-align: center;border-collapse: collapse; \">仕入先名</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"command-center\">\n            \n            <button id=\"productSearch2_close\" class=\"button button-icon ui-button ui-corner-all ui-widget applied customized\" type=\"button\" onclick=\"closeDialog('productSearch2Dialog',false);\" style=\"position:relative;\">\n                <span class=\"ui-button-icon ui-icon ui-icon-cancel\"></span>\n                <span class=\"ui-button-icon-space\"> </span>終了\n            </button>\n        </div>\n    </div>\n`\n",
            "Id": 16
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 19
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 20
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841990,
      "Title": "納入先マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841990,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB",
          "ClassC",
          "ClassD",
          "ClassE",
          "ClassF",
          "ClassG",
          "ClassH",
          "ClassI",
          "ClassJ",
          "ClassK",
          "ClassL",
          "ClassM",
          "ClassN",
          "ClassO",
          "ClassP",
          "ClassQ",
          "ClassR",
          "DateA"
        ],
        "FilterColumns": [
          "ClassA",
          "ClassB",
          "ClassC",
          "ClassD",
          "ClassE",
          "ClassI"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "ClassD",
            "_Section-1",
            "ClassB",
            "ClassC",
            "ClassE",
            "ClassF",
            "ClassG",
            "ClassH",
            "ClassI",
            "ClassJ",
            "ClassK",
            "ClassL",
            "ClassM",
            "ClassN",
            "ClassO",
            "ClassP",
            "Title",
            "Class100"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassD"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "得意先CD",
            "ChoicesText": "[\n    {\n        \"SiteId\": 1841987,\n        \"SearchFormat\": \"[ClassA] __ [ClassB] __ [ClassC]\",\n        \"Value\": \"[ClassA]\",\n        \"NoAddButton\" : true,\n        \"Lookups\": [\n              {\n                \"From\": \"ClassB\",\n                \"To\": \"ClassB\"\n              },\n              {\n                \"From\": \"ClassC\",\n                \"To\": \"ClassC\"\n              },\n         ]\n    }\n]",
            "UseSearch": true,
            "ValidateRequired": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassB,ClassC",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "得意先名1",
            "ValidateRequired": true,
            "EditorReadOnly": true,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "得意先名2",
            "EditorReadOnly": true,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "納入先CD",
            "ValidateRequired": true,
            "MaxLength": 4.0,
            "ClientRegexValidation": "^[a-zA-Z0-9]*$",
            "RegexValidationMessage": "英数字のみ入力可能です。"
          },
          {
            "ColumnName": "ClassE",
            "LabelText": "納入先名1",
            "ValidateRequired": true,
            "MaxLength": 28.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassF",
            "LabelText": "納入先名2",
            "MaxLength": 28.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassG",
            "LabelText": "略称",
            "MaxLength": 8.0
          },
          {
            "ColumnName": "ClassH",
            "LabelText": "表示用店舗名",
            "MaxLength": 20.0
          },
          {
            "ColumnName": "ClassI",
            "LabelText": "フリガナ",
            "MaxLength": 5.0,
            "ClientRegexValidation": "^[a-zA-Z0-9ｦ-ﾟ]*$",
            "RegexValidationMessage": "英数字半角カナのみ入力可能です。"
          },
          {
            "ColumnName": "ClassJ",
            "LabelText": "郵便番号",
            "NoWrap": true,
            "MaxLength": 8.0,
            "ClientRegexValidation": "^\\d{3}-\\d{4}$",
            "RegexValidationMessage": "999-9999形式で入力して下さい。"
          },
          {
            "ColumnName": "ClassK",
            "LabelText": "住所1",
            "MaxLength": 32.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassL",
            "LabelText": "住所2",
            "MaxLength": 32.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassM",
            "LabelText": "電話番号",
            "MaxLength": 15.0,
            "ClientRegexValidation": "^[0-9\\-]+$",
            "RegexValidationMessage": "半角数字またはハイフンのみ入力可能です。"
          },
          {
            "ColumnName": "ClassN",
            "LabelText": "FAX番号",
            "MaxLength": 15.0,
            "ClientRegexValidation": "^[0-9\\-]+$",
            "RegexValidationMessage": "半角数字またはハイフンのみ入力可能です。"
          },
          {
            "ColumnName": "ClassO",
            "LabelText": "納入先担当者名",
            "NoWrap": true,
            "MaxLength": 40.0
          },
          {
            "ColumnName": "ClassP",
            "LabelText": "メモ",
            "MaxLength": 40.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassQ",
            "LabelText": "担当者CD",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassR",
            "LabelText": "担当者名",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "DateA",
            "LabelText": "最終使用日"
          },
          {
            "ColumnName": "Title",
            "Hide": true,
            "NoDuplication": true
          },
          {
            "ColumnName": "Class100",
            "LabelText": "主キー項目",
            "ImportKey": true,
            "Hide": true,
            "NoDuplication": true
          }
        ],
        "Links": [
          {
            "ColumnName": "ClassA",
            "SiteId": 1841987,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB] __ [ClassC]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassB"
              },
              {
                "From": "ClassC",
                "To": "ClassC"
              }
            ],
            "JsonFormat": true
          }
        ],
        "Processes": [
          {
            "Id": 1,
            "Name": "更新",
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassE',byte:28},         {item:'ClassF',byte:28},         {item:'ClassG',byte:8},         {item:'ClassH',byte:20},         {item:'ClassK',byte:32},          {item:'ClassL',byte:32},          {item:'ClassO',byte:40},          {item:'ClassP',byte:40},  ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          },
          {
            "Id": 2,
            "Name": "作成",
            "ScreenType": 10,
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassE',byte:28},         {item:'ClassF',byte:28},         {item:'ClassG',byte:8},         {item:'ClassH',byte:20},         {item:'ClassK',byte:32},          {item:'ClassL',byte:32},          {item:'ClassO',byte:40},          {item:'ClassP',byte:40},  ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc",
              "ClassD": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "CalendarTimePeriod": "Monthly",
            "CalendarFromTo": "DateA",
            "CrosstabGroupByX": "ClassA",
            "CrosstabGroupByY": "ClassA",
            "CrosstabAggregateType": "Total",
            "CrosstabValue": "ClassA~1841987,NumA",
            "CrosstabTimePeriod": "Monthly",
            "KambanAggregateType": "Count",
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "Class100",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          },
          {
            "Title": "作成・更新ボタン非表示",
            "New": true,
            "Edit": true,
            "Body": "#CreateCommand{\n    display:none !important\n}\n#UpdateCommand{\n    display:none !important\n}",
            "Id": 2
          }
        ],
        "Scripts": [
          {
            "Title": "主キー設定",
            "New": true,
            "Edit": true,
            "Body": "$(document).on('change', '#Results_ClassA, #Results_ClassD', function () {\n    var A = $('#Results_ClassA').val();\n    var B = $('#Results_ClassD').val();\n\n   $p.set($('#Results_Class100'), A + '__' + B);\n})",
            "Id": 1
          },
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n  if($p.action() != 'edit'){\n      return;\n  }\n\n  $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n  $('#Results_ClassD').attr('disabled',true).css('background-color','#f5f5f5');\n\n})",
            "Id": 2
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 3
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 4
          },
          {
            "Title": "バイト数チェック",
            "New": true,
            "Edit": true,
            "Body": "/**\n * sjisで使えない文字列を返す\n * @param {string} text エンコード文字列\n * @returns {Array} 文字化けした文字列配列\n */\nfunction detectUnsupportedChars(text) {\n    const utf16Array = Encoding.stringToCode(text); // 文字列をコードポイントの配列に変換\n    const sjisArray = Encoding.convert(utf16Array, 'SJIS', 'UNICODE'); // Shift JIS に変換\n    const restoredArray = Encoding.convert(sjisArray, 'UNICODE', 'SJIS'); // 再び UTF-16 に戻す\n    const restoredText = Encoding.codeToString(restoredArray); // 文字列に変換\n    \n    console.log(text);\n    console.log(restoredText);\n\n    text = Array.from(text);\n\n    let unsupportedChars = [];\n    for (let i = 0; i < text.length; i++) {\n        if (text[i] !== restoredText[i]) {\n            unsupportedChars.push(text[i]); // 変換後に変化した文字をリストアップ\n        }\n    }\n    \n    return unsupportedChars;\n}\n\n/**\n * 全角文字かチェックします。\n * @param str チェック対象の文字列\n * @returns 全角文字の場合 true\n */\nfunction isFullWidth(str) {\n    return /^[^\\x01-\\x7E\\uFF65-\\uFF9F]+$/.test(str);\n}\n\n/**\n * 入力文字のバリデーション\n * @param {string} label 対象項目名\n * @param {string} text 対象文字列\n * @param {number} byte バイト数\n */\nfunction byte_check(label,text,byte){\n    const unsuported_string = detectUnsupportedChars(text);\n    if(unsuported_string.length > 0){\n        alert(`下記文字列は使用できません。\\n${unsuported_string.toString()}`);\n        return false;\n    }\n\n    const byte_count = Array.from(text).reduce((a,b) => a += isFullWidth(b) ? 2 : 1,0);\n    if(byte_count > byte){\n        alert(`${label}の文字数が多すぎます。`);\n        return false;\n    }\n    return true;\n}\n\n// マスタ用\n/*[\n    {item:'ClassA',byte:15},\n    {item:'ClassB',byte:15},\n    {item:'ClassC',byte:15},\n]*/\nfunction maste_byte_check(e,option){\n    for(item of option){\n        const label = $p.getControl(item[\"item\"]).parent().parent().prev().text();\n        const text = $p.getControl(item[\"item\"]).val();\n        if(!byte_check(label,text,item[\"byte\"])){\n            return;\n        }\n    }\n    // 登録処理\n    const commandId = $p.action() == \"new\" ? \"CreateCommand\" : \"UpdateCommand\";\n    $(`#${commandId}`).click();\n}\n\n",
            "Id": 5
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          },
          {
            "Title": "encodingjs読み込み",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js\"></script>",
            "Id": 3
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n//得意先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA']);\n    newData['ClassA'] = n_results1[0]['ClassA'];\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n//得意先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA']);\n    newData['ClassA'] = n_results1[0]['ClassA'];\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n}\n\n//得意先CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassA']);\n    oldData['ClassA'] = o_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n//得意先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA']);\n    newData['ClassA'] = n_results1[0]['ClassA'];\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n}\n\n//得意先CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassA']);\n    oldData['ClassA'] = o_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841991,
      "Title": "補助科目マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841991,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB",
          "ClassC",
          "ClassD",
          "ClassE",
          "ClassF",
          "ClassG"
        ],
        "FilterColumns": [
          "ClassA",
          "ClassB",
          "ClassC",
          "ClassD"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "ClassB",
            "ClassC",
            "_Section-1",
            "ClassD",
            "ClassE",
            "ClassF",
            "ClassG",
            "Title",
            "Class100"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassC"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "科目CD",
            "ChoicesText": "[\n    {\n        \"SiteId\": 1841980,\n        \"SearchFormat\": \"[ClassA] __ [ClassB]\",\n        \"Value\": \"[ClassA]\",\n        \"NoAddButton\" : true,\n        \"Lookups\": [\n              {\n                \"From\": \"ClassB\",\n                \"To\": \"ClassB\"\n              },\n         ]\n    }\n]",
            "UseSearch": true,
            "NoWrap": true,
            "ValidateRequired": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassB",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "科目名",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "補助CD",
            "NoWrap": true,
            "ValidateRequired": true,
            "MaxLength": 4.0,
            "ClientRegexValidation": "^[0-9]*$",
            "RegexValidationMessage": "数値のみ入力可能です。"
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "補助科目名",
            "ValidateRequired": true,
            "MaxLength": 16.0
          },
          {
            "ColumnName": "ClassE",
            "LabelText": "借方消費税区分",
            "NoWrap": true,
            "MaxLength": 2.0,
            "ClientRegexValidation": "^[0-9]*$",
            "RegexValidationMessage": "数値のみ入力可能です。"
          },
          {
            "ColumnName": "ClassF",
            "LabelText": "貸方消費税区分",
            "MaxLength": 2.0,
            "ClientRegexValidation": "^[0-9]*$",
            "RegexValidationMessage": "数値のみ入力可能です。"
          },
          {
            "ColumnName": "ClassG",
            "LabelText": "按分区分",
            "ChoicesText": "0\n1\n2",
            "MaxLength": 1.0,
            "ExtendedHtmlAfterControl": "<div style=\"padding-left: 100%; margin-top : 10px; white-space:nowrap;\">\n(0:人数按分　1:売上金額按分　2:個別按分)\n</div>",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "Class100",
            "LabelText": "主キー項目",
            "ImportKey": true,
            "Hide": true
          }
        ],
        "Links": [
          {
            "ColumnName": "ClassA",
            "SiteId": 1841980,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassB"
              }
            ],
            "JsonFormat": true
          }
        ],
        "Processes": [
          {
            "Id": 1,
            "Name": "更新",
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassD',byte:16}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          },
          {
            "Id": 2,
            "Name": "作成",
            "ScreenType": 10,
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassD',byte:16}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc",
              "ClassB": "asc",
              "ClassC": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "Class100",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          },
          {
            "Title": "作成・更新ボタン非表示",
            "New": true,
            "Edit": true,
            "Body": "#CreateCommand{\n    display:none !important\n}\n#UpdateCommand{\n    display:none !important\n}",
            "Id": 2
          }
        ],
        "Scripts": [
          {
            "Title": "主キー設定",
            "All": true,
            "Body": "$(document).on('change', '#Results_ClassA, #Results_ClassC', function() {\n    var A = $('#Results_ClassA').val();\n    var C = $('#Results_ClassC').val();\n\n   $p.set($('#Results_Class100'), A + '__' + C);\n});",
            "Id": 1
          },
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n    if($p.action() != 'edit'){\n        return;\n    }\n\n    $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_ClassC').attr('disabled',true).css('background-color','#f5f5f5');\n})\n",
            "Id": 2
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 3
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 4
          },
          {
            "Title": "バイト数チェック",
            "New": true,
            "Edit": true,
            "Body": "/**\n * sjisで使えない文字列を返す\n * @param {string} text エンコード文字列\n * @returns {Array} 文字化けした文字列配列\n */\nfunction detectUnsupportedChars(text) {\n    const utf16Array = Encoding.stringToCode(text); // 文字列をコードポイントの配列に変換\n    const sjisArray = Encoding.convert(utf16Array, 'SJIS', 'UNICODE'); // Shift JIS に変換\n    const restoredArray = Encoding.convert(sjisArray, 'UNICODE', 'SJIS'); // 再び UTF-16 に戻す\n    const restoredText = Encoding.codeToString(restoredArray); // 文字列に変換\n    \n    console.log(text);\n    console.log(restoredText);\n\n    text = Array.from(text);\n\n    let unsupportedChars = [];\n    for (let i = 0; i < text.length; i++) {\n        if (text[i] !== restoredText[i]) {\n            unsupportedChars.push(text[i]); // 変換後に変化した文字をリストアップ\n        }\n    }\n    \n    return unsupportedChars;\n}\n\n/**\n * 全角文字かチェックします。\n * @param str チェック対象の文字列\n * @returns 全角文字の場合 true\n */\nfunction isFullWidth(str) {\n    return /^[^\\x01-\\x7E\\uFF65-\\uFF9F]+$/.test(str);\n}\n\n/**\n * 入力文字のバリデーション\n * @param {string} label 対象項目名\n * @param {string} text 対象文字列\n * @param {number} byte バイト数\n */\nfunction byte_check(label,text,byte){\n    const unsuported_string = detectUnsupportedChars(text);\n    if(unsuported_string.length > 0){\n        alert(`下記文字列は使用できません。\\n${unsuported_string.toString()}`);\n        return false;\n    }\n\n    const byte_count = Array.from(text).reduce((a,b) => a += isFullWidth(b) ? 2 : 1,0);\n    if(byte_count > byte){\n        alert(`${label}の文字数が多すぎます。`);\n        return false;\n    }\n    return true;\n}\n\n// マスタ用\n/*[\n    {item:'ClassA',byte:15},\n    {item:'ClassB',byte:15},\n    {item:'ClassC',byte:15},\n]*/\nfunction maste_byte_check(e,option){\n    for(item of option){\n        const label = $p.getControl(item[\"item\"]).parent().parent().prev().text();\n        const text = $p.getControl(item[\"item\"]).val();\n        if(!byte_check(label,text,item[\"byte\"])){\n            return;\n        }\n    }\n    // 登録処理\n    const commandId = $p.action() == \"new\" ? \"CreateCommand\" : \"UpdateCommand\";\n    $(`#${commandId}`).click();\n}\n\n",
            "Id": 5
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          },
          {
            "Title": "encodingjs読み込み",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js\"></script>",
            "Id": 3
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "\nlet newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n//科目CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n//科目CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n}\n\n//科目CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassA'])\n    oldData['ClassA'] = o_results1[0]['ClassA']\n} catch(e) {\n    oldData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n//科目CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n}\n\n//科目CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassA'])\n    oldData['ClassA'] = o_results1[0]['ClassA']\n} catch(e) {\n    oldData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841992,
      "Title": "製品マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841992,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridView": 1,
        "GridColumns": [
          "ClassA",
          "ClassB",
          "ClassC",
          "ClassD",
          "ClassE",
          "ClassG",
          "NumA",
          "NumD",
          "NumG",
          "NumB",
          "NumE",
          "NumC",
          "NumF",
          "ClassH",
          "ClassI",
          "ClassL",
          "NumH",
          "ClassN",
          "ClassO",
          "ClassP",
          "ClassQ",
          "ClassR",
          "ClassS",
          "ClassT",
          "ClassU",
          "ClassW",
          "ClassX",
          "DescriptionA"
        ],
        "FilterColumns": [
          "ClassA",
          "ClassB",
          "ClassC",
          "ClassD",
          "NumA",
          "NumD",
          "NumG",
          "NumB",
          "NumE",
          "NumC",
          "NumF",
          "ClassL"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "ClassB",
            "_Section-1",
            "ClassC",
            "ClassD",
            "ClassE",
            "ClassG",
            "NumA",
            "NumD",
            "NumG",
            "NumB",
            "NumE",
            "NumC",
            "NumF",
            "ClassH",
            "ClassI",
            "ClassZ",
            "ClassL",
            "ClassM",
            "NumH",
            "ClassN",
            "ClassO",
            "ClassP",
            "ClassQ",
            "ClassR",
            "ClassS",
            "ClassT",
            "ClassU",
            "ClassW",
            "ClassX",
            "DateA",
            "DescriptionA",
            "CheckA",
            "Class100",
            "Title"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "製品No",
            "UseSearch": true,
            "NoWrap": true,
            "ValidateRequired": true,
            "MaxLength": 7.0,
            "ClientRegexValidation": "^[a-zA-Z0-9!@#\\$%\\^\\&\\*\\(\\)_\\+\\-=\\[\\]\\{\\};:'\",<>\\.\\?\\/\\\\|`~]+$",
            "RegexValidationMessage": "英数字または記号のみ入力可能です。"
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "仕様No",
            "NoWrap": true,
            "MaxLength": 7.0,
            "ClientRegexValidation": "^[a-zA-Z0-9ｦ-ﾟ!@#\\$%\\^\\&\\*\\(\\)_\\+\\-=\\[\\]\\{\\};:'\",<>\\.\\?\\/\\\\|`~]*$",
            "RegexValidationMessage": "英数字半角カナ記号のみ入力可能です。"
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "漢字名称",
            "NoWrap": true,
            "ValidateRequired": true,
            "MaxLength": 40.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "カナ名称",
            "NoWrap": true,
            "MaxLength": 40.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassE",
            "LabelText": "ベース色",
            "NoWrap": true,
            "MaxLength": 7.0,
            "ClientRegexValidation": "^[a-zA-Z0-9]*$",
            "RegexValidationMessage": "英数字のみ入力可能です。"
          },
          {
            "ColumnName": "ClassG",
            "LabelText": "入出庫用コード",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassH",
            "LabelText": "単位名",
            "NoWrap": true,
            "MaxLength": 6.0
          },
          {
            "ColumnName": "ClassI",
            "LabelText": "費用区分",
            "ChoicesText": "0\n1",
            "DefaultInput": "0",
            "ValidateRequired": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassL",
            "LabelText": "主仕入先CD",
            "ChoicesText": "[\n    {\n        \"SiteId\": 1841977,\n        \"SearchFormat\": \"[ClassA] __ [ClassB] __ [ClassC]\",\n        \"Value\": \"[ClassA]\",\n        \"Lookups\": [\n             {\n                \"From\": \"ClassB\",\n                \"To\": \"ClassM\"\n              },\n         ]\n    }\n]",
            "UseSearch": true,
            "NoWrap": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassM",
            "SearchType": "ForwardMatch"
          },
          {
            "ColumnName": "ClassM",
            "LabelText": "主仕入先名",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassN",
            "LabelText": "売上税区分CD",
            "ChoicesText": "0\n1\n2",
            "DefaultInput": "0",
            "NoWrap": true,
            "ValidateRequired": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassO",
            "LabelText": "売上税区分",
            "DefaultInput": "0:外税　1:内税　2:非課税",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassP",
            "LabelText": "仕入税区分CD",
            "ChoicesText": "0\n1\n2",
            "DefaultInput": "0",
            "NoWrap": true,
            "ValidateRequired": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassQ",
            "LabelText": "仕入税区分",
            "DefaultInput": "0:外税　1:内税　2:非課税",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassR",
            "LabelText": "在庫区分CD",
            "ChoicesText": "0\n1",
            "DefaultInput": "0",
            "NoWrap": true,
            "ValidateRequired": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassS",
            "LabelText": "在庫区分",
            "DefaultInput": "0:在庫管理する　1:在庫管理しない",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassT",
            "LabelText": "サイズ変更区分CD",
            "ChoicesText": "0\n1",
            "DefaultInput": "0",
            "ValidateRequired": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassU",
            "LabelText": "サイズ変更区分",
            "DefaultInput": "0:変更不可　1:変更可",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassW",
            "LabelText": "取組区分CD",
            "ChoicesText": "0\n1",
            "DefaultInput": "0",
            "NoWrap": true,
            "ValidateRequired": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassX",
            "LabelText": "取組区分",
            "DefaultInput": "0:一般製品　1:取組製品",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "NumA",
            "LabelText": "W",
            "NoWrap": true,
            "Nullable": true,
            "Min": 0.0,
            "Max": 9999.0
          },
          {
            "ColumnName": "NumB",
            "LabelText": "D1",
            "Nullable": true,
            "Min": 0.0,
            "Max": 9999.0,
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "NumC",
            "LabelText": "H1",
            "Nullable": true,
            "Min": 0.0,
            "Max": 9999.0,
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "NumD",
            "LabelText": "D",
            "NoWrap": true,
            "Nullable": true,
            "Min": 0.0,
            "Max": 9999.0
          },
          {
            "ColumnName": "NumE",
            "LabelText": "D2",
            "Nullable": true,
            "Min": 0.0,
            "Max": 9999.0,
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "NumF",
            "LabelText": "H2",
            "Nullable": true,
            "Min": 0.0,
            "Max": 9999.0,
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "NumG",
            "LabelText": "H",
            "NoWrap": true,
            "Nullable": true,
            "Min": 0.0,
            "Max": 9999.0,
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "NumH",
            "LabelText": "定価",
            "NoWrap": true,
            "Nullable": true,
            "Min": 0.0,
            "Max": 99999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumI",
            "LabelText": "売上単価",
            "NoWrap": true
          },
          {
            "ColumnName": "NumJ",
            "LabelText": "仕入単価",
            "NoWrap": true
          },
          {
            "ColumnName": "DateA",
            "LabelText": "取組終了年月"
          },
          {
            "ColumnName": "CheckA",
            "LabelText": "廃盤FLG",
            "NoWrap": true
          },
          {
            "ColumnName": "DescriptionA",
            "LabelText": "メモ"
          },
          {
            "ColumnName": "Class100",
            "LabelText": "主キー項目",
            "ImportKey": true,
            "Hide": true,
            "NoDuplication": true
          },
          {
            "ColumnName": "Title",
            "Hide": true
          },
          {
            "ColumnName": "ClassZ",
            "LabelText": "費用区分名",
            "DefaultInput": "0:部材費　1:労務費",
            "EditorReadOnly": true
          }
        ],
        "Links": [
          {
            "ColumnName": "ClassL",
            "SiteId": 1841977,
            "SearchFormat": "[ClassA] __ [ClassB] __ [ClassC]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassM"
              }
            ],
            "JsonFormat": true
          }
        ],
        "Processes": [
          {
            "Id": 1,
            "Name": "更新",
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[     {item:'ClassC',byte:40},     {item:'ClassD',byte:40},     {item:'ClassE',byte:7},     {item:'ClassH',byte:6}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          },
          {
            "Id": 2,
            "Name": "作成",
            "ScreenType": 10,
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[     {item:'ClassC',byte:40},     {item:'ClassD',byte:40},     {item:'ClassE',byte:7},     {item:'ClassH',byte:6}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc",
              "ClassB": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "CalendarTimePeriod": "Monthly",
            "CalendarFromTo": "DateA",
            "CrosstabGroupByX": "ClassI",
            "CrosstabGroupByY": "ClassI",
            "CrosstabAggregateType": "Total",
            "CrosstabValue": "NumA",
            "CrosstabTimePeriod": "Monthly",
            "KambanAggregateType": "Count",
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "Class100",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          },
          {
            "Title": "作成・更新ボタン非表示",
            "New": true,
            "Edit": true,
            "Body": "#CreateCommand{\n    display:none !important\n}\n#UpdateCommand{\n    display:none !important\n}",
            "Id": 2
          }
        ],
        "Scripts": [
          {
            "Title": "主キー設定",
            "New": true,
            "Edit": true,
            "Body": "$(document).on('change', '#Results_ClassA, #Results_ClassB', function () {\n    var A = $('#Results_ClassA').val();\n    var B = $('#Results_ClassB').val();\n\n   $p.set($('#Results_Class100'), A + '__' + B);\n})",
            "Id": 1
          },
          {
            "Title": "サイズ入力制御",
            "New": true,
            "Edit": true,
            "Body": "//Dに入力されたらD1,D2を読み取り専用にする\n$p.on('change', 'NumD', function () {\n    if ($p.getControl('NumD').val() != \"\") {\n\n        $p.getControl('NumB').attr('readonly', true);\n        $p.getControl('NumB').css('background', '#f5f5f5');\n        $p.getControl('NumE').attr('readonly', true);\n        $p.getControl('NumE').css('background', '#f5f5f5');\n\n    }else if($p.getControl('NumD').val() === \"\") {\n\n        $p.getControl('NumB').attr('readonly', false);\n        $p.getControl('NumB').css('background', '#ffffff');\n        $p.getControl('NumE').attr('readonly', false);\n        $p.getControl('NumE').css('background', '#ffffff');\n    }\n\n});\n//Hに入力されたらH1,H2を読み取り専用にする\n$p.on('change', 'NumG', function () {\n\n    if ($p.getControl('NumG').val() != \"\") {\n\n        $p.getControl('NumC').attr('readonly', true);\n        $p.getControl('NumC').css('background', '#f5f5f5');\n        $p.getControl('NumF').attr('readonly', true);\n        $p.getControl('NumF').css('background', '#f5f5f5');\n\n    }else if($p.getControl('NumG').val() === \"\") {\n\n        $p.getControl('NumC').attr('readonly', false);\n        $p.getControl('NumC').css('background', '#ffffff');\n        $p.getControl('NumF').attr('readonly', false);\n        $p.getControl('NumF').css('background', '#ffffff');\n\n    }\n});\n\n\n//D1に入力されたらDを読み取り専用にする\n$p.on('change', 'NumB', function () {\n    if ($p.getControl('NumB').val() != \"\") {\n\n        $p.getControl('NumD').attr('readonly', true);\n        $p.getControl('NumD').css('background', '#f5f5f5');\n\n    }else if($p.getControl('NumB').val() === \"\" && $p.getControl('NumE').val() === \"\") {\n\n        $p.getControl('NumD').attr('readonly', false);\n        $p.getControl('NumD').css('background', '#ffffff');\n\n    }\n});\n\n\n//D2に入力されたらDを読み取り専用にする\n$p.on('change', 'NumE', function () {\n    if ($p.getControl('NumE').val() != \"\") {\n\n        $p.getControl('NumD').attr('readonly', true);\n        $p.getControl('NumD').css('background', '#f5f5f5');\n\n    }else if($p.getControl('NumB').val() === \"\" && $p.getControl('NumE').val() === \"\") {\n\n        $p.getControl('NumD').attr('readonly', false);\n        $p.getControl('NumD').css('background', '#ffffff');\n\n    }\n});\n\n//H1に入力されたらHを読み取り専用にする\n$p.on('change', 'NumC', function () {\n\n    if ($p.getControl('NumC').val() != \"\") {\n\n        $p.getControl('NumG').attr('readonly', true);\n        $p.getControl('NumG').css('background', '#f5f5f5');\n\n    }else if($p.getControl('NumC').val() === \"\" && $p.getControl('NumF').val() === \"\") {\n\n        $p.getControl('NumG').attr('readonly', false);\n        $p.getControl('NumG').css('background', '#ffffff');\n\n\n    }\n});\n\n//H2に入力されたらHを読み取り専用にする\n$p.on('change', 'NumF', function () {\n\n    if ($p.getControl('NumF').val() != \"\") {\n\n        $p.getControl('NumG').attr('readonly', true);\n        $p.getControl('NumG').css('background', '#f5f5f5');\n\n    }else if($p.getControl('NumC').val() === \"\" && $p.getControl('NumF').val() === \"\") {\n\n        $p.getControl('NumG').attr('readonly', false);\n        $p.getControl('NumG').css('background', '#ffffff');\n\n\n    }\n});",
            "Id": 2
          },
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "\n// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n",
            "Id": 3
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 4
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 5
          },
          {
            "Title": "バイト数チェック",
            "New": true,
            "Edit": true,
            "Body": "/**\n * sjisで使えない文字列を返す\n * @param {string} text エンコード文字列\n * @returns {Array} 文字化けした文字列配列\n */\nfunction detectUnsupportedChars(text) {\n    const utf16Array = Encoding.stringToCode(text); // 文字列をコードポイントの配列に変換\n    const sjisArray = Encoding.convert(utf16Array, 'SJIS', 'UNICODE'); // Shift JIS に変換\n    const restoredArray = Encoding.convert(sjisArray, 'UNICODE', 'SJIS'); // 再び UTF-16 に戻す\n    const restoredText = Encoding.codeToString(restoredArray); // 文字列に変換\n    \n    console.log(text);\n    console.log(restoredText);\n\n    text = Array.from(text);\n\n    let unsupportedChars = [];\n    for (let i = 0; i < text.length; i++) {\n        if (text[i] !== restoredText[i]) {\n            unsupportedChars.push(text[i]); // 変換後に変化した文字をリストアップ\n        }\n    }\n    \n    return unsupportedChars;\n}\n\n/**\n * 全角文字かチェックします。\n * @param str チェック対象の文字列\n * @returns 全角文字の場合 true\n */\nfunction isFullWidth(str) {\n    return /^[^\\x01-\\x7E\\uFF65-\\uFF9F]+$/.test(str);\n}\n\n/**\n * 入力文字のバリデーション\n * @param {string} label 対象項目名\n * @param {string} text 対象文字列\n * @param {number} byte バイト数\n */\nfunction byte_check(label,text,byte){\n    const unsuported_string = detectUnsupportedChars(text);\n    if(unsuported_string.length > 0){\n        alert(`下記文字列は使用できません。\\n${unsuported_string.toString()}`);\n        return false;\n    }\n\n    const byte_count = Array.from(text).reduce((a,b) => a += isFullWidth(b) ? 2 : 1,0);\n    if(byte_count > byte){\n        alert(`${label}の文字数が多すぎます。`);\n        return false;\n    }\n    return true;\n}\n\n// マスタ用\n/*[\n    {item:'ClassA',byte:15},\n    {item:'ClassB',byte:15},\n    {item:'ClassC',byte:15},\n]*/\nfunction maste_byte_check(e,option){\n    for(item of option){\n        const label = $p.getControl(item[\"item\"]).parent().parent().prev().text();\n        const text = $p.getControl(item[\"item\"]).val();\n        if(!byte_check(label,text,item[\"byte\"])){\n            return;\n        }\n    }\n    // 登録処理\n    const commandId = $p.action() == \"new\" ? \"CreateCommand\" : \"UpdateCommand\";\n    $(`#${commandId}`).click();\n}\n\n",
            "Id": 6
          },
          {
            "Title": "主キーを編集不可に",
            "Edit": true,
            "Body": "onEditorLoadFuncs.push(function(){\n    if($p.action() != 'edit'){\n        return;\n    }\n\n    $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_ClassB').attr('disabled',true).css('background-color','#f5f5f5');\n\n})",
            "Id": 7
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'></script>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          },
          {
            "Title": "encodingjs読み込み",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js\"></script>",
            "Id": 3
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//仕入先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassL']);\n    newData['ClassL'] = n_results1[0]['ClassA'];\n} catch(e) {\n    newData['ClassL'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"インポートが失敗しました。ファイルを確認してください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//仕入先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassL']);\n    newData['ClassL'] = n_results1[0]['ClassA'];\n} catch(e) {\n    newData['ClassL'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n//仕入先CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassL'])\n    oldData['ClassL'] = o_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassL'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n//仕入先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassL']);\n    newData['ClassL'] = n_results1[0]['ClassA'];\n} catch(e) {\n    newData['ClassL'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n}\n\n//仕入先CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassL'])\n    oldData['ClassL'] = o_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassL'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841993,
      "Title": "買掛金額マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841993,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB",
          "DateC",
          "NumA",
          "NumB",
          "NumC",
          "NumD",
          "NumE",
          "NumF",
          "NumG",
          "NumH",
          "NumI",
          "DateA",
          "DateB",
          "NumJ"
        ],
        "FilterColumns": [
          "ClassA",
          "ClassB",
          "DateC",
          "DateA",
          "DateB"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "ClassB",
            "DateC",
            "_Section-1",
            "NumA",
            "NumB",
            "NumC",
            "NumD",
            "NumE",
            "NumF",
            "NumG",
            "NumH",
            "NumI",
            "DateA",
            "DateB",
            "NumJ",
            "Title",
            "Class100"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "仕入先CD",
            "ChoicesText": "[\n    {\n        \"SiteId\": 1841977,\n        \"SearchFormat\": \"[ClassA] __ [ClassB] __ [ClassC]\",\n        \"Value\": \"[ClassA]\",\n        \"NoAddButton\" : true,\n        \"Lookups\": [\n             {\n                \"From\": \"ClassB\",\n                \"To\": \"ClassB\"\n              },\n         ]\n    }\n]",
            "UseSearch": true,
            "ValidateRequired": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassB",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "仕入先名",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "NumA",
            "LabelText": "前月残高",
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumB",
            "LabelText": "支払金額",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumC",
            "LabelText": "調整金額",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumD",
            "LabelText": "仕入金額",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumE",
            "LabelText": "返品金額",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumF",
            "LabelText": "訂正金額",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumG",
            "LabelText": "消費税額",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumH",
            "LabelText": "当月残高",
            "NoWrap": true,
            "ExtendedFieldCss": "sdt_disabled",
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumI",
            "LabelText": "非課税金額",
            "NoWrap": true,
            "ExtendedHtmlAfterControl": "<div style=\"padding-left: 100%; margin-top : 10px; white-space:nowrap;\">\n(金額に含まれる)\n</div>",
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumJ",
            "LabelText": "伝票枚数",
            "NoWrap": true,
            "Min": 0.0,
            "Max": 999999999999.0,
            "TextAlign": 20
          },
          {
            "ColumnName": "DateA",
            "LabelText": "買掛開始日付",
            "NoWrap": true,
            "ValidateRequired": true,
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "DateB",
            "LabelText": "買掛終了日付",
            "ValidateRequired": true,
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "Title",
            "Hide": true,
            "NoDuplication": true
          },
          {
            "ColumnName": "Class100",
            "LabelText": "主キー項目",
            "ImportKey": true,
            "Hide": true,
            "NoDuplication": true
          },
          {
            "ColumnName": "DateC",
            "LabelText": "買掛日付",
            "NoWrap": true,
            "ValidateRequired": true,
            "DateFilterSetMode": 2
          }
        ],
        "Links": [
          {
            "ColumnName": "ClassA",
            "SiteId": 1841977,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB] __ [ClassC]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassB"
              }
            ],
            "JsonFormat": true
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc",
              "ClassB": "asc",
              "DateC": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "CalendarTimePeriod": "Monthly",
            "CalendarFromTo": "DateA",
            "CrosstabGroupByX": "ClassA",
            "CrosstabGroupByY": "ClassA",
            "CrosstabAggregateType": "Total",
            "CrosstabValue": "NumA",
            "CrosstabTimePeriod": "Monthly",
            "KambanAggregateType": "Count",
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "Class100",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          }
        ],
        "Scripts": [
          {
            "Title": "主キー設定",
            "New": true,
            "Edit": true,
            "Body": "$(document).on('change', '#Results_ClassA, #Results_ClassC', function () {\n    var A = $('#Results_ClassA').val();\n    var B = $('#Results_DateC').val();\n\n   $p.set($('#Results_Class100'), A + '__' + B);\n})",
            "Id": 1
          },
          {
            "Title": "当月残高計算",
            "New": true,
            "Edit": true,
            "Body": "let Zan  //当月残高\n\n$p.on('change', 'NumA', function () { //前月残高\n    A = $p.getControl('NumA').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumA'), EN(B)); \n    NUM();\n})\n\n\n$p.on('change', 'NumB', function () { //前月残高\n    A = $p.getControl('NumB').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumB'), EN(B));\n    NUM();\n})\n\n\n$p.on('change', 'NumC', function () { //前月残高\n    A = $p.getControl('NumC').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumC'), EN(B));\n    NUM();\n})\n\n$p.on('change', 'NumD', function () { //前月残高\n    A = $p.getControl('NumD').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumD'), EN(B));\n    NUM();\n})\n\n\n$p.on('change', 'NumE', function () { //前月残高\n    A = $p.getControl('NumE').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumE'), EN(B));\n    NUM();\n})\n\n\n$p.on('change', 'NumE', function () { //前月残高\n    A = $p.getControl('NumE').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumE'), EN(B));\n    NUM();\n})\n\n$p.on('change', 'NumF', function () { //前月残高\n    A = $p.getControl('NumF').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumF'), EN(B));\n    NUM();\n})\n\n$p.on('change', 'NumG', function () { //前月残高\n    A = $p.getControl('NumG').val();\n    B = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n\n    $p.set($p.getControl('NumG'), EN(B));\n    NUM();\n})\n//取得した合計金額を数値に変換して計算する関数\nfunction NUM() {\n    A = $p.getControl('NumA').val();\n    B = $p.getControl('NumB').val();\n    C = $p.getControl('NumC').val();\n    D = $p.getControl('NumD').val();\n    E = $p.getControl('NumE').val();\n    F = $p.getControl('NumF').val();\n    G = $p.getControl('NumG').val();\n\n    A1 = parseInt(String(A).replace(/[^0-9]/g, ''), 10);\n    B1 = parseInt(String(B).replace(/[^0-9]/g, ''), 10);\n    C1 = parseInt(String(C).replace(/[^0-9]/g, ''), 10);\n    D1 = parseInt(String(D).replace(/[^0-9]/g, ''), 10);\n    E1 = parseInt(String(E).replace(/[^0-9]/g, ''), 10);\n    F1 = parseInt(String(F).replace(/[^0-9]/g, ''), 10);\n    G1 = parseInt(String(G).replace(/[^0-9]/g, ''), 10);\n\n    let H\n\n    //当月残高=前月残高-入金金額-調整金額+売上金額+返品金額+訂正金額+消費税額\n    H = A1 - B1 - C1 + D1 + E1 + F1 + G1;\n    $p.set($p.getControl('NumH'), EN(H)); //(A)小計\n}\n\n//\\マークと３桁区切りのカンマを追加する関数\nfunction EN(x) {\n    x = '\\xA5' + Math.round(x).toLocaleString();\n    return x;\n}",
            "Id": 2
          },
          {
            "Title": "sdt_disabled",
            "New": true,
            "Edit": true,
            "Body": "// =================================================\n// フィールドCSSに'sdt_disabled'クラスが設定されているフィールドを\n// disabledにします。\n// $p.set()は稼働しますが、手動での操作を制限します。\n// -------------------------------------------------\n// 引数：disabledにするかreadonlyにするか\n// =================================================\n\nfunction setDisabled(type){\n    //該当の入力エリアをdisabled / readonlyにする\n    $('.sdt_disabled input').prop(type, true); // 一般的なinput要素\n    $('.sdt_disabled input[type=\"number\"]').prop(type, true); // 数値用のinput要素\n    $('.sdt_disabled textarea').prop(type, true); // textarea要素\n    $('.sdt_disabled select').prop(type, true); // select要素\n  \n    // selectはreadonlyが効かないのでoptionをdisabledにする\n    // $('.sdt_disabled option').prop('disabled', true);\n    // $('.sdt_disabled option:selected').prop('disabled', false);\n  \n    //コントロールアイコンを削除する\n    $('.sdt_disabled div.field-control div.ui-icon').remove();\n  }\n  \n  \n  onEditorLoadFuncs.push(\n    function () {\n      setDisabled('disabled');\n    }\n  )",
            "Id": 3
          },
          {
            "Title": "日付変更",
            "New": true,
            "Edit": true,
            "Body": "$p.on('change', 'DateC', function () { //売掛日付\n    AA()\n})\n\n//日付を1日に変更する関数\nfunction AA(){\n\n    let Date=$p.getControl(\"DateC\").val()\n    let parts = Date.split(\"/\");\n    parts[2] = 1;\n    let newDate = parts.join(\"/\");\n    $p.set($p.getControl('DateC'), newDate)\n\n}",
            "Id": 4
          },
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n    if($p.action() != 'edit'){\n        return;\n    }\n\n    $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_DateC').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_DateCField .ui-icon').css('display','none');\n})",
            "Id": 5
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 6
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 7
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//仕入先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//仕入先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n//仕入先CDを実データに修正\ntry {\n    results1 = items.Get(results[0]['ClassA'])\n    oldData['ClassA'] = results1[0]['ClassA']\n} catch(e) {\n    oldData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//仕入先CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassA'])\n    newData['ClassA'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassA'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n//仕入先CDを実データに修正\ntry {\n    results1 = items.Get(results[0]['ClassA'])\n    oldData['ClassA'] = results1[0]['ClassA']\n} catch(e) {\n    oldData['ClassA'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841994,
      "Title": "工事担当マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841994,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB",
          "ClassC"
        ],
        "FilterColumns": [
          "ClassA",
          "ClassB"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "_Section-1",
            "ClassB",
            "ClassC",
            "Title"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "工事担当CD",
            "ImportKey": true,
            "ValidateRequired": true,
            "MaxLength": 3.0,
            "ClientRegexValidation": "^[0-9]*$",
            "RegexValidationMessage": "数値のみ入力可能です。"
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "工事担当名",
            "ValidateRequired": true,
            "MaxLength": 16.0
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "順序",
            "MaxLength": 2.0,
            "ClientRegexValidation": "^[0-9]*$",
            "RegexValidationMessage": "数値のみ入力可能です。"
          },
          {
            "ColumnName": "Title",
            "Hide": true,
            "ValidateRequired": false
          }
        ],
        "Processes": [
          {
            "Id": 1,
            "Name": "更新",
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[ {item:'ClassB',byte:16}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          },
          {
            "Id": 2,
            "Name": "作成",
            "ScreenType": 10,
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[ {item:'ClassB',byte:16}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "CalendarTimePeriod": "Monthly",
            "CalendarFromTo": "DateA",
            "CrosstabGroupByX": "CreatedTime",
            "CrosstabGroupByY": "Columns",
            "CrosstabAggregateType": "Total",
            "CrosstabValue": "ClassZ~~3064532,NumC",
            "CrosstabTimePeriod": "Monthly",
            "KambanAggregateType": "Count",
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "ClassA",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          },
          {
            "Title": "作成・更新ボタン非表示",
            "New": true,
            "Edit": true,
            "Body": "#CreateCommand{\n    display:none !important\n}\n#UpdateCommand{\n    display:none !important\n}",
            "Id": 2
          }
        ],
        "Scripts": [
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n    if($p.action() != 'edit'){\n        return;\n    }\n\n    $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n})",
            "Id": 1
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 2
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 3
          },
          {
            "Title": "バイト数チェック",
            "New": true,
            "Edit": true,
            "Body": "/**\n * sjisで使えない文字列を返す\n * @param {string} text エンコード文字列\n * @returns {Array} 文字化けした文字列配列\n */\nfunction detectUnsupportedChars(text) {\n    const utf16Array = Encoding.stringToCode(text); // 文字列をコードポイントの配列に変換\n    const sjisArray = Encoding.convert(utf16Array, 'SJIS', 'UNICODE'); // Shift JIS に変換\n    const restoredArray = Encoding.convert(sjisArray, 'UNICODE', 'SJIS'); // 再び UTF-16 に戻す\n    const restoredText = Encoding.codeToString(restoredArray); // 文字列に変換\n    \n    console.log(text);\n    console.log(restoredText);\n\n    text = Array.from(text);\n\n    let unsupportedChars = [];\n    for (let i = 0; i < text.length; i++) {\n        if (text[i] !== restoredText[i]) {\n            unsupportedChars.push(text[i]); // 変換後に変化した文字をリストアップ\n        }\n    }\n    \n    return unsupportedChars;\n}\n\n/**\n * 全角文字かチェックします。\n * @param str チェック対象の文字列\n * @returns 全角文字の場合 true\n */\nfunction isFullWidth(str) {\n    return /^[^\\x01-\\x7E\\uFF65-\\uFF9F]+$/.test(str);\n}\n\n/**\n * 入力文字のバリデーション\n * @param {string} label 対象項目名\n * @param {string} text 対象文字列\n * @param {number} byte バイト数\n */\nfunction byte_check(label,text,byte){\n    const unsuported_string = detectUnsupportedChars(text);\n    if(unsuported_string.length > 0){\n        alert(`下記文字列は使用できません。\\n${unsuported_string.toString()}`);\n        return false;\n    }\n\n    const byte_count = Array.from(text).reduce((a,b) => a += isFullWidth(b) ? 2 : 1,0);\n    if(byte_count > byte){\n        alert(`${label}の文字数が多すぎます。`);\n        return false;\n    }\n    return true;\n}\n\n// マスタ用\n/*[\n    {item:'ClassA',byte:15},\n    {item:'ClassB',byte:15},\n    {item:'ClassC',byte:15},\n]*/\nfunction maste_byte_check(e,option){\n    for(item of option){\n        const label = $p.getControl(item[\"item\"]).parent().parent().prev().text();\n        const text = $p.getControl(item[\"item\"]).val();\n        if(!byte_check(label,text,item[\"byte\"])){\n            return;\n        }\n    }\n    // 登録処理\n    const commandId = $p.action() == \"new\" ? \"CreateCommand\" : \"UpdateCommand\";\n    $(`#${commandId}`).click();\n}\n\n",
            "Id": 4
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          },
          {
            "Title": "encodingjs読み込み",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js\"></script>",
            "Id": 3
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 1841996,
      "Title": "三和サービス実績入力",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841996,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "EditorColumnHash": {
          "General": [
            "DateA",
            "_Section-1",
            "_Section-3",
            "NumH",
            "NumA",
            "NumI",
            "NumB",
            "NumJ",
            "NumC",
            "NumK",
            "NumD",
            "NumL",
            "NumE",
            "NumM",
            "NumF",
            "NumN",
            "NumG",
            "_Section-4",
            "_Section-2",
            "NumO",
            "NumP",
            "NumQ",
            "NumR",
            "NumS",
            "NumT",
            "NumU",
            "NumV",
            "NumW",
            "NumX"
          ]
        },
        "SectionLatestId": 4,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "貨物",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 3,
            "LabelText": "自車",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 4,
            "LabelText": "庸車",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 2,
            "LabelText": "物流",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "Columns": [
          {
            "ColumnName": "DateA",
            "LabelText": "実績日付"
          },
          {
            "ColumnName": "NumA",
            "LabelText": "売上税抜金額_三和商研"
          },
          {
            "ColumnName": "NumB",
            "LabelText": "売上税抜金額_店装技研"
          },
          {
            "ColumnName": "NumC",
            "LabelText": "売上税抜金額_サンワP"
          },
          {
            "ColumnName": "NumD",
            "LabelText": "売上税抜金額_日本運輸荷造"
          },
          {
            "ColumnName": "NumE",
            "LabelText": "売上税抜金額_トランコム"
          },
          {
            "ColumnName": "NumF",
            "LabelText": "売上税抜金額_その他"
          },
          {
            "ColumnName": "NumG",
            "LabelText": "売上税抜金額_事故"
          },
          {
            "ColumnName": "NumH",
            "LabelText": "原価税抜金額_三和商研",
            "NoWrap": true
          },
          {
            "ColumnName": "NumI",
            "LabelText": "原価税抜金額_店装技研",
            "NoWrap": true
          },
          {
            "ColumnName": "NumJ",
            "LabelText": "原価税抜金額_サンワP",
            "NoWrap": true
          },
          {
            "ColumnName": "NumK",
            "LabelText": "原価税抜金額_日本運輸荷造",
            "NoWrap": true
          },
          {
            "ColumnName": "NumL",
            "LabelText": "原価税抜金額_トランコム",
            "NoWrap": true
          },
          {
            "ColumnName": "NumM",
            "LabelText": "原価税抜金額_その他",
            "NoWrap": true
          },
          {
            "ColumnName": "NumN",
            "LabelText": "原価税抜金額_事故",
            "NoWrap": true
          }
        ],
        "Scripts": [
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n",
            "Id": 1
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 2190740,
      "Title": "入金区分マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841974,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB",
          "ClassD",
          "ClassC"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "_Section-1",
            "ClassB",
            "ClassD",
            "ClassC"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "入金区分CD",
            "ImportKey": true,
            "ValidateRequired": true,
            "NoDuplication": true
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "入金区分名",
            "MaxLength": 10.0
          },
          {
            "ColumnName": "Title",
            "Hide": true,
            "ValidateRequired": false
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "入金種別"
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "入金種別CD"
          }
        ],
        "Processes": [
          {
            "Id": 1,
            "Name": "更新",
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassB',byte:10}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          },
          {
            "Id": 2,
            "Name": "作成",
            "ScreenType": 10,
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassB',byte:10}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "ClassA",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          },
          {
            "Title": "作成・更新ボタン非表示",
            "New": true,
            "Edit": true,
            "Body": "#CreateCommand{\n    display:none !important\n}\n#UpdateCommand{\n    display:none !important\n}",
            "Id": 2
          }
        ],
        "Scripts": [
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n    if($p.action() != 'edit'){\n        return;\n    }\n\n    $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n})",
            "Id": 1
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 2
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 3
          },
          {
            "Title": "バイト数チェック",
            "New": true,
            "Edit": true,
            "Body": "/**\n * sjisで使えない文字列を返す\n * @param {string} text エンコード文字列\n * @returns {Array} 文字化けした文字列配列\n */\nfunction detectUnsupportedChars(text) {\n    const utf16Array = Encoding.stringToCode(text); // 文字列をコードポイントの配列に変換\n    const sjisArray = Encoding.convert(utf16Array, 'SJIS', 'UNICODE'); // Shift JIS に変換\n    const restoredArray = Encoding.convert(sjisArray, 'UNICODE', 'SJIS'); // 再び UTF-16 に戻す\n    const restoredText = Encoding.codeToString(restoredArray); // 文字列に変換\n    \n    console.log(text);\n    console.log(restoredText);\n\n    text = Array.from(text);\n\n    let unsupportedChars = [];\n    for (let i = 0; i < text.length; i++) {\n        if (text[i] !== restoredText[i]) {\n            unsupportedChars.push(text[i]); // 変換後に変化した文字をリストアップ\n        }\n    }\n    \n    return unsupportedChars;\n}\n\n/**\n * 全角文字かチェックします。\n * @param str チェック対象の文字列\n * @returns 全角文字の場合 true\n */\nfunction isFullWidth(str) {\n    return /^[^\\x01-\\x7E\\uFF65-\\uFF9F]+$/.test(str);\n}\n\n/**\n * 入力文字のバリデーション\n * @param {string} label 対象項目名\n * @param {string} text 対象文字列\n * @param {number} byte バイト数\n */\nfunction byte_check(label,text,byte){\n    const unsuported_string = detectUnsupportedChars(text);\n    if(unsuported_string.length > 0){\n        alert(`下記文字列は使用できません。\\n${unsuported_string.toString()}`);\n        return false;\n    }\n\n    const byte_count = Array.from(text).reduce((a,b) => a += isFullWidth(b) ? 2 : 1,0);\n    if(byte_count > byte){\n        alert(`${label}の文字数が多すぎます。`);\n        return false;\n    }\n    return true;\n}\n\n// マスタ用\n/*[\n    {item:'ClassA',byte:15},\n    {item:'ClassB',byte:15},\n    {item:'ClassC',byte:15},\n]*/\nfunction maste_byte_check(e,option){\n    for(item of option){\n        const label = $p.getControl(item[\"item\"]).parent().parent().prev().text();\n        const text = $p.getControl(item[\"item\"]).val();\n        if(!byte_check(label,text,item[\"byte\"])){\n            return;\n        }\n    }\n    // 登録処理\n    const commandId = $p.action() == \"new\" ? \"CreateCommand\" : \"UpdateCommand\";\n    $(`#${commandId}`).click();\n}\n\n",
            "Id": 4
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          },
          {
            "Title": "encodingjs読み込み",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js\"></script>",
            "Id": 3
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 2190749,
      "Title": "支払区分マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 1841974,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB",
          "ClassD",
          "ClassC"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "_Section-1",
            "ClassB",
            "ClassD",
            "ClassC",
            "Title"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "Columns": [
          {
            "ColumnName": "Title",
            "Hide": true,
            "ValidateRequired": false
          },
          {
            "ColumnName": "ClassA",
            "LabelText": "支払区分CD",
            "ImportKey": true
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "支払区分名"
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "支払種別"
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "支払種別CD"
          }
        ],
        "Processes": [
          {
            "Id": 1,
            "Name": "更新",
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[ {item:'ClassB',byte:10}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          },
          {
            "Id": 2,
            "Name": "作成",
            "ScreenType": 10,
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[ {item:'ClassB',byte:10}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "ClassA",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          },
          {
            "Title": "作成・更新ボタン非表示",
            "New": true,
            "Edit": true,
            "Body": "#CreateCommand{\n    display:none !important\n}\n#UpdateCommand{\n    display:none !important\n}",
            "Id": 2
          }
        ],
        "Scripts": [
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n    if($p.action() != 'edit'){\n        return;\n    }\n\n    $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n})",
            "Id": 1
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 2
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 3
          },
          {
            "Title": "バイト数チェック",
            "New": true,
            "Edit": true,
            "Body": "/**\n * sjisで使えない文字列を返す\n * @param {string} text エンコード文字列\n * @returns {Array} 文字化けした文字列配列\n */\nfunction detectUnsupportedChars(text) {\n    const utf16Array = Encoding.stringToCode(text); // 文字列をコードポイントの配列に変換\n    const sjisArray = Encoding.convert(utf16Array, 'SJIS', 'UNICODE'); // Shift JIS に変換\n    const restoredArray = Encoding.convert(sjisArray, 'UNICODE', 'SJIS'); // 再び UTF-16 に戻す\n    const restoredText = Encoding.codeToString(restoredArray); // 文字列に変換\n    \n    console.log(text);\n    console.log(restoredText);\n\n    text = Array.from(text);\n\n    let unsupportedChars = [];\n    for (let i = 0; i < text.length; i++) {\n        if (text[i] !== restoredText[i]) {\n            unsupportedChars.push(text[i]); // 変換後に変化した文字をリストアップ\n        }\n    }\n    \n    return unsupportedChars;\n}\n\n/**\n * 全角文字かチェックします。\n * @param str チェック対象の文字列\n * @returns 全角文字の場合 true\n */\nfunction isFullWidth(str) {\n    return /^[^\\x01-\\x7E\\uFF65-\\uFF9F]+$/.test(str);\n}\n\n/**\n * 入力文字のバリデーション\n * @param {string} label 対象項目名\n * @param {string} text 対象文字列\n * @param {number} byte バイト数\n */\nfunction byte_check(label,text,byte){\n    const unsuported_string = detectUnsupportedChars(text);\n    if(unsuported_string.length > 0){\n        alert(`下記文字列は使用できません。\\n${unsuported_string.toString()}`);\n        return false;\n    }\n\n    const byte_count = Array.from(text).reduce((a,b) => a += isFullWidth(b) ? 2 : 1,0);\n    if(byte_count > byte){\n        alert(`${label}の文字数が多すぎます。`);\n        return false;\n    }\n    return true;\n}\n\n// マスタ用\n/*[\n    {item:'ClassA',byte:15},\n    {item:'ClassB',byte:15},\n    {item:'ClassC',byte:15},\n]*/\nfunction maste_byte_check(e,option){\n    for(item of option){\n        const label = $p.getControl(item[\"item\"]).parent().parent().prev().text();\n        const text = $p.getControl(item[\"item\"]).val();\n        if(!byte_check(label,text,item[\"byte\"])){\n            return;\n        }\n    }\n    // 登録処理\n    const commandId = $p.action() == \"new\" ? \"CreateCommand\" : \"UpdateCommand\";\n    $(`#${commandId}`).click();\n}\n\n",
            "Id": 4
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          },
          {
            "Title": "encodingjs読み込み",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js\"></script>",
            "Id": 3
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 3064531,
      "Title": "担当者マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 3064531,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB",
          "ClassC",
          "ClassD",
          "ClassE",
          "ClassF",
          "NumA"
        ],
        "FilterColumns": [
          "ClassA",
          "ClassB",
          "ClassC",
          "ClassD",
          "ClassE",
          "ClassF",
          "NumA"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "_Section-1",
            "ClassB",
            "ClassC",
            "ClassD",
            "ClassE",
            "ClassF",
            "NumA",
            "Title"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "LinkColumns": [],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "担当者CD",
            "ImportKey": true,
            "ValidateRequired": true,
            "MaxLength": 3.0,
            "ClientRegexValidation": "^[0-9]*$",
            "RegexValidationMessage": "数値のみ入力可能です。"
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "担当者名",
            "ValidateRequired": true,
            "MaxLength": 16.0
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "メールアドレス",
            "NoWrap": true,
            "MaxLength": 30.0,
            "ClientRegexValidation": "^[!-~]+@([!-~]+\\.)+[a-zA-Z]{2,}$",
            "RegexValidationMessage": "アドレスが不正です"
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "部署CD",
            "ChoicesText": "[\n    {\n        \"SiteId\": 3064556,\n        \"SearchFormat\": \"[ClassA] __ [ClassB]\",\n        \"Value\": \"[ClassA]\",\n        \"NoAddButton\" : true,\n        \"Lookups\": [\n              {\n                \"From\": \"ClassB\",\n                \"To\": \"ClassE\"\n              },\n\n         ]\n    }\n]",
            "UseSearch": true,
            "ValidateRequired": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassE",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassE",
            "LabelText": "部署名",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassF",
            "LabelText": "問い合わせ先",
            "NoWrap": true,
            "MaxLength": 16.0
          },
          {
            "ColumnName": "NumA",
            "LabelText": "順序",
            "Nullable": true,
            "Min": 0.0,
            "Max": 99.0
          },
          {
            "ColumnName": "Title",
            "Hide": true
          }
        ],
        "Links": [
          {
            "ColumnName": "ClassD",
            "SiteId": 3064556,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassE"
              }
            ],
            "JsonFormat": true
          }
        ],
        "Processes": [
          {
            "Id": 1,
            "Name": "更新",
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassB',byte:16},         {item:'ClassF',byte:50}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          },
          {
            "Id": 2,
            "Name": "作成",
            "ScreenType": 10,
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassB',byte:16},         {item:'ClassF',byte:50}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "CalendarTimePeriod": "Monthly",
            "CalendarFromTo": "DateA",
            "CrosstabGroupByX": "ClassD",
            "CrosstabGroupByY": "ClassD",
            "CrosstabAggregateType": "Total",
            "CrosstabValue": "NumA",
            "CrosstabTimePeriod": "Monthly",
            "KambanAggregateType": "Count",
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "ClassA",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          },
          {
            "Title": "作成・更新ボタン非表示",
            "New": true,
            "Edit": true,
            "Body": "#CreateCommand{\n    display:none !important\n}\n#UpdateCommand{\n    display:none !important\n}",
            "Id": 2
          }
        ],
        "Scripts": [
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n    if($p.action() != 'edit'){\n        return;\n    }\n\n    $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n})",
            "Id": 1
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 2
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 3
          },
          {
            "Title": "バイト数チェック",
            "New": true,
            "Edit": true,
            "Body": "/**\n * sjisで使えない文字列を返す\n * @param {string} text エンコード文字列\n * @returns {Array} 文字化けした文字列配列\n */\nfunction detectUnsupportedChars(text) {\n    const utf16Array = Encoding.stringToCode(text); // 文字列をコードポイントの配列に変換\n    const sjisArray = Encoding.convert(utf16Array, 'SJIS', 'UNICODE'); // Shift JIS に変換\n    const restoredArray = Encoding.convert(sjisArray, 'UNICODE', 'SJIS'); // 再び UTF-16 に戻す\n    const restoredText = Encoding.codeToString(restoredArray); // 文字列に変換\n    \n    console.log(text);\n    console.log(restoredText);\n\n    text = Array.from(text);\n\n    let unsupportedChars = [];\n    for (let i = 0; i < text.length; i++) {\n        if (text[i] !== restoredText[i]) {\n            unsupportedChars.push(text[i]); // 変換後に変化した文字をリストアップ\n        }\n    }\n    \n    return unsupportedChars;\n}\n\n/**\n * 全角文字かチェックします。\n * @param str チェック対象の文字列\n * @returns 全角文字の場合 true\n */\nfunction isFullWidth(str) {\n    return /^[^\\x01-\\x7E\\uFF65-\\uFF9F]+$/.test(str);\n}\n\n/**\n * 入力文字のバリデーション\n * @param {string} label 対象項目名\n * @param {string} text 対象文字列\n * @param {number} byte バイト数\n */\nfunction byte_check(label,text,byte){\n    const unsuported_string = detectUnsupportedChars(text);\n    if(unsuported_string.length > 0){\n        alert(`下記文字列は使用できません。\\n${unsuported_string.toString()}`);\n        return false;\n    }\n\n    const byte_count = Array.from(text).reduce((a,b) => a += isFullWidth(b) ? 2 : 1,0);\n    if(byte_count > byte){\n        alert(`${label}の文字数が多すぎます。`);\n        return false;\n    }\n    return true;\n}\n\n// マスタ用\n/*[\n    {item:'ClassA',byte:15},\n    {item:'ClassB',byte:15},\n    {item:'ClassC',byte:15},\n]*/\nfunction maste_byte_check(e,option){\n    for(item of option){\n        const label = $p.getControl(item[\"item\"]).parent().parent().prev().text();\n        const text = $p.getControl(item[\"item\"]).val();\n        if(!byte_check(label,text,item[\"byte\"])){\n            return;\n        }\n    }\n    // 登録処理\n    const commandId = $p.action() == \"new\" ? \"CreateCommand\" : \"UpdateCommand\";\n    $(`#${commandId}`).click();\n}\n\n",
            "Id": 4
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          },
          {
            "Title": "encodingjs読み込み",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js\"></script>",
            "Id": 3
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n//部署CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassD'])\n    newData['ClassD'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassD'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n//部署CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassD'])\n    newData['ClassD'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassD'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n}\n\n//部署CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassD'])\n    oldData['ClassD'] = o_results1[0]['ClassA']\n} catch(e) {\n    oldData['ClassD'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n//部署CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassD'])\n    newData['ClassD'] = n_results1[0]['ClassA']\n} catch(e) {\n    newData['ClassD'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n}\n\n//部署CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassD'])\n    oldData['ClassD'] = o_results1[0]['ClassA']\n} catch(e) {\n    oldData['ClassD'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 3064532,
      "Title": "物件入力",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 3064532,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "DateA",
          "ClassB",
          "ClassC",
          "ClassD",
          "ClassE",
          "ClassF",
          "ClassG",
          "ClassH",
          "ClassI",
          "ClassJ",
          "ClassK",
          "ClassL",
          "ClassM",
          "ClassN",
          "ClassO",
          "ClassP",
          "ClassQ",
          "ClassR",
          "ClassS",
          "ClassT",
          "ClassU",
          "ClassV",
          "ClassW",
          "ClassX",
          "ClassY",
          "ClassZ",
          "Class001",
          "DateB",
          "DateC",
          "DateD",
          "Class002",
          "DateE",
          "DateF",
          "DateG",
          "NumA",
          "NumB",
          "NumC",
          "NumD"
        ],
        "FilterColumns": [
          "ClassD",
          "ClassM",
          "ClassV",
          "ClassA",
          "ClassB",
          "DateA"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "_Section-5",
            "DateA",
            "ClassB",
            "ClassC",
            "_Section-6",
            "ClassD",
            "ClassE",
            "ClassF",
            "ClassG",
            "ClassH",
            "ClassI",
            "ClassJ",
            "ClassK",
            "_Section-7",
            "ClassL",
            "ClassM",
            "ClassN",
            "ClassO",
            "ClassP",
            "ClassQ",
            "ClassR",
            "ClassS",
            "ClassT",
            "ClassU",
            "_Section-8",
            "ClassV",
            "ClassW",
            "ClassX",
            "ClassY",
            "ClassZ",
            "Class001",
            "_Section-9",
            "DateB",
            "DateC",
            "DateD",
            "Class002",
            "Class003",
            "DateE",
            "DateF",
            "DateG",
            "_Section-11",
            "NumA",
            "NumB",
            "NumC",
            "NumD",
            "_Links-1842000",
            "Title"
          ]
        },
        "SectionLatestId": 11,
        "Sections": [
          {
            "Id": 5,
            "LabelText": "物件情報",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 6,
            "LabelText": "得意先",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 7,
            "LabelText": "納入先",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 8,
            "LabelText": "担当部署",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 9,
            "LabelText": "予定情報",
            "AllowExpand": false,
            "Expand": true
          },
          {
            "Id": 11,
            "LabelText": "合計金額(参考)",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "LinkColumns": [
          "ClassA",
          "ClassB",
          "ClassC",
          "ClassD"
        ],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "物件番号",
            "ImportKey": true,
            "NoWrap": true,
            "AutoNumberingFormat": "[NNNN]",
            "AutoNumberingDefault": 1000,
            "ValidateRequired": true,
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "物件名",
            "NoWrap": true,
            "MaxLength": 60.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "物件略称",
            "NoWrap": true,
            "MaxLength": 24.0,
            "FieldCss": "field-wide"
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "得意先CD",
            "ChoicesText": "[\r\n  {\r\n    \"SiteId\": 1841987,\r\n    \"NoAddButton\": true,\r\n    \"SearchFormat\": \"[ClassA] __ [ClassB] __ [ClassC]\",\r\n    \"Lookups\": [\r\n      {\r\n        \"From\": \"ClassB\",\r\n        \"To\": \"ClassE\"\r\n      },\r\n      {\r\n        \"From\": \"ClassC\",\r\n        \"To\": \"ClassF\"\r\n      },\r\n      {\r\n        \"From\": \"ClassI\",\r\n        \"To\": \"ClassG\",\r\n        \"Type\": 1\r\n      },\r\n      {\r\n        \"From\": \"ClassJ\",\r\n        \"To\": \"ClassH\"\r\n      },\r\n      {\r\n        \"From\": \"ClassK\",\r\n        \"To\": \"ClassI\"\r\n      },\r\n      {\r\n        \"From\": \"ResultId\",\r\n        \"To\": \"ClassJ\"\r\n      },\r\n      {\r\n        \"From\": \"ClassD\",\r\n        \"To\": \"ClassK\"\r\n      }\r\n    ]\r\n  }\r\n]",
            "UseSearch": true,
            "NoWrap": true,
            "ValidateRequired": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassE,ClassF,ClassG,ClassH,ClassI,ClassJ,ClassK",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassE",
            "LabelText": "得意先名1",
            "MaxLength": 28.0
          },
          {
            "ColumnName": "ClassF",
            "LabelText": "得意先名2",
            "MaxLength": 28.0
          },
          {
            "ColumnName": "ClassG",
            "LabelText": "得TEL",
            "NoWrap": true,
            "MaxLength": 15.0,
            "ClientRegexValidation": "^[0-9\\-]+$",
            "RegexValidationMessage": "半角数字またはハイフンのみ入力可能です。"
          },
          {
            "ColumnName": "ClassH",
            "LabelText": "得FAX",
            "MaxLength": 15.0,
            "ClientRegexValidation": "^[0-9\\-]+$",
            "RegexValidationMessage": "半角数字またはハイフンのみ入力可能です。"
          },
          {
            "ColumnName": "ClassI",
            "LabelText": "得意先担当者",
            "NoWrap": true,
            "MaxLength": 40.0
          },
          {
            "ColumnName": "ClassJ",
            "LabelText": "集計CD",
            "ChoicesText": "[\r\n  {\r\n    \"SiteId\": 1841987,\r\n    \"NoAddButton\": true,\r\n    \"SearchFormat\": \"[ClassA] __ [ClassB] __ [ClassC]\",\r\n    \"Lookups\": [\r\n      {\r\n        \"From\": \"ClassD\",\r\n        \"To\": \"ClassK\"\r\n      }\r\n    ]\r\n  }\r\n]",
            "UseSearch": true,
            "NoWrap": true,
            "MaxLength": 10.0,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassK",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassK",
            "LabelText": "集計",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassL",
            "LabelText": "納入得意先CD",
            "ChoicesText": "[\r\n  {\r\n    \"SiteId\": 1841987,\r\n    \"NoAddButton\": true,\r\n    \"SearchFormat\": \"[ClassA] __ [ClassB] __ [ClassC]\"\r\n  }\r\n]",
            "UseSearch": true,
            "NoWrap": true,
            "ValidateRequired": true,
            "AutoPostBack": true,
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassM",
            "LabelText": "納入先CD",
            "ChoicesText": "[\r\n  {\r\n    \"SiteId\": 1841990,\r\n    \"NoAddButton\": true,\r\n    \"SearchFormat\": \"[ClassD] __ [ClassE] __ [ClassF]\",\r\n    \"Lookups\": [\r\n      {\r\n        \"From\": \"ClassE\",\r\n        \"To\": \"ClassN\"\r\n      },\r\n      {\r\n        \"From\": \"ClassF\",\r\n        \"To\": \"ClassO\"\r\n      },\r\n      {\r\n        \"From\": \"ClassJ\",\r\n        \"To\": \"ClassP\"\r\n      },\r\n      {\r\n        \"From\": \"ClassK\",\r\n        \"To\": \"ClassQ\"\r\n      },\r\n      {\r\n        \"From\": \"ClassL\",\r\n        \"To\": \"ClassR\"\r\n      },\r\n      {\r\n        \"From\": \"ClassM\",\r\n        \"To\": \"ClassS\"\r\n      },\r\n      {\r\n        \"From\": \"ClassN\",\r\n        \"To\": \"ClassT\"\r\n      },\r\n      {\r\n        \"From\": \"ClassO\",\r\n        \"To\": \"ClassU\"\r\n      }\r\n    ]\r\n  }\r\n]",
            "UseSearch": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassN,ClassO,ClassP,ClassQ,ClassR,ClassS,ClassT,ClassU",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassN",
            "LabelText": "納入先名1",
            "MaxLength": 28.0
          },
          {
            "ColumnName": "ClassO",
            "LabelText": "納入先名2",
            "MaxLength": 28.0
          },
          {
            "ColumnName": "ClassP",
            "LabelText": "郵便番号",
            "NoWrap": true,
            "MaxLength": 8.0,
            "ClientRegexValidation": "^\\d{3}-\\d{4}$",
            "RegexValidationMessage": "999-9999形式で入力して下さい。"
          },
          {
            "ColumnName": "ClassQ",
            "LabelText": "住所1",
            "MaxLength": 32.0
          },
          {
            "ColumnName": "ClassR",
            "LabelText": "住所2",
            "MaxLength": 32.0
          },
          {
            "ColumnName": "ClassS",
            "LabelText": "納TEL",
            "NoWrap": true,
            "MaxLength": 15.0,
            "ClientRegexValidation": "^[0-9\\-]+$",
            "RegexValidationMessage": "半角数字またはハイフンのみ入力可能です。"
          },
          {
            "ColumnName": "ClassT",
            "LabelText": "納FAX",
            "MaxLength": 15.0,
            "ClientRegexValidation": "^[0-9\\-]+$",
            "RegexValidationMessage": "半角数字またはハイフンのみ入力可能です。"
          },
          {
            "ColumnName": "ClassU",
            "LabelText": "納入先担当者",
            "NoWrap": true,
            "MaxLength": 40.0
          },
          {
            "ColumnName": "ClassV",
            "LabelText": "担当者CD",
            "ChoicesText": "[\n  {\n    \"SiteId\": 3064531,\n    \"NoAddButton\": true,\n    \"SearchFormat\": \"[ClassA] __ [ClassB]\",\n    \"Lookups\": [\n      {\n        \"From\": \"ClassB\",\n        \"To\": \"ClassW\"\n      },\n      {\n        \"From\": \"ClassD\",\n        \"To\": \"ClassX\"\n      },\n      {\n        \"From\": \"ClassE\",\n        \"To\": \"ClassY\"\n      }\n    ]\n  }\n]",
            "UseSearch": true,
            "NoWrap": true,
            "ValidateRequired": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassW,ClassX,ClassY",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassW",
            "LabelText": "担当者名",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassX",
            "LabelText": "部署CD",
            "ChoicesText": "[\n    {\n        \"SiteId\": 3064556,\n        \"SearchFormat\": \"[ClassA] __ [ClassB] \",\n        \"Value\": \"[ClassA]\",\n        \"NoAddButton\" : true,\n        \"Lookups\": [\n              {\n                \"From\": \"ClassB\",\n                \"To\": \"ClassY\"\n              },\n         ]\n    }\n]",
            "UseSearch": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "ClassY",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "ClassY",
            "LabelText": "部署名",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "ClassZ",
            "LabelText": "工事担当CD",
            "ChoicesText": "[\r\n  {\r\n    \"SiteId\": 1841994,\r\n    \"NoAddButton\": true,\r\n    \"SearchFormat\": \"[ClassA] __ [ClassB]\",\r\n    \"Lookups\": [\r\n      {\r\n        \"From\": \"ClassB\",\r\n        \"To\": \"Class001\"\r\n      }\r\n    ]\r\n  }\r\n]",
            "UseSearch": true,
            "NoWrap": true,
            "ValidateRequired": true,
            "AutoPostBack": true,
            "ColumnsReturnedWhenAutomaticPostback": "Class001",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "NumA",
            "LabelText": "売上合計",
            "NoWrap": true,
            "Min": 0.0,
            "EditorReadOnly": true,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumB",
            "LabelText": "出精値引き",
            "Min": 0.0,
            "EditorReadOnly": true,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumC",
            "LabelText": "原価合計",
            "Min": 0.0,
            "EditorReadOnly": true,
            "TextAlign": 20
          },
          {
            "ColumnName": "NumD",
            "LabelText": "原価率",
            "Min": 0.0,
            "EditorReadOnly": true,
            "TextAlign": 20
          },
          {
            "ColumnName": "DateA",
            "LabelText": "物件登録日付",
            "NoWrap": true,
            "ValidateRequired": true
          },
          {
            "ColumnName": "DateB",
            "LabelText": "予定納期S",
            "NoWrap": true,
            "ValidateRequired": true
          },
          {
            "ColumnName": "DateC",
            "LabelText": "予定納期E"
          },
          {
            "ColumnName": "DateD",
            "LabelText": "予定オープン日"
          },
          {
            "ColumnName": "DateE",
            "LabelText": "予定受付日付",
            "NoWrap": true
          },
          {
            "ColumnName": "DateF",
            "LabelText": "予定完工日付"
          },
          {
            "ColumnName": "DateG",
            "LabelText": "予定請求予定日付"
          },
          {
            "ColumnName": "Class001",
            "LabelText": "工事担当者名",
            "EditorReadOnly": true
          },
          {
            "ColumnName": "Class002",
            "LabelText": "予定業種区分",
            "ChoicesText": "0\n1",
            "NoWrap": true,
            "ExtendedHtmlAfterControl": "<div style=\"padding-left: 100%; margin-top : 10px; white-space:nowrap;\">\n(０:什器　1:内装)\n</div>",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "Class003",
            "LabelText": "予定物件種別",
            "ChoicesText": "0\n1\n2\n6",
            "NoWrap": true,
            "ExtendedHtmlAfterControl": "<div style=\"padding-left: 100%; margin-top : 10px; white-space:nowrap;\">\n(０:新店　1:改装　2:メンテ　6:委託)\n</div>",
            "SearchType": "PartialMatch"
          },
          {
            "ColumnName": "NumE",
            "ControlType": "Normal"
          }
        ],
        "Links": [
          {
            "ColumnName": "ClassM",
            "SiteId": 1841990,
            "NoAddButton": true,
            "SearchFormat": "[ClassD] __ [ClassE] __ [ClassF]",
            "Lookups": [
              {
                "From": "ClassE",
                "To": "ClassN"
              },
              {
                "From": "ClassF",
                "To": "ClassO"
              },
              {
                "From": "ClassJ",
                "To": "ClassP"
              },
              {
                "From": "ClassK",
                "To": "ClassQ"
              },
              {
                "From": "ClassL",
                "To": "ClassR"
              },
              {
                "From": "ClassM",
                "To": "ClassS"
              },
              {
                "From": "ClassN",
                "To": "ClassT"
              },
              {
                "From": "ClassO",
                "To": "ClassU"
              }
            ],
            "JsonFormat": true
          },
          {
            "ColumnName": "ClassL",
            "SiteId": 1841987,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB] __ [ClassC]",
            "JsonFormat": true
          },
          {
            "ColumnName": "ClassJ",
            "SiteId": 1841987,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB] __ [ClassC]",
            "Lookups": [
              {
                "From": "ClassD",
                "To": "ClassK"
              }
            ],
            "JsonFormat": true
          },
          {
            "ColumnName": "ClassD",
            "SiteId": 1841987,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB] __ [ClassC]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassE"
              },
              {
                "From": "ClassC",
                "To": "ClassF"
              },
              {
                "From": "ClassI",
                "To": "ClassG",
                "Type": 1
              },
              {
                "From": "ClassJ",
                "To": "ClassH"
              },
              {
                "From": "ClassK",
                "To": "ClassI"
              },
              {
                "From": "ResultId",
                "To": "ClassJ"
              },
              {
                "From": "ClassD",
                "To": "ClassK"
              }
            ],
            "JsonFormat": true
          },
          {
            "ColumnName": "ClassZ",
            "SiteId": 1841994,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "Class001"
              }
            ],
            "JsonFormat": true
          },
          {
            "ColumnName": "ClassV",
            "SiteId": 3064531,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB]",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassW"
              },
              {
                "From": "ClassD",
                "To": "ClassX"
              },
              {
                "From": "ClassE",
                "To": "ClassY"
              }
            ],
            "JsonFormat": true
          },
          {
            "ColumnName": "ClassX",
            "SiteId": 3064556,
            "NoAddButton": true,
            "SearchFormat": "[ClassA] __ [ClassB] ",
            "Lookups": [
              {
                "From": "ClassB",
                "To": "ClassY"
              }
            ],
            "JsonFormat": true
          }
        ],
        "Processes": [
          {
            "Id": 1,
            "Name": "更新",
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[ {item:'ClassB',byte:60}, {item:'ClassC',byte:24}, {item:'ClassE',byte:28}, {item:'ClassF',byte:28}, {item:'ClassI',byte:40}, {item:'ClassN',byte:28}, {item:'ClassO',byte:28}, {item:'ClassP',byte:8}, {item:'ClassQ',byte:32}, {item:'ClassR',byte:32}, {item:'ClassU',byte:40}, {item:'ClassU',byte:40}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          },
          {
            "Id": 2,
            "Name": "作成",
            "ScreenType": 10,
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[ {item:'ClassB',byte:60}, {item:'ClassC',byte:24}, {item:'ClassE',byte:28}, {item:'ClassF',byte:28}, {item:'ClassI',byte:40}, {item:'ClassN',byte:28}, {item:'ClassO',byte:28}, {item:'ClassP',byte:8}, {item:'ClassQ',byte:32}, {item:'ClassR',byte:32}, {item:'ClassU',byte:40}, {item:'ClassU',byte:40}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "ClassA",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          },
          {
            "Title": "作成・更新ボタン非表示",
            "New": true,
            "Edit": true,
            "Body": "#CreateCommand{\n    display:none !important\n}\n#UpdateCommand{\n    display:none !important\n}",
            "Id": 2
          }
        ],
        "Scripts": [
          {
            "Title": "編集画面",
            "All": true,
            "Body": "\n// 郵便番号横に住所検索ボタンを追加する\ncreateAndAddAddressButton(\"郵便番号\")\n// 得意先名1のフリガナを自動入力する\ninputAutoKana(\"得意先名1\", 'フリガナ', {katakana:true});\ninputAutoRyaku(\"得意先名1\", \"略称\");\n",
            "Id": 1
          },
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n",
            "Id": 2
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 3
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 4
          },
          {
            "Title": "バイト数チェック",
            "New": true,
            "Edit": true,
            "Body": "/**\n * sjisで使えない文字列を返す\n * @param {string} text エンコード文字列\n * @returns {Array} 文字化けした文字列配列\n */\nfunction detectUnsupportedChars(text) {\n    const utf16Array = Encoding.stringToCode(text); // 文字列をコードポイントの配列に変換\n    const sjisArray = Encoding.convert(utf16Array, 'SJIS', 'UNICODE'); // Shift JIS に変換\n    const restoredArray = Encoding.convert(sjisArray, 'UNICODE', 'SJIS'); // 再び UTF-16 に戻す\n    const restoredText = Encoding.codeToString(restoredArray); // 文字列に変換\n    \n    console.log(text);\n    console.log(restoredText);\n\n    text = Array.from(text);\n\n    let unsupportedChars = [];\n    for (let i = 0; i < text.length; i++) {\n        if (text[i] !== restoredText[i]) {\n            unsupportedChars.push(text[i]); // 変換後に変化した文字をリストアップ\n        }\n    }\n    \n    return unsupportedChars;\n}\n\n/**\n * 全角文字かチェックします。\n * @param str チェック対象の文字列\n * @returns 全角文字の場合 true\n */\nfunction isFullWidth(str) {\n    return /^[^\\x01-\\x7E\\uFF65-\\uFF9F]+$/.test(str);\n}\n\n/**\n * 入力文字のバリデーション\n * @param {string} label 対象項目名\n * @param {string} text 対象文字列\n * @param {number} byte バイト数\n */\nfunction byte_check(label,text,byte){\n    const unsuported_string = detectUnsupportedChars(text);\n    if(unsuported_string.length > 0){\n        alert(`下記文字列は使用できません。\\n${unsuported_string.toString()}`);\n        return false;\n    }\n\n    const byte_count = Array.from(text).reduce((a,b) => a += isFullWidth(b) ? 2 : 1,0);\n    if(byte_count > byte){\n        alert(`${label}の文字数が多すぎます。`);\n        return false;\n    }\n    return true;\n}\n\n// マスタ用\n/*[\n    {item:'ClassA',byte:15},\n    {item:'ClassB',byte:15},\n    {item:'ClassC',byte:15},\n]*/\nfunction maste_byte_check(e,option){\n    for(item of option){\n        const label = $p.getControl(item[\"item\"]).parent().parent().prev().text();\n        const text = $p.getControl(item[\"item\"]).val();\n        if(!byte_check(label,text,item[\"byte\"])){\n            return;\n        }\n    }\n    // 登録処理\n    const commandId = $p.action() == \"new\" ? \"CreateCommand\" : \"UpdateCommand\";\n    $(`#${commandId}`).click();\n}\n\n",
            "Id": 5
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          },
          {
            "Title": "encodingjs読み込み",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js\"></script>",
            "Id": 3
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//得意先CD、集計CD、納入得意先CD、納入先CD、担当者CD、部署CD、工事担当CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassD']);\n    newData['ClassD'] = n_results1[0]['ClassA'];\n} catch(e) {\n    newData['ClassD'] = '';\n}\ntry {\n    let n_results2 = items.Get(model['ClassJ']);\n    newData['ClassJ'] = n_results2[0]['ClassA'];\n} catch(e) {\n    newData['ClassJ'] = '';\n}\ntry {\n    let n_results3 = items.Get(model['ClassL']);\n    newData['ClassL'] = n_results3[0]['ClassA'];\n} catch(e) {\n    newData['ClassL'] = '';\n}\ntry {\n    let n_results4 = items.Get(model['ClassM']);\n    newData['ClassM'] = n_results4[0]['ClassD'];\n} catch(e) {\n    newData['ClassM'] = '';\n}\ntry {\n    let n_results5 = items.Get(model['ClassV']);\n    newData['ClassV'] = n_results5[0]['ClassA'];\n} catch(e) {\n    newData['ClassV'] = '';\n}\ntry {\n    let n_results6 = items.Get(model['ClassX']);\n    newData['ClassX'] = n_results6[0]['ClassA'];\n} catch(e) {\n    newData['ClassX'] = '';\n}\ntry {\n    let n_results7 = items.Get(model['ClassZ']);\n    newData['ClassZ'] = n_results7[0]['ClassA'];\n} catch(e) {\n    newData['ClassZ'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//得意先CD、集計CD、納入得意先CD、納入先CD、担当者CD、部署CD、工事担当CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassD']);\n    newData['ClassD'] = n_results1[0]['ClassA'];\n} catch(e) {\n    newData['ClassD'] = '';\n}\ntry {\n    let n_results2 = items.Get(model['ClassJ']);\n    newData['ClassJ'] = n_results2[0]['ClassA'];\n} catch(e) {\n    newData['ClassJ'] = '';\n}\ntry {\n    let n_results3 = items.Get(model['ClassL']);\n    newData['ClassL'] = n_results3[0]['ClassA'];\n} catch(e) {\n    newData['ClassL'] = '';\n}\ntry {\n    let n_results4 = items.Get(model['ClassM']);\n    newData['ClassM'] = n_results4[0]['ClassD'];\n} catch(e) {\n    newData['ClassM'] = '';\n}\ntry {\n    let n_results5 = items.Get(model['ClassV']);\n    newData['ClassV'] = n_results5[0]['ClassA'];\n} catch(e) {\n    newData['ClassV'] = '';\n}\ntry {\n    let n_results6 = items.Get(model['ClassX']);\n    newData['ClassX'] = n_results6[0]['ClassA'];\n} catch(e) {\n    newData['ClassX'] = '';\n}\ntry {\n    let n_results7 = items.Get(model['ClassZ']);\n    newData['ClassZ'] = n_results7[0]['ClassA'];\n} catch(e) {\n    newData['ClassZ'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n//得意先CD、集計CD、納入得意先CD、納入先CD、担当者CD、部署CD、工事担当CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassD']);\n    oldData['ClassD'] = o_results1[0]['ClassA']\n} catch(e) {\n    oldData['ClassD'] = '';\n}\ntry {\n    let o_results2 = items.Get(results[0]['ClassJ']);\n    oldData['ClassJ'] = o_results2[0]['ClassA']\n} catch(e) {\n    oldData['ClassJ'] = '';\n}\ntry {\n    let o_results3 = items.Get(results[0]['ClassL']);\n    oldData['ClassL'] = o_results3[0]['ClassA']\n} catch(e) {\n    oldData['ClassL'] = '';\n}\ntry {\n    let o_results4 = items.Get(results[0]['ClassM']);\n    oldData['ClassM'] = o_results4[0]['ClassD']\n} catch(e) {\n    oldData['ClassM'] = '';\n}\ntry {\n    let o_results5 = items.Get(results[0]['ClassV']);\n    oldData['ClassV'] = o_results5[0]['ClassA']\n} catch(e) {\n    oldData['ClassV'] = '';\n}\ntry {\n    let o_results6 = items.Get(results[0]['ClassX']);\n    oldData['ClassX'] = o_results6[0]['ClassA']\n} catch(e) {\n    oldData['ClassX'] = '';\n}\ntry {\n    let o_results7 = items.Get(results[0]['ClassZ']);\n    oldData['ClassZ'] = o_results7[0]['ClassA']\n} catch(e) {\n    oldData['ClassZ'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n        // 日付型はJSTに修正する\n        if (key.indexOf('Date') !== -1) {\n            newData[key] = model[key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n        }\n    }\n}\n\n//得意先CD、集計CD、納入得意先CD、納入先CD、担当者CD、部署CD、工事担当CDを実データに修正\ntry {\n    let n_results1 = items.Get(model['ClassD']);\n    newData['ClassD'] = n_results1[0]['ClassA'];\n} catch(e) {\n    newData['ClassD'] = '';\n}\ntry {\n    let n_results2 = items.Get(model['ClassJ']);\n    newData['ClassJ'] = n_results2[0]['ClassA'];\n} catch(e) {\n    newData['ClassJ'] = '';\n}\ntry {\n    let n_results3 = items.Get(model['ClassL']);\n    newData['ClassL'] = n_results3[0]['ClassA'];\n} catch(e) {\n    newData['ClassL'] = '';\n}\ntry {\n    let n_results4 = items.Get(model['ClassM']);\n    newData['ClassM'] = n_results4[0]['ClassD'];\n} catch(e) {\n    newData['ClassM'] = '';\n}\ntry {\n    let n_results5 = items.Get(model['ClassV']);\n    newData['ClassV'] = n_results5[0]['ClassA'];\n} catch(e) {\n    newData['ClassV'] = '';\n}\ntry {\n    let n_results6 = items.Get(model['ClassX']);\n    newData['ClassX'] = n_results6[0]['ClassA'];\n} catch(e) {\n    newData['ClassX'] = '';\n}\ntry {\n    let n_results7 = items.Get(model['ClassZ']);\n    newData['ClassZ'] = n_results7[0]['ClassA'];\n} catch(e) {\n    newData['ClassZ'] = '';\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n    // 日付型はJSTに修正する\n    if (key.indexOf('Date') !== -1) {\n        oldData[key] = results[0][key].toLocaleString(\"ja-JP\", {timeZone: \"JST\"});\n    }\n}\n\n//得意先CD、集計CD、納入得意先CD、納入先CD、担当者CD、部署CD、工事担当CDを実データに修正\ntry {\n    let o_results1 = items.Get(results[0]['ClassD']);\n    oldData['ClassD'] = o_results1[0]['ClassA']\n} catch(e) {\n    oldData['ClassD'] = '';\n}\ntry {\n    let o_results2 = items.Get(results[0]['ClassJ']);\n    oldData['ClassJ'] = o_results2[0]['ClassA']\n} catch(e) {\n    oldData['ClassJ'] = '';\n}\ntry {\n    let o_results3 = items.Get(results[0]['ClassL']);\n    oldData['ClassL'] = o_results3[0]['ClassA']\n} catch(e) {\n    oldData['ClassL'] = '';\n}\ntry {\n    let o_results4 = items.Get(results[0]['ClassM']);\n    oldData['ClassM'] = o_results4[0]['ClassD']\n} catch(e) {\n    oldData['ClassM'] = '';\n}\ntry {\n    let o_results5 = items.Get(results[0]['ClassV']);\n    oldData['ClassV'] = o_results5[0]['ClassA']\n} catch(e) {\n    oldData['ClassV'] = '';\n}\ntry {\n    let o_results6 = items.Get(results[0]['ClassX']);\n    oldData['ClassX'] = o_results6[0]['ClassA']\n} catch(e) {\n    oldData['ClassX'] = '';\n}\ntry {\n    let o_results7 = items.Get(results[0]['ClassZ']);\n    oldData['ClassZ'] = o_results7[0]['ClassA']\n} catch(e) {\n    oldData['ClassZ'] = '';\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "RelatingColumns": [
          {
            "Title": "納入連携",
            "Columns": [
              "ClassL",
              "ClassM"
            ],
            "Id": 1
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "AllowRestoreHistories": false,
        "AllowPhysicalDeleteHistories": false,
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 3064556,
      "Title": "部署マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 3064556,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "ClassA",
          "ClassB",
          "ClassC"
        ],
        "EditorColumnHash": {
          "General": [
            "ClassA",
            "_Section-1",
            "ClassB",
            "ClassC",
            "Title"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "ClassA"
        ],
        "Columns": [
          {
            "ColumnName": "ClassA",
            "LabelText": "部署CD",
            "ImportKey": true
          },
          {
            "ColumnName": "ClassB",
            "LabelText": "部署名"
          },
          {
            "ColumnName": "ClassC",
            "LabelText": "順序"
          }
        ],
        "Processes": [
          {
            "Id": 1,
            "Name": "更新",
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassB',byte:16}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          },
          {
            "Id": 2,
            "Name": "作成",
            "ScreenType": 10,
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this),[         {item:'ClassB',byte:16}, ])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "ClassA": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "ClassA",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          },
          {
            "Title": "作成・更新ボタン非表示",
            "New": true,
            "Edit": true,
            "Body": "#CreateCommand{\n    display:none !important\n}\n#UpdateCommand{\n    display:none !important\n}",
            "Id": 2
          }
        ],
        "Scripts": [
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n    if($p.action() != 'edit'){\n        return;\n    }\n\n    $('#Results_ClassA').attr('disabled',true).css('background-color','#f5f5f5');\n})",
            "Id": 1
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 2
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 3
          },
          {
            "Title": "バイト数チェック",
            "New": true,
            "Edit": true,
            "Body": "/**\n * sjisで使えない文字列を返す\n * @param {string} text エンコード文字列\n * @returns {Array} 文字化けした文字列配列\n */\nfunction detectUnsupportedChars(text) {\n    const utf16Array = Encoding.stringToCode(text); // 文字列をコードポイントの配列に変換\n    const sjisArray = Encoding.convert(utf16Array, 'SJIS', 'UNICODE'); // Shift JIS に変換\n    const restoredArray = Encoding.convert(sjisArray, 'UNICODE', 'SJIS'); // 再び UTF-16 に戻す\n    const restoredText = Encoding.codeToString(restoredArray); // 文字列に変換\n    \n    console.log(text);\n    console.log(restoredText);\n\n    text = Array.from(text);\n\n    let unsupportedChars = [];\n    for (let i = 0; i < text.length; i++) {\n        if (text[i] !== restoredText[i]) {\n            unsupportedChars.push(text[i]); // 変換後に変化した文字をリストアップ\n        }\n    }\n    \n    return unsupportedChars;\n}\n\n/**\n * 全角文字かチェックします。\n * @param str チェック対象の文字列\n * @returns 全角文字の場合 true\n */\nfunction isFullWidth(str) {\n    return /^[^\\x01-\\x7E\\uFF65-\\uFF9F]+$/.test(str);\n}\n\n/**\n * 入力文字のバリデーション\n * @param {string} label 対象項目名\n * @param {string} text 対象文字列\n * @param {number} byte バイト数\n */\nfunction byte_check(label,text,byte){\n    const unsuported_string = detectUnsupportedChars(text);\n    if(unsuported_string.length > 0){\n        alert(`下記文字列は使用できません。\\n${unsuported_string.toString()}`);\n        return false;\n    }\n\n    const byte_count = Array.from(text).reduce((a,b) => a += isFullWidth(b) ? 2 : 1,0);\n    if(byte_count > byte){\n        alert(`${label}の文字数が多すぎます。`);\n        return false;\n    }\n    return true;\n}\n\n// マスタ用\n/*[\n    {item:'ClassA',byte:15},\n    {item:'ClassB',byte:15},\n    {item:'ClassC',byte:15},\n]*/\nfunction maste_byte_check(e,option){\n    for(item of option){\n        const label = $p.getControl(item[\"item\"]).parent().parent().prev().text();\n        const text = $p.getControl(item[\"item\"]).val();\n        if(!byte_check(label,text,item[\"byte\"])){\n            return;\n        }\n    }\n    // 登録処理\n    const commandId = $p.action() == \"new\" ? \"CreateCommand\" : \"UpdateCommand\";\n    $(`#${commandId}`).click();\n}\n\n",
            "Id": 4
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          },
          {
            "Title": "encodingjs読み込み",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js\"></script>",
            "Id": 3
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "HideLink": true,
        "TitleSeparator": "",
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    },
    {
      "TenantId": 1,
      "SiteId": 3066123,
      "Title": "人数按分マスタ",
      "SiteName": "",
      "SiteGroupName": "",
      "Body": "",
      "GridGuide": "",
      "EditorGuide": "",
      "CalendarGuide": "",
      "CrosstabGuide": "",
      "GanttGuide": "",
      "BurnDownGuide": "",
      "TimeSeriesGuide": "",
      "AnalyGuide": "",
      "KambanGuide": "",
      "ImageLibGuide": "",
      "ReferenceType": "Results",
      "ParentId": 1841974,
      "InheritPermission": 3066123,
      "SiteSettings": {
        "Version": 1.017,
        "ReferenceType": "Results",
        "GridColumns": [
          "NumB",
          "ClassB",
          "ClassD",
          "NumC",
          "NumD",
          "NumA"
        ],
        "FilterColumns": [
          "NumB",
          "ClassB",
          "NumC",
          "NumD"
        ],
        "EditorColumnHash": {
          "General": [
            "NumB",
            "ClassB",
            "NumC",
            "NumD",
            "_Section-1",
            "ClassD",
            "NumA",
            "Title",
            "Class100"
          ]
        },
        "SectionLatestId": 1,
        "Sections": [
          {
            "Id": 1,
            "LabelText": "",
            "AllowExpand": false,
            "Expand": true
          }
        ],
        "TitleColumns": [
          "NumB"
        ],
        "Columns": [
          {
            "ColumnName": "ClassB",
            "LabelText": "統計集計先CD",
            "ValidateRequired": true,
            "MaxLength": 4.0,
            "ClientRegexValidation": "[a-zA-Z0-9]",
            "RegexValidationMessage": "半角英数で入力してください"
          },
          {
            "ColumnName": "ClassD",
            "LabelText": "集計先名",
            "MaxLength": 25.0
          },
          {
            "ColumnName": "NumA",
            "LabelText": "比率",
            "DecimalPlaces": 2,
            "Min": 0.00,
            "Max": 99.99
          },
          {
            "ColumnName": "Title",
            "Hide": true
          },
          {
            "ColumnName": "Class100",
            "LabelText": "主キー項目",
            "ImportKey": true,
            "Hide": true,
            "NoDuplication": true
          },
          {
            "ColumnName": "NumB",
            "LabelText": "部CD",
            "ValidateRequired": true,
            "Min": 0.0,
            "Max": 9999.0,
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "NumC",
            "LabelText": "営業担当CD",
            "ValidateRequired": true,
            "Min": 0.0,
            "Max": 9999.0,
            "DateFilterSetMode": 2
          },
          {
            "ColumnName": "NumD",
            "LabelText": "工事担当CD",
            "ValidateRequired": true,
            "Min": 0.0,
            "Max": 9999.0,
            "DateFilterSetMode": 2
          }
        ],
        "Processes": [
          {
            "Id": 1,
            "Name": "更新",
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this), [ {item:'ClassD',byte:50},])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          },
          {
            "Id": 2,
            "Name": "作成",
            "ScreenType": 10,
            "CurrentStatus": -1,
            "ChangedStatus": -1,
            "OnClick": "maste_byte_check($(this), [ {item:'ClassD',byte:50},])",
            "View": {
              "Id": 0,
              "ApiColumnKeyDisplayType": 0,
              "ApiColumnValueDisplayType": 0,
              "CalendarSiteId": 0,
              "ApiDataType": 0
            }
          }
        ],
        "ViewLatestId": 1,
        "Views": [
          {
            "Id": 1,
            "Name": "主キーソート",
            "DefaultMode": "Index",
            "ColumnSorterHash": {
              "NumB": "asc",
              "ClassB": "asc",
              "NumC": "asc",
              "NumD": "asc"
            },
            "ApiColumnKeyDisplayType": 0,
            "ApiColumnValueDisplayType": 0,
            "CalendarSiteId": 0,
            "ApiDataType": 0
          }
        ],
        "UpdatableImport": true,
        "DefaultImportKey": "Class100",
        "Styles": [
          {
            "Title": "一括削除ボタン非表示",
            "Index": true,
            "Body": "#BulkDeleteCommand{display:none!important}",
            "Id": 1
          },
          {
            "Title": "作成・更新ボタン非表示",
            "New": true,
            "Edit": true,
            "Body": "#CreateCommand{\n    display:none !important\n}\n#UpdateCommand{\n    display:none !important\n}",
            "Id": 2
          }
        ],
        "Scripts": [
          {
            "Title": "主キー設定",
            "New": true,
            "Edit": true,
            "Body": "$(document).on('change', '#Results_NumB, #Results_ClassB, #Results_NumC, #Results_NumD', function() {\n    var A = $('#Results_NumB').val();\n    var B = $('#Results_ClassB').val();\n    var C = $('#Results_NumC').val();\n    var D = $('#Results_NumD').val();\n\n   $p.set($('#Results_Class100'), A + '__' + B + '__' + C + '__' + D);\n});",
            "Id": 1
          },
          {
            "Title": "10_ロード時処理.js",
            "All": true,
            "Body": "\n// スクリプトに記載しないと動作しないと思われる\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝ロード時処理宣言＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 各画面ロード時に実行するメソッドを格納する\nonGridLoadFuncs = []\nonEditorLoadFuncs = []\n\n// 格納したメソッドを実行するメソッド\n$p.events.on_grid_load = () => {\n    console.log(\"start!! onGridLoadFuncs!!!\")\n    onGridLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n$p.events.on_editor_load = () => {\n    console.log(\"start!! onEditorLoadFuncs!!!\")\n    onEditorLoadFuncs.forEach(func => {\n        // console.log(func)\n        func()\n    })\n}\n\n\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝タイトル修正処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\n\n// 一覧画面\nonGridLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 一覧\"\n})\n\n// 編集画面\nonEditorLoadFuncs.push(() => {\n    // サイトタイトル編集\n    document.title = JSON.parse(document.getElementById(\"JoinedSites\").value)[0].Title + \" - 編集\"\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝一般権限処理＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nlet masterTableFlag = Object.values(MASTER_TABLES).includes($p.siteId())\n\n// 一覧画面\nonGridLoadFuncs.push(async () => {\n    loadPermittion(masterTableFlag)\n    if (masterTableFlag) {\n        setInterval(() => {\n            loadPermittion(masterTableFlag)\n        }, 5000);\n    }\n})\n\n\n// 編集画面\nonEditorLoadFuncs.push(async () => {\n    if (masterTableFlag) {\n        loadPermittion(masterTableFlag)\n    }\n})\n\n// ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝主キーを編集不可に＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝\nonEditorLoadFuncs.push(function(){\n    if($p.action() != 'edit'){\n        return;\n    }\n\n    $('#Results_ClassB').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_NumB').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_NumC').attr('disabled',true).css('background-color','#f5f5f5');\n    $('#Results_NumD').attr('disabled',true).css('background-color','#f5f5f5');\n})",
            "Id": 2
          },
          {
            "Title": "一括削除ボタン追加",
            "Index": true,
            "Body": "$(\"#MainCommands button:last-child\").after($('<button class=\"button button-icon ui-button ui-corner-all ui-widget applied\" onclick=\"o_BulkDelete();\">一括削除</button>'))",
            "Id": 3
          },
          {
            "Title": "BulkDelete.js",
            "Index": true,
            "Body": "//削除ボタン押したときの処理\nasync function o_BulkDelete() {\n    try {\n        // 選択されたIDを取得\n        let selectedIds = $p.selectedIds();\n        console.log(selectedIds);\n\n        // 選択されていない場合はエラーメッセージ\n        if (selectedIds.length === 0) {\n            $p.setMessage('#Message', JSON.stringify({\n                Css: 'alert-error',\n                Text: 'レコードを選択してください。'\n            }));\n            return;\n        }\n\n        // 確認フォームの文言\n        let confirmText = '削除してもよろしいですか。';\n        // 確定して問題ないか聞く\n        let answer = confirm(confirmText);\n        if (!answer) {\n            return;\n        }\n\n        // メッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-warning',\n            Text: '処理中です。'\n        }));\n\n        // レコードごとに処理（0.1秒ごとに実行）\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            $p.apiDelete({\n                id: selectedId\n            });\n        }\n\n        // 処理中のメッセージ消す\n        $p.clearMessage();\n        // 完了のメッセージ出す\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-success',\n            Text: `${selectedIds.length}件のレコードを削除しました。`\n        }));\n\n    } catch (error) {\n        console.error(error);\n        $p.setMessage('#Message', JSON.stringify({\n            Css: 'alert-error',\n            Text: '処理中にエラーが発生しました。'\n        }));\n    }\n}",
            "Id": 4
          },
          {
            "Title": "バイト数チェック",
            "New": true,
            "Edit": true,
            "Body": "/**\n * sjisで使えない文字列を返す\n * @param {string} text エンコード文字列\n * @returns {Array} 文字化けした文字列配列\n */\nfunction detectUnsupportedChars(text) {\n    const utf16Array = Encoding.stringToCode(text); // 文字列をコードポイントの配列に変換\n    const sjisArray = Encoding.convert(utf16Array, 'SJIS', 'UNICODE'); // Shift JIS に変換\n    const restoredArray = Encoding.convert(sjisArray, 'UNICODE', 'SJIS'); // 再び UTF-16 に戻す\n    const restoredText = Encoding.codeToString(restoredArray); // 文字列に変換\n    \n    console.log(text);\n    console.log(restoredText);\n\n    text = Array.from(text);\n\n    let unsupportedChars = [];\n    for (let i = 0; i < text.length; i++) {\n        if (text[i] !== restoredText[i]) {\n            unsupportedChars.push(text[i]); // 変換後に変化した文字をリストアップ\n        }\n    }\n    \n    return unsupportedChars;\n}\n\n/**\n * 全角文字かチェックします。\n * @param str チェック対象の文字列\n * @returns 全角文字の場合 true\n */\nfunction isFullWidth(str) {\n    return /^[^\\x01-\\x7E\\uFF65-\\uFF9F]+$/.test(str);\n}\n\n/**\n * 入力文字のバリデーション\n * @param {string} label 対象項目名\n * @param {string} text 対象文字列\n * @param {number} byte バイト数\n */\nfunction byte_check(label,text,byte){\n    const unsuported_string = detectUnsupportedChars(text);\n    if(unsuported_string.length > 0){\n        alert(`下記文字列は使用できません。\\n${unsuported_string.toString()}`);\n        return false;\n    }\n\n    const byte_count = Array.from(text).reduce((a,b) => a += isFullWidth(b) ? 2 : 1,0);\n    if(byte_count > byte){\n        alert(`${label}の文字数が多すぎます。`);\n        return false;\n    }\n    return true;\n}\n\n// マスタ用\n/*[\n    {item:'ClassA',byte:15},\n    {item:'ClassB',byte:15},\n    {item:'ClassC',byte:15},\n]*/\nfunction maste_byte_check(e,option){\n    for(item of option){\n        const label = $p.getControl(item[\"item\"]).parent().parent().prev().text();\n        const text = $p.getControl(item[\"item\"]).val();\n        if(!byte_check(label,text,item[\"byte\"])){\n            return;\n        }\n    }\n    // 登録処理\n    const commandId = $p.action() == \"new\" ? \"CreateCommand\" : \"UpdateCommand\";\n    $(`#${commandId}`).click();\n}\n\n",
            "Id": 5
          }
        ],
        "Htmls": [
          {
            "Title": "dev_assets_required",
            "PositionType": 1000,
            "All": true,
            "Body": "<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/02_開発環境向け共通変数.js?ts=<?= time() ?'></script>\n<script src='http://192.168.10.54:8000/pleasanter/01_共通/Scripts/99_権限処理.js?ts=<?= time()'></script>",
            "Id": 1
          },
          {
            "Title": "pro_assets_required",
            "PositionType": 1000,
            "All": true,
            "Disabled": true,
            "Body": "<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/03_本番環境向け共通変数.js'>\n<script src='http://192.168.0.7:8000/pleasanter/01_共通/Scripts/99_権限処理.js'></script>",
            "Id": 2
          },
          {
            "Title": "encodingjs読み込み",
            "PositionType": 1000,
            "New": true,
            "Edit": true,
            "Body": "    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js\"></script>",
            "Id": 3
          }
        ],
        "ServerScripts": [
          {
            "Title": "createSync.js",
            "Name": "作成同期",
            "BeforeCreate": true,
            "Body": "let newData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/create\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 1
          },
          {
            "Title": "updateSync.js",
            "Name": "更新同期",
            "BeforeUpdate": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n    oldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.new_data = newData;\ndata.old_data = oldData;\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/update\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 2
          },
          {
            "Title": "deleteSync.js",
            "Name": "削除同期",
            "BeforeDelete": true,
            "Body": "let newData = {};\nlet oldData = {};\n\n// model から必要なフィールドを抽出してnewDataにセット\nfor (let key in model) {\n    if (model.hasOwnProperty(key)) {\n        newData[key] = model[key];\n    }\n}\n\nlet results = items.Get(model.ResultId)\n// newData と同じフィールドを抽出し oldData にセット\nfor (let key in newData) {\n\toldData[key] = results[0][key];\n}\n\n// 送信するパラメータをオブジェクトで定義\nlet data = {}\ndata.pleasanter_table_name = context.SiteTitle;\ndata.old_data = oldData;\n\n\n// オブジェクトをJSON文字列に変換して、Contentプロパティにセット\nhttpClient.Content = JSON.stringify(data);\n\nhttpClient.Encoding = \"utf-8\";\nhttpClient.MediaType = \"application/json\";\n\n// FastAPI サーバーのエンドポイントを指定\nhttpClient.RequestUri = \"http://localhost:8000/sync-record/delete\";\n\ntry{\n    // POST メソッドでリクエストを送信する\n    let response = httpClient.Post();\n\n    // レスポンスの結果をチェックする\n    if (!httpClient.IsSuccess) {\n        // エラーの場合、ステータスコードとレスポンス内容をログに出力し、例外を発生させる\n        context.AddMessage(\"Error: 【\" + httpClient.StatusCode + \"】 \" + response, \"alert-error\");\n        throw new Error(\"HTTPリクエストに失敗しました。以降の処理を中断します。\");\n    }\n} catch (e) {\n    context.Error(\"実行処理がエラーとなりました。登録内容をご確認ください。\");\n    context.Log(e.stack);\n}",
            "Id": 3
          }
        ],
        "AutoVerUpType": 2,
        "AllowCopy": false,
        "HideLink": true,
        "NoDisplayIfReadOnly": false
      },
      "Publish": false,
      "DisableCrossSearch": false,
      "Comments": []
    }
  ],
  "Data": [],
  "Permissions": [],
  "PermissionIdList": {
    "DeptIdList": [],
    "GroupIdList": [],
    "UserIdList": []
  }
}