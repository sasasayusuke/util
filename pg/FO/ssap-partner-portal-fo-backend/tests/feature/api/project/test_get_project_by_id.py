from datetime import datetime

import pytest
from app.main import app
from app.models.master import MasterSupporterOrganizationModel
from app.models.project import (
    GrossProfitAttribute,
    ProjectModel,
    SalesforceMainCustomerAttribute,
)
from app.models.user import UserModel
from app.resources.const import DataType, MasterDataType, UserRoleType
from app.service.project_service import ProjectService
from fastapi import HTTPException, status
from fastapi.testclient import TestClient
from pynamodb.exceptions import DoesNotExist
from pytz import timezone

client = TestClient(app)


class TestGetProjectById:
    @pytest.mark.parametrize(
        "project_id, project_model, expected, master_model, user_models",
        [
            (
                "efba46d3-1d56-428b-ac6d-a51e263b54a8",
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_opportunity_id="a03d1661-cdab-494c-818e-d4845088269b",
                    salesforce_update_at=timezone("Asia/Tokyo").localize(
                        datetime.strptime(
                            "2020/10/23 03:21",
                            "%Y/%m/%d %H:%M",
                        )
                    ),
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    service_manager_name="山田太郎",
                    main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    is_solver_project=False,
                    dedicated_survey_user_name="山田太郎",
                    dedicated_survey_user_email="user@sample.com",
                    is_survey_email_to_salesforce_main_customer=True,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="a9b67094-cdab-494c-818e-d4845088269b",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {
                    "id": "efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    "salesforceCustomerId": "c9b67094-cdab-494c-818e-d4845088269b",
                    "salesforceOpportunityId": "a03d1661-cdab-494c-818e-d4845088269b",
                    "salesforceUpdateAt": "2020/10/23 03:21",
                    "name": "サンプルプロジェクト",
                    "customerName": "ソニーグループ株式会社",
                    "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "serviceTypeName": "組織開発",
                    "createNew": True,
                    "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                    "mainSalesUserName": "田中太郎",
                    "phase": "プラン提示(D)",
                    "customerSuccess": "DXの実現",
                    "supportDateFrom": "2021/01/30",
                    "supportDateTo": "2021/02/28",
                    "profit": {
                        "monthly": [
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        "quarterly": [1200000, 1200000, 1200000, 1200000],
                        "half": [2400000, 2400000],
                        "year": 4800000,
                    },
                    "totalContractTime": 200,
                    "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                    "mainCustomerUserName": "田中次郎",
                    "salesforceMainCustomer": {
                        "name": "山田太郎",
                        "email": "yamada@example.com",
                        "organizationName": "IST",
                    },
                    "customerUsers": [
                        {"id": "c9b67094-cdab-494c-818e-d4845088269b", "name": "田中三郎"}
                    ],
                    "serviceManagerName": "山田太郎",
                    "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                    "mainSupporterUserName": "田中三郎",
                    "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "supporterOrganizationName": "IST",
                    "salesforceMainSupporterUserName": "山田太郎",
                    "supporterUsers": [
                        {"id": "c9b67094-cdab-494c-818e-d4845088269b", "name": "田中三郎"}
                    ],
                    "salesforceSupporterUserNames": ["山田太郎", "山田次郎"],
                    "isCountManHour": True,
                    "isKarteRemind": True,
                    "isMasterKarteRemind": True,
                    "contractType": "有償",
                    "isSecret": False,
                    "isSolverProject": False,
                    "dedicatedSurveyUserName": "山田太郎",
                    "dedicatedSurveyUserEmail": "user@sample.com",
                    "isSurveyEmailToSalesforceMainCustomer": True,
                    "createId": "998c3cd7-63b5-453f-9de2-5af21d565b98",
                    "createAt": "2022-05-23T16:34:21.523+09:00",
                    "updateId": "a9b67094-cdab-494c-818e-d4845088269b",
                    "updateUserName": "田中太郎",
                    "updateAt": "2022-05-23T16:34:21.523+09:00",
                    "version": 1,
                },
                # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
                MasterSupporterOrganizationModel(
                    id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                    name="組織開発",
                    value="IST",
                    attributes=None,
                    order=1,
                    use=True,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # MasterSupporterOrganizationModel(
                #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                #     name="組織開発",
                #     value=None,
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                # MasterSupporterOrganizationModel(
                #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
                #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
                #     name="Ideation Service Team",
                #     value="IST",
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                        data_type=DataType.USER,
                        name="山田太郎",
                        email="taro.yamada@example.com",
                        job="部長",
                        supporter_organization_id=[
                            "89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"
                        ],
                        organization_name="IST",
                        cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                        role="supporter_mgr",
                    ),
                ],
            ),
        ],
    )
    @pytest.mark.usefixtures("auth_user")
    def test_ok(
        self, mocker, project_id, project_model, expected, master_model, user_models
    ):
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        mock_master_supporter.return_value = master_model
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = user_models
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model

        response = client.get(f"/api/projects/{project_id}")

        actual = response.json()
        assert response.status_code == 200
        assert actual == expected

    @pytest.mark.usefixtures("auth_customer_user")
    def test_auth_ok_customer(
        self,
        mocker,
    ):
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                customer_name="取引先株式会社",
                job="部長",
                organization_name="コンサルティング事業部",
                project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                agreed=True,
                role=UserRoleType.CUSTOMER.key,
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="886a3144-9650-4a34-8a23-3b02f3b9aeac",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
            name="サンプルプロジェクト",
            customer_name="取引先株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=False,
            dedicated_survey_user_name="山田太郎",
            dedicated_survey_user_email="user@sample.com",
            is_survey_email_to_salesforce_main_customer=True,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="a9b67094-cdab-494c-818e-d4845088269b",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}")
        assert response.status_code == 200

    @pytest.mark.usefixtures("auth_supporter_user")
    def test_auth_ok_supporter(
        self,
        mocker,
    ):
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                company="テスト株式会社",
                supporter_organization_id=["556a3144-9650-4a34-8a23-3b02f3b9aeac"],
                is_input_man_hour=True,
                project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                agreed=True,
                role=UserRoleType.SUPPORTER.key,
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=False,
            dedicated_survey_user_name="山田太郎",
            dedicated_survey_user_email="user@sample.com",
            is_survey_email_to_salesforce_main_customer=True,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="a9b67094-cdab-494c-818e-d4845088269b",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}")
        assert response.status_code == 200

    @pytest.mark.usefixtures("auth_sales_user")
    def test_auth_ok_sales(
        self,
        mocker,
    ):
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                company="テスト株式会社",
                is_input_man_hour=True,
                project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                agreed=True,
                role=UserRoleType.SALES.key,
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=False,
            dedicated_survey_user_name="山田太郎",
            dedicated_survey_user_email="user@sample.com",
            is_survey_email_to_salesforce_main_customer=True,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="a9b67094-cdab-494c-818e-d4845088269b",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}")
        assert response.status_code == 200

    @pytest.mark.usefixtures("auth_supporter_mgr_user")
    def test_auth_ok_supporter_mgr(
        self,
        mocker,
    ):
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                company="テスト株式会社",
                supporter_organization_id=["556a3144-9650-4a34-8a23-3b02f3b9aeac"],
                is_input_man_hour=True,
                project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                agreed=True,
                role=UserRoleType.SUPPORTER_MGR.key,
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=False,
            dedicated_survey_user_name="山田太郎",
            dedicated_survey_user_email="user@sample.com",
            is_survey_email_to_salesforce_main_customer=True,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="a9b67094-cdab-494c-818e-d4845088269b",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}")
        assert response.status_code == 200

    @pytest.mark.parametrize(
        "project_model",
        [
            # 顧客, 自身の案件以外（別顧客の案件）
            ProjectModel(
                id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                data_type=DataType.PROJECT,
                salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                name="サンプルプロジェクト",
                customer_name="ソニーグループ株式会社",
                service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                create_new=True,
                continued=True,
                main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                contract_date="2021/01/30",
                phase="プラン提示(D)",
                customer_success="DXの実現",
                support_date_from="2021/01/30",
                support_date_to="2021/02/28",
                profit=GrossProfitAttribute(
                    monthly=[
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                    ],
                    quarterly=[1200000, 1200000, 1200000, 1200000],
                    half=[2400000, 2400000],
                    year=4800000,
                ),
                total_contract_time=200,
                main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                salesforce_main_customer=SalesforceMainCustomerAttribute(
                    name="山田太郎",
                    email="yamada@example.com",
                    organization_name="IST",
                    job="部長",
                ),
                customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
                service_manager_name="山田太郎",
                main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                salesforce_main_supporter_user_name="山田太郎",
                supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
                salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                is_count_man_hour=True,
                is_karte_remind=True,
                is_master_karte_remind=True,
                contract_type="有償",
                is_secret=False,
                is_solver_project=False,
                create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                create_at="2022-05-23T16:34:21.523000+0000",
                update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                update_at="2022-05-23T16:34:21.523000+0000",
                version=1,
            ),
        ],
    )
    @pytest.mark.usefixtures("auth_customer_user")
    def test_auth_error_customer(
        self,
        mocker,
        project_model,
    ):
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                customer_name="取引先株式会社",
                job="部長",
                organization_name="コンサルティング事業部",
                project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                agreed=True,
                role=UserRoleType.CUSTOMER.key,
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}")
        assert response.status_code == 403

    @pytest.mark.parametrize(
        "project_model",
        [
            # 支援者, 所属していない非公開案件
            ProjectModel(
                id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                data_type=DataType.PROJECT,
                salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                name="サンプルプロジェクト",
                customer_name="ソニーグループ株式会社",
                service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                create_new=True,
                continued=True,
                main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                contract_date="2021/01/30",
                phase="プラン提示(D)",
                customer_success="DXの実現",
                support_date_from="2021/01/30",
                support_date_to="2021/02/28",
                profit=GrossProfitAttribute(
                    monthly=[
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                    ],
                    quarterly=[1200000, 1200000, 1200000, 1200000],
                    half=[2400000, 2400000],
                    year=4800000,
                ),
                total_contract_time=200,
                main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                salesforce_main_customer=SalesforceMainCustomerAttribute(
                    name="山田太郎",
                    email="yamada@example.com",
                    organization_name="IST",
                    job="部長",
                ),
                customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
                service_manager_name="山田太郎",
                main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                salesforce_main_supporter_user_name="山田太郎",
                supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
                salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                is_count_man_hour=True,
                is_karte_remind=True,
                is_master_karte_remind=True,
                contract_type="有償",
                is_secret=True,
                is_solver_project=False,
                create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                create_at="2022-05-23T16:34:21.523000+0000",
                update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                update_at="2022-05-23T16:34:21.523000+0000",
                version=1,
            ),
        ],
    )
    @pytest.mark.usefixtures("auth_supporter_user")
    def test_auth_error_supporter(
        self,
        mocker,
        project_model,
    ):
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                company="テスト株式会社",
                supporter_organization_id=["556a3144-9650-4a34-8a23-3b02f3b9aeac"],
                is_input_man_hour=True,
                project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                agreed=True,
                role=UserRoleType.SUPPORTER.key,
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}")
        assert response.status_code == 403

    @pytest.mark.parametrize(
        "project_model",
        [
            # 営業担当者, 所属していない非公開案件
            ProjectModel(
                id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                data_type=DataType.PROJECT,
                salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                name="サンプルプロジェクト",
                customer_name="ソニーグループ株式会社",
                service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                create_new=True,
                continued=True,
                main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                contract_date="2021/01/30",
                phase="プラン提示(D)",
                customer_success="DXの実現",
                support_date_from="2021/01/30",
                support_date_to="2021/02/28",
                profit=GrossProfitAttribute(
                    monthly=[
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                    ],
                    quarterly=[1200000, 1200000, 1200000, 1200000],
                    half=[2400000, 2400000],
                    year=4800000,
                ),
                total_contract_time=200,
                main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                salesforce_main_customer=SalesforceMainCustomerAttribute(
                    name="山田太郎",
                    email="yamada@example.com",
                    organization_name="IST",
                    job="部長",
                ),
                customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
                service_manager_name="山田太郎",
                main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                salesforce_main_supporter_user_name="山田太郎",
                supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
                salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                is_count_man_hour=True,
                is_karte_remind=True,
                is_master_karte_remind=True,
                contract_type="有償",
                is_secret=True,
                is_solver_project=False,
                create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                create_at="2022-05-23T16:34:21.523000+0000",
                update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                update_at="2022-05-23T16:34:21.523000+0000",
                version=1,
            ),
        ],
    )
    @pytest.mark.usefixtures("auth_sales_user")
    def test_auth_error_sales(
        self,
        mocker,
        project_model,
    ):
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                company="テスト株式会社",
                is_input_man_hour=True,
                project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                agreed=True,
                role=UserRoleType.SALES.key,
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}")
        assert response.status_code == 403

    @pytest.mark.parametrize(
        "project_model",
        [
            # 支援者責任者, 所属していない非公開案件
            ProjectModel(
                id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                data_type=DataType.PROJECT,
                salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                name="サンプルプロジェクト",
                customer_name="ソニーグループ株式会社",
                service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                create_new=True,
                continued=True,
                main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                contract_date="2021/01/30",
                phase="プラン提示(D)",
                customer_success="DXの実現",
                support_date_from="2021/01/30",
                support_date_to="2021/02/28",
                profit=GrossProfitAttribute(
                    monthly=[
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                        400000,
                    ],
                    quarterly=[1200000, 1200000, 1200000, 1200000],
                    half=[2400000, 2400000],
                    year=4800000,
                ),
                total_contract_time=200,
                main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                salesforce_main_customer=SalesforceMainCustomerAttribute(
                    name="山田太郎",
                    email="yamada@example.com",
                    organization_name="IST",
                    job="部長",
                ),
                customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
                service_manager_name="山田太郎",
                main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                salesforce_main_supporter_user_name="山田太郎",
                supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
                salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                is_count_man_hour=True,
                is_karte_remind=True,
                is_master_karte_remind=True,
                contract_type="有償",
                is_secret=True,
                is_solver_project=False,
                is_survey_email_to_salesforce_main_customer=True,
                create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                create_at="2022-05-23T16:34:21.523000+0000",
                update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                update_at="2022-05-23T16:34:21.523000+0000",
                version=1,
            ),
        ],
    )
    @pytest.mark.usefixtures("auth_supporter_mgr_user")
    def test_auth_error_supporter_mgr(
        self,
        mocker,
        project_model,
    ):
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                company="テスト株式会社",
                supporter_organization_id=["556a3144-9650-4a34-8a23-3b02f3b9aeac"],
                is_input_man_hour=True,
                project_ids=["886a3144-9650-4a34-8a23-3b02f3b9aeac"],
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                agreed=True,
                role=UserRoleType.SUPPORTER_MGR.key,
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}")
        assert response.status_code == 200

    @pytest.mark.usefixtures("auth_user")
    def test_customer_not_found(self, mocker):
        """案件が存在しない時のテスト"""
        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        mock = mocker.patch.object(ProjectModel, "get")
        mock.side_effect = DoesNotExist()

        response = client.get(f"/api/projects/{project_id}")

        actual = response.json()
        assert response.status_code == 404
        assert actual["detail"] == "Not found"

    @pytest.mark.usefixtures("auth_user")
    def test_400_service_type_not_exists(
        self,
        mocker,
    ):
        """サービス区分の存在チェックエラー"""
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        mock_master_supporter.side_effect = DoesNotExist()
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                job="部長",
                supporter_organization_id=["89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"],
                organization_name="IST",
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                role="supporter_mgr",
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=False,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}")
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'serviceType'], 'msg': 'Not exist.'}]"
        )

    @pytest.mark.usefixtures("auth_user")
    def test_400_supporter_organization_id_not_exists(
        self,
        mocker,
    ):
        """支援者組織（課）IDの存在チェックエラー"""
        mocker.patch.object(MasterSupporterOrganizationModel, "get")
        mock_master_supporter = mocker.patch.object(ProjectService, "get_service_name")
        mock_master_supporter.side_effect = HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=[{"loc": ["body", "supporterOrganizationId"], "msg": "Not exist."}],
        )
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                job="部長",
                supporter_organization_id=["89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"],
                organization_name="IST",
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                role="supporter_mgr",
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=False,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}")
        assert response.status_code == 400

    @pytest.mark.usefixtures("auth_user")
    def test_400_main_sales_user_id_not_exists(
        self,
        mocker,
    ):
        """営業担当者IDの存在チェックエラー"""
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                job="部長",
                supporter_organization_id=["89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"],
                organization_name="IST",
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                role="supporter_mgr",
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            # main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            main_sales_user_id="xxxxxxxx-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=False,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}")
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'mainSalesUserId'], 'msg': 'Not exist.'}]"
        )

    @pytest.mark.usefixtures("auth_user")
    def test_400_main_customer_user_id_not_exists(
        self,
        mocker,
    ):
        """担当顧客（取引先責任者）IDの存在チェックエラー"""
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906 a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                job="部長",
                supporter_organization_id=["89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"],
                organization_name="IST",
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                role="supporter_mgr",
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            # main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            main_customer_user_id="xxxxxxxx-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=False,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}")
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'mainCustomerUserId'], 'msg': 'Not exist.'}]"
        )

    @pytest.mark.usefixtures("auth_user")
    def test_400_main_supporter_user_id_not_exists(
        self,
        mocker,
    ):
        """メイン支援者（主担当）IDの存在チェックエラー"""
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                job="部長",
                supporter_organization_id=["89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"],
                organization_name="IST",
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                role="supporter_mgr",
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            # main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            main_supporter_user_id="xxxxxxxx-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=False,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}")
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'mainSupporterUserId'], 'msg': 'Not exist.'}]"
        )

    @pytest.mark.usefixtures("auth_user")
    def test_400_customer_users_not_exists(
        self,
        mocker,
    ):
        """顧客メンバーIDの存在チェックエラー"""
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                job="部長",
                supporter_organization_id=["89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"],
                organization_name="IST",
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                role="supporter_mgr",
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            # customer_user_ids=set(
            #     list(["c9b67094-cdab-494c-818e-d4845088269b"])
            # ),
            customer_user_ids=set(list(["xxxxxxxx-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=False,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}")
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'customerUsers'], 'msg': 'Not exist.'}]"
        )

    @pytest.mark.usefixtures("auth_user")
    def test_400_supporter_users_not_exists(
        self,
        mocker,
    ):
        """支援メンバー（副担当）IDの存在チェックエラー"""
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                data_type=DataType.USER,
                name="山田太郎",
                email="taro.yamada@example.com",
                job="部長",
                supporter_organization_id=["89cbe2ed-f44c-4a1c-9408-c67b0ca2270d"],
                organization_name="IST",
                cognito_id="itk5s7d0-fj4s-kg05-b238-kld430d2bb97",
                role="supporter_mgr",
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            # supporter_user_ids=set(
            #     list(["c9b67094-cdab-494c-818e-d4845088269b"])
            # ),
            supporter_user_ids=set(list(["xxxxxxxx-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=False,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}")
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'supporterUsers'], 'msg': 'Not exist.'}]"
        )
