# 個別カルテ作成手順書 - 新人向けガイド

## 📋 目次
1. [概要](#概要)
2. [前提条件](#前提条件)
3. [ロール別アクセス権限](#ロール別アクセス権限)
4. [カルテ作成の流れ](#カルテ作成の流れ)
5. [画面操作手順](#画面操作手順)
6. [カルテ入力項目](#カルテ入力項目)
7. [注意事項](#注意事項)
8. [トラブルシューティング](#トラブルシューティング)

---

## 📖 概要

**個別カルテ**は、日々の顧客支援活動を記録するための機能です。
プロジェクトの支援スケジュールを基に自動生成され、支援者が実際の活動内容を記録します。

### カルテシステムの構成
- **BO（Back Office）**: 管理者・支援者用画面
- **FO（Front Office）**: 顧客・営業担当者用画面

---

## ⚙️ 前提条件

### 必要な準備
1. **プロジェクトが作成済み**であること
2. **支援スケジュールが設定済み**であること  
   ※支援スケジュールを作成すると、対応するカルテが自動生成されます
3. **適切なロールでログイン**していること

---

## 👥 ロール別アクセス権限

### カルテ作成・編集可能なロール
| ロール | 権限 | 対象システム |
|--------|------|-------------|
| SUPPORTER（支援者） | 作成・編集 | BO |
| SUPPORTER_MGR（支援者責任者） | 作成・編集・削除 | BO |
| SALES（営業担当者） | 作成・編集 | BO/FO |
| BUSINESS_MGR（事業責任者） | 作成・編集・削除 | BO |

### カルテ閲覧のみ可能なロール
| ロール | 権限 | 対象システム |
|--------|------|-------------|
| CUSTOMER（顧客） | 閲覧のみ | FO |
| SALES_MGR（営業責任者） | 閲覧・管理 | BO/FO |

---

## 🔄 カルテ作成の流れ

### 詳細な作業フロー（新人向け完全ガイド）

#### **STEP 1: プロジェクト作成**
- **担当ロール**: `BUSINESS_MGR`（事業責任者）または `SALES_MGR`（営業責任者）
- **作業場所**: BO（Back Office）管理画面
- **具体的作業**:
  1. BOにログイン → 「プロジェクト」メニューをクリック
  2. 「新規作成」ボタンをクリック
  3. 顧客情報、プロジェクト詳細を入力して保存
  4. プロジェクトメンバー（支援者・営業担当者）を追加
- **成果物**: プロジェクト基本情報の登録完了

#### **STEP 2: 支援スケジュール設定**
- **担当ロール**: `SUPPORTER_MGR`（支援者責任者）または `SUPPORTER`（支援者）
- **作業場所**: BO（Back Office） → プロジェクト詳細画面
- **具体的作業**:
  1. 対象プロジェクトの詳細画面にアクセス
  2. 「スケジュール」タブをクリック
  3. 「新規スケジュール追加」ボタンをクリック
  4. 支援日時・参加者・支援内容予定を入力
  5. 「保存」ボタンでスケジュール確定
- **成果物**: 支援スケジュールの登録完了
- **重要**: この作業完了と同時に、対応するカルテが **システムで自動生成** されます

#### **STEP 3: カルテ自動生成（空データ）**
- **担当ロール**: システム自動処理（人的作業なし）
- **作業場所**: システム内部処理
- **具体的処理**:
  - スケジュール保存と同時に、空のカルテデータを自動作成
  - カルテID、プロジェクトID、支援日時などの基本情報を自動設定
  - 初期状態は「下書き」フラグ = `true`（顧客には非表示）
- **成果物**: 入力待ちの空カルテの生成完了

#### **STEP 4: カルテ内容入力・編集**
- **担当ロール**: `SUPPORTER`（支援者）※実際に支援を行った担当者
- **作業場所**: BO（Back Office） → カルテ一覧 → カルテ詳細
- **具体的作業**:
  1. BOログイン → ヘッダー「カルテ」をクリック
  2. 対象プロジェクトのカルテを一覧から選択
  3. カルテ詳細画面で以下を入力:
     - **必須項目**: お客様名、SAP支援チーム、支援実施内容、フィードバック、宿題
     - **任意項目**: 資料、成果物、課題・所感など
  4. 「一時保存」で下書き保存（編集途中の場合）
- **成果物**: 支援内容が記録されたカルテ（下書き状態）
- **所要時間**: 支援後30分程度（当日中の入力を推奨）

#### **STEP 5: カルテ確定・共有**
- **担当ロール**: `SUPPORTER`（カルテ作成者）または `SUPPORTER_MGR`（支援者責任者）
- **作業場所**: BO（Back Office） → カルテ詳細画面
- **具体的作業**:
  1. カルテ内容の最終確認
     - 必須項目がすべて入力済みかチェック
     - 誤字脱字、内容の妥当性を確認
     - 顧客に見せても問題ない内容かチェック
  2. 「下書きフラグ」を `false` に変更
  3. 「確定保存」ボタンをクリック
  4. 必要に応じて関係者にメール通知
- **成果物**: 顧客・関係者が閲覧可能な確定カルテ
- **確認方法**: FO（顧客画面）でカルテが表示されることを確認

### 📊 ロール別作業分担表
| STEP | 事業責任者 | 営業責任者 | 支援者責任者 | 支援者 | 営業担当 |
|------|-----------|----------|------------|-------|---------|
| 1. プロジェクト作成 | ✅主担当 | ✅主担当 | - | - | △協力 |
| 2. スケジュール設定 | - | △確認 | ✅主担当 | ✅実施可 | △協力 |
| 3. 自動生成 | - | - | - | - | - |
| 4. 内容入力 | - | - | △確認 | ✅主担当 | △協力 |
| 5. 確定・共有 | - | △確認 | ✅承認可 | ✅主担当 | - |

### ⏰ 推奨タイムライン
- **支援実施後**: 当日中にカルテ入力開始
- **入力完了**: 支援日から **2営業日以内**
- **確定・共有**: 入力完了から **1営業日以内**

---

## 🖥️ 画面操作手順

### 【方法1】ヘッダーメニューからアクセス（推奨）

#### BO（管理者・支援者向け）
1. **ヘッダーの「カルテ」ボタンをクリック**
   - URL: `/karte/list`
   - カルテ一覧画面が表示されます

2. **対象プロジェクトのカルテを選択**
   - プロジェクト別にカルテが表示されます
   - 編集したいカルテをクリック

3. **カルテ詳細画面で編集**
   - URL: `/karte/{karteId}`
   - カルテ情報を入力・編集します

#### FO（顧客・営業担当者向け）
1. **ヘッダーの「案件」ボタンをクリック**
   - URL: `/project/list`
   - プロジェクト一覧画面が表示されます

2. **対象プロジェクトを選択**
   - URL: `/project/{projectId}`
   - プロジェクト詳細画面が表示されます

3. **支援スケジュールからカルテにアクセス**
   - 支援スケジュール欄からカルテリンクをクリック
   - URL: `/karte/list/{projectId}`

4. **カルテ詳細画面で確認・編集**
   - URL: `/karte/{karteId}`

### 【方法2】ホーム画面からアクセス

#### FO専用（顧客向け）
1. **ホーム画面のプロジェクトカードをクリック**
   - URL: `/home`
   - 参加プロジェクトがカード表示されます

2. **カルテ一覧に直接アクセス**
   - URL: `/karte/list/{projectId}`

3. **カルテ詳細画面で確認**
   - URL: `/karte/{karteId}`

---

## 📝 カルテ入力項目

### 基本情報（自動設定）
- **カルテID**: システム自動生成
- **プロジェクトID**: 関連プロジェクトから自動設定
- **顧客ID**: プロジェクトの顧客情報から自動設定
- **支援日**: スケジュールから自動設定
- **開始時間・終了時間**: スケジュールから自動設定

### 入力必須項目
| 項目名 | 説明 | 入力例 |
|--------|------|--------|
| **お客様（敬称略）** | 参加した顧客担当者名 | 田中、佐藤 |
| **SAP支援チーム（敬称略）** | 参加した支援者名 | 山田、鈴木 |
| **支援実施内容** | 実際に行った支援内容 | システム設定説明、操作研修 |
| **フィードバック** | 顧客からのフィードバック | 操作方法が分かりやすかった |
| **宿題** | 次回までの課題・宿題 | マスタデータ整備 |

### 入力任意項目
| 項目名 | 説明 | 入力例 |
|--------|------|--------|
| **資料** | 使用した資料の情報 | 操作マニュアル v1.2 |
| **成果物** | 作成・提供した成果物 | カスタマイズ仕様書 |
| **マネジメントへのリクエスト** | 管理者への連絡事項 | リソース追加検討 |
| **現状の課題・所感・申し送り** | 支援者間の情報共有 | データ移行に時間要 |
| **場所** | 支援実施場所 | オンライン/オフィス |

### 重要な設定項目
- **下書きフラグ**: 
  - `true`: 編集中（顧客には非表示）
  - `false`: 確定済み（顧客に表示）
- **支援者ID**: 複数の支援者を選択可能
- **起票支援者ID**: カルテ作成者

---

## ⚠️ 注意事項

### 1. 権限関連
- **顧客は下書き状態のカルテを見ることができません**
- **編集権限のないロールではカルテを変更できません**
- **所属していないプロジェクトのカルテは閲覧できません**

### 2. データ関連
- **カルテは支援スケジュールから自動生成されます**
- **手動でカルテを個別作成することはできません**
- **楽観的ロック制御があるため、同時編集時は注意が必要です**

### 3. 操作関連
- **カルテ確定前は必ず内容を確認してください**
- **顧客に表示する前に下書きフラグを解除してください**
- **関連するアンケートがある場合は併せて管理してください**

---

## 🛠️ トラブルシューティング

### Q1: カルテが表示されない
**原因**: 
- ロール権限不足
- プロジェクトへの参加権限なし
- 支援スケジュールが未作成

**解決方法**:
1. 管理者に権限確認を依頼
2. プロジェクトメンバーに追加してもらう
3. 支援スケジュールを先に作成する

### Q2: カルテが編集できない
**原因**:
- 編集権限のないロール
- 他のユーザーが同時編集中
- システムエラー

**解決方法**:
1. 管理者に編集権限を確認
2. 時間をおいて再度アクセス
3. ページを再読み込み

### Q3: 顧客にカルテが表示されない
**原因**:
- 下書きフラグが `true` のまま
- 顧客の権限設定に問題

**解決方法**:
1. カルテの下書きフラグを `false` に変更
2. 管理者に顧客の権限設定を確認してもらう

### Q4: カルテの自動生成がされない
**原因**:
- 支援スケジュールが正しく設定されていない
- システムのバッチ処理に問題

**解決方法**:
1. プロジェクト詳細で支援スケジュールを確認
2. 支援スケジュールを再作成
3. システム管理者に確認を依頼

---

## 📞 サポート連絡先

システムに関する問題や不明点がある場合は、以下に連絡してください：
- **システム管理者**: [連絡先情報]
- **プロジェクト管理者**: [連絡先情報]

---

*この手順書は新人の方がスムーズにカルテ作成業務を行えるよう作成されています。*
*不明点があればお気軽にお尋ねください。*