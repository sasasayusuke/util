# プロジェクト・スケジュール作成手順書 - カルテ作成の準備

## 📋 目次
1. [概要](#概要)
2. [前提条件](#前提条件)
3. [手順1：プロジェクト作成](#手順1プロジェクト作成)
4. [手順2：支援スケジュール設定](#手順2支援スケジュール設定)
5. [手順3：カルテ自動生成確認](#手順3カルテ自動生成確認)
6. [権限とロール](#権限とロール)
7. [注意事項](#注意事項)
8. [トラブルシューティング](#トラブルシューティング)

---

## 📖 概要

**個別カルテを作成する前に必要な準備作業**の手順書です。
カルテは支援スケジュールから自動生成されるため、以下の順序で作業を進める必要があります。

### 作業フロー
```
プロジェクト作成 → 支援スケジュール設定 → カルテ自動生成 → カルテ編集
```

---

## ⚙️ 前提条件

### 必要な権限
以下のいずれかのロールでBO（管理画面）にログインしている必要があります：
- **SYSTEM_ADMIN**（システム管理者）
- **SALES**（営業担当者）
- **SALES_MGR**（営業責任者）
- **SUPPORTER_MGR**（支援者責任者）
- **BUSINESS_MGR**（事業者責任者）

### 事前準備データ
- **取引先（顧客）情報**が登録済みであること
- **ユーザー情報**（営業担当者、支援者）が登録済みであること

---

## 🏗️ 手順1：プロジェクト作成

### 1-1. プロジェクト作成画面へのアクセス
1. **BO（管理画面）にログイン**
2. **ヘッダーメニューの「案件」をクリック**
3. **プロジェクト一覧画面（`/project/list`）が表示**
4. **「新規作成」ボタンをクリック**
5. **プロジェクト作成画面（`/project/create`）に遷移**

### 1-2. 必須項目の入力

#### 基本情報
| 項目名 | 説明 | 入力例 |
|--------|------|--------|
| **取引先** | 顧客を選択（サジェスト機能あり） | ○○株式会社 |
| **商談名** | プロジェクト名 | SAPシステム導入支援 |
| **サービス区分** | 提供サービス種別 | コンサルティング |
| **営業担当者** | 主担当営業 | 田中太郎 |
| **フェーズ** | プロジェクトの段階 | 要件定義 |

#### 支援期間
| 項目名 | 説明 | 入力例 |
|--------|------|--------|
| **支援開始日** | 支援開始日（yyyy/mm/dd） | 2024/04/01 |
| **支援終了日** | 支援終了日（yyyy/mm/dd） | 2024/09/30 |

#### 契約情報
| 項目名 | 説明 | 入力例 |
|--------|------|--------|
| **粗利（年間）** | 契約金額 | 5000000 |
| **延べ契約時間** | 総契約時間（h） | 240 |
| **契約形態** | 契約の種類 | 準委任 |

#### 設定項目
| 項目名 | 説明 | 推奨設定 |
|--------|------|---------|
| **工数調査** | 工数を調査するか | チェック |
| **カルテリマインド** | カルテ書き忘れ通知 | チェック |
| **マスターカルテリマインド** | マスターカルテ書き忘れ通知 | チェック |
| **案件秘匿** | 関係者以外参照不可 | 必要に応じて |

### 1-3. 任意項目の入力

#### 顧客情報
- **担当顧客（取引先責任者）**: 顧客側のメイン担当者
- **顧客メンバー**: プロジェクトに参加する顧客側メンバー

#### 支援者情報  
- **メイン支援者（主担当）**: 支援側のメイン担当者
- **支援者組織（課）**: 所属部署
- **支援者メンバー（副担当）**: プロジェクトに参加する支援者

#### アンケート設定
- **アンケート専用ユーザ名**: 匿名アンケート用
- **アンケート専用メールアドレス**: 通知先
- **匿名回答アンケートのパスワード**: セキュリティ設定

### 1-4. プロジェクト作成の実行
1. **全項目を確認**
2. **「作成」ボタンをクリック**
3. **プロジェクト詳細画面に自動遷移**
4. **プロジェクトID確認**（後続作業で使用）

---

## 📅 手順2：支援スケジュール設定

### 2-1. 支援スケジュール画面へのアクセス
1. **プロジェクト詳細画面（`/project/{projectId}`）で**
2. **「支援」タブをクリック**
3. **支援スケジュール管理画面が表示**

### 2-2. 支援スケジュールの追加
1. **「追加」ボタンをクリック**
2. **支援スケジュール追加モーダルが表示**

### 2-3. スケジュール情報の入力
| 項目名 | 説明 | 入力例 |
|--------|------|--------|
| **タイミング** | 単発を選択 | 単発 |
| **支援日** | 支援実施日（yyyy/mm/dd） | 2024/04/15 |
| **開始時間** | 支援開始時間（HH:mm） | 09:00 |
| **終了時間** | 支援終了時間（HH:mm） | 17:00 |

### 2-4. スケジュール保存
1. **入力内容を確認**
2. **「保存」ボタンをクリック**
3. **スケジュール一覧に追加確認**

### 2-5. 複数スケジュールの追加
**複数の支援日がある場合は、2-2〜2-4を繰り返し**
- 毎週決まった曜日の場合も、個別に追加が必要
- 各支援日程で個別のカルテが生成されます

---

## ✅ 手順3：カルテ自動生成確認

### 3-1. カルテ生成の確認
支援スケジュール保存後、**自動的にカルテが生成**されます。

### 3-2. カルテアクセス方法
1. **プロジェクト詳細画面で**
2. **支援スケジュール一覧から「カルテ」リンクをクリック**
3. **カルテ一覧画面（`/karte/list/{projectId}`）に遷移**
4. **生成されたカルテを確認**

### 3-3. 生成されるカルテの初期状態
- **カルテID**: 自動生成（UUID）
- **下書きフラグ**: `true`（編集中状態）
- **基本情報**: プロジェクト・スケジュール情報から自動設定
- **支援内容**: 空欄（後で入力）

---

## 👥 権限とロール

### プロジェクト・スケジュール作成権限
| ロール | 権限レベル | 制限事項 |
|--------|-----------|---------|
| **SYSTEM_ADMIN** | 全権限 | なし |
| **SALES_MGR** | 全権限 | なし |
| **BUSINESS_MGR** | 全権限 | なし |
| **SALES** | 作成・編集 | なし |
| **SUPPORTER_MGR** | 作成・編集 | 所属課案件または公開案件のみ |

### 権限による操作制限
- **支援者責任者**: 自部署関連案件のみ作成・編集可能
- **その他管理者系**: 制限なし
- **SUPPORTER**: プロジェクト作成権限なし（カルテ編集のみ）

---

## ⚠️ 注意事項

### 1. データ関連性
- **プロジェクト削除時**: 関連スケジュール・カルテも削除される可能性
- **スケジュール削除時**: 対応するカルテも削除される
- **支援期間変更時**: 期間外のスケジュール・カルテは影響を受ける

### 2. 入力値制限
- **支援開始日 ≤ 支援終了日**: 必須
- **開始時間 < 終了時間**: 必須  
- **契約時間**: 正の値のみ
- **粗利**: 数値のみ

### 3. 自動生成の仕組み
- **カルテは支援スケジュール作成時に自動生成**
- **手動でのカルテ個別作成は不可**
- **スケジュール変更時は、対応するカルテも更新**

### 4. リマインド機能
- **カルテリマインド**: 設定した場合、定期的にカルテ入力を促す通知
- **マスターカルテリマインド**: マスターカルテの更新通知
- **通知タイミング**: システム設定による

---

## 🛠️ トラブルシューティング

### Q1: プロジェクト作成ボタンが表示されない
**原因**: 権限不足
**解決方法**: 
1. ログインしているロールを確認
2. 必要な権限を持つロールでログインし直し
3. システム管理者に権限付与を依頼

### Q2: 取引先が選択できない
**原因**: 取引先データが未登録
**解決方法**:
1. 取引先管理画面で顧客情報を事前に登録
2. サジェスト機能が正常に動作するか確認

### Q3: 支援スケジュール保存時にエラー
**原因**: 
- 入力値の不整合（開始時間 ≥ 終了時間）
- 必須項目の未入力
- システムエラー

**解決方法**:
1. 入力値の妥当性を確認
2. 必須項目がすべて入力されているか確認
3. エラーメッセージの内容を確認して対応

### Q4: カルテが自動生成されない
**原因**:
- 支援スケジュールの保存が完了していない
- システムのバッチ処理遅延
- データベース接続エラー

**解決方法**:
1. 支援スケジュール一覧で保存状況を確認
2. しばらく待ってからカルテ一覧を再確認
3. システム管理者にシステム状況を確認

### Q5: 権限エラーでアクセスできない
**原因**: ロール権限の設定ミス
**解決方法**:
1. プロジェクトメンバーに正しく追加されているか確認
2. ロール権限設定を管理者に確認してもらう
3. 必要に応じてプロジェクトメンバーに追加

---

## 📞 次のステップ

プロジェクトと支援スケジュールの作成が完了したら：

1. **📝 [個別カルテ作成手順書.md](./個別カルテ作成手順書.md)** を参照してカルテを編集
2. **カルテ内容の入力・更新**
3. **下書きフラグの解除**（顧客表示用）
4. **関連アンケートの設定**

---

*このガイドに従って作業を進めることで、スムーズにカルテ作成の準備が整います。*
*不明点があればお気軽にお尋ねください。*