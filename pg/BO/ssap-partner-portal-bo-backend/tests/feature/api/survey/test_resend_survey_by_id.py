import pytest
from fastapi.testclient import TestClient
from pynamodb.exceptions import DoesNotExist

from app.main import app
from app.models.admin import AdminModel
from app.models.project import (
    GrossProfitAttribute,
    ProjectModel,
    SalesforceMainCustomerAttribute,
)
from app.models.project_survey import (
    AnswersAttribute,
    PointsAttribute,
    ProjectSurveyModel,
    SupporterUserAttribute,
)
from app.models.user import UserModel
from app.models.master import MasterSupporterOrganizationModel
from app.models.survey_master import (
    SurveyMasterModel,
    QuestionsAttribute,
    QuestionFlowAttribute,
)
from app.resources.const import DataType, UserRoleType
from app.service.notification_service import NotificationService
from app.utils.aws.sqs import SqsHelper
from app.utils.cipher_aes import AesCipherUtils

client = TestClient(app)

REQUEST_HEADERS = {"x-otp-verified-token": "111111"}


class TestResendSurveyById:
    @pytest.mark.parametrize(
        "survey_model, expected, admin_models, user_models, project_model",
        [
            (
                ProjectSurveyModel(
                    id="3361530c-1f7a-43f7-b306-6e88f88f92c3",
                    data_type=DataType.SURVEY,
                    survey_master_id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                    survey_master_revision=4,
                    survey_type="quick",
                    project_id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    project_name="サンプルプロジェクト",
                    customer_success="DXの実現",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    supporter_organization_name="AST",
                    support_date_from="2021/06/01",
                    support_date_to="2022/12/31",
                    main_supporter_user=SupporterUserAttribute(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        name="田中 三郎",
                        organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                        organization_name="AST",
                    ),
                    supporter_users=[
                        SupporterUserAttribute(
                            id="b9b67094-cdab-494c-818e-d4845088269b",
                            name="田中 次郎",
                            organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                            organization_name="AST",
                        )
                    ],
                    sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    service_type_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    service_type_name="組織開発",
                    answer_user_id="",
                    answer_user_name="",
                    customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                    customer_name="取引先株式会社",
                    company="ソニーグループ株式会社",
                    answers=[
                        AnswersAttribute(
                            id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                            answer="問題なし",
                            point=3,
                        )
                    ],
                    summary_month="2022/01",
                    plan_survey_request_datetime="2022/01/15 01:00",
                    actual_survey_request_datetime="2022/01/15 01:10",
                    plan_survey_response_datetime="2022/01/31 17:00",
                    actual_survey_response_datetime="",
                    is_finished=True,
                    is_disclosure=True,
                    is_not_summary=False,
                    points=PointsAttribute(
                        satisfaction=3,
                        continuation=False,
                        recommended=3,
                        sales=0,
                        survey_satisfaction=4,
                        man_hour_satisfaction=4,
                        karte_satisfaction=4,
                        master_karte_satisfaction=0,
                    ),
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                [
                    AdminModel(
                        id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        data_type=DataType.ADMIN,
                        name="田中太郎",
                        email="user@example.com",
                        roles={UserRoleType.SURVEY_OPS.key},
                        company=None,
                        job="部長",
                        supporter_organization_id={
                            "180a3597-b7e7-42c8-902c-a29016afa662"
                        },
                        organization_name=None,
                        cognito_id=None,
                        last_login_at="2020-10-23T03:21:39.356000+0000",
                        otp_secret=None,
                        otp_verified_token=None,
                        otp_verified_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.SALES.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="d9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="顧客太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                ProjectModel(
                    id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="7b36cc66-fe66-495f-b416-16ecc879fbaa",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    main_supporter_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    survey_password="coKbMSLitfhRxTT00VEm8zZxr9x4AY29d6yR",
                    is_survey_email_to_salesforce_main_customer=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
            (
                ProjectSurveyModel(
                    id="3361530c-1f7a-43f7-b306-6e88f88f92c3",
                    data_type=DataType.SURVEY,
                    survey_master_id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                    survey_master_revision=4,
                    survey_type="quick",
                    project_id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    project_name="サンプルプロジェクト",
                    customer_success="DXの実現",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    supporter_organization_name="AST",
                    support_date_from="2021/06/01",
                    support_date_to="2022/12/31",
                    main_supporter_user=SupporterUserAttribute(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        name="田中 三郎",
                        organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                        organization_name="AST",
                    ),
                    supporter_users=[
                        SupporterUserAttribute(
                            id="b9b67094-cdab-494c-818e-d4845088269b",
                            name="田中 次郎",
                            organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                            organization_name="AST",
                        )
                    ],
                    sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    service_type_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    service_type_name="組織開発",
                    answer_user_id="",
                    answer_user_name="",
                    customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                    customer_name="取引先株式会社",
                    company="ソニーグループ株式会社",
                    answers=[
                        AnswersAttribute(
                            id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                            answer="問題なし",
                            point=3,
                        )
                    ],
                    summary_month="2022/01",
                    plan_survey_request_datetime="2022/01/15 01:00",
                    actual_survey_request_datetime="2022/01/15 01:10",
                    plan_survey_response_datetime="",
                    actual_survey_response_datetime="",
                    is_finished=True,
                    is_disclosure=True,
                    is_not_summary=False,
                    points=PointsAttribute(
                        satisfaction=3,
                        continuation=False,
                        recommended=3,
                        sales=0,
                        survey_satisfaction=4,
                        man_hour_satisfaction=4,
                        karte_satisfaction=4,
                        master_karte_satisfaction=0,
                    ),
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                [
                    AdminModel(
                        id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        data_type=DataType.ADMIN,
                        name="田中太郎",
                        email="user@example.com",
                        roles={UserRoleType.SURVEY_OPS.key},
                        company=None,
                        job="部長",
                        supporter_organization_id={
                            "180a3597-b7e7-42c8-902c-a29016afa662"
                        },
                        organization_name=None,
                        cognito_id=None,
                        last_login_at="2020-10-23T03:21:39.356000+0000",
                        otp_secret=None,
                        otp_verified_token=None,
                        otp_verified_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.SALES.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="d9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="顧客太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                ProjectModel(
                    id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="7b36cc66-fe66-495f-b416-16ecc879fbaa",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    main_supporter_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    survey_password="",
                    is_survey_email_to_salesforce_main_customer=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
            (
                ProjectSurveyModel(
                    id="3361530c-1f7a-43f7-b306-6e88f88f92c3",
                    data_type=DataType.SURVEY,
                    survey_master_id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                    survey_master_revision=4,
                    survey_type="quick",
                    project_id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    project_name="サンプルプロジェクト",
                    customer_success="DXの実現",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    supporter_organization_name="AST",
                    support_date_from="2021/06/01",
                    support_date_to="2022/12/31",
                    main_supporter_user=SupporterUserAttribute(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        name="田中 三郎",
                        organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                        organization_name="AST",
                    ),
                    supporter_users=[
                        SupporterUserAttribute(
                            id="b9b67094-cdab-494c-818e-d4845088269b",
                            name="田中 次郎",
                            organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                            organization_name="AST",
                        )
                    ],
                    sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    service_type_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    service_type_name="組織開発",
                    answer_user_id="d9b67094-cdab-494c-818e-d4845088269b",
                    answer_user_name="顧客太郎",
                    customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                    customer_name="取引先株式会社",
                    company="ソニーグループ株式会社",
                    answers=[
                        AnswersAttribute(
                            id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                            answer="問題なし",
                            point=3,
                        )
                    ],
                    summary_month="2022/01",
                    plan_survey_request_datetime="2022/01/15 01:00",
                    actual_survey_request_datetime="2022/01/15 01:10",
                    plan_survey_response_datetime="2022/01/31 17:00",
                    actual_survey_response_datetime=None,
                    is_finished=True,
                    is_disclosure=True,
                    is_not_summary=False,
                    points=PointsAttribute(
                        satisfaction=3,
                        continuation=False,
                        recommended=3,
                        sales=0,
                        survey_satisfaction=4,
                        man_hour_satisfaction=4,
                        karte_satisfaction=4,
                        master_karte_satisfaction=0,
                    ),
                    dedicated_survey_user_name="",
                    dedicated_survey_user_email="",
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                [
                    AdminModel(
                        id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        data_type=DataType.ADMIN,
                        name="田中太郎",
                        email="user@example.com",
                        roles={UserRoleType.SURVEY_OPS.key},
                        company=None,
                        job="部長",
                        supporter_organization_id={
                            "180a3597-b7e7-42c8-902c-a29016afa662"
                        },
                        organization_name=None,
                        cognito_id=None,
                        last_login_at="2020-10-23T03:21:39.356000+0000",
                        otp_secret=None,
                        otp_verified_token=None,
                        otp_verified_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.SALES.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="d9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="顧客太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                ProjectModel(
                    id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="7b36cc66-fe66-495f-b416-16ecc879fbaa",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    main_supporter_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    dedicated_survey_user_name="",
                    dedicated_survey_user_email="",
                    survey_password="coKbMSLitfhRxTT00VEm8zZxr9x4AY29d6yR",
                    is_survey_email_to_salesforce_main_customer=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
        ],
    )
    def test_ok(
        self,
        mocker,
        mock_auth_admin,
        survey_model,
        expected,
        admin_models,
        user_models,
        project_model,
    ):
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])
        survey_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        mock_survey = mocker.patch.object(ProjectSurveyModel, "get")
        mock_survey.return_value = survey_model

        mock_admin = mocker.patch.object(AdminModel, "scan")
        mock_admin.return_value = admin_models
        mock_user = mocker.patch.object(UserModel, "scan")
        mock_user.return_value = user_models
        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model
        mock_master_supporter_org = mocker.patch.object(
            MasterSupporterOrganizationModel.data_type_index, "query"
        )
        mock_master_supporter_org.return_value = [
            MasterSupporterOrganizationModel(
                id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                data_type="master_supporter_organization",
                name="Ideation Service Team",
                value="IST",
                attributes=None,
                order=1,
                use=True,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T04:21:39.356000+0000",
                version=1,
            )
        ]
        mock_survey_master = mocker.patch.object(
            SurveyMasterModel.is_latest_name_index, "query"
        )
        mock_survey_master.return_value = [
            SurveyMasterModel(
                id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                revision=4,
                name="テンプレート",
                type="service",
                timing="毎月",
                init_send_day_setting=20,
                init_answer_limit_day_setting=5,
                is_disclosure=True,
                questions=[QuestionsAttribute()],
                question_flow=[QuestionFlowAttribute()],
                is_latest=1,
                create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                create_at="2022-05-23T16:34:21.523000+0000",
                update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                update_at="2022-05-23T16:34:21.523000+0000",
                version=1,
            )
        ]

        mocker.patch.object(ProjectSurveyModel, "update")

        mocker.patch.object(NotificationService, "save_notification")
        mocker.patch.object(SqsHelper, "send_message_to_queue")
        mock_aes_cipher = mocker.patch.object(AesCipherUtils, "decrypt")
        mock_aes_cipher.return_value = "iret1234"

        response = client.get(
            f"/api/surveys/resend/{survey_id}", headers=REQUEST_HEADERS
        )

        actual = response.json()
        assert response.status_code == 200
        assert actual == expected

    def test_survey_not_found(self, mocker, mock_auth_admin):
        """案件アンケートが存在しない時のテスト"""
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])
        survey_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        mock_survey = mocker.patch.object(ProjectSurveyModel, "get")
        mock_survey.side_effect = DoesNotExist()

        response = client.get(
            f"/api/surveys/resend/{survey_id}", headers=REQUEST_HEADERS
        )

        actual = response.json()
        assert response.status_code == 404
        assert actual["detail"] == "Not found"

    @pytest.mark.parametrize(
        "survey_model, expected, admin_models, user_models, project_model",
        [
            (
                ProjectSurveyModel(
                    id="3361530c-1f7a-43f7-b306-6e88f88f92c3",
                    data_type=DataType.SURVEY,
                    survey_master_id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                    survey_master_revision=4,
                    survey_type="quick",
                    project_id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    project_name="サンプルプロジェクト",
                    customer_success="DXの実現",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    supporter_organization_name="AST",
                    support_date_from="2021/06/01",
                    support_date_to="2022/12/31",
                    main_supporter_user=SupporterUserAttribute(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        name="田中 三郎",
                        organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                        organization_name="AST",
                    ),
                    supporter_users=[
                        SupporterUserAttribute(
                            id="b9b67094-cdab-494c-818e-d4845088269b",
                            name="田中 次郎",
                            organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                            organization_name="AST",
                        )
                    ],
                    sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    service_type_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    service_type_name="組織開発",
                    answer_user_id="",
                    answer_user_name="",
                    customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                    customer_name="取引先株式会社",
                    company="ソニーグループ株式会社",
                    answers=[
                        AnswersAttribute(
                            id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                            answer="問題なし",
                            point=3,
                        )
                    ],
                    summary_month="2022/01",
                    plan_survey_request_datetime="2022/01/15 01:00",
                    actual_survey_request_datetime="",
                    plan_survey_response_datetime="2022/01/31 17:00",
                    actual_survey_response_datetime="",
                    is_finished=True,
                    is_disclosure=True,
                    is_not_summary=False,
                    points=PointsAttribute(
                        satisfaction=3,
                        continuation=False,
                        recommended=3,
                        sales=0,
                        survey_satisfaction=4,
                        man_hour_satisfaction=4,
                        karte_satisfaction=4,
                        master_karte_satisfaction=0,
                    ),
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                [
                    AdminModel(
                        id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        data_type=DataType.ADMIN,
                        name="田中太郎",
                        email="user@example.com",
                        roles={UserRoleType.SURVEY_OPS.key},
                        company=None,
                        job="部長",
                        supporter_organization_id={
                            "180a3597-b7e7-42c8-902c-a29016afa662"
                        },
                        organization_name=None,
                        cognito_id=None,
                        last_login_at="2020-10-23T03:21:39.356000+0000",
                        otp_secret=None,
                        otp_verified_token=None,
                        otp_verified_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.SALES.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="d9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="顧客太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                ProjectModel(
                    id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="7b36cc66-fe66-495f-b416-16ecc879fbaa",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    main_supporter_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    survey_password="coKbMSLitfhRxTT00VEm8zZxr9x4AY29d6yR",
                    is_survey_email_to_salesforce_main_customer=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
        ],
    )
    def test_validate_error_non_survey_request(
        self,
        mocker,
        mock_auth_admin,
        survey_model,
        expected,
        admin_models,
        user_models,
        project_model,
    ):
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])
        survey_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        mock_survey = mocker.patch.object(ProjectSurveyModel, "get")
        mock_survey.return_value = survey_model

        mock_admin = mocker.patch.object(AdminModel, "scan")
        mock_admin.return_value = admin_models
        mock_user = mocker.patch.object(UserModel, "scan")
        mock_user.return_value = user_models
        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model

        mock_master_supporter_org = mocker.patch.object(
            MasterSupporterOrganizationModel.data_type_index, "query"
        )
        mock_master_supporter_org.return_value = [
            MasterSupporterOrganizationModel(
                id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                data_type="master_supporter_organization",
                name="Ideation Service Team",
                value="IST",
                attributes=None,
                order=1,
                use=True,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T04:21:39.356000+0000",
                version=1,
            )
        ]
        mock_survey_master = mocker.patch.object(
            SurveyMasterModel.is_latest_name_index, "query"
        )
        mock_survey_master.return_value = [
            SurveyMasterModel(
                id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                revision=4,
                name="テンプレート",
                type="service",
                timing="毎月",
                init_send_day_setting=20,
                init_answer_limit_day_setting=5,
                is_disclosure=True,
                questions=[QuestionsAttribute()],
                question_flow=[QuestionFlowAttribute()],
                is_latest=1,
                create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                create_at="2022-05-23T16:34:21.523000+0000",
                update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                update_at="2022-05-23T16:34:21.523000+0000",
                version=1,
            )
        ]

        mocker.patch.object(ProjectSurveyModel, "update")

        mocker.patch.object(NotificationService, "save_notification")
        mocker.patch.object(SqsHelper, "send_message_to_queue")
        mock_aes_cipher = mocker.patch.object(AesCipherUtils, "decrypt")
        mock_aes_cipher.return_value = "iret1234"

        response = client.get(
            f"/api/surveys/resend/{survey_id}", headers=REQUEST_HEADERS
        )

        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "Surveys that have not been requested to respond cannot be resent."
        )

    @pytest.mark.parametrize(
        "survey_model, expected, admin_models, user_models, project_model",
        [
            (
                ProjectSurveyModel(
                    id="3361530c-1f7a-43f7-b306-6e88f88f92c3",
                    data_type=DataType.SURVEY,
                    survey_master_id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                    survey_master_revision=4,
                    survey_type="quick",
                    project_id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    project_name="サンプルプロジェクト",
                    customer_success="DXの実現",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    supporter_organization_name="AST",
                    support_date_from="2021/06/01",
                    support_date_to="2022/12/31",
                    main_supporter_user=SupporterUserAttribute(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        name="田中 三郎",
                        organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                        organization_name="AST",
                    ),
                    supporter_users=[
                        SupporterUserAttribute(
                            id="b9b67094-cdab-494c-818e-d4845088269b",
                            name="田中 次郎",
                            organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                            organization_name="AST",
                        )
                    ],
                    sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    service_type_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    service_type_name="組織開発",
                    answer_user_id="",
                    answer_user_name="",
                    customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                    customer_name="取引先株式会社",
                    company="ソニーグループ株式会社",
                    answers=[
                        AnswersAttribute(
                            id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                            answer="問題なし",
                            point=3,
                        )
                    ],
                    summary_month="2022/01",
                    plan_survey_request_datetime="2022/01/15 01:00",
                    actual_survey_request_datetime="2022/01/15 01:00",
                    plan_survey_response_datetime="2022/01/31 17:00",
                    actual_survey_response_datetime="2022/01/31 17:00",
                    is_finished=True,
                    is_disclosure=True,
                    is_not_summary=False,
                    points=PointsAttribute(
                        satisfaction=3,
                        continuation=False,
                        recommended=3,
                        sales=0,
                        survey_satisfaction=4,
                        man_hour_satisfaction=4,
                        karte_satisfaction=4,
                        master_karte_satisfaction=0,
                    ),
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                [
                    AdminModel(
                        id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        data_type=DataType.ADMIN,
                        name="田中太郎",
                        email="user@example.com",
                        roles={UserRoleType.SURVEY_OPS.key},
                        company=None,
                        job="部長",
                        supporter_organization_id={
                            "180a3597-b7e7-42c8-902c-a29016afa662"
                        },
                        organization_name=None,
                        cognito_id=None,
                        last_login_at="2020-10-23T03:21:39.356000+0000",
                        otp_secret=None,
                        otp_verified_token=None,
                        otp_verified_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.SALES.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="d9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="顧客太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                ProjectModel(
                    id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="7b36cc66-fe66-495f-b416-16ecc879fbaa",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    main_supporter_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    survey_password="coKbMSLitfhRxTT00VEm8zZxr9x4AY29d6yR",
                    is_survey_email_to_salesforce_main_customer=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
        ],
    )
    def test_validate_error_answered_survey_request(
        self,
        mocker,
        mock_auth_admin,
        survey_model,
        expected,
        admin_models,
        user_models,
        project_model,
    ):
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])
        survey_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        mock_survey = mocker.patch.object(ProjectSurveyModel, "get")
        mock_survey.return_value = survey_model

        mock_admin = mocker.patch.object(AdminModel, "scan")
        mock_admin.return_value = admin_models
        mock_user = mocker.patch.object(UserModel, "scan")
        mock_user.return_value = user_models
        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model

        mock_master_supporter_org = mocker.patch.object(
            MasterSupporterOrganizationModel.data_type_index, "query"
        )
        mock_master_supporter_org.return_value = [
            MasterSupporterOrganizationModel(
                id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                data_type="master_supporter_organization",
                name="Ideation Service Team",
                value="IST",
                attributes=None,
                order=1,
                use=True,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T04:21:39.356000+0000",
                version=1,
            )
        ]
        mock_survey_master = mocker.patch.object(
            SurveyMasterModel.is_latest_name_index, "query"
        )
        mock_survey_master.return_value = [
            SurveyMasterModel(
                id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                revision=4,
                name="テンプレート",
                type="service",
                timing="毎月",
                init_send_day_setting=20,
                init_answer_limit_day_setting=5,
                is_disclosure=True,
                questions=[QuestionsAttribute()],
                question_flow=[QuestionFlowAttribute()],
                is_latest=1,
                create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                create_at="2022-05-23T16:34:21.523000+0000",
                update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                update_at="2022-05-23T16:34:21.523000+0000",
                version=1,
            )
        ]

        mocker.patch.object(ProjectSurveyModel, "update")

        mocker.patch.object(NotificationService, "save_notification")
        mocker.patch.object(SqsHelper, "send_message_to_queue")
        mock_aes_cipher = mocker.patch.object(AesCipherUtils, "decrypt")
        mock_aes_cipher.return_value = "iret1234"

        response = client.get(
            f"/api/surveys/resend/{survey_id}", headers=REQUEST_HEADERS
        )

        actual = response.json()
        assert response.status_code == 400
        assert actual["detail"] == "The answered survey cannot be resent."

    @pytest.mark.parametrize(
        "survey_model, expected, admin_models, user_models, project_model",
        [
            (
                ProjectSurveyModel(
                    id="3361530c-1f7a-43f7-b306-6e88f88f92c3",
                    data_type=DataType.SURVEY,
                    survey_master_id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                    survey_master_revision=4,
                    survey_type="quick",
                    project_id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    project_name="サンプルプロジェクト",
                    customer_success="DXの実現",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    supporter_organization_name="AST",
                    support_date_from="2021/06/01",
                    support_date_to="2022/12/31",
                    main_supporter_user=SupporterUserAttribute(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        name="田中 三郎",
                        organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                        organization_name="AST",
                    ),
                    supporter_users=[
                        SupporterUserAttribute(
                            id="b9b67094-cdab-494c-818e-d4845088269b",
                            name="田中 次郎",
                            organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                            organization_name="AST",
                        )
                    ],
                    sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    service_type_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    service_type_name="組織開発",
                    answer_user_id="",
                    answer_user_name="",
                    customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                    customer_name="取引先株式会社",
                    company="ソニーグループ株式会社",
                    answers=[
                        AnswersAttribute(
                            id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                            answer="問題なし",
                            point=3,
                        )
                    ],
                    summary_month="2022/01",
                    plan_survey_request_datetime="2022/01/15 01:00",
                    actual_survey_request_datetime="2022/01/15 01:00",
                    plan_survey_response_datetime="2022/01/31 17:00",
                    actual_survey_response_datetime="",
                    is_finished=True,
                    is_disclosure=True,
                    is_not_summary=False,
                    points=PointsAttribute(
                        satisfaction=3,
                        continuation=False,
                        recommended=3,
                        sales=0,
                        survey_satisfaction=4,
                        man_hour_satisfaction=4,
                        karte_satisfaction=4,
                        master_karte_satisfaction=0,
                    ),
                    dedicated_survey_user_name="",
                    dedicated_survey_user_email="",
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                [
                    AdminModel(
                        id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        data_type=DataType.ADMIN,
                        name="田中太郎",
                        email="user@example.com",
                        roles={UserRoleType.SURVEY_OPS.key},
                        company=None,
                        job="部長",
                        supporter_organization_id={
                            "180a3597-b7e7-42c8-902c-a29016afa662"
                        },
                        organization_name=None,
                        cognito_id=None,
                        last_login_at="2020-10-23T03:21:39.356000+0000",
                        otp_secret=None,
                        otp_verified_token=None,
                        otp_verified_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.SALES.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="d9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="顧客太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                ProjectModel(
                    id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="7b36cc66-fe66-495f-b416-16ecc879fbaa",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    main_supporter_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    dedicated_survey_user_name="",
                    dedicated_survey_user_email="",
                    survey_password="coKbMSLitfhRxTT00VEm8zZxr9x4AY29d6yR",
                    is_survey_email_to_salesforce_main_customer=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
        ],
    )
    def test_validate_error_empty_of_the_surveys_email(
        self,
        mocker,
        mock_auth_admin,
        survey_model,
        expected,
        admin_models,
        user_models,
        project_model,
    ):
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])
        survey_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        mock_survey = mocker.patch.object(ProjectSurveyModel, "get")
        mock_survey.return_value = survey_model

        mock_admin = mocker.patch.object(AdminModel, "scan")
        mock_admin.return_value = admin_models
        mock_user = mocker.patch.object(UserModel, "scan")
        mock_user.return_value = user_models
        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model

        mock_master_supporter_org = mocker.patch.object(
            MasterSupporterOrganizationModel.data_type_index, "query"
        )
        mock_master_supporter_org.return_value = [
            MasterSupporterOrganizationModel(
                id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                data_type="master_supporter_organization",
                name="Ideation Service Team",
                value="IST",
                attributes=None,
                order=1,
                use=True,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T04:21:39.356000+0000",
                version=1,
            )
        ]
        mock_survey_master = mocker.patch.object(
            SurveyMasterModel.is_latest_name_index, "query"
        )
        mock_survey_master.return_value = [
            SurveyMasterModel(
                id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                revision=4,
                name="テンプレート",
                type="service",
                timing="毎月",
                init_send_day_setting=20,
                init_answer_limit_day_setting=5,
                is_disclosure=True,
                questions=[QuestionsAttribute()],
                question_flow=[QuestionFlowAttribute()],
                is_latest=1,
                create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                create_at="2022-05-23T16:34:21.523000+0000",
                update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                update_at="2022-05-23T16:34:21.523000+0000",
                version=1,
            )
        ]

        mocker.patch.object(ProjectSurveyModel, "update")

        mocker.patch.object(NotificationService, "save_notification")
        mocker.patch.object(SqsHelper, "send_message_to_queue")
        mock_aes_cipher = mocker.patch.object(AesCipherUtils, "decrypt")
        mock_aes_cipher.return_value = "iret1234"

        response = client.get(
            f"/api/surveys/resend/{survey_id}", headers=REQUEST_HEADERS
        )

        actual = response.json()
        assert response.status_code == 400
        assert actual["detail"] == "Email of the survey is empty."

    @pytest.mark.parametrize(
        "survey_model, expected, admin_models, user_models, project_model",
        [
            (
                ProjectSurveyModel(
                    id="3361530c-1f7a-43f7-b306-6e88f88f92c3",
                    data_type=DataType.SURVEY,
                    survey_master_id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                    survey_master_revision=4,
                    survey_type="pp",
                    project_id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    project_name="サンプルプロジェクト",
                    customer_success="DXの実現",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    supporter_organization_name="AST",
                    support_date_from="2021/06/01",
                    support_date_to="2022/12/31",
                    main_supporter_user=SupporterUserAttribute(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        name="田中 三郎",
                        organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                        organization_name="AST",
                    ),
                    supporter_users=[
                        SupporterUserAttribute(
                            id="b9b67094-cdab-494c-818e-d4845088269b",
                            name="田中 次郎",
                            organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                            organization_name="AST",
                        )
                    ],
                    sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    service_type_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    service_type_name="組織開発",
                    answer_user_id="",
                    answer_user_name="",
                    customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                    customer_name="取引先株式会社",
                    company="ソニーグループ株式会社",
                    answers=[
                        AnswersAttribute(
                            id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                            answer="問題なし",
                            point=3,
                        )
                    ],
                    summary_month="2022/01",
                    plan_survey_request_datetime="2022/01/15 01:00",
                    actual_survey_request_datetime="2022/01/15 01:00",
                    plan_survey_response_datetime="2022/01/31 17:00",
                    actual_survey_response_datetime="",
                    is_finished=True,
                    is_disclosure=True,
                    is_not_summary=False,
                    points=PointsAttribute(
                        satisfaction=3,
                        continuation=False,
                        recommended=3,
                        sales=0,
                        survey_satisfaction=4,
                        man_hour_satisfaction=4,
                        karte_satisfaction=4,
                        master_karte_satisfaction=0,
                    ),
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                [
                    AdminModel(
                        id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        data_type=DataType.ADMIN,
                        name="田中太郎",
                        email="user@example.com",
                        roles={UserRoleType.SURVEY_OPS.key},
                        company=None,
                        job="部長",
                        supporter_organization_id={
                            "180a3597-b7e7-42c8-902c-a29016afa662"
                        },
                        organization_name=None,
                        cognito_id=None,
                        last_login_at="2020-10-23T03:21:39.356000+0000",
                        otp_secret=None,
                        otp_verified_token=None,
                        otp_verified_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.SALES.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="d9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="顧客太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                ProjectModel(
                    id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="7b36cc66-fe66-495f-b416-16ecc879fbaa",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    main_supporter_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    survey_password="coKbMSLitfhRxTT00VEm8zZxr9x4AY29d6yR",
                    is_survey_email_to_salesforce_main_customer=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
        ],
    )
    def test_validate_error_pp_survey(
        self,
        mocker,
        mock_auth_admin,
        survey_model,
        expected,
        admin_models,
        user_models,
        project_model,
    ):
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])
        survey_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        mock_survey = mocker.patch.object(ProjectSurveyModel, "get")
        mock_survey.return_value = survey_model

        mock_admin = mocker.patch.object(AdminModel, "scan")
        mock_admin.return_value = admin_models
        mock_user = mocker.patch.object(UserModel, "scan")
        mock_user.return_value = user_models
        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model

        mock_master_supporter_org = mocker.patch.object(
            MasterSupporterOrganizationModel.data_type_index, "query"
        )
        mock_master_supporter_org.return_value = [
            MasterSupporterOrganizationModel(
                id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                data_type="master_supporter_organization",
                name="Ideation Service Team",
                value="IST",
                attributes=None,
                order=1,
                use=True,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T04:21:39.356000+0000",
                version=1,
            )
        ]
        mock_survey_master = mocker.patch.object(
            SurveyMasterModel.is_latest_name_index, "query"
        )
        mock_survey_master.return_value = [
            SurveyMasterModel(
                id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                revision=4,
                name="テンプレート",
                type="service",
                timing="毎月",
                init_send_day_setting=20,
                init_answer_limit_day_setting=5,
                is_disclosure=True,
                questions=[QuestionsAttribute()],
                question_flow=[QuestionFlowAttribute()],
                is_latest=1,
                create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                create_at="2022-05-23T16:34:21.523000+0000",
                update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                update_at="2022-05-23T16:34:21.523000+0000",
                version=1,
            )
        ]

        mocker.patch.object(ProjectSurveyModel, "update")

        mocker.patch.object(NotificationService, "save_notification")
        mocker.patch.object(SqsHelper, "send_message_to_queue")
        mock_aes_cipher = mocker.patch.object(AesCipherUtils, "decrypt")
        mock_aes_cipher.return_value = "iret1234"

        response = client.get(
            f"/api/surveys/resend/{survey_id}", headers=REQUEST_HEADERS
        )

        actual = response.json()
        assert response.status_code == 400
        assert actual["detail"] == "The PP survey cannot be resent."

    @pytest.mark.parametrize(
        "survey_model, expected, admin_models, user_models, project_model",
        [
            (
                ProjectSurveyModel(
                    id="3361530c-1f7a-43f7-b306-6e88f88f92c3",
                    data_type=DataType.SURVEY,
                    survey_master_id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                    survey_master_revision=4,
                    survey_type="quick",
                    project_id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    project_name="サンプルプロジェクト",
                    customer_success="DXの実現",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    supporter_organization_name="AST",
                    support_date_from="2021/06/01",
                    support_date_to="2022/12/31",
                    main_supporter_user=SupporterUserAttribute(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        name="田中 三郎",
                        organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                        organization_name="AST",
                    ),
                    supporter_users=[
                        SupporterUserAttribute(
                            id="b9b67094-cdab-494c-818e-d4845088269b",
                            name="田中 次郎",
                            organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                            organization_name="AST",
                        )
                    ],
                    sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    service_type_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    service_type_name="組織開発",
                    answer_user_id="",
                    answer_user_name="",
                    customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                    customer_name="取引先株式会社",
                    company="ソニーグループ株式会社",
                    answers=[
                        AnswersAttribute(
                            id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                            answer="問題なし",
                            point=3,
                        )
                    ],
                    summary_month="2022/01",
                    plan_survey_request_datetime="2022/01/15 01:00",
                    actual_survey_request_datetime="2022/01/15 01:10",
                    plan_survey_response_datetime="2022/01/31 17:00",
                    actual_survey_response_datetime="",
                    is_finished=True,
                    is_disclosure=True,
                    is_not_summary=False,
                    points=PointsAttribute(
                        satisfaction=3,
                        continuation=False,
                        recommended=3,
                        sales=0,
                        survey_satisfaction=4,
                        man_hour_satisfaction=4,
                        karte_satisfaction=4,
                        master_karte_satisfaction=0,
                    ),
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                [
                    AdminModel(
                        id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        data_type=DataType.ADMIN,
                        name="田中太郎",
                        email="user@example.com",
                        roles={UserRoleType.SURVEY_OPS.key},
                        company=None,
                        job="部長",
                        supporter_organization_id={
                            "180a3597-b7e7-42c8-902c-a29016afa662"
                        },
                        organization_name=None,
                        cognito_id=None,
                        last_login_at="2020-10-23T03:21:39.356000+0000",
                        otp_secret=None,
                        otp_verified_token=None,
                        otp_verified_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.SALES.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="d9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="顧客太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                ProjectModel(
                    id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="7b36cc66-fe66-495f-b416-16ecc879fbaa",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    main_supporter_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    survey_password="coKbMSLitfhRxTT00VEm8zZxr9x4AY29d6yR",
                    is_survey_email_to_salesforce_main_customer=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
        ],
    )
    def test_validate_project_not_found(
        self,
        mocker,
        mock_auth_admin,
        survey_model,
        expected,
        admin_models,
        user_models,
        project_model,
    ):
        """アンケートに紐づく案件が存在しない場合"""
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])
        survey_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        mock_survey = mocker.patch.object(ProjectSurveyModel, "get")
        mock_survey.return_value = survey_model

        mock_admin = mocker.patch.object(AdminModel, "scan")
        mock_admin.return_value = admin_models
        mock_user = mocker.patch.object(UserModel, "scan")
        mock_user.return_value = user_models
        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.side_effect = DoesNotExist()

        mock_master_supporter_org = mocker.patch.object(
            MasterSupporterOrganizationModel.data_type_index, "query"
        )
        mock_master_supporter_org.return_value = [
            MasterSupporterOrganizationModel(
                id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                data_type="master_supporter_organization",
                name="Ideation Service Team",
                value="IST",
                attributes=None,
                order=1,
                use=True,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T04:21:39.356000+0000",
                version=1,
            )
        ]
        mock_survey_master = mocker.patch.object(
            SurveyMasterModel.is_latest_name_index, "query"
        )
        mock_survey_master.return_value = [
            SurveyMasterModel(
                id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                revision=4,
                name="テンプレート",
                type="service",
                timing="毎月",
                init_send_day_setting=20,
                init_answer_limit_day_setting=5,
                is_disclosure=True,
                questions=[QuestionsAttribute()],
                question_flow=[QuestionFlowAttribute()],
                is_latest=1,
                create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                create_at="2022-05-23T16:34:21.523000+0000",
                update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                update_at="2022-05-23T16:34:21.523000+0000",
                version=1,
            )
        ]

        mocker.patch.object(ProjectSurveyModel, "update")

        mocker.patch.object(NotificationService, "save_notification")
        mocker.patch.object(SqsHelper, "send_message_to_queue")
        mock_aes_cipher = mocker.patch.object(AesCipherUtils, "decrypt")
        mock_aes_cipher.return_value = "iret1234"

        response = client.get(
            f"/api/surveys/resend/{survey_id}", headers=REQUEST_HEADERS
        )

        actual = response.json()
        assert response.status_code == 400
        assert actual["detail"] == "Project_id of the survey not found."

    @pytest.mark.parametrize(
        "survey_model, expected, admin_models, user_models, project_model",
        [
            (
                ProjectSurveyModel(
                    id="3361530c-1f7a-43f7-b306-6e88f88f92c3",
                    data_type=DataType.SURVEY,
                    survey_master_id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                    survey_master_revision=4,
                    survey_type="quick",
                    project_id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    project_name="サンプルプロジェクト",
                    customer_success="DXの実現",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    supporter_organization_name="AST",
                    support_date_from="2021/06/01",
                    support_date_to="2022/12/31",
                    main_supporter_user=SupporterUserAttribute(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        name="田中 三郎",
                        organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                        organization_name="AST",
                    ),
                    supporter_users=[
                        SupporterUserAttribute(
                            id="b9b67094-cdab-494c-818e-d4845088269b",
                            name="田中 次郎",
                            organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                            organization_name="AST",
                        )
                    ],
                    sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    service_type_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    service_type_name="組織開発",
                    answer_user_id="",
                    answer_user_name="",
                    customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                    customer_name="取引先株式会社",
                    company="ソニーグループ株式会社",
                    answers=[
                        AnswersAttribute(
                            id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                            answer="問題なし",
                            point=3,
                        )
                    ],
                    summary_month="2022/01",
                    plan_survey_request_datetime="2022/01/15 01:00",
                    actual_survey_request_datetime="2022/01/15 01:10",
                    plan_survey_response_datetime="2022/01/31 17:00",
                    actual_survey_response_datetime="",
                    is_finished=True,
                    is_disclosure=True,
                    is_not_summary=False,
                    points=PointsAttribute(
                        satisfaction=3,
                        continuation=False,
                        recommended=3,
                        sales=0,
                        survey_satisfaction=4,
                        man_hour_satisfaction=4,
                        karte_satisfaction=4,
                        master_karte_satisfaction=0,
                    ),
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                [
                    AdminModel(
                        id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        data_type=DataType.ADMIN,
                        name="田中太郎",
                        email="user@example.com",
                        roles={UserRoleType.SURVEY_OPS.key},
                        company=None,
                        job="部長",
                        supporter_organization_id={
                            "180a3597-b7e7-42c8-902c-a29016afa662"
                        },
                        organization_name=None,
                        cognito_id=None,
                        last_login_at="2020-10-23T03:21:39.356000+0000",
                        otp_secret=None,
                        otp_verified_token=None,
                        otp_verified_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.SALES.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="d9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="顧客太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                # 所属課×公開案件：アクセス不可
                ProjectModel(
                    id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="7b36cc66-fe66-495f-b416-16ecc879fbaa",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    main_supporter_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    supporter_organization_id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    survey_password="coKbMSLitfhRxTT00VEm8zZxr9x4AY29d6yR",
                    is_survey_email_to_salesforce_main_customer=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
            (
                ProjectSurveyModel(
                    id="3361530c-1f7a-43f7-b306-6e88f88f92c3",
                    data_type=DataType.SURVEY,
                    survey_master_id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                    survey_master_revision=4,
                    survey_type="quick",
                    project_id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    project_name="サンプルプロジェクト",
                    customer_success="DXの実現",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    supporter_organization_name="AST",
                    support_date_from="2021/06/01",
                    support_date_to="2022/12/31",
                    main_supporter_user=SupporterUserAttribute(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        name="田中 三郎",
                        organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                        organization_name="AST",
                    ),
                    supporter_users=[
                        SupporterUserAttribute(
                            id="b9b67094-cdab-494c-818e-d4845088269b",
                            name="田中 次郎",
                            organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                            organization_name="AST",
                        )
                    ],
                    sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    service_type_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    service_type_name="組織開発",
                    answer_user_id="",
                    answer_user_name="",
                    customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                    customer_name="取引先株式会社",
                    company="ソニーグループ株式会社",
                    answers=[
                        AnswersAttribute(
                            id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                            answer="問題なし",
                            point=3,
                        )
                    ],
                    summary_month="2022/01",
                    plan_survey_request_datetime="2022/01/15 01:00",
                    actual_survey_request_datetime="2022/01/15 01:10",
                    plan_survey_response_datetime="2022/01/31 17:00",
                    actual_survey_response_datetime="",
                    is_finished=True,
                    is_disclosure=True,
                    is_not_summary=False,
                    points=PointsAttribute(
                        satisfaction=3,
                        continuation=False,
                        recommended=3,
                        sales=0,
                        survey_satisfaction=4,
                        man_hour_satisfaction=4,
                        karte_satisfaction=4,
                        master_karte_satisfaction=0,
                    ),
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                [
                    AdminModel(
                        id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        data_type=DataType.ADMIN,
                        name="田中太郎",
                        email="user@example.com",
                        roles={UserRoleType.SURVEY_OPS.key},
                        company=None,
                        job="部長",
                        supporter_organization_id={
                            "180a3597-b7e7-42c8-902c-a29016afa662"
                        },
                        organization_name=None,
                        cognito_id=None,
                        last_login_at="2020-10-23T03:21:39.356000+0000",
                        otp_secret=None,
                        otp_verified_token=None,
                        otp_verified_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.SALES.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="d9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="顧客太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                # 所属課×非公開案件：アクセス不可
                ProjectModel(
                    id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="7b36cc66-fe66-495f-b416-16ecc879fbaa",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    main_supporter_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    supporter_organization_id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["906a3144-9650-4a34-8a23-3b02f3b9aeac"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    contract_type="有償",
                    is_secret=True,
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    survey_password="coKbMSLitfhRxTT00VEm8zZxr9x4AY29d6yR",
                    is_survey_email_to_salesforce_main_customer=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
            (
                ProjectSurveyModel(
                    id="3361530c-1f7a-43f7-b306-6e88f88f92c3",
                    data_type=DataType.SURVEY,
                    survey_master_id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                    survey_master_revision=4,
                    survey_type="quick",
                    project_id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    project_name="サンプルプロジェクト",
                    customer_success="DXの実現",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    supporter_organization_name="AST",
                    support_date_from="2021/06/01",
                    support_date_to="2022/12/31",
                    main_supporter_user=SupporterUserAttribute(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        name="田中 三郎",
                        organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                        organization_name="AST",
                    ),
                    supporter_users=[
                        SupporterUserAttribute(
                            id="b9b67094-cdab-494c-818e-d4845088269b",
                            name="田中 次郎",
                            organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                            organization_name="AST",
                        )
                    ],
                    sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    service_type_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    service_type_name="組織開発",
                    answer_user_id="",
                    answer_user_name="",
                    customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                    customer_name="取引先株式会社",
                    company="ソニーグループ株式会社",
                    answers=[
                        AnswersAttribute(
                            id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                            answer="問題なし",
                            point=3,
                        )
                    ],
                    summary_month="2022/01",
                    plan_survey_request_datetime="2022/01/15 01:00",
                    actual_survey_request_datetime="2022/01/15 01:10",
                    plan_survey_response_datetime="2022/01/31 17:00",
                    actual_survey_response_datetime="",
                    is_finished=True,
                    is_disclosure=True,
                    is_not_summary=False,
                    points=PointsAttribute(
                        satisfaction=3,
                        continuation=False,
                        recommended=3,
                        sales=0,
                        survey_satisfaction=4,
                        man_hour_satisfaction=4,
                        karte_satisfaction=4,
                        master_karte_satisfaction=0,
                    ),
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                [
                    AdminModel(
                        id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        data_type=DataType.ADMIN,
                        name="田中太郎",
                        email="user@example.com",
                        roles={UserRoleType.SURVEY_OPS.key},
                        company=None,
                        job="部長",
                        supporter_organization_id={
                            "180a3597-b7e7-42c8-902c-a29016afa662"
                        },
                        organization_name=None,
                        cognito_id=None,
                        last_login_at="2020-10-23T03:21:39.356000+0000",
                        otp_secret=None,
                        otp_verified_token=None,
                        otp_verified_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.SALES.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="d9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="顧客太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                # 非所属課×公開案件：アクセス不可
                ProjectModel(
                    id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="7b36cc66-fe66-495f-b416-16ecc879fbaa",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    main_supporter_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["906a3144-9650-4a34-8a23-3b02f3b9aeac"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    survey_password="coKbMSLitfhRxTT00VEm8zZxr9x4AY29d6yR",
                    is_survey_email_to_salesforce_main_customer=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
            (
                ProjectSurveyModel(
                    id="3361530c-1f7a-43f7-b306-6e88f88f92c3",
                    data_type=DataType.SURVEY,
                    survey_master_id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                    survey_master_revision=4,
                    survey_type="quick",
                    project_id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    project_name="サンプルプロジェクト",
                    customer_success="DXの実現",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    supporter_organization_name="AST",
                    support_date_from="2021/06/01",
                    support_date_to="2022/12/31",
                    main_supporter_user=SupporterUserAttribute(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        name="田中 三郎",
                        organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                        organization_name="AST",
                    ),
                    supporter_users=[
                        SupporterUserAttribute(
                            id="b9b67094-cdab-494c-818e-d4845088269b",
                            name="田中 次郎",
                            organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                            organization_name="AST",
                        )
                    ],
                    sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    service_type_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    service_type_name="組織開発",
                    answer_user_id="",
                    answer_user_name="",
                    customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                    customer_name="取引先株式会社",
                    company="ソニーグループ株式会社",
                    answers=[
                        AnswersAttribute(
                            id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                            answer="問題なし",
                            point=3,
                        )
                    ],
                    summary_month="2022/01",
                    plan_survey_request_datetime="2022/01/15 01:00",
                    actual_survey_request_datetime="2022/01/15 01:10",
                    plan_survey_response_datetime="2022/01/31 17:00",
                    actual_survey_response_datetime="",
                    is_finished=True,
                    is_disclosure=True,
                    is_not_summary=False,
                    points=PointsAttribute(
                        satisfaction=3,
                        continuation=False,
                        recommended=3,
                        sales=0,
                        survey_satisfaction=4,
                        man_hour_satisfaction=4,
                        karte_satisfaction=4,
                        master_karte_satisfaction=0,
                    ),
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                [
                    AdminModel(
                        id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        data_type=DataType.ADMIN,
                        name="田中太郎",
                        email="user@example.com",
                        roles={UserRoleType.SURVEY_OPS.key},
                        company=None,
                        job="部長",
                        supporter_organization_id={
                            "180a3597-b7e7-42c8-902c-a29016afa662"
                        },
                        organization_name=None,
                        cognito_id=None,
                        last_login_at="2020-10-23T03:21:39.356000+0000",
                        otp_secret=None,
                        otp_verified_token=None,
                        otp_verified_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.SALES.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="d9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="顧客太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                # 非所属課×非公開案件
                ProjectModel(
                    id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="7b36cc66-fe66-495f-b416-16ecc879fbaa",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    main_supporter_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    contract_type="有償",
                    is_secret=True,
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    survey_password="coKbMSLitfhRxTT00VEm8zZxr9x4AY29d6yR",
                    is_survey_email_to_salesforce_main_customer=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
        ],
    )
    def test_auth_error_supporter_mgr_404(
        self,
        mocker,
        mock_auth_admin,
        survey_model,
        expected,
        admin_models,
        user_models,
        project_model,
    ):
        """権限確認、支援者責任者：「自身の課以外の非公開案件」-> アクセス不可"""
        mock_auth_admin([UserRoleType.SUPPORTER_MGR.key])
        survey_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        mock_survey = mocker.patch.object(ProjectSurveyModel, "get")
        mock_survey.return_value = survey_model

        mock_admin = mocker.patch.object(AdminModel, "scan")
        mock_admin.return_value = admin_models
        mock_user = mocker.patch.object(UserModel, "scan")
        mock_user.return_value = user_models
        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model

        mock_master_supporter_org = mocker.patch.object(
            MasterSupporterOrganizationModel.data_type_index, "query"
        )
        mock_master_supporter_org.return_value = [
            MasterSupporterOrganizationModel(
                id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                data_type="master_supporter_organization",
                name="Ideation Service Team",
                value="IST",
                attributes=None,
                order=1,
                use=True,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T04:21:39.356000+0000",
                version=1,
            )
        ]
        mock_survey_master = mocker.patch.object(
            SurveyMasterModel.is_latest_name_index, "query"
        )
        mock_survey_master.return_value = [
            SurveyMasterModel(
                id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                revision=4,
                name="テンプレート",
                type="service",
                timing="毎月",
                init_send_day_setting=20,
                init_answer_limit_day_setting=5,
                is_disclosure=True,
                questions=[QuestionsAttribute()],
                question_flow=[QuestionFlowAttribute()],
                is_latest=1,
                create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                create_at="2022-05-23T16:34:21.523000+0000",
                update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                update_at="2022-05-23T16:34:21.523000+0000",
                version=1,
            )
        ]

        mocker.patch.object(ProjectSurveyModel, "update")

        mocker.patch.object(NotificationService, "save_notification")
        mocker.patch.object(SqsHelper, "send_message_to_queue")
        mock_aes_cipher = mocker.patch.object(AesCipherUtils, "decrypt")
        mock_aes_cipher.return_value = "iret1234"

        response = client.get(
            f"/api/surveys/resend/{survey_id}", headers=REQUEST_HEADERS
        )

        assert response.status_code == 404

    @pytest.mark.parametrize(
        "survey_model, expected, admin_models, user_models, project_model",
        [
            (
                ProjectSurveyModel(
                    id="3361530c-1f7a-43f7-b306-6e88f88f92c3",
                    data_type=DataType.SURVEY,
                    survey_master_id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                    survey_master_revision=4,
                    survey_type="quick",
                    project_id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    project_name="サンプルプロジェクト",
                    customer_success="DXの実現",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    supporter_organization_name="AST",
                    support_date_from="2021/06/01",
                    support_date_to="2022/12/31",
                    main_supporter_user=SupporterUserAttribute(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        name="田中 三郎",
                        organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                        organization_name="AST",
                    ),
                    supporter_users=[
                        SupporterUserAttribute(
                            id="b9b67094-cdab-494c-818e-d4845088269b",
                            name="田中 次郎",
                            organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                            organization_name="AST",
                        )
                    ],
                    sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    service_type_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    service_type_name="組織開発",
                    answer_user_id="",
                    answer_user_name="",
                    customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                    customer_name="取引先株式会社",
                    company="ソニーグループ株式会社",
                    answers=[
                        AnswersAttribute(
                            id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                            answer="問題なし",
                            point=3,
                        )
                    ],
                    summary_month="2022/01",
                    plan_survey_request_datetime="2022/01/15 01:00",
                    actual_survey_request_datetime="2022/01/15 01:10",
                    plan_survey_response_datetime="2022/01/31 17:00",
                    actual_survey_response_datetime="",
                    is_finished=True,
                    is_disclosure=True,
                    is_not_summary=False,
                    points=PointsAttribute(
                        satisfaction=3,
                        continuation=False,
                        recommended=3,
                        sales=0,
                        survey_satisfaction=4,
                        man_hour_satisfaction=4,
                        karte_satisfaction=4,
                        master_karte_satisfaction=0,
                    ),
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                [
                    AdminModel(
                        id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        data_type=DataType.ADMIN,
                        name="田中太郎",
                        email="user@example.com",
                        roles={UserRoleType.SURVEY_OPS.key},
                        company=None,
                        job="部長",
                        supporter_organization_id={
                            "180a3597-b7e7-42c8-902c-a29016afa662"
                        },
                        organization_name=None,
                        cognito_id=None,
                        last_login_at="2020-10-23T03:21:39.356000+0000",
                        otp_secret=None,
                        otp_verified_token=None,
                        otp_verified_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.SALES.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="d9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="顧客太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                ProjectModel(
                    id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="906a3144-9650-4a34-8a23-3b02f3b9aeac",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="7b36cc66-fe66-495f-b416-16ecc879fbaa",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    main_supporter_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    survey_password="coKbMSLitfhRxTT00VEm8zZxr9x4AY29d6yR",
                    is_survey_email_to_salesforce_main_customer=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
        ],
    )
    def test_auth_ok_sales(
        self,
        mocker,
        mock_auth_admin,
        survey_model,
        expected,
        admin_models,
        user_models,
        project_model,
    ):
        """権限確認、営業担当者：アクセス可"""
        mock_auth_admin([UserRoleType.SALES.key])
        survey_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        mock_survey = mocker.patch.object(ProjectSurveyModel, "get")
        mock_survey.return_value = survey_model

        mock_admin = mocker.patch.object(AdminModel, "scan")
        mock_admin.return_value = admin_models
        mock_user = mocker.patch.object(UserModel, "scan")
        mock_user.return_value = user_models
        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model

        mock_master_supporter_org = mocker.patch.object(
            MasterSupporterOrganizationModel.data_type_index, "query"
        )
        mock_master_supporter_org.return_value = [
            MasterSupporterOrganizationModel(
                id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                data_type="master_supporter_organization",
                name="Ideation Service Team",
                value="IST",
                attributes=None,
                order=1,
                use=True,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T04:21:39.356000+0000",
                version=1,
            )
        ]
        mock_survey_master = mocker.patch.object(
            SurveyMasterModel.is_latest_name_index, "query"
        )
        mock_survey_master.return_value = [
            SurveyMasterModel(
                id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                revision=4,
                name="テンプレート",
                type="service",
                timing="毎月",
                init_send_day_setting=20,
                init_answer_limit_day_setting=5,
                is_disclosure=True,
                questions=[QuestionsAttribute()],
                question_flow=[QuestionFlowAttribute()],
                is_latest=1,
                create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                create_at="2022-05-23T16:34:21.523000+0000",
                update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                update_at="2022-05-23T16:34:21.523000+0000",
                version=1,
            )
        ]

        mocker.patch.object(ProjectSurveyModel, "update")

        mocker.patch.object(NotificationService, "save_notification")
        mocker.patch.object(SqsHelper, "send_message_to_queue")
        mock_aes_cipher = mocker.patch.object(AesCipherUtils, "decrypt")
        mock_aes_cipher.return_value = "iret1234"

        response = client.get(
            f"/api/surveys/resend/{survey_id}", headers=REQUEST_HEADERS
        )

        actual = response.json()
        assert response.status_code == 200
        assert actual == expected

    @pytest.mark.parametrize(
        "survey_model, expected, admin_models, user_models, project_model",
        [
            (
                ProjectSurveyModel(
                    id="3361530c-1f7a-43f7-b306-6e88f88f92c3",
                    data_type=DataType.SURVEY,
                    survey_master_id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                    survey_master_revision=4,
                    survey_type="quick",
                    project_id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    project_name="サンプルプロジェクト",
                    customer_success="DXの実現",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    supporter_organization_name="AST",
                    support_date_from="2021/06/01",
                    support_date_to="2022/12/31",
                    main_supporter_user=SupporterUserAttribute(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        name="田中 三郎",
                        organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                        organization_name="AST",
                    ),
                    supporter_users=[
                        SupporterUserAttribute(
                            id="b9b67094-cdab-494c-818e-d4845088269b",
                            name="田中 次郎",
                            organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                            organization_name="AST",
                        )
                    ],
                    sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    service_type_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    service_type_name="組織開発",
                    answer_user_id="",
                    answer_user_name="",
                    customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                    customer_name="取引先株式会社",
                    company="ソニーグループ株式会社",
                    answers=[
                        AnswersAttribute(
                            id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                            answer="問題なし",
                            point=3,
                        )
                    ],
                    summary_month="2022/01",
                    plan_survey_request_datetime="2022/01/15 01:00",
                    actual_survey_request_datetime="2022/01/15 01:10",
                    plan_survey_response_datetime="2022/01/31 17:00",
                    actual_survey_response_datetime="",
                    is_finished=True,
                    is_disclosure=True,
                    is_not_summary=False,
                    points=PointsAttribute(
                        satisfaction=3,
                        continuation=False,
                        recommended=3,
                        sales=0,
                        survey_satisfaction=4,
                        man_hour_satisfaction=4,
                        karte_satisfaction=4,
                        master_karte_satisfaction=0,
                    ),
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                [
                    AdminModel(
                        id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        data_type=DataType.ADMIN,
                        name="田中太郎",
                        email="user@example.com",
                        roles={UserRoleType.SURVEY_OPS.key},
                        company=None,
                        job="部長",
                        supporter_organization_id={
                            "180a3597-b7e7-42c8-902c-a29016afa662"
                        },
                        organization_name=None,
                        cognito_id=None,
                        last_login_at="2020-10-23T03:21:39.356000+0000",
                        otp_secret=None,
                        otp_verified_token=None,
                        otp_verified_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.SALES.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="d9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="顧客太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                ProjectModel(
                    id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="7b36cc66-fe66-495f-b416-16ecc879fbaa",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    main_supporter_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    survey_password="coKbMSLitfhRxTT00VEm8zZxr9x4AY29d6yR",
                    is_survey_email_to_salesforce_main_customer=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
        ],
    )
    def test_auth_ok_sales_mgr(
        self,
        mocker,
        mock_auth_admin,
        survey_model,
        expected,
        admin_models,
        user_models,
        project_model,
    ):
        """権限確認、営業責任者：アクセス可"""
        mock_auth_admin([UserRoleType.SALES_MGR.key])
        survey_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        mock_survey = mocker.patch.object(ProjectSurveyModel, "get")
        mock_survey.return_value = survey_model

        mock_admin = mocker.patch.object(AdminModel, "scan")
        mock_admin.return_value = admin_models
        mock_user = mocker.patch.object(UserModel, "scan")
        mock_user.return_value = user_models
        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model

        mock_master_supporter_org = mocker.patch.object(
            MasterSupporterOrganizationModel.data_type_index, "query"
        )
        mock_master_supporter_org.return_value = [
            MasterSupporterOrganizationModel(
                id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                data_type="master_supporter_organization",
                name="Ideation Service Team",
                value="IST",
                attributes=None,
                order=1,
                use=True,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T04:21:39.356000+0000",
                version=1,
            )
        ]
        mock_survey_master = mocker.patch.object(
            SurveyMasterModel.is_latest_name_index, "query"
        )
        mock_survey_master.return_value = [
            SurveyMasterModel(
                id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                revision=4,
                name="テンプレート",
                type="service",
                timing="毎月",
                init_send_day_setting=20,
                init_answer_limit_day_setting=5,
                is_disclosure=True,
                questions=[QuestionsAttribute()],
                question_flow=[QuestionFlowAttribute()],
                is_latest=1,
                create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                create_at="2022-05-23T16:34:21.523000+0000",
                update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                update_at="2022-05-23T16:34:21.523000+0000",
                version=1,
            )
        ]

        mocker.patch.object(ProjectSurveyModel, "update")

        mocker.patch.object(NotificationService, "save_notification")
        mocker.patch.object(SqsHelper, "send_message_to_queue")
        mock_aes_cipher = mocker.patch.object(AesCipherUtils, "decrypt")
        mock_aes_cipher.return_value = "iret1234"

        response = client.get(
            f"/api/surveys/resend/{survey_id}", headers=REQUEST_HEADERS
        )

        actual = response.json()
        assert response.status_code == 200
        assert actual == expected

    @pytest.mark.parametrize(
        "survey_model, expected, admin_models, user_models, project_model",
        [
            (
                ProjectSurveyModel(
                    id="3361530c-1f7a-43f7-b306-6e88f88f92c3",
                    data_type=DataType.SURVEY,
                    survey_master_id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                    survey_master_revision=4,
                    survey_type="quick",
                    project_id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    project_name="サンプルプロジェクト",
                    customer_success="DXの実現",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    supporter_organization_name="AST",
                    support_date_from="2021/06/01",
                    support_date_to="2022/12/31",
                    main_supporter_user=SupporterUserAttribute(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        name="田中 三郎",
                        organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                        organization_name="AST",
                    ),
                    supporter_users=[
                        SupporterUserAttribute(
                            id="b9b67094-cdab-494c-818e-d4845088269b",
                            name="田中 次郎",
                            organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                            organization_name="AST",
                        )
                    ],
                    sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    service_type_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    service_type_name="組織開発",
                    answer_user_id="",
                    answer_user_name="",
                    customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                    customer_name="取引先株式会社",
                    company="ソニーグループ株式会社",
                    answers=[
                        AnswersAttribute(
                            id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                            answer="問題なし",
                            point=3,
                        )
                    ],
                    summary_month="2022/01",
                    plan_survey_request_datetime="2022/01/15 01:00",
                    actual_survey_request_datetime="2022/01/15 01:10",
                    plan_survey_response_datetime="2022/01/31 17:00",
                    actual_survey_response_datetime="",
                    is_finished=True,
                    is_disclosure=True,
                    is_not_summary=False,
                    points=PointsAttribute(
                        satisfaction=3,
                        continuation=False,
                        recommended=3,
                        sales=0,
                        survey_satisfaction=4,
                        man_hour_satisfaction=4,
                        karte_satisfaction=4,
                        master_karte_satisfaction=0,
                    ),
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                [
                    AdminModel(
                        id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        data_type=DataType.ADMIN,
                        name="田中太郎",
                        email="user@example.com",
                        roles={UserRoleType.SURVEY_OPS.key},
                        company=None,
                        job="部長",
                        supporter_organization_id={
                            "180a3597-b7e7-42c8-902c-a29016afa662"
                        },
                        organization_name=None,
                        cognito_id=None,
                        last_login_at="2020-10-23T03:21:39.356000+0000",
                        otp_secret=None,
                        otp_verified_token=None,
                        otp_verified_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.SALES.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="d9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="顧客太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                ProjectModel(
                    id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="7b36cc66-fe66-495f-b416-16ecc879fbaa",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    main_supporter_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    survey_password="coKbMSLitfhRxTT00VEm8zZxr9x4AY29d6yR",
                    is_survey_email_to_salesforce_main_customer=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
        ],
    )
    def test_auth_ok_survey_ops(
        self,
        mocker,
        mock_auth_admin,
        survey_model,
        expected,
        admin_models,
        user_models,
        project_model,
    ):
        """権限確認、アンケート事務局：アクセス可"""
        mock_auth_admin([UserRoleType.SURVEY_OPS.key])
        survey_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        mock_survey = mocker.patch.object(ProjectSurveyModel, "get")
        mock_survey.return_value = survey_model

        mock_admin = mocker.patch.object(AdminModel, "scan")
        mock_admin.return_value = admin_models
        mock_user = mocker.patch.object(UserModel, "scan")
        mock_user.return_value = user_models
        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model

        mock_master_supporter_org = mocker.patch.object(
            MasterSupporterOrganizationModel.data_type_index, "query"
        )
        mock_master_supporter_org.return_value = [
            MasterSupporterOrganizationModel(
                id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                data_type="master_supporter_organization",
                name="Ideation Service Team",
                value="IST",
                attributes=None,
                order=1,
                use=True,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T04:21:39.356000+0000",
                version=1,
            )
        ]
        mock_survey_master = mocker.patch.object(
            SurveyMasterModel.is_latest_name_index, "query"
        )
        mock_survey_master.return_value = [
            SurveyMasterModel(
                id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                revision=4,
                name="テンプレート",
                type="service",
                timing="毎月",
                init_send_day_setting=20,
                init_answer_limit_day_setting=5,
                is_disclosure=True,
                questions=[QuestionsAttribute()],
                question_flow=[QuestionFlowAttribute()],
                is_latest=1,
                create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                create_at="2022-05-23T16:34:21.523000+0000",
                update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                update_at="2022-05-23T16:34:21.523000+0000",
                version=1,
            )
        ]

        mocker.patch.object(ProjectSurveyModel, "update")

        mocker.patch.object(NotificationService, "save_notification")
        mocker.patch.object(SqsHelper, "send_message_to_queue")
        mock_aes_cipher = mocker.patch.object(AesCipherUtils, "decrypt")
        mock_aes_cipher.return_value = "iret1234"

        response = client.get(
            f"/api/surveys/resend/{survey_id}", headers=REQUEST_HEADERS
        )

        actual = response.json()
        assert response.status_code == 200
        assert actual == expected

    @pytest.mark.parametrize(
        "survey_model, expected, admin_models, user_models, project_model",
        [
            (
                ProjectSurveyModel(
                    id="3361530c-1f7a-43f7-b306-6e88f88f92c3",
                    data_type=DataType.SURVEY,
                    survey_master_id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                    survey_master_revision=4,
                    survey_type="quick",
                    project_id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    project_name="サンプルプロジェクト",
                    customer_success="DXの実現",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    supporter_organization_name="AST",
                    support_date_from="2021/06/01",
                    support_date_to="2022/12/31",
                    main_supporter_user=SupporterUserAttribute(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        name="田中 三郎",
                        organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                        organization_name="AST",
                    ),
                    supporter_users=[
                        SupporterUserAttribute(
                            id="b9b67094-cdab-494c-818e-d4845088269b",
                            name="田中 次郎",
                            organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                            organization_name="AST",
                        )
                    ],
                    sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    service_type_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    service_type_name="組織開発",
                    answer_user_id="",
                    answer_user_name="",
                    customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                    customer_name="取引先株式会社",
                    company="ソニーグループ株式会社",
                    answers=[
                        AnswersAttribute(
                            id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                            answer="問題なし",
                            point=3,
                        )
                    ],
                    summary_month="2022/01",
                    plan_survey_request_datetime="2022/01/15 01:00",
                    actual_survey_request_datetime="2022/01/15 01:10",
                    plan_survey_response_datetime="2022/01/31 17:00",
                    actual_survey_response_datetime="",
                    is_finished=True,
                    is_disclosure=True,
                    is_not_summary=False,
                    points=PointsAttribute(
                        satisfaction=3,
                        continuation=False,
                        recommended=3,
                        sales=0,
                        survey_satisfaction=4,
                        man_hour_satisfaction=4,
                        karte_satisfaction=4,
                        master_karte_satisfaction=0,
                    ),
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                [
                    AdminModel(
                        id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        data_type=DataType.ADMIN,
                        name="田中太郎",
                        email="user@example.com",
                        roles={UserRoleType.SURVEY_OPS.key},
                        company=None,
                        job="部長",
                        supporter_organization_id={
                            "180a3597-b7e7-42c8-902c-a29016afa662"
                        },
                        organization_name=None,
                        cognito_id=None,
                        last_login_at="2020-10-23T03:21:39.356000+0000",
                        otp_secret=None,
                        otp_verified_token=None,
                        otp_verified_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.SALES.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="d9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="顧客太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                ProjectModel(
                    id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="7b36cc66-fe66-495f-b416-16ecc879fbaa",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    main_supporter_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    survey_password="coKbMSLitfhRxTT00VEm8zZxr9x4AY29d6yR",
                    is_survey_email_to_salesforce_main_customer=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
        ],
    )
    def test_auth_ok_man_hour_ops(
        self,
        mocker,
        mock_auth_admin,
        survey_model,
        expected,
        admin_models,
        user_models,
        project_model,
    ):
        """権限確認、稼働率調査事務局：アクセス不可"""
        mock_auth_admin([UserRoleType.MAN_HOUR_OPS.key])
        survey_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        mock_survey = mocker.patch.object(ProjectSurveyModel, "get")
        mock_survey.return_value = survey_model

        mock_admin = mocker.patch.object(AdminModel, "scan")
        mock_admin.return_value = admin_models
        mock_user = mocker.patch.object(UserModel, "scan")
        mock_user.return_value = user_models
        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model

        mock_master_supporter_org = mocker.patch.object(
            MasterSupporterOrganizationModel.data_type_index, "query"
        )
        mock_master_supporter_org.return_value = [
            MasterSupporterOrganizationModel(
                id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                data_type="master_supporter_organization",
                name="Ideation Service Team",
                value="IST",
                attributes=None,
                order=1,
                use=True,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T04:21:39.356000+0000",
                version=1,
            )
        ]
        mock_survey_master = mocker.patch.object(
            SurveyMasterModel.is_latest_name_index, "query"
        )
        mock_survey_master.return_value = [
            SurveyMasterModel(
                id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                revision=4,
                name="テンプレート",
                type="service",
                timing="毎月",
                init_send_day_setting=20,
                init_answer_limit_day_setting=5,
                is_disclosure=True,
                questions=[QuestionsAttribute()],
                question_flow=[QuestionFlowAttribute()],
                is_latest=1,
                create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                create_at="2022-05-23T16:34:21.523000+0000",
                update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                update_at="2022-05-23T16:34:21.523000+0000",
                version=1,
            )
        ]

        mocker.patch.object(ProjectSurveyModel, "update")

        mocker.patch.object(NotificationService, "save_notification")
        mocker.patch.object(SqsHelper, "send_message_to_queue")
        mock_aes_cipher = mocker.patch.object(AesCipherUtils, "decrypt")
        mock_aes_cipher.return_value = "iret1234"

        response = client.get(
            f"/api/surveys/resend/{survey_id}", headers=REQUEST_HEADERS
        )

        assert response.status_code == 404

    @pytest.mark.parametrize(
        "survey_model, expected, admin_models, user_models, project_model",
        [
            (
                ProjectSurveyModel(
                    id="3361530c-1f7a-43f7-b306-6e88f88f92c3",
                    data_type=DataType.SURVEY,
                    survey_master_id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                    survey_master_revision=4,
                    survey_type="quick",
                    project_id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    project_name="サンプルプロジェクト",
                    customer_success="DXの実現",
                    supporter_organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                    supporter_organization_name="AST",
                    support_date_from="2021/06/01",
                    support_date_to="2022/12/31",
                    main_supporter_user=SupporterUserAttribute(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        name="田中 三郎",
                        organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                        organization_name="AST",
                    ),
                    supporter_users=[
                        SupporterUserAttribute(
                            id="b9b67094-cdab-494c-818e-d4845088269b",
                            name="田中 次郎",
                            organization_id="de40733f-6be9-4fef-8229-01052f43c1e2",
                            organization_name="AST",
                        )
                    ],
                    sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    service_type_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    service_type_name="組織開発",
                    answer_user_id="",
                    answer_user_name="",
                    customer_id="106a3144-9650-4a34-8a23-3b02f3b9aeac",
                    customer_name="取引先株式会社",
                    company="ソニーグループ株式会社",
                    answers=[
                        AnswersAttribute(
                            id="89cbe2ed-f44c-4a1c-9408-c67b0ca2270d",
                            answer="問題なし",
                            point=3,
                        )
                    ],
                    summary_month="2022/01",
                    plan_survey_request_datetime="2022/01/15 01:00",
                    actual_survey_request_datetime="2022/01/15 01:10",
                    plan_survey_response_datetime="2022/01/31 17:00",
                    actual_survey_response_datetime="",
                    is_finished=True,
                    is_disclosure=True,
                    is_not_summary=False,
                    points=PointsAttribute(
                        satisfaction=3,
                        continuation=False,
                        recommended=3,
                        sales=0,
                        survey_satisfaction=4,
                        man_hour_satisfaction=4,
                        karte_satisfaction=4,
                        master_karte_satisfaction=0,
                    ),
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {"message": "OK"},
                [
                    AdminModel(
                        id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        data_type=DataType.ADMIN,
                        name="田中太郎",
                        email="user@example.com",
                        roles={UserRoleType.SURVEY_OPS.key},
                        company=None,
                        job="部長",
                        supporter_organization_id={
                            "180a3597-b7e7-42c8-902c-a29016afa662"
                        },
                        organization_name=None,
                        cognito_id=None,
                        last_login_at="2020-10-23T03:21:39.356000+0000",
                        otp_secret=None,
                        otp_verified_token=None,
                        otp_verified_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.SALES.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.SUPPORTER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="d9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="顧客太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER.key,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
                ProjectModel(
                    id="ca57d2cd-a898-4344-bdbd-9811fb26e19f",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="7b36cc66-fe66-495f-b416-16ecc879fbaa",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    main_supporter_user_id="51ff73f4-2414-421c-b64c-9981f988b331",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["51ff73f4-2414-421c-b64c-9981f988b331"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    dedicated_survey_user_name="テストアンケート回答者",
                    dedicated_survey_user_email="test@example.com",
                    survey_password="coKbMSLitfhRxTT00VEm8zZxr9x4AY29d6yR",
                    is_survey_email_to_salesforce_main_customer=False,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
        ],
    )
    def test_auth_ok_system_admin_ops(
        self,
        mocker,
        mock_auth_admin,
        survey_model,
        expected,
        admin_models,
        user_models,
        project_model,
    ):
        """権限確認、システム管理者：アクセス可"""
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])
        survey_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        mock_survey = mocker.patch.object(ProjectSurveyModel, "get")
        mock_survey.return_value = survey_model

        mock_admin = mocker.patch.object(AdminModel, "scan")
        mock_admin.return_value = admin_models
        mock_user = mocker.patch.object(UserModel, "scan")
        mock_user.return_value = user_models
        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model

        mock_master_supporter_org = mocker.patch.object(
            MasterSupporterOrganizationModel.data_type_index, "query"
        )
        mock_master_supporter_org.return_value = [
            MasterSupporterOrganizationModel(
                id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                data_type="master_supporter_organization",
                name="Ideation Service Team",
                value="IST",
                attributes=None,
                order=1,
                use=True,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T04:21:39.356000+0000",
                version=1,
            )
        ]
        mock_survey_master = mocker.patch.object(
            SurveyMasterModel.is_latest_name_index, "query"
        )
        mock_survey_master.return_value = [
            SurveyMasterModel(
                id="9fb8c7c1-fa03-48ce-b0b1-be8fe638fabf",
                revision=4,
                name="テンプレート",
                type="service",
                timing="毎月",
                init_send_day_setting=20,
                init_answer_limit_day_setting=5,
                is_disclosure=True,
                questions=[QuestionsAttribute()],
                question_flow=[QuestionFlowAttribute()],
                is_latest=1,
                create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                create_at="2022-05-23T16:34:21.523000+0000",
                update_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                update_at="2022-05-23T16:34:21.523000+0000",
                version=1,
            )
        ]

        mocker.patch.object(ProjectSurveyModel, "update")

        mocker.patch.object(NotificationService, "save_notification")
        mocker.patch.object(SqsHelper, "send_message_to_queue")
        mock_aes_cipher = mocker.patch.object(AesCipherUtils, "decrypt")
        mock_aes_cipher.return_value = "iret1234"

        response = client.get(
            f"/api/surveys/resend/{survey_id}", headers=REQUEST_HEADERS
        )

        actual = response.json()
        assert response.status_code == 200
        assert actual == expected
