from datetime import datetime

import pytest
from fastapi import HTTPException, status
from fastapi.testclient import TestClient
from pynamodb.exceptions import DoesNotExist

from app.main import app
from app.models.admin import AdminModel
from app.models.master import MasterSupporterOrganizationModel
from app.models.project import (
    GrossProfitAttribute,
    ProjectModel,
    SalesforceMainCustomerAttribute,
)
from app.models.user import UserModel
from app.resources.const import DataType, MasterDataType, UserRoleType
from app.service.customer_service import CustomerService
from app.service.project_service import ProjectService
from app.utils.cipher_aes import AesCipherUtils

client = TestClient(app)

REQUEST_HEADERS = {"x-otp-verified-token": "111111"}


class TestGetProjectById:
    @pytest.mark.parametrize(
        "role_types",
        [
            [UserRoleType.SYSTEM_ADMIN.key],
            [UserRoleType.SALES.key],
            [UserRoleType.SALES_MGR.key],
            [UserRoleType.SUPPORTER_MGR.key],
            [UserRoleType.SURVEY_OPS.key],
            [UserRoleType.MAN_HOUR_OPS.key],
            [UserRoleType.BUSINESS_MGR.key],
        ]
    )
    def test_access_ok(
        self,
        mock_auth_admin,
        role_types,
    ):
        mock_auth_admin(role_types)
        response = client.get("/api/projects/efba46d3-1d56-428b-ac6d-a51e263b54a8", headers=REQUEST_HEADERS)

        assert response.status_code == 404

    @pytest.mark.parametrize(
        "project_id, project_model, expected, master_model, user_models",
        [
            (
                "efba46d3-1d56-428b-ac6d-a51e263b54a8",
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_opportunity_id="a03d1661-cdab-494c-818e-d4845088269b",
                    salesforce_update_at=CustomerService.jst.localize(
                        datetime.strptime(
                            "2020/10/23 03:21",
                            "%Y/%m/%d %H:%M",
                        )
                    ),
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    service_manager_name="山田太郎",
                    main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    is_solver_project=True,
                    dedicated_survey_user_name="山田太郎",
                    dedicated_survey_user_email="user@sample.com",
                    survey_password="ABCDEFGH1234",
                    is_survey_email_to_salesforce_main_customer=True,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="a9b67094-cdab-494c-818e-d4845088269b",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {
                    "id": "efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    "salesforceCustomerId": "c9b67094-cdab-494c-818e-d4845088269b",
                    "salesforceOpportunityId": "a03d1661-cdab-494c-818e-d4845088269b",
                    "salesforceUpdateAt": "2020/10/23 03:21",
                    "name": "サンプルプロジェクト",
                    "customerName": "ソニーグループ株式会社",
                    "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "serviceTypeName": "組織開発",
                    "createNew": True,
                    "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                    "mainSalesUserName": "田中太郎",
                    "phase": "プラン提示(D)",
                    "customerSuccess": "DXの実現",
                    "supportDateFrom": "2021/01/30",
                    "supportDateTo": "2021/02/28",
                    "profit": {
                        "monthly": [
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        "quarterly": [1200000, 1200000, 1200000, 1200000],
                        "half": [2400000, 2400000],
                        "year": 4800000,
                    },
                    "totalContractTime": 200,
                    "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                    "mainCustomerUserName": "田中次郎",
                    "salesforceMainCustomer": {
                        "name": "山田太郎",
                        "email": "yamada@example.com",
                        "organizationName": "IST",
                    },
                    "customerUsers": [
                        {"id": "c9b67094-cdab-494c-818e-d4845088269b", "name": "田中三郎"}
                    ],
                    "serviceManagerName": "山田太郎",
                    "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                    "mainSupporterUserName": "田中三郎",
                    "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "supporterOrganizationName": "IST",
                    "salesforceMainSupporterUserName": "山田太郎",
                    "supporterUsers": [
                        {"id": "c9b67094-cdab-494c-818e-d4845088269b", "name": "田中三郎"}
                    ],
                    "salesforceSupporterUserNames": ["山田太郎", "山田次郎"],
                    "isCountManHour": True,
                    "isKarteRemind": True,
                    "isMasterKarteRemind": True,
                    "contractType": "有償",
                    "isSecret": False,
                    "isSolverProject": True,
                    "dedicatedSurveyUserName": "山田太郎",
                    "dedicatedSurveyUserEmail": "user@sample.com",
                    "surveyPassword": "ABCDEFGH1234",
                    "isSurveyEmailToSalesforceMainCustomer": True,
                    "createId": "998c3cd7-63b5-453f-9de2-5af21d565b98",
                    "createAt": "2022-05-23T16:34:21.523+09:00",
                    "updateId": "a9b67094-cdab-494c-818e-d4845088269b",
                    "updateUserName": "田中太郎",
                    "updateAt": "2022-05-23T16:34:21.523+09:00",
                    "version": 1,
                },
                # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
                MasterSupporterOrganizationModel(
                    id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                    name="組織開発",
                    value="IST",
                    attributes=None,
                    order=1,
                    use=True,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # MasterSupporterOrganizationModel(
                #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                #     name="組織開発",
                #     value=None,
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                # MasterSupporterOrganizationModel(
                #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
                #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
                #     name="Ideation Service Team",
                #     value="IST",
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
            ),
            (
                "efba46d3-1d56-428b-ac6d-a51e263b54a8",
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_opportunity_id="a03d1661-cdab-494c-818e-d4845088269b",
                    salesforce_update_at=CustomerService.jst.localize(
                        datetime.strptime(
                            "2020/10/23 03:21",
                            "%Y/%m/%d %H:%M",
                        )
                    ),
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    service_manager_name="山田太郎",
                    main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    is_solver_project=True,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="a9b67094-cdab-494c-818e-d4845088269b",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
                {
                    "id": "efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    "customerId": "3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    "salesforceCustomerId": "c9b67094-cdab-494c-818e-d4845088269b",
                    "salesforceOpportunityId": "a03d1661-cdab-494c-818e-d4845088269b",
                    "salesforceUpdateAt": "2020/10/23 03:21",
                    "name": "サンプルプロジェクト",
                    "customerName": "ソニーグループ株式会社",
                    "serviceType": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "serviceTypeName": "組織開発",
                    "createNew": True,
                    "mainSalesUserId": "a9b67094-cdab-494c-818e-d4845088269b",
                    "mainSalesUserName": "田中太郎",
                    "phase": "プラン提示(D)",
                    "customerSuccess": "DXの実現",
                    "supportDateFrom": "2021/01/30",
                    "supportDateTo": "2021/02/28",
                    "profit": {
                        "monthly": [
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        "quarterly": [1200000, 1200000, 1200000, 1200000],
                        "half": [2400000, 2400000],
                        "year": 4800000,
                    },
                    "totalContractTime": 200,
                    "mainCustomerUserId": "b9b67094-cdab-494c-818e-d4845088269b",
                    "mainCustomerUserName": "田中次郎",
                    "salesforceMainCustomer": {
                        "name": "山田太郎",
                        "email": "yamada@example.com",
                        "organizationName": "IST",
                    },
                    "customerUsers": [
                        {"id": "c9b67094-cdab-494c-818e-d4845088269b", "name": "田中三郎"}
                    ],
                    "serviceManagerName": "山田太郎",
                    "mainSupporterUserId": "c9b67094-cdab-494c-818e-d4845088269b",
                    "mainSupporterUserName": "田中三郎",
                    "supporterOrganizationId": "7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    "supporterOrganizationName": "IST",
                    "salesforceMainSupporterUserName": "山田太郎",
                    "supporterUsers": [
                        {"id": "c9b67094-cdab-494c-818e-d4845088269b", "name": "田中三郎"}
                    ],
                    "salesforceSupporterUserNames": ["山田太郎", "山田次郎"],
                    "isCountManHour": True,
                    "isKarteRemind": True,
                    "isMasterKarteRemind": True,
                    "contractType": "有償",
                    "isSecret": False,
                    "isSolverProject": True,
                    "dedicatedSurveyUserName": "",
                    "dedicatedSurveyUserEmail": "",
                    "surveyPassword": "",
                    "isSurveyEmailToSalesforceMainCustomer": None,
                    "createId": "998c3cd7-63b5-453f-9de2-5af21d565b98",
                    "createAt": "2022-05-23T16:34:21.523+09:00",
                    "updateId": "a9b67094-cdab-494c-818e-d4845088269b",
                    "updateUserName": "田中太郎",
                    "updateAt": "2022-05-23T16:34:21.523+09:00",
                    "version": 1,
                },
                # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
                MasterSupporterOrganizationModel(
                    id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                    name="組織開発",
                    value="IST",
                    attributes=None,
                    order=1,
                    use=True,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T04:21:39.356000+0000",
                    version=1,
                ),
                # MasterSupporterOrganizationModel(
                #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
                #     name="組織開発",
                #     value=None,
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                # MasterSupporterOrganizationModel(
                #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
                #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
                #     name="Ideation Service Team",
                #     value="IST",
                #     attributes=None,
                #     order=1,
                #     use=True,
                #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     create_at="2020-10-23T03:21:39.356000+0000",
                #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                #     update_at="2020-10-23T04:21:39.356000+0000",
                #     version=1,
                # ),
                [
                    UserModel(
                        id="a9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中太郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="b9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中次郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                    UserModel(
                        id="c9b67094-cdab-494c-818e-d4845088269b",
                        data_type=DataType.USER,
                        name="田中三郎",
                        email="user@example.com",
                        role=UserRoleType.CUSTOMER,
                        customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                        customer_name="ソニーグループ株式会社",
                        job="部長",
                        company=None,
                        supporter_organization_id=None,
                        is_input_man_hour=None,
                        project_ids=None,
                        cognito_id=None,
                        agreed=False,
                        last_login_at=None,
                        disabled=False,
                        create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        create_at="2020-10-23T03:21:39.356000+0000",
                        update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                        update_at="2020-10-23T03:21:39.356000+0000",
                        version=1,
                    ),
                ],
            ),
        ],
    )
    def test_ok(
        self,
        mocker,
        mock_auth_admin,
        project_id,
        project_model,
        expected,
        master_model,
        user_models,
    ):
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])
        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        mock_master_supporter.return_value = master_model
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = user_models
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model
        mock_cipher = mocker.patch.object(AesCipherUtils, "decrypt")
        mock_cipher.return_value = "ABCDEFGH1234"

        response = client.get(f"/api/projects/{project_id}", headers=REQUEST_HEADERS)

        actual = response.json()
        assert response.status_code == 200
        assert actual == expected

    @pytest.mark.parametrize(
        "admin_model_get",
        [
            # システム管理者
            AdminModel(
                id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                data_type=DataType.ADMIN,
                name="田中太郎",
                email="user@example.com",
                roles={UserRoleType.SYSTEM_ADMIN.key},
                company=None,
                job="部長",
                supporter_organization_id={"180a3597-b7e7-42c8-902c-a29016afa662"},
                organization_name=None,
                cognito_id=None,
                last_login_at="2020-10-23T03:21:39.356000+0000",
                otp_secret=None,
                otp_verified_token="111111",
                otp_verified_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            # 営業担当者
            AdminModel(
                id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                data_type=DataType.ADMIN,
                name="田中太郎",
                email="user@example.com",
                roles={UserRoleType.SALES.key},
                company=None,
                job="部長",
                supporter_organization_id={"180a3597-b7e7-42c8-902c-a29016afa662"},
                organization_name=None,
                cognito_id=None,
                last_login_at="2020-10-23T03:21:39.356000+0000",
                otp_secret=None,
                otp_verified_token="111111",
                otp_verified_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            # 営業責任者
            AdminModel(
                id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                data_type=DataType.ADMIN,
                name="田中太郎",
                email="user@example.com",
                roles={UserRoleType.SALES_MGR.key},
                company=None,
                job="部長",
                supporter_organization_id={"180a3597-b7e7-42c8-902c-a29016afa662"},
                organization_name=None,
                cognito_id=None,
                last_login_at="2020-10-23T03:21:39.356000+0000",
                otp_secret=None,
                otp_verified_token="111111",
                otp_verified_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            # アンケート事務局
            AdminModel(
                id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                data_type=DataType.ADMIN,
                name="田中太郎",
                email="user@example.com",
                roles={UserRoleType.SURVEY_OPS.key},
                company=None,
                job="部長",
                supporter_organization_id={"180a3597-b7e7-42c8-902c-a29016afa662"},
                organization_name=None,
                cognito_id=None,
                last_login_at="2020-10-23T03:21:39.356000+0000",
                otp_secret=None,
                otp_verified_token="111111",
                otp_verified_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            # 稼働率調査事務局
            AdminModel(
                id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                data_type=DataType.ADMIN,
                name="田中太郎",
                email="user@example.com",
                roles={UserRoleType.MAN_HOUR_OPS.key},
                company=None,
                job="部長",
                supporter_organization_id={"180a3597-b7e7-42c8-902c-a29016afa662"},
                organization_name=None,
                cognito_id=None,
                last_login_at="2020-10-23T03:21:39.356000+0000",
                otp_secret=None,
                otp_verified_token="111111",
                otp_verified_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            # 支援者責任者, 自分の課以外の公開案件
            AdminModel(
                id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                data_type=DataType.ADMIN,
                name="田中太郎",
                email="user@example.com",
                roles={UserRoleType.SUPPORTER_MGR.key},
                company=None,
                job="部長",
                supporter_organization_id={"180a3597-b7e7-42c8-902c-a29016afa662"},
                organization_name=None,
                cognito_id=None,
                last_login_at="2020-10-23T03:21:39.356000+0000",
                otp_secret=None,
                otp_verified_token="111111",
                otp_verified_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
        ],
    )
    def test_auth_ok(
        self,
        mocker,
        mock_auth_admin,
        admin_model_get,
    ):
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])
        # mock_auth_adminのユーザ部分を上書き
        mock = mocker.patch.object(AdminModel, "get_admin_by_cognito_id")
        mock.return_value = admin_model_get

        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=True,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="a9b67094-cdab-494c-818e-d4845088269b",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}", headers=REQUEST_HEADERS)
        assert response.status_code == 200

    @pytest.mark.parametrize(
        "admin_model_get, project_model",
        [
            (
                # 支援者責任者, 自分の課以外の公開案件
                AdminModel(
                    id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    data_type=DataType.ADMIN,
                    name="田中太郎",
                    email="user@example.com",
                    roles={UserRoleType.SUPPORTER_MGR.key},
                    company=None,
                    job="部長",
                    supporter_organization_id={"180a3597-b7e7-42c8-902c-a29016afa662"},
                    organization_name=None,
                    cognito_id=None,
                    last_login_at="2020-10-23T03:21:39.356000+0000",
                    otp_secret=None,
                    otp_verified_token="111111",
                    otp_verified_at=None,
                    disabled=False,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T03:21:39.356000+0000",
                    version=1,
                ),
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    service_manager_name="山田太郎",
                    main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    is_solver_project=True,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="a9b67094-cdab-494c-818e-d4845088269b",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
            (
                # 支援者責任者, 自分の課の公開案件
                AdminModel(
                    id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    data_type=DataType.ADMIN,
                    name="田中太郎",
                    email="user@example.com",
                    roles={UserRoleType.SUPPORTER_MGR.key},
                    company=None,
                    job="部長",
                    supporter_organization_id={"7ac8bddf-88da-46c9-a504-a03d1661ad58"},
                    organization_name=None,
                    cognito_id=None,
                    last_login_at="2020-10-23T03:21:39.356000+0000",
                    otp_secret=None,
                    otp_verified_token="111111",
                    otp_verified_at=None,
                    disabled=False,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T03:21:39.356000+0000",
                    version=1,
                ),
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    service_manager_name="山田太郎",
                    main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=False,
                    is_solver_project=True,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="a9b67094-cdab-494c-818e-d4845088269b",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
            (
                # 支援者責任者, 自分の課の非公開案件
                AdminModel(
                    id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    data_type=DataType.ADMIN,
                    name="田中太郎",
                    email="user@example.com",
                    roles={UserRoleType.SUPPORTER_MGR.key},
                    company=None,
                    job="部長",
                    supporter_organization_id={"7ac8bddf-88da-46c9-a504-a03d1661ad58"},
                    organization_name=None,
                    cognito_id=None,
                    last_login_at="2020-10-23T03:21:39.356000+0000",
                    otp_secret=None,
                    otp_verified_token="111111",
                    otp_verified_at=None,
                    disabled=False,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T03:21:39.356000+0000",
                    version=1,
                ),
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    service_manager_name="山田太郎",
                    main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=True,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="a9b67094-cdab-494c-818e-d4845088269b",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
        ],
    )
    def test_auth_ok_supporter_mgr(
        self,
        mocker,
        mock_auth_admin,
        admin_model_get,
        project_model,
    ):
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])
        # mock_auth_adminのユーザ部分を上書き
        mock = mocker.patch.object(AdminModel, "get_admin_by_cognito_id")
        mock.return_value = admin_model_get

        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}", headers=REQUEST_HEADERS)
        assert response.status_code == 200

    @pytest.mark.parametrize(
        "admin_model_get, project_model",
        [
            (
                # 支援者責任者, 自分の課以外の非公開案件
                AdminModel(
                    id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    data_type=DataType.ADMIN,
                    name="田中太郎",
                    email="user@example.com",
                    roles={UserRoleType.SUPPORTER_MGR.key},
                    company=None,
                    job="部長",
                    supporter_organization_id={"180a3597-b7e7-42c8-902c-a29016afa662"},
                    organization_name=None,
                    cognito_id=None,
                    last_login_at="2020-10-23T03:21:39.356000+0000",
                    otp_secret=None,
                    otp_verified_token="111111",
                    otp_verified_at=None,
                    disabled=False,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T03:21:39.356000+0000",
                    version=1,
                ),
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    service_manager_name="山田太郎",
                    main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                    supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=True,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="a9b67094-cdab-494c-818e-d4845088269b",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
            (
                # 支援者責任者, 自分の課以外の非公開案件
                # (案件のsupporter_organization_idが空の場合)
                AdminModel(
                    id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    data_type=DataType.ADMIN,
                    name="田中太郎",
                    email="user@example.com",
                    roles={UserRoleType.SUPPORTER_MGR.key},
                    company=None,
                    job="部長",
                    supporter_organization_id={"180a3597-b7e7-42c8-902c-a29016afa662"},
                    organization_name=None,
                    cognito_id=None,
                    last_login_at="2020-10-23T03:21:39.356000+0000",
                    otp_secret=None,
                    otp_verified_token="111111",
                    otp_verified_at=None,
                    disabled=False,
                    create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    create_at="2020-10-23T03:21:39.356000+0000",
                    update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                    update_at="2020-10-23T03:21:39.356000+0000",
                    version=1,
                ),
                ProjectModel(
                    id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
                    data_type=DataType.PROJECT,
                    salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
                    customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
                    name="サンプルプロジェクト",
                    customer_name="ソニーグループ株式会社",
                    service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
                    create_new=True,
                    continued=True,
                    main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
                    contract_date="2021/01/30",
                    phase="プラン提示(D)",
                    customer_success="DXの実現",
                    support_date_from="2021/01/30",
                    support_date_to="2021/02/28",
                    profit=GrossProfitAttribute(
                        monthly=[
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                            400000,
                        ],
                        quarterly=[1200000, 1200000, 1200000, 1200000],
                        half=[2400000, 2400000],
                        year=4800000,
                    ),
                    total_contract_time=200,
                    main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
                    salesforce_main_customer=SalesforceMainCustomerAttribute(
                        name="山田太郎",
                        email="yamada@example.com",
                        organization_name="IST",
                        job="部長",
                    ),
                    customer_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    service_manager_name="山田太郎",
                    main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
                    supporter_organization_id="",
                    salesforce_main_supporter_user_name="山田太郎",
                    supporter_user_ids=set(
                        list(["c9b67094-cdab-494c-818e-d4845088269b"])
                    ),
                    salesforce_supporter_user_names=["山田太郎", "山田次郎"],
                    is_count_man_hour=True,
                    is_karte_remind=True,
                    is_master_karte_remind=True,
                    contract_type="有償",
                    is_secret=True,
                    create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
                    create_at="2022-05-23T16:34:21.523000+0000",
                    update_id="a9b67094-cdab-494c-818e-d4845088269b",
                    update_at="2022-05-23T16:34:21.523000+0000",
                    version=1,
                ),
            ),
        ],
    )
    def test_auth_error_supporter_mgr(
        self,
        mocker,
        mock_auth_admin,
        admin_model_get,
        project_model,
    ):
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])
        # mock_auth_adminのユーザ部分を上書き
        mock = mocker.patch.object(AdminModel, "get_admin_by_cognito_id")
        mock.return_value = admin_model_get

        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = project_model

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}", headers=REQUEST_HEADERS)
        assert response.status_code == 200

    def test_customer_not_found(self, mocker, mock_auth_admin):
        """案件が存在しない時のテスト"""
        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])

        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )
        mock = mocker.patch.object(ProjectModel, "get")
        mock.side_effect = DoesNotExist()

        response = client.get(f"/api/projects/{project_id}", headers=REQUEST_HEADERS)

        actual = response.json()
        assert response.status_code == 404
        assert actual["detail"] == "Not found"

    def test_400_service_type_not_exists(self, mocker, mock_auth_admin):
        """サービス区分の存在チェックエラー"""
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])

        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        mock_master_supporter.side_effect = DoesNotExist()
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=True,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="a9b67094-cdab-494c-818e-d4845088269b",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}", headers=REQUEST_HEADERS)
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'serviceType'], 'msg': 'Not exist.'}]"
        )

    def test_400_supporter_organization_id_not_exists(self, mocker, mock_auth_admin):
        """支援者組織（課）IDの存在チェックエラー"""
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])

        mocker.patch.object(MasterSupporterOrganizationModel, "get")
        mock_master_supporter = mocker.patch.object(ProjectService, "get_service_name")
        mock_master_supporter.side_effect = HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=[{"loc": ["body", "supporterOrganizationId"], "msg": "Not exist."}],
        )
        mock_get_customer_name = mocker.patch.object(
            ProjectService, "get_customer_name"
        )
        mock_get_customer_name.return_value = "組織開発"
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=True,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="a9b67094-cdab-494c-818e-d4845088269b",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}", headers=REQUEST_HEADERS)
        assert response.status_code == 400

    def test_400_main_sales_user_id_not_exists(self, mocker, mock_auth_admin):
        """営業担当者IDの存在チェックエラー"""
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])

        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            # main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            main_sales_user_id="xxxxxxxx-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=True,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="a9b67094-cdab-494c-818e-d4845088269b",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}", headers=REQUEST_HEADERS)
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'mainSalesUserId'], 'msg': 'Not exist.'}]"
        )

    def test_400_main_customer_user_id_not_exists(self, mocker, mock_auth_admin):
        """営業担当者IDの存在チェックエラー"""
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])

        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            # main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            main_customer_user_id="xxxxxxxx-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=True,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="a9b67094-cdab-494c-818e-d4845088269b",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}", headers=REQUEST_HEADERS)
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'mainCustomerUserId'], 'msg': 'Not exist.'}]"
        )

    def test_400_main_supporter_user_id_not_exists(
        self,
        mocker,
        mock_auth_admin,
    ):
        """メイン支援者（主担当）IDの存在チェックエラー"""
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])

        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            # main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            main_supporter_user_id="xxxxxxxx-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=True,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="a9b67094-cdab-494c-818e-d4845088269b",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}", headers=REQUEST_HEADERS)
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'mainSupporterUserId'], 'msg': 'Not exist.'}]"
        )

    def test_400_customer_users_not_exists(
        self,
        mocker,
        mock_auth_admin,
    ):
        """顧客メンバーIDの存在チェックエラー"""
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])

        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            # customer_user_ids=set(
            #     list(["c9b67094-cdab-494c-818e-d4845088269b"])
            # ),
            customer_user_ids=set(list(["xxxxxxxx-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            supporter_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=True,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="a9b67094-cdab-494c-818e-d4845088269b",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}", headers=REQUEST_HEADERS)
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'customerUsers'], 'msg': 'Not exist.'}]"
        )

    def test_400_supporter_users_not_exists(
        self,
        mocker,
        mock_auth_admin,
    ):
        """支援メンバー（副担当）IDの存在チェックエラー"""
        mock_auth_admin([UserRoleType.SYSTEM_ADMIN.key])

        mock_master_supporter = mocker.patch.object(
            MasterSupporterOrganizationModel, "get"
        )
        # mockで複数定義できないため、サービス種別と支援者組織を１つで定義
        mock_master_supporter.return_value = MasterSupporterOrganizationModel(
            id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
            name="組織開発",
            value="IST",
            attributes=None,
            order=1,
            use=True,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T04:21:39.356000+0000",
            version=1,
        )
        # MasterSupporterOrganizationModel(
        #     id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
        #     data_type=MasterDataType.MASTER_SERVICE_TYPE.value,
        #     name="組織開発",
        #     value=None,
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        # MasterSupporterOrganizationModel(
        #     id="2d82eff6-0af4-48a6-8036-9bec43db33e1",
        #     data_type=MasterDataType.MASTER_SUPPORTER_ORGANIZATION.value,
        #     name="Ideation Service Team",
        #     value="IST",
        #     attributes=None,
        #     order=1,
        #     use=True,
        #     create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     create_at="2020-10-23T03:21:39.356000+0000",
        #     update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
        #     update_at="2020-10-23T04:21:39.356000+0000",
        #     version=1,
        # ),
        mock_user = mocker.patch.object(UserModel, "batch_get")
        mock_user.return_value = [
            UserModel(
                id="a9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中太郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="b9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中次郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
            UserModel(
                id="c9b67094-cdab-494c-818e-d4845088269b",
                data_type=DataType.USER,
                name="田中三郎",
                email="user@example.com",
                role=UserRoleType.CUSTOMER,
                customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
                customer_name="ソニーグループ株式会社",
                job="部長",
                company=None,
                supporter_organization_id=None,
                is_input_man_hour=None,
                project_ids=None,
                cognito_id=None,
                agreed=False,
                last_login_at=None,
                disabled=False,
                create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                create_at="2020-10-23T03:21:39.356000+0000",
                update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
                update_at="2020-10-23T03:21:39.356000+0000",
                version=1,
            ),
        ]
        mock_user_get = mocker.patch.object(UserModel, "get")
        mock_user_get.return_value = UserModel(
            id="a9b67094-cdab-494c-818e-d4845088269b",
            data_type=DataType.USER,
            name="田中太郎",
            email="user@example.com",
            role=UserRoleType.CUSTOMER,
            customer_id="033bd0b5-c2c7-4778-a58d-76a46500f7d9",
            customer_name="ソニーグループ株式会社",
            job="部長",
            company=None,
            supporter_organization_id=None,
            is_input_man_hour=None,
            project_ids=None,
            cognito_id=None,
            agreed=False,
            last_login_at=None,
            disabled=False,
            create_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            create_at="2020-10-23T03:21:39.356000+0000",
            update_id="fa5c9f96-af22-bbc6-ac4e-cbcb25ad18e7",
            update_at="2020-10-23T03:21:39.356000+0000",
            version=1,
        )

        mock_project = mocker.patch.object(ProjectModel, "get")
        mock_project.return_value = ProjectModel(
            id="efba46d3-1d56-428b-ac6d-a51e263b54a8",
            data_type=DataType.PROJECT,
            salesforce_customer_id="c9b67094-cdab-494c-818e-d4845088269b",
            customer_id="3c648558-c450-42d7-9c4b-62e0f22dc0ff",
            name="サンプルプロジェクト",
            customer_name="ソニーグループ株式会社",
            service_type="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            create_new=True,
            continued=True,
            main_sales_user_id="a9b67094-cdab-494c-818e-d4845088269b",
            contract_date="2021/01/30",
            phase="プラン提示(D)",
            customer_success="DXの実現",
            support_date_from="2021/01/30",
            support_date_to="2021/02/28",
            profit=GrossProfitAttribute(
                monthly=[
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                    400000,
                ],
                quarterly=[1200000, 1200000, 1200000, 1200000],
                half=[2400000, 2400000],
                year=4800000,
            ),
            total_contract_time=200,
            main_customer_user_id="b9b67094-cdab-494c-818e-d4845088269b",
            salesforce_main_customer=SalesforceMainCustomerAttribute(
                name="山田太郎",
                email="yamada@example.com",
                organization_name="IST",
                job="部長",
            ),
            customer_user_ids=set(list(["c9b67094-cdab-494c-818e-d4845088269b"])),
            service_manager_name="山田太郎",
            main_supporter_user_id="c9b67094-cdab-494c-818e-d4845088269b",
            supporter_organization_id="7ac8bddf-88da-46c9-a504-a03d1661ad58",
            salesforce_main_supporter_user_name="山田太郎",
            # supporter_user_ids=set(
            #     list(["c9b67094-cdab-494c-818e-d4845088269b"])
            # ),
            supporter_user_ids=set(list(["xxxxxxxx-cdab-494c-818e-d4845088269b"])),
            salesforce_supporter_user_names=["山田太郎", "山田次郎"],
            is_count_man_hour=True,
            is_karte_remind=True,
            is_master_karte_remind=True,
            contract_type="有償",
            is_secret=False,
            is_solver_project=True,
            create_id="998c3cd7-63b5-453f-9de2-5af21d565b98",
            create_at="2022-05-23T16:34:21.523000+0000",
            update_id="a9b67094-cdab-494c-818e-d4845088269b",
            update_at="2022-05-23T16:34:21.523000+0000",
            version=1,
        )

        project_id = "12cbe2ed-f44c-4a1c-9408-c67b0ca2270d"

        response = client.get(f"/api/projects/{project_id}", headers=REQUEST_HEADERS)
        actual = response.json()
        assert response.status_code == 400
        assert (
            actual["detail"]
            == "[{'loc': ['body', 'supporterUsers'], 'msg': 'Not exist.'}]"
        )
